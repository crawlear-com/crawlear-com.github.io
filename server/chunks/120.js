exports.id=120,exports.ids=[120],exports.modules={27749:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addAdminServicesToServer=t.registerAdminService=void 0;let n=[];function r(e,t){n.push({getServiceDefinition:e,getHandlers:t})}function i(e){for(let{getServiceDefinition:t,getHandlers:r}of n)e.addService(t(),r())}t.registerAdminService=r,t.addAdminServicesToServer=i},1742:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackoffTimeout=void 0;let n=1e3,r=1.6,i=12e4,s=.2;function o(e,t){return Math.random()*(t-e)+e}class a{constructor(e,t){this.callback=e,this.initialDelay=n,this.multiplier=r,this.maxDelay=i,this.jitter=s,this.running=!1,this.hasRef=!0,this.startTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,n;clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null===(n=(t=this.timerId).unref)||void 0===n||n.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+o(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null===(t=(e=this.timerId).ref)||void 0===t||t.call(e)}unref(){var e,t;this.hasRef=!1,null===(t=(e=this.timerId).unref)||void 0===t||t.call(e)}}t.BackoffTimeout=a},65797:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallCredentialsFilterFactory=t.CallCredentialsFilter=void 0;let r=n(53223),i=n(19572),s=n(55541);class o extends r.BaseFilter{constructor(e,t){var n,r;super(),this.channel=e,this.stream=t,this.channel=e,this.stream=t;let i=t.getMethod().split("/"),o="";i.length>=2&&(o=i[1]);let a=null!==(r=null===(n=s.splitHostPort(t.getHost()))||void 0===n?void 0:n.host)&&void 0!==r?r:"localhost";this.serviceUrl=`https://${a}/${o}`}async sendMetadata(e){let t=this.stream.getCredentials().generateMetadata({service_url:this.serviceUrl}),n=await e;try{n.merge(await t)}catch(e){return this.stream.cancelWithStatus(i.Status.UNAUTHENTICATED,`Failed to retrieve auth metadata with error: ${e.message}`),Promise.reject("Failed to retrieve auth metadata")}return n.get("authorization").length>1?(this.stream.cancelWithStatus(i.Status.INTERNAL,'"authorization" metadata cannot have multiple values'),Promise.reject('"authorization" metadata cannot have multiple values')):n}}t.CallCredentialsFilter=o;class a{constructor(e){this.channel=e,this.channel=e}createFilter(e){return new o(this.channel,e)}}t.CallCredentialsFilterFactory=a},45402:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallCredentials=void 0;let r=n(6281);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new a(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,n)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((n,r)=>{e.getRequestMetadata(t.service_url,(e,t)=>{if(e){r(e);return}n(t)})})).then(e=>{let t=new r.Metadata;for(let n of Object.keys(e))t.add(n,e[n]);n(null,t)},e=>{n(e)})})}static createEmpty(){return new l}}t.CallCredentials=s;class o extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new r.Metadata;for(let n of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(n);return t}compose(e){return new o(this.creds.concat([e]))}_equals(e){return this===e||e instanceof o&&this.creds.every((t,n)=>t._equals(e.creds[n]))}}class a extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,n)=>{this.metadataGenerator(e,(e,r)=>{void 0!==r?t(r):n(e)})})}compose(e){return new o([this,e])}_equals(e){return this===e||e instanceof a&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new r.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},89502:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2CallStream=t.InterceptingListenerImpl=t.isInterceptingListener=void 0;let r=n(85158),i=n(22037),s=n(19572),o=n(6281),a=n(80615),l=n(25792),u=n(19572),c="call_stream",{HTTP2_HEADER_STATUS:h,HTTP2_HEADER_CONTENT_TYPE:d,NGHTTP2_CANCEL:p}=r.constants;function f(e){for(let[t,n]of Object.entries(i.constants.errno))if(n===e)return t;return"Unknown system error "+e}function g(e){let t=1/0;for(let n of e){let e=n instanceof Date?n.getTime():n;e<t&&(t=e)}return t}function m(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length}t.isInterceptingListener=m;class y{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}t.InterceptingListenerImpl=y;class v{constructor(e,t,n,r,i,l){this.methodName=e,this.channel=t,this.options=n,this.channelCallCredentials=i,this.callNumber=l,this.http2Stream=null,this.pendingRead=!1,this.isWriteFilterPending=!1,this.pendingWrite=null,this.pendingWriteCallback=null,this.writesClosed=!1,this.decoder=new a.StreamDecoder,this.isReadFilterPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.unfilteredReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.subchannel=null,this.listener=null,this.internalError=null,this.configDeadline=1/0,this.statusWatchers=[],this.streamEndWatchers=[],this.callStatsTracker=null,this.filterStack=r.createFilter(this),this.credentials=i,this.disconnectListener=()=>{this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new o.Metadata})},this.options.parentCall&&this.options.flags&s.Propagate.CANCELLATION&&this.options.parentCall.on("cancelled",()=>{this.cancelWithStatus(s.Status.CANCELLED,"Cancelled by parent call")})}outputStatus(){var e;if(this.listener&&!this.statusOutput){this.statusOutput=!0;let t=this.filterStack.receiveTrailers(this.finalStatus);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null===(e=this.listener)||void 0===e||e.onReceiveStatus(t)}),null===(e=this.http2Stream)||void 0===e||e.resume(),this.subchannel&&(this.subchannel.callUnref(),this.subchannel.removeDisconnectListener(this.disconnectListener))}}trace(e){l.trace(u.LogVerbosity.DEBUG,c,"["+this.callNumber+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null!==this.finalStatus&&(this.finalStatus.code!==s.Status.OK||this.readsClosed&&0===this.unpushedReadMessages.length&&0===this.unfilteredReadMessages.length&&!this.isReadFilterPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,process.nextTick(()=>{var t;this.statusOutput||(null===(t=this.listener)||void 0===t||t.onReceiveMessage(e),this.maybeOutputStatus())})}handleFilterError(e){this.cancelWithStatus(s.Status.INTERNAL,e.message)}handleFilteredRead(e){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.maybeOutputStatus();return}if(this.isReadFilterPending=!1,this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e)),this.unfilteredReadMessages.length>0){let e=this.unfilteredReadMessages.shift();this.filterReceivedMessage(e)}}filterReceivedMessage(e){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.maybeOutputStatus();return}this.trace("filterReceivedMessage of length "+e.length),this.isReadFilterPending=!0,this.filterStack.receiveMessage(Promise.resolve(e)).then(this.handleFilteredRead.bind(this),this.handleFilterError.bind(this))}tryPush(e){this.isReadFilterPending?(this.trace("unfilteredReadMessages.push message of length "+(e&&e.length)),this.unfilteredReadMessages.push(e)):this.filterReceivedMessage(e)}handleTrailers(e){let t;this.streamEndWatchers.forEach(e=>e(!0));let n="";for(let t of Object.keys(e))n+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+n);try{t=o.Metadata.fromHttp2Headers(e)}catch(e){t=new o.Metadata}let r=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof r["grpc-status"]){let e=Number(r["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let a="";if("string"==typeof r["grpc-message"]){try{a=decodeURI(r["grpc-message"])}catch(e){a=r["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+a+'" from server')}let l={code:i,details:a,metadata:t};this.endCall(l)}writeMessageToStream(e,t){var n;null===(n=this.callStatsTracker)||void 0===n||n.addMessageSent(),this.http2Stream.write(e,t)}attachHttp2Stream(e,t,n,i){if(this.filterStack.push(n),null!==this.finalStatus)e.close(p);else{if(this.trace("attachHttp2Stream from subchannel "+t.getAddress()),this.http2Stream=e,this.subchannel=t,this.callStatsTracker=i,t.addDisconnectListener(this.disconnectListener),t.callRef(),e.on("response",(e,t)=>{var n;let i="";for(let t of Object.keys(e))i+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+i),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&r.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=o.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new o.Metadata});return}try{let e=this.filterStack.receiveMetadata(t);null===(n=this.listener)||void 0===n||n.onReceiveMetadata(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new o.Metadata})}}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{if(!this.statusOutput)for(let t of(this.trace("receive HTTP/2 data frame of length "+e.length),this.decoder.write(e)))this.trace("parsed message of length "+t.length),this.callStatsTracker.addMessageReceived(),this.tryPush(t)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let n;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null===(t=this.finalStatus)||void 0===t?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case r.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;n=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case r.constants.NGHTTP2_REFUSED_STREAM:n=s.Status.UNAVAILABLE,i="Stream refused by server";break;case r.constants.NGHTTP2_CANCEL:n=s.Status.CANCELLED,i="Call cancelled";break;case r.constants.NGHTTP2_ENHANCE_YOUR_CALM:n=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case r.constants.NGHTTP2_INADEQUATE_SECURITY:n=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case r.constants.NGHTTP2_INTERNAL_ERROR:n=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(n=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:n=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:n,details:i,metadata:new o.Metadata})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+f(e.errno)+" syscall="+e.syscall),this.internalError=e),this.streamEndWatchers.forEach(e=>e(!1))}),this.pendingWrite){if(!this.pendingWriteCallback)throw Error("Invalid state in write handling code");this.trace("sending data chunk of length "+this.pendingWrite.length+" (deferred)");try{this.writeMessageToStream(this.pendingWrite,this.pendingWriteCallback)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new o.Metadata})}}this.maybeCloseWrites()}}start(e,t){this.trace("Sending metadata"),this.listener=t,this.channel._startCallStream(this,e),this.maybeOutputStatus()}destroyHttp2Stream(){var e;if(null!==this.http2Stream&&!this.http2Stream.destroyed){let t;t=(null===(e=this.finalStatus)||void 0===e?void 0:e.code)===s.Status.OK?r.constants.NGHTTP2_NO_ERROR:r.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new o.Metadata})}getDeadline(){let e=[this.options.deadline];return this.options.parentCall&&this.options.flags&s.Propagate.DEADLINE&&e.push(this.options.parentCall.getDeadline()),this.configDeadline&&e.push(this.configDeadline),g(e)}getCredentials(){return this.credentials}setCredentials(e){this.credentials=this.channelCallCredentials.compose(e)}getStatus(){return this.finalStatus}getPeer(){var e,t;return null!==(t=null===(e=this.subchannel)||void 0===e?void 0:e.getAddress())&&void 0!==t?t:this.channel.getTarget()}getMethod(){return this.methodName}getHost(){return this.options.host}setConfigDeadline(e){this.configDeadline=e}addStatusWatcher(e){this.statusWatchers.push(e)}addStreamEndWatcher(e){this.streamEndWatchers.push(e)}addFilters(e){this.filterStack.push(e)}getCallNumber(){return this.callNumber}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,null===this.http2Stream)this.pendingRead=!0;else{if(this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}}maybeCloseWrites(){this.writesClosed&&!this.isWriteFilterPending&&null!==this.http2Stream&&(this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end())}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},r=t=>{var n,r;let i=s.Status.UNAVAILABLE;(null===(n=t)||void 0===n?void 0:n.code)==="ERR_STREAM_WRITE_AFTER_END"&&(i=s.Status.INTERNAL),t&&this.cancelWithStatus(i,`Write error: ${t.message}`),null===(r=e.callback)||void 0===r||r.call(e)};this.isWriteFilterPending=!0,this.filterStack.sendMessage(Promise.resolve(n)).then(e=>{if(this.isWriteFilterPending=!1,null===this.http2Stream)this.trace("deferring writing data chunk of length "+e.message.length),this.pendingWrite=e.message,this.pendingWriteCallback=r;else{this.trace("sending data chunk of length "+e.message.length);try{this.writeMessageToStream(e.message,r)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new o.Metadata})}this.maybeCloseWrites()}},this.handleFilterError.bind(this))}halfClose(){this.trace("end() called"),this.writesClosed=!0,this.maybeCloseWrites()}}t.Http2CallStream=v},7639:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientDuplexStreamImpl=t.ClientWritableStreamImpl=t.ClientReadableStreamImpl=t.ClientUnaryCallImpl=t.callErrorFromStatus=void 0;let r=n(82361),i=n(12781),s=n(19572);function o(e,t){let n=`${e.code} ${s.Status[e.code]}: ${e.details}`,r=Error(n),i=`${r.stack}
for call at
${t}`;return Object.assign(Error(n),e,{stack:i})}t.callErrorFromStatus=o;class a extends r.EventEmitter{constructor(){super()}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}}t.ClientUnaryCallImpl=a;class l extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){var t;null===(t=this.call)||void 0===t||t.startRead()}}t.ClientReadableStreamImpl=l;class u extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_write(e,t,n){var r;let i={callback:n},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(r=this.call)||void 0===r||r.sendMessageWithContext(i,e)}_final(e){var t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientWritableStreamImpl=u;class c extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){var t;null===(t=this.call)||void 0===t||t.startRead()}_write(e,t,n){var r;let i={callback:n},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(r=this.call)||void 0===r||r.sendMessageWithContext(i,e)}_final(e){var t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientDuplexStreamImpl=c},70499:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelCredentials=void 0;let r=n(24404),i=n(45402),s=n(80606);function o(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class a{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,n,i){var a;if(o(e,"Root certificate"),o(t,"Private key"),o(n,"Certificate chain"),t&&!n)throw Error("Private key must be given with accompanying certificate chain");if(!t&&n)throw Error("Certificate chain must be given with accompanying private key");return new u(r.createSecureContext({ca:null!==(a=null!=e?e:s.getDefaultRootsData())&&void 0!==a?a:void 0,key:null!=t?t:void 0,cert:null!=n?n:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new u(e,null!=t?t:{})}static createInsecure(){return new l}}t.ChannelCredentials=a;class l extends a{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class u extends a{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new c(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class c extends a{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new c(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},89455:(e,t)=>{"use strict";function n(e,t){let n=Object.keys(e).sort(),r=Object.keys(t).sort();if(n.length!==r.length)return!1;for(let i=0;i<n.length;i+=1)if(n[i]!==r[i]||e[n[i]]!==t[r[i]])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.channelOptionsEqual=t.recognizedOptions=void 0,t.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc-node.max_session_memory":!0},t.channelOptionsEqual=n},39452:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelImplementation=void 0;let r=n(89502),i=n(70499),s=n(77661),o=n(87328),a=n(2352),l=n(19572),u=n(59386),c=n(65797),h=n(12899),d=n(16289),p=n(84063),f=n(25792),g=n(82313),m=n(85242),y=n(55541),v=n(72409),_=n(65962),b=2147483647,S=0;function w(){let e=S;return(S+=1)>=Number.MAX_SAFE_INTEGER&&(S=0),e}let T=[l.Status.OK,l.Status.INVALID_ARGUMENT,l.Status.NOT_FOUND,l.Status.ALREADY_EXISTS,l.Status.FAILED_PRECONDITION,l.Status.ABORTED,l.Status.OUT_OF_RANGE,l.Status.DATA_LOSS];function E(e,t){return T.includes(e)?{code:l.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${l.Status[e]} ${t}`}:{code:e,details:t}}class C{constructor(e,t,n){var r,S,w,T;if(this.credentials=t,this.options=n,this.connectivityState=v.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.channelzEnabled=!0,this.callTracker=new _.ChannelzCallTracker,this.childrenTracker=new _.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof i.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(n&&"object"!=typeof n)throw TypeError("Channel options must be an object");this.originalTarget=e;let C=y.parseUri(e);if(null===C)throw Error(`Could not parse target name "${e}"`);let I=p.mapUriDefaultScheme(C);if(null===I)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},b),null===(S=(r=this.callRefTimer).unref)||void 0===S||S.call(r),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new _.ChannelzTrace,this.channelzRef=_.registerChannelzChannel(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=p.getDefaultAuthority(I);let k=m.mapProxyName(I,n);this.target=k.target,this.options=Object.assign({},this.options,k.extraOptions),this.subchannelPool=o.getSubchannelPool((null!==(w=n["grpc.use_local_subchannel_pool"])&&void 0!==w?w:0)===0);let R={createSubchannel:(e,t)=>{let n=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);return this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",n.getChannelzRef()),n},updateState:(e,t)=>{this.currentPicker=t;let n=this.pickQueue.slice();for(let{callStream:e,callMetadata:t,callConfig:r,dynamicFilters:i}of(this.pickQueue=[],this.callRefTimerUnref(),n))this.tryPick(e,t,r,i);this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new s.ResolvingLoadBalancer(this.target,R,n,e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=e,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let{callStream:t,callMetadata:n}of(this.configSelectionQueue=[],this.callRefTimerUnref(),e))this.tryGetConfig(t,n);this.configSelectionQueue=[]})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},E(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let{callStream:n,callMetadata:r}of(this.configSelectionQueue=[],this.callRefTimerUnref(),t))r.getOptions().waitForReady?(this.callRefTimerRef(),this.configSelectionQueue.push({callStream:n,callMetadata:r})):n.cancelWithStatus(e.code,e.details)}),this.filterStackFactory=new u.FilterStackFactory([new c.CallCredentialsFilterFactory(this),new h.DeadlineFilterFactory(this),new g.MaxMessageSizeFilterFactory(this.options),new d.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(n,void 0,2));let O=Error();f.trace(l.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null===(T=O.stack)||void 0===T?void 0:T.substring(O.stack.indexOf("\n")+1)))}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){f.trace(null!=t?t:l.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+y.uriToString(this.target)+" "+e)}callRefTimerRef(){var e,t,n,r;(null===(t=(e=this.callRefTimer).hasRef)||void 0===t?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(r=(n=this.callRefTimer).ref)||void 0===r||r.call(n))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(t=(e=this.callRefTimer).unref)||void 0===t||t.call(e))}pushPick(e,t,n,r){this.pickQueue.push({callStream:e,callMetadata:t,callConfig:n,dynamicFilters:r}),this.callRefTimerRef()}tryPick(e,t,n,r){var i,s;let o=this.currentPicker.pick({metadata:t,extraPickInfo:n.pickInformation}),u=o.subchannel?"("+o.subchannel.getChannelzRef().id+") "+o.subchannel.getAddress():""+o.subchannel;switch(this.trace("Pick result for call ["+e.getCallNumber()+"]: "+a.PickResultType[o.pickResultType]+" subchannel: "+u+" status: "+(null===(i=o.status)||void 0===i?void 0:i.code)+" "+(null===(s=o.status)||void 0===s?void 0:s.details)),o.pickResultType){case a.PickResultType.COMPLETE:if(null===o.subchannel)e.cancelWithStatus(l.Status.UNAVAILABLE,"Request dropped by load balancing policy");else{if(o.subchannel.getConnectivityState()!==v.ConnectivityState.READY){f.log(l.LogVerbosity.ERROR,"Error: COMPLETE pick result subchannel "+u+" has state "+v.ConnectivityState[o.subchannel.getConnectivityState()]),this.pushPick(e,t,n,r);break}e.filterStack.sendMetadata(Promise.resolve(t.clone())).then(i=>{var s,a,c;let h=o.subchannel.getConnectivityState();if(h===v.ConnectivityState.READY)try{let t=o.extraFilterFactories.map(t=>t.createFilter(e));null===(s=o.subchannel)||void 0===s||s.getRealSubchannel().startCallStream(i,e,[...r,...t]),null===(a=n.onCommitted)||void 0===a||a.call(n),null===(c=o.onCallStarted)||void 0===c||c.call(o)}catch(s){let i=s.code;"ERR_HTTP2_GOAWAY_SESSION"===i||"ERR_HTTP2_INVALID_SESSION"===i?(this.trace("Failed to start call on picked subchannel "+u+" with error "+s.message+". Retrying pick",l.LogVerbosity.INFO),this.tryPick(e,t,n,r)):(this.trace("Failed to start call on picked subchanel "+u+" with error "+s.message+". Ending call",l.LogVerbosity.INFO),e.cancelWithStatus(l.Status.INTERNAL,`Failed to start HTTP/2 stream with error: ${s.message}`))}else this.trace("Picked subchannel "+u+" has state "+v.ConnectivityState[h]+" after metadata filters. Retrying pick",l.LogVerbosity.INFO),this.tryPick(e,t,n,r)},t=>{let{code:n,details:r}=E("number"==typeof t.code?t.code:l.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${t.message}`);e.cancelWithStatus(n,r)})}break;case a.PickResultType.QUEUE:this.pushPick(e,t,n,r);break;case a.PickResultType.TRANSIENT_FAILURE:if(t.getOptions().waitForReady)this.pushPick(e,t,n,r);else{let{code:t,details:n}=E(o.status.code,o.status.details);e.cancelWithStatus(t,n)}break;case a.PickResultType.DROP:let{code:c,details:h}=E(o.status.code,o.status.details);e.cancelWithStatus(c,h);break;default:throw Error(`Invalid state: unknown pickResultType ${o.pickResultType}`)}}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of(f.trace(l.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+y.uriToString(this.target)+" "+v.ConnectivityState[this.connectivityState]+" -> "+v.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO",v.ConnectivityState[this.connectivityState]+" -> "+v.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==v.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}tryGetConfig(e,t){if(null===e.getStatus()){if(null===this.configSelector)this.resolvingLoadBalancer.exitIdle(),this.currentResolutionError&&!t.getOptions().waitForReady?e.cancelWithStatus(this.currentResolutionError.code,this.currentResolutionError.details):(this.configSelectionQueue.push({callStream:e,callMetadata:t}),this.callRefTimerRef());else{let n=this.configSelector(e.getMethod(),t);if(n.status===l.Status.OK){if(n.methodConfig.timeout){let t=new Date;t.setSeconds(t.getSeconds()+n.methodConfig.timeout.seconds),t.setMilliseconds(t.getMilliseconds()+n.methodConfig.timeout.nanos/1e6),e.setConfigDeadline(t),e.filterStack.refresh()}if(n.dynamicFilterFactories.length>0){let r=new u.FilterStackFactory(n.dynamicFilterFactories).createFilter(e);r.sendMetadata(Promise.resolve(t)).then(t=>{this.tryPick(e,t,n,r.getFilters())})}else this.tryPick(e,t,n,[])}else{let{code:t,details:r}=E(n.status,"Failed to route call to method "+e.getMethod());e.cancelWithStatus(t,r)}}}}_startCallStream(e,t){this.tryGetConfig(e,t.clone())}close(){this.resolvingLoadBalancer.destroy(),this.updateState(v.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.channelzEnabled&&_.unregisterChannelzRef(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return y.uriToString(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&this.resolvingLoadBalancer.exitIdle(),t}watchConnectivityState(e,t,n){if(this.connectivityState===v.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let r=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s){process.nextTick(n,Error("Deadline passed without connectivity state change"));return}r=setTimeout(()=>{this.removeConnectivityStateWatcher(i),n(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:n,timer:r};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,n,i,s){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===v.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let o=w();this.trace("createCall ["+o+'] method="'+e+'", deadline='+t);let a={deadline:t,flags:null!=s?s:l.Propagate.DEFAULTS,host:null!=n?n:this.defaultAuthority,parentCall:i},u=new r.Http2CallStream(e,this,a,this.filterStackFactory,this.credentials._getCallCredentials(),o);return this.channelzEnabled&&(this.callTracker.addCallStarted(),u.addStatusWatcher(e=>{e.code===l.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()})),u}}t.ChannelImplementation=C},65962:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.getChannelzServiceDefinition=t.getChannelzHandlers=t.unregisterChannelzRef=t.registerChannelzSocket=t.registerChannelzServer=t.registerChannelzSubchannel=t.registerChannelzChannel=t.ChannelzCallTracker=t.ChannelzChildrenTracker=t.ChannelzTrace=void 0;let r=n(41808),i=n(72409),s=n(19572),o=n(74955),a=n(27749),l=n(54529);function u(e){return{channel_id:e.id,name:e.name}}function c(e){return{subchannel_id:e.id,name:e.name}}function h(e){return{server_id:e.id}}function d(e){return{socket_id:e.id,name:e.name}}let p=32;class f{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,n){let r=new Date;this.events.push({description:t,severity:e,timestamp:r,childChannel:(null==n?void 0:n.kind)==="channel"?n:void 0,childSubchannel:(null==n?void 0:n.kind)==="subchannel"?n:void 0}),this.events.length>=2*p&&(this.events=this.events.slice(p)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:x(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:x(e.timestamp),channel_ref:e.childChannel?u(e.childChannel):null,subchannel_ref:e.childSubchannel?c(e.childSubchannel):null}))}}}t.ChannelzTrace=f;class g{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,n,r;switch(e.kind){case"channel":{let n=null!==(t=this.channelChildren.get(e.id))&&void 0!==t?t:{ref:e,count:0};n.count+=1,this.channelChildren.set(e.id,n);break}case"subchannel":{let t=null!==(n=this.subchannelChildren.get(e.id))&&void 0!==n?n:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!==(r=this.socketChildren.get(e.id))&&void 0!==r?r:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let n=[];for(let{ref:e}of this.socketChildren.values())n.push(e);return{channels:e,subchannels:t,sockets:n}}}t.ChannelzChildrenTracker=g;class m{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}t.ChannelzCallTracker=m;let y=1;function v(){return y++}let _=[],b=[],S=[],w=[];function T(e,t,n){let r=v(),i={id:r,name:e,kind:"channel"};return n&&(_[r]={ref:i,getInfo:t}),i}function E(e,t,n){let r=v(),i={id:r,name:e,kind:"subchannel"};return n&&(b[r]={ref:i,getInfo:t}),i}function C(e,t){let n=v(),r={id:n,kind:"server"};return t&&(S[n]={ref:r,getInfo:e}),r}function I(e,t,n){let r=v(),i={id:r,name:e,kind:"socket"};return n&&(w[r]={ref:i,getInfo:t}),i}function k(e){switch(e.kind){case"channel":delete _[e.id];return;case"subchannel":delete b[e.id];return;case"server":delete S[e.id];return;case"socket":delete w[e.id];return}}function R(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function O(e){return""===e?[]:[].concat(...e.split(":").map(e=>R(e)))}function N(e){if(r.isIPv4(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!r.isIPv6(e))return null;{let t,n;let r=e.indexOf("::");-1===r?(t=e,n=""):(t=e.substring(0,r),n=e.substring(r+2));let i=Buffer.from(O(t)),s=Buffer.from(O(n)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}}function A(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function x(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function D(e){let t=e.getInfo();return{ref:u(e.ref),data:{target:t.target,state:A(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:x(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>u(e)),subchannel_ref:t.children.subchannels.map(e=>c(e))}}function P(e,t){let n=Number.parseInt(e.request.channel_id),r=_[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+n});return}t(null,{channel:D(r)})}function M(e,t){let n=Number.parseInt(e.request.max_results),r=[],i=Number.parseInt(e.request.start_channel_id);for(;i<_.length;i++){let e=_[i];if(void 0!==e&&(r.push(D(e)),r.length>=n))break}t(null,{channel:r,end:i>=S.length})}function L(e){let t=e.getInfo();return{ref:h(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:x(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>d(e))}}function F(e,t){let n=Number.parseInt(e.request.server_id),r=S[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+n});return}t(null,{server:L(r)})}function B(e,t){let n=Number.parseInt(e.request.max_results),r=[],i=Number.parseInt(e.request.start_server_id);for(;i<S.length;i++){let e=S[i];if(void 0!==e&&(r.push(L(e)),r.length>=n))break}t(null,{server:r,end:i>=S.length})}function j(e,t){let n=Number.parseInt(e.request.subchannel_id),r=b[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+n});return}let i=r.getInfo();t(null,{subchannel:{ref:c(r.ref),data:{target:i.target,state:A(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:x(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>d(e))}})}function U(e){var t;return o.isTcpSubchannelAddress(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!==(t=N(e.host))&&void 0!==t?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function q(e,t){var n,r,i,o,a;let l=Number.parseInt(e.request.socket_id),u=w[l];if(void 0===u){t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});return}let c=u.getInfo(),h=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!==(n=c.security.cipherSuiteStandardName)&&void 0!==n?n:void 0,other_name:null!==(r=c.security.cipherSuiteOtherName)&&void 0!==r?r:void 0,local_certificate:null!==(i=c.security.localCertificate)&&void 0!==i?i:void 0,remote_certificate:null!==(o=c.security.remoteCertificate)&&void 0!==o?o:void 0}}:null;t(null,{socket:{ref:d(u.ref),local:c.localAddress?U(c.localAddress):null,remote:c.remoteAddress?U(c.remoteAddress):null,remote_name:null!==(a=c.remoteName)&&void 0!==a?a:void 0,security:h,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:x(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:x(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:x(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:x(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}}})}function V(e,t){let n=Number.parseInt(e.request.server_id),r=S[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+n});return}let i=Number.parseInt(e.request.start_socket_id),o=Number.parseInt(e.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],u=0;for(;u<a.length&&(!(a[u].id>=i)||(l.push(d(a[u])),!(l.length>=o)));u++);t(null,{socket_ref:l,end:u>=a.length})}function z(){return{GetChannel:P,GetTopChannels:M,GetServer:F,GetServers:B,GetSubchannel:j,GetSocket:q,GetServerSockets:V}}t.registerChannelzChannel=T,t.registerChannelzSubchannel=E,t.registerChannelzServer=C,t.registerChannelzSocket=I,t.unregisterChannelzRef=k,t.getChannelzHandlers=z;let W=null;function $(){if(W)return W;let e=(0,n(69361).J_)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return W=l.loadPackageDefinition(e).grpc.channelz.v1.Channelz.service}function G(){a.registerAdminService($,z)}t.getChannelzServiceDefinition=$,t.setup=G},61809:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInterceptingCall=t.InterceptingCall=t.RequesterBuilder=t.ListenerBuilder=t.InterceptorConfigurationError=void 0;let r=n(6281),i=n(89502),s=n(19572);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}t.InterceptorConfigurationError=o;class a{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}t.ListenerBuilder=a;class l{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}t.RequesterBuilder=l;let u={onReceiveMetadata:(e,t)=>{t(e)},onReceiveMessage:(e,t)=>{t(e)},onReceiveStatus:(e,t)=>{t(e)}},c={start:(e,t,n)=>{n(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class h{constructor(e,t){var n,r,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!==(n=t.start)&&void 0!==n?n:c.start,sendMessage:null!==(r=t.sendMessage)&&void 0!==r?r:c.sendMessage,halfClose:null!==(i=t.halfClose)&&void 0!==i?i:c.halfClose,cancel:null!==(s=t.cancel)&&void 0!==s?s:c.cancel}:this.requester=c}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var n,r,s,o,a,l;let c={onReceiveMetadata:null!==(r=null===(n=null==t?void 0:t.onReceiveMetadata)||void 0===n?void 0:n.bind(t))&&void 0!==r?r:e=>{},onReceiveMessage:null!==(o=null===(s=null==t?void 0:t.onReceiveMessage)||void 0===s?void 0:s.bind(t))&&void 0!==o?o:e=>{},onReceiveStatus:null!==(l=null===(a=null==t?void 0:t.onReceiveStatus)||void 0===a?void 0:a.bind(t))&&void 0!==l?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,c,(e,t)=>{var n,r,s;let o;if(this.processingMetadata=!1,i.isInterceptingListener(t))o=t;else{let e={onReceiveMetadata:null!==(n=t.onReceiveMetadata)&&void 0!==n?n:u.onReceiveMetadata,onReceiveMessage:null!==(r=t.onReceiveMessage)&&void 0!==r?r:u.onReceiveMessage,onReceiveStatus:null!==(s=t.onReceiveStatus)&&void 0!==s?s:u.onReceiveStatus};o=new i.InterceptingListenerImpl(e,c)}this.nextCall.start(e,o),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,n=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,n),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}setCredentials(e){this.nextCall.setCredentials(e)}}function d(e,t,n){var r,i;let s=null!==(r=n.deadline)&&void 0!==r?r:1/0,o=n.host,a=null!==(i=n.parent)&&void 0!==i?i:null,l=n.propagate_flags,u=n.credentials,c=e.createCall(t,s,o,a,l);return u&&c.setCredentials(u),c}t.InterceptingCall=h;class p{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}setCredentials(e){this.call.setCredentials(e)}sendMessageWithContext(e,t){let n;try{n=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${e.message}`);return}this.call.sendMessageWithContext(e,n)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let n=null;this.call.start(e,{onReceiveMetadata:e=>{var n;null===(n=null==t?void 0:t.onReceiveMetadata)||void 0===n||n.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){n={code:s.Status.INTERNAL,details:`Response message parsing error: ${e.message}`,metadata:new r.Metadata},this.call.cancelWithStatus(n.code,n.details);return}null===(i=null==t?void 0:t.onReceiveMessage)||void 0===i||i.call(t,o)},onReceiveStatus:e=>{var r,i;n?null===(r=null==t?void 0:t.onReceiveStatus)||void 0===r||r.call(t,n):null===(i=null==t?void 0:t.onReceiveStatus)||void 0===i||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class f extends p{constructor(e,t){super(e,t)}start(e,t){var n,r;let i=!1,s={onReceiveMetadata:null!==(r=null===(n=null==t?void 0:t.onReceiveMetadata)||void 0===n?void 0:n.bind(t))&&void 0!==r?r:e=>{},onReceiveMessage:e=>{var n;i=!0,null===(n=null==t?void 0:t.onReceiveMessage)||void 0===n||n.call(t,e)},onReceiveStatus:e=>{var n,r;i||null===(n=null==t?void 0:t.onReceiveMessage)||void 0===n||n.call(t,null),null===(r=null==t?void 0:t.onReceiveStatus)||void 0===r||r.call(t,e)}};super.start(e,s),this.call.startRead()}}class g extends p{}function m(e,t,n){let r=d(e,n.path,t);return n.responseStream?new g(r,n):new f(r,n)}function y(e,t,n,r){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},n,{method_definition:t});return i.reduceRight((e,t)=>n=>t(n,e),e=>m(r,e,t))(s)}t.getInterceptingCall=y},91865:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;let r=n(7639),i=n(39452),s=n(72409),o=n(19572),a=n(6281),l=n(61809),u=Symbol(),c=Symbol(),h=Symbol(),d=Symbol();function p(e){return"function"==typeof e}function f(e){return e.stack.split("\n").slice(1).join("\n")}class g{constructor(e,t,n={}){var r,s;if(n=Object.assign({},n),this[c]=null!==(r=n.interceptors)&&void 0!==r?r:[],delete n.interceptors,this[h]=null!==(s=n.interceptor_providers)&&void 0!==s?s:[],delete n.interceptor_providers,this[c].length>0&&this[h].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[d]=n.callInvocationTransformer,delete n.callInvocationTransformer,n.channelOverride)this[u]=n.channelOverride;else if(n.channelFactoryOverride){let r=n.channelFactoryOverride;delete n.channelFactoryOverride,this[u]=r(e,t,n)}else this[u]=new i.ChannelImplementation(e,t,n)}close(){this[u].close()}getChannel(){return this[u]}waitForReady(e,t){let n=r=>{let i;if(r){t(Error("Failed to connect before the deadline"));return}try{i=this[u].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[u].watchConnectivityState(i,e,n)}catch(e){t(Error("The channel has been closed"))}};setImmediate(n)}checkOptionalUnaryResponseArguments(e,t,n){if(p(e))return{metadata:new a.Metadata,options:{},callback:e};if(p(t))return e instanceof a.Metadata?{metadata:e,options:{},callback:t}:{metadata:new a.Metadata,options:e,callback:t};if(!(e instanceof a.Metadata&&t instanceof Object&&p(n)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:n}}makeUnaryRequest(e,t,n,i,s,a,p){var g,m;let y=this.checkOptionalUnaryResponseArguments(s,a,p),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:n},_={argument:i,metadata:y.metadata,call:new r.ClientUnaryCallImpl,channel:this[u],methodDefinition:v,callOptions:y.options,callback:y.callback};this[d]&&(_=this[d](_));let b=_.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(g=_.callOptions.interceptors)&&void 0!==g?g:[],callInterceptorProviders:null!==(m=_.callOptions.interceptor_providers)&&void 0!==m?m:[]},w=l.getInterceptingCall(S,_.methodDefinition,_.callOptions,_.channel);b.call=w,_.callOptions.credentials&&w.setCredentials(_.callOptions.credentials);let T=null,E=!1,C=Error();return w.start(_.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==T&&w.cancelWithStatus(o.Status.INTERNAL,"Too many responses received"),T=e},onReceiveStatus(e){if(!E){if(E=!0,e.code===o.Status.OK){if(null===T){let t=f(C);_.callback(r.callErrorFromStatus({code:o.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else _.callback(null,T)}else{let t=f(C);_.callback(r.callErrorFromStatus(e,t))}b.emit("status",e)}}}),w.sendMessage(i),w.halfClose(),b}makeClientStreamRequest(e,t,n,i,s,a){var p,g;let m=this.checkOptionalUnaryResponseArguments(i,s,a),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:n},v={metadata:m.metadata,call:new r.ClientWritableStreamImpl(t),channel:this[u],methodDefinition:y,callOptions:m.options,callback:m.callback};this[d]&&(v=this[d](v));let _=v.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(p=v.callOptions.interceptors)&&void 0!==p?p:[],callInterceptorProviders:null!==(g=v.callOptions.interceptor_providers)&&void 0!==g?g:[]},S=l.getInterceptingCall(b,v.methodDefinition,v.callOptions,v.channel);_.call=S,v.callOptions.credentials&&S.setCredentials(v.callOptions.credentials);let w=null,T=!1,E=Error();return S.start(v.metadata,{onReceiveMetadata:e=>{_.emit("metadata",e)},onReceiveMessage(e){null!==w&&S.cancelWithStatus(o.Status.INTERNAL,"Too many responses received"),w=e},onReceiveStatus(e){if(!T){if(T=!0,e.code===o.Status.OK){if(null===w){let t=f(E);v.callback(r.callErrorFromStatus({code:o.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,w)}else{let t=f(E);v.callback(r.callErrorFromStatus(e,t))}_.emit("status",e)}}}),_}checkMetadataAndOptions(e,t){let n,r;return e instanceof a.Metadata?(n=e,r=t||{}):(r=e||{},n=new a.Metadata),{metadata:n,options:r}}makeServerStreamRequest(e,t,n,i,s,a){var p,g;let m=this.checkMetadataAndOptions(s,a),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:n},v={argument:i,metadata:m.metadata,call:new r.ClientReadableStreamImpl(n),channel:this[u],methodDefinition:y,callOptions:m.options};this[d]&&(v=this[d](v));let _=v.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(p=v.callOptions.interceptors)&&void 0!==p?p:[],callInterceptorProviders:null!==(g=v.callOptions.interceptor_providers)&&void 0!==g?g:[]},S=l.getInterceptingCall(b,v.methodDefinition,v.callOptions,v.channel);_.call=S,v.callOptions.credentials&&S.setCredentials(v.callOptions.credentials);let w=!1,T=Error();return S.start(v.metadata,{onReceiveMetadata(e){_.emit("metadata",e)},onReceiveMessage(e){_.push(e)},onReceiveStatus(e){if(!w){if(w=!0,_.push(null),e.code!==o.Status.OK){let t=f(T);_.emit("error",r.callErrorFromStatus(e,t))}_.emit("status",e)}}}),S.sendMessage(i),S.halfClose(),_}makeBidiStreamRequest(e,t,n,i,s){var a,p;let g=this.checkMetadataAndOptions(i,s),m={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:n},y={metadata:g.metadata,call:new r.ClientDuplexStreamImpl(t,n),channel:this[u],methodDefinition:m,callOptions:g.options};this[d]&&(y=this[d](y));let v=y.call,_={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(a=y.callOptions.interceptors)&&void 0!==a?a:[],callInterceptorProviders:null!==(p=y.callOptions.interceptor_providers)&&void 0!==p?p:[]},b=l.getInterceptingCall(_,y.methodDefinition,y.callOptions,y.channel);v.call=b,y.callOptions.credentials&&b.setCredentials(y.callOptions.credentials);let S=!1,w=Error();return b.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!S){if(S=!0,v.push(null),e.code!==o.Status.OK){let t=f(w);v.emit("error",r.callErrorFromStatus(e,t))}v.emit("status",e)}}}),v}}t.Client=g},74334:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(n=t.CompressionAlgorithms||(t.CompressionAlgorithms={}))},16289:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionFilterFactory=t.CompressionFilter=void 0;let r=n(59796),i=n(74334),s=n(19572),o=n(53223),a=n(25792),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class u{async writeMessage(e,t){let n=e;t&&(n=await this.compressMessage(n));let r=Buffer.allocUnsafe(n.length+5);return r.writeUInt8(t?1:0,0),r.writeUInt32BE(n.length,1),n.copy(r,5),r}async readMessage(e){let t=1===e.readUInt8(0),n=e.slice(5);return t&&(n=await this.decompressMessage(n)),n}}class c extends u{async compressMessage(e){return e}async writeMessage(e,t){let n=Buffer.allocUnsafe(e.length+5);return n.writeUInt8(0,0),n.writeUInt32BE(e.length,1),e.copy(n,5),n}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class h extends u{compressMessage(e){return new Promise((t,n)=>{r.deflate(e,(e,r)=>{e?n(e):t(r)})})}decompressMessage(e){return new Promise((t,n)=>{r.inflate(e,(e,r)=>{e?n(e):t(r)})})}}class d extends u{compressMessage(e){return new Promise((t,n)=>{r.gzip(e,(e,r)=>{e?n(e):t(r)})})}decompressMessage(e){return new Promise((t,n)=>{r.unzip(e,(e,r)=>{e?n(e):t(r)})})}}class p extends u{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function f(e){switch(e){case"identity":return new c;case"deflate":return new h;case"gzip":return new d;default:return new p(e)}}class g extends o.BaseFilter{constructor(e,t){var n;super(),this.sharedFilterConfig=t,this.sendCompression=new c,this.receiveCompression=new c,this.currentCompressionAlgorithm="identity";let r=e["grpc.default_compression_algorithm"];if(void 0!==r){if(l(r)){let e=i.CompressionAlgorithms[r],s=null===(n=t.serverSupportedEncodingHeader)||void 0===n?void 0:n.split(",");(!s||s.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=f(this.currentCompressionAlgorithm))}else a.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${r}`)}}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=f(e))}e.remove("grpc-encoding");let n=e.get("grpc-accept-encoding")[0];return n&&(this.sharedFilterConfig.serverSupportedEncodingHeader=n,n.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new c,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let n;let r=await e;return n=!(this.sendCompression instanceof c)&&((null!==(t=r.flags)&&void 0!==t?t:0)&2)==0,{message:await this.sendCompression.writeMessage(r.message,n),flags:r.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}t.CompressionFilter=g;class m{constructor(e,t){this.channel=e,this.options=t,this.sharedFilterConfig={}}createFilter(e){return new g(this.options,this.sharedFilterConfig)}}t.CompressionFilterFactory=m},72409:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(n=t.ConnectivityState||(t.ConnectivityState={}))},19572:(e,t)=>{"use strict";var n,r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=t.Propagate=t.LogVerbosity=t.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(n=t.Status||(t.Status={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(r=t.LogVerbosity||(t.LogVerbosity={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(i=t.Propagate||(t.Propagate={})),t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},12899:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeadlineFilterFactory=t.DeadlineFilter=void 0;let r=n(19572),i=n(53223),s=[["m",1],["S",1e3],["M",6e4],["H",36e5]];function o(e){let t=Math.max(e-new Date().getTime(),0);for(let[e,n]of s){let r=t/n;if(r<1e8)return String(Math.ceil(r))+e}throw Error("Deadline is too far in the future")}class a extends i.BaseFilter{constructor(e,t){super(),this.channel=e,this.callStream=t,this.timer=null,this.deadline=1/0,this.retreiveDeadline(),this.runTimer()}retreiveDeadline(){let e=this.callStream.getDeadline();e instanceof Date?this.deadline=e.getTime():this.deadline=e}runTimer(){var e,t;this.timer&&clearTimeout(this.timer);let n=new Date().getTime(),i=this.deadline-n;i<=0?process.nextTick(()=>{this.callStream.cancelWithStatus(r.Status.DEADLINE_EXCEEDED,"Deadline exceeded")}):this.deadline!==1/0&&(this.timer=setTimeout(()=>{this.callStream.cancelWithStatus(r.Status.DEADLINE_EXCEEDED,"Deadline exceeded")},i),null===(t=(e=this.timer).unref)||void 0===t||t.call(e))}refresh(){this.retreiveDeadline(),this.runTimer()}async sendMetadata(e){if(this.deadline===1/0)return e;let t=await e,n=o(this.deadline);return t.set("grpc-timeout",n),t}receiveTrailers(e){return this.timer&&clearTimeout(this.timer),e}}t.DeadlineFilter=a;class l{constructor(e){this.channel=e}createFilter(e){return new a(this.channel,e)}}t.DeadlineFilterFactory=l},87974:(e,t)=>{"use strict";function n(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}}function r(e){return 1e3*e.seconds+e.nanos/1e6|0}function i(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}Object.defineProperty(t,"__esModule",{value:!0}),t.isDuration=t.durationToMs=t.msToDuration=void 0,t.msToDuration=n,t.durationToMs=r,t.isDuration=i},38779:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25792);Object.defineProperty(t,"trace",{enumerable:!0,get:function(){return r.trace}}),Object.defineProperty(t,"log",{enumerable:!0,get:function(){return r.log}});var i=n(84063);Object.defineProperty(t,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}});var s=n(55541);Object.defineProperty(t,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var o=n(87974);Object.defineProperty(t,"durationToMs",{enumerable:!0,get:function(){return o.durationToMs}});var a=n(1742);Object.defineProperty(t,"BackoffTimeout",{enumerable:!0,get:function(){return a.BackoffTimeout}});var l=n(69884);Object.defineProperty(t,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(t,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(t,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(t,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var u=n(74955);Object.defineProperty(t,"subchannelAddressToString",{enumerable:!0,get:function(){return u.subchannelAddressToString}});var c=n(56372);Object.defineProperty(t,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c.ChildLoadBalancerHandler}});var h=n(2352);Object.defineProperty(t,"UnavailablePicker",{enumerable:!0,get:function(){return h.UnavailablePicker}}),Object.defineProperty(t,"QueuePicker",{enumerable:!0,get:function(){return h.QueuePicker}}),Object.defineProperty(t,"PickResultType",{enumerable:!0,get:function(){return h.PickResultType}});var d=n(53223);Object.defineProperty(t,"BaseFilter",{enumerable:!0,get:function(){return d.BaseFilter}});var p=n(59386);Object.defineProperty(t,"FilterStackFactory",{enumerable:!0,get:function(){return p.FilterStackFactory}});var f=n(27749);Object.defineProperty(t,"registerAdminService",{enumerable:!0,get:function(){return f.registerAdminService}});var g=n(40487);Object.defineProperty(t,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return g.BaseSubchannelWrapper}});var m=n(7542);Object.defineProperty(t,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return m.OutlierDetectionLoadBalancingConfig}})},59386:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterStackFactory=t.FilterStack=void 0;class n{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}refresh(){for(let e of this.filters)e.refresh()}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}t.FilterStack=n;class r{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}createFilter(e){return new n(this.factories.map(t=>t.createFilter(e)))}}t.FilterStackFactory=r},53223:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseFilter=void 0;class n{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}refresh(){}}t.BaseFilter=n},85242:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProxiedConnection=t.mapProxyName=void 0;let r=n(25792),i=n(19572),s=n(84063),o=n(13685),a=n(24404),l=n(25792),u=n(74955),c=n(55541),h=n(57310),d="proxy";function p(e){l.trace(i.LogVerbosity.DEBUG,d,e)}function f(){let e,t="",n="";if(process.env.grpc_proxy)n="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)n="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};n="http_proxy",t=process.env.http_proxy}try{e=new h.URL(t)}catch(e){return r.log(i.LogVerbosity.ERROR,`cannot parse value of "${n}" env var`),{}}if("http:"!==e.protocol)return r.log(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?(r.log(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let o=e.hostname,a=e.port;""===a&&(a="80");let l={address:`${o}:${a}`};return s&&(l.creds=s),p("Proxy server "+l.address+" set by environment variable "+n),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(p("No proxy server list set by environment variable "+t),e.split(",")):[]}function m(e,t){var n;let r={target:e,extraOptions:{}};if((null!==(n=t["grpc.enable_http_proxy"])&&void 0!==n?n:1)===0||"unix"===e.scheme)return r;let i=f();if(!i.address)return r;let s=c.splitHostPort(e.path);if(!s)return r;let o=s.host;for(let t of g())if(t===o)return p("Not using proxy for target in no_proxy list: "+c.uriToString(e)),r;let a={"grpc.http_connect_target":c.uriToString(e)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}function y(e,t,n){if(!("grpc.http_connect_target"in t))return Promise.resolve({});let l=t["grpc.http_connect_target"],h=c.parseUri(l);if(null===h)return Promise.resolve({});let d={method:"CONNECT",path:h.path},f={Host:h.path};u.isTcpSubchannelAddress(e)?(d.host=e.host,d.port=e.port):d.socketPath=e.path,"grpc.http_connect_creds"in t&&(f["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),d.headers=f;let g=u.subchannelAddressToString(e);return p("Using proxy "+g+" to connect to "+d.path),new Promise((e,t)=>{let l=o.request(d);l.once("connect",(o,u,f)=>{var m;if(l.removeAllListeners(),u.removeAllListeners(),200===o.statusCode){if(p("Successfully connected to "+d.path+" through proxy "+g),"secureContext"in n){let r=s.getDefaultAuthority(h),i=c.splitHostPort(r),o=null!==(m=null==i?void 0:i.host)&&void 0!==m?m:r,l=a.connect(Object.assign({host:o,servername:o,socket:u},n),()=>{p("Successfully established a TLS connection to "+d.path+" through proxy "+g),e({socket:l,realTarget:h})});l.on("error",e=>{p("Failed to establish a TLS connection to "+d.path+" through proxy "+g+" with error "+e.message),t()})}else p("Successfully established a plaintext connection to "+d.path+" through proxy "+g),e({socket:u,realTarget:h})}else r.log(i.LogVerbosity.ERROR,"Failed to connect to "+d.path+" through proxy "+g+" with status "+o.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),r.log(i.LogVerbosity.ERROR,"Failed to connect to proxy "+g+" with error "+e.message),t()}),l.end()})}t.mapProxyName=m,t.getProxiedConnection=y},1968:(e,t,n)=>{"use strict";m={value:!0},m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=t.Rz=m=m=m=m=m=m=t.SF=t.K9=void 0;let r=n(45402);m={enumerable:!0,get:function(){return r.CallCredentials}};let i=n(39452);m={enumerable:!0,get:function(){return i.ChannelImplementation}};let s=n(74334);m={enumerable:!0,get:function(){return s.CompressionAlgorithms}};let o=n(72409);m={enumerable:!0,get:function(){return o.ConnectivityState}};let a=n(70499);m={enumerable:!0,get:function(){return a.ChannelCredentials}};let l=n(91865);m={enumerable:!0,get:function(){return l.Client}};let u=n(19572);m={enumerable:!0,get:function(){return u.LogVerbosity}},m={enumerable:!0,get:function(){return u.Status}},m={enumerable:!0,get:function(){return u.Propagate}};let c=n(25792),h=n(54529);Object.defineProperty(t,"Rz",{enumerable:!0,get:function(){return h.loadPackageDefinition}}),m={enumerable:!0,get:function(){return h.makeClientConstructor}},m={enumerable:!0,get:function(){return h.makeClientConstructor}};let d=n(6281);Object.defineProperty(t,"SF",{enumerable:!0,get:function(){return d.Metadata}});let p=n(66418);m={enumerable:!0,get:function(){return p.Server}};let f=n(43783);m={enumerable:!0,get:function(){return f.ServerCredentials}};let g=n(14339);m={enumerable:!0,get:function(){return g.StatusBuilder}},t.K9={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:a.ChannelCredentials.createInsecure,createSsl:a.ChannelCredentials.createSsl,createFromSecureContext:a.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:r.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:r.CallCredentials.createFromGoogleCredential,createEmpty:r.CallCredentials.createEmpty},m=e=>e.close(),m=(e,t,n)=>e.waitForReady(t,n),m=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},m=(e,t,n)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},m=e=>{c.setLogger(e)},m=e=>{c.setLoggerVerbosity(e)},m=e=>l.Client.prototype.getChannel.call(e);var m,y=n(61809);m={enumerable:!0,get:function(){return y.ListenerBuilder}},m={enumerable:!0,get:function(){return y.RequesterBuilder}},m={enumerable:!0,get:function(){return y.InterceptingCall}},m={enumerable:!0,get:function(){return y.InterceptorConfigurationError}};var v=n(65962);m={enumerable:!0,get:function(){return v.getChannelzServiceDefinition}},m={enumerable:!0,get:function(){return v.getChannelzHandlers}};var _=n(27749);m={enumerable:!0,get:function(){return _.addAdminServicesToServer}},m=n(38779);let b=n(48501),S=n(47255),w=n(63988),T=n(15102),E=n(14556),C=n(7542),I=n(65962),k=n(81513).i8;(()=>{c.trace(u.LogVerbosity.DEBUG,"index","Loading @grpc/grpc-js version "+k),b.setup(),S.setup(),w.setup(),T.setup(),E.setup(),C.setup(),I.setup()})()},56372:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChildLoadBalancerHandler=void 0;let r=n(69884),i=n(72409),s="child_load_balancer_helper";class o{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var n;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null===(n=this.parent.currentChild)||void 0===n||n.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!==(e=this.parent.pendingChild)&&void 0!==e?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}updateAddressList(e,t,n){let i;if(null===this.currentChild||this.currentChild.getTypeName()!==t.getLoadBalancerName()){let e=new this.ChildPolicyHelper(this),n=r.createLoadBalancer(t,e);e.setChild(n),null===this.currentChild?(this.currentChild=n,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=n,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;i.updateAddressList(e,t,n)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}t.ChildLoadBalancerHandler=o},7542:(e,t,n)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.OutlierDetectionLoadBalancer=t.OutlierDetectionLoadBalancingConfig=void 0;let i=n(72409),s=n(19572),o=n(87974),a=n(38779),l=n(53223),u=n(69884),c=n(56372),h=n(2352),d=n(74955),p=n(40487),f=n(25792),g="outlier_detection";function m(e){f.trace(s.LogVerbosity.DEBUG,g,e)}let y="outlier_detection",v=(null!==(r=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)&&void 0!==r?r:"true")==="true",_={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function S(e,t,n,r){if(t in e&&typeof e[t]!==n){let i=r?`${r}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${n}, got ${typeof e[t]}`)}}function w(e,t,n){let r=n?`${n}.${t}`:t;if(t in e){if(!o.isDuration(e[t]))throw Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=999999999))throw Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function T(e,t,n){let r=n?`${n}.${t}`:t;if(S(e,t,"number",n),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}class E{constructor(e,t,n,r,i,s,o){this.childPolicy=o,this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=n?n:3e5,this.maxEjectionPercent=null!=r?r:10,this.successRateEjection=i?Object.assign(Object.assign({},_),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return y}toJsonObject(){return{interval:o.msToDuration(this.intervalMs),base_ejection_time:o.msToDuration(this.baseEjectionTimeMs),max_ejection_time:o.msToDuration(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new E(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(w(e,"interval"),w(e,"base_ejection_time"),w(e,"max_ejection_time"),T(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");S(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),T(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),S(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),S(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");T(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),T(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),S(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),S(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new E(e.interval?o.durationToMs(e.interval):null,e.base_ejection_time?o.durationToMs(e.base_ejection_time):null,e.max_ejection_time?o.durationToMs(e.max_ejection_time):null,null!==(t=e.max_ejection_percent)&&void 0!==t?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(u.validateLoadBalancingConfig))}}t.OutlierDetectionLoadBalancingConfig=E;class C extends p.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,n)=>{if(this.childSubchannelState=n,!this.ejected)for(let e of this.stateListeners)e(this,t,n)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function I(){return{success:0,failure:0}}class k{constructor(){this.activeBucket=I(),this.inactiveBucket=I()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=I()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class R extends l.BaseFilter{constructor(e){super(),this.callCounter=e}receiveTrailers(e){return e.code===s.Status.OK?this.callCounter.addSuccess():this.callCounter.addFailure(),e}}class O{constructor(e){this.callCounter=e}createFilter(e){return new R(this.callCounter)}}class N{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==h.PickResultType.COMPLETE)return t;{let e=t.subchannel,n=e.getMapEntry();if(!n)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let r=[...t.extraFilterFactories];return this.countCalls&&r.push(new O(n.counter)),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),extraFilterFactories:r})}}}}class A{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new c.ChildLoadBalancerHandler(a.createChildChannelControlHelper(e,{createSubchannel:(t,n)=>{let r=e.createSubchannel(t,n),i=this.addressMap.get(d.subchannelAddressToString(t)),s=new C(r,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,n)=>{t===i.ConnectivityState.READY?e.updateState(t,new N(n,this.isCountingEnabled())):e.updateState(t,n)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;m("Running success rate check");let n=t.request_volume,r=0,i=[];for(let e of this.addressMap.values()){let t=e.counter.getLastSuccesses(),s=e.counter.getLastFailures();t+s>=n&&(r+=1,i.push(t/(t+s)))}if(m("Found "+r+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),r<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,o=0;for(let e of i){let t=e-s;o+=t*t}let a=Math.sqrt(o/i.length),l=s-t.stdev_factor/1e3*a;for(let[r,i]of(m("stdev="+a+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();if(s+o<n)continue;let a=s/(s+o);if(m("Checking candidate "+r+" successRate="+a),a<l){let n=100*Math.random();m("Candidate "+r+" randomNumber="+n+" enforcement_percentage="+t.enforcement_percentage),n<t.enforcement_percentage&&(m("Ejecting candidate "+r),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;m("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let n=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(n+=1);if(!(n<t.minimum_hosts))for(let[n,r]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=r.counter.getLastSuccesses(),s=r.counter.getLastFailures();if(m("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume)&&100*s/(s+i)>t.threshold){let i=100*Math.random();m("Candidate "+n+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(m("Ejecting candidate "+n),this.eject(r,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){this.ejectionTimer=setTimeout(()=>this.runChecks(),e)}runChecks(){let e=new Date;if(m("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,n]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===n.currentEjectionTimestamp)n.ejectionTimeMultiplier>0&&(n.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),r=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(n.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*n.ejectionTimeMultiplier,Math.max(e,r))),i<new Date&&(m("Unejecting "+t),this.uneject(n))}}updateAddressList(e,t,n){if(!(t instanceof E))return;let r=new Set;for(let t of e)r.add(d.subchannelAddressToString(t));for(let e of r)this.addressMap.has(e)||(m("Adding map entry for "+e),this.addressMap.set(e,{counter:new k,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())r.has(e)||(m("Removing map entry for "+e),this.addressMap.delete(e));let i=u.getFirstUsableConfig(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,n),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig()){if(this.timerStartTime){m("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else m("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets()}else for(let e of(m("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return y}}function x(){v&&a.registerLoadBalancerType(y,A,E)}t.OutlierDetectionLoadBalancer=A,t.setup=x},15102:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.PickFirstLoadBalancer=t.PickFirstLoadBalancingConfig=void 0;let r=n(69884),i=n(72409),s=n(2352),o=n(74955),a=n(25792),l=n(19572),u="pick_first";function c(e){a.trace(l.LogVerbosity.DEBUG,u,e)}let h="pick_first",d=250;class p{getLoadBalancerName(){return h}constructor(){}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new p}}t.PickFirstLoadBalancingConfig=p;class f{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,extraFilterFactories:[],onCallStarted:null}}}class g{constructor(e){this.channelControlHelper=e,this.latestAddressList=[],this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.triedAllSubchannels=!1,this.subchannelStateCounts={[i.ConnectivityState.CONNECTING]:0,[i.ConnectivityState.IDLE]:0,[i.ConnectivityState.READY]:0,[i.ConnectivityState.SHUTDOWN]:0,[i.ConnectivityState.TRANSIENT_FAILURE]:0},this.subchannelStateListener=(e,t,n)=>{if(this.subchannelStateCounts[t]-=1,this.subchannelStateCounts[n]+=1,e===this.subchannels[this.currentSubchannelIndex]&&n===i.ConnectivityState.TRANSIENT_FAILURE&&this.startNextSubchannelConnecting(),n===i.ConnectivityState.READY){this.pickSubchannel(e);return}if(this.triedAllSubchannels&&this.subchannelStateCounts[i.ConnectivityState.IDLE]===this.subchannels.length){this.resetSubchannelList(!1),this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this));return}if(null===this.currentPick){if(this.triedAllSubchannels){let e;(e=this.subchannelStateCounts[i.ConnectivityState.CONNECTING]>0?i.ConnectivityState.CONNECTING:this.subchannelStateCounts[i.ConnectivityState.TRANSIENT_FAILURE]>0?i.ConnectivityState.TRANSIENT_FAILURE:i.ConnectivityState.IDLE)!==this.currentState&&(e===i.ConnectivityState.TRANSIENT_FAILURE?this.updateState(e,new s.UnavailablePicker):this.updateState(e,new s.QueuePicker(this)))}else this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}},this.pickedSubchannelStateListener=(e,t,n)=>{if(n!==i.ConnectivityState.READY){if(this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.pickedSubchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef()),this.subchannels.length>0){if(this.triedAllSubchannels){let e;(e=this.subchannelStateCounts[i.ConnectivityState.CONNECTING]>0?i.ConnectivityState.CONNECTING:this.subchannelStateCounts[i.ConnectivityState.TRANSIENT_FAILURE]>0?i.ConnectivityState.TRANSIENT_FAILURE:i.ConnectivityState.IDLE)===i.ConnectivityState.TRANSIENT_FAILURE?this.updateState(e,new s.UnavailablePicker):this.updateState(e,new s.QueuePicker(this))}else this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}else this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}},this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}startNextSubchannelConnecting(){if(!this.triedAllSubchannels){for(let[e,t]of this.subchannels.entries())if(e>this.currentSubchannelIndex){let n=t.getConnectivityState();if(n===i.ConnectivityState.IDLE||n===i.ConnectivityState.CONNECTING){this.startConnecting(e);return}}this.triedAllSubchannels=!0}}startConnecting(e){clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.subchannels[e].getConnectivityState()===i.ConnectivityState.IDLE&&(c("Start connecting to subchannel with address "+this.subchannels[e].getAddress()),process.nextTick(()=>{this.subchannels[e].startConnecting()})),this.connectionDelayTimeout=setTimeout(()=>{this.startNextSubchannelConnecting()},d)}pickSubchannel(e){c("Pick subchannel with address "+e.getAddress()),null!==this.currentPick&&(this.currentPick.unref(),this.currentPick.removeConnectivityStateListener(this.pickedSubchannelStateListener)),this.currentPick=e,this.updateState(i.ConnectivityState.READY,new f(e)),e.addConnectivityStateListener(this.pickedSubchannelStateListener),e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout)}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(e=!0){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.currentSubchannelIndex=0,this.subchannelStateCounts={[i.ConnectivityState.CONNECTING]:0,[i.ConnectivityState.IDLE]:0,[i.ConnectivityState.READY]:0,[i.ConnectivityState.SHUTDOWN]:0,[i.ConnectivityState.TRANSIENT_FAILURE]:0},this.subchannels=[],e&&(this.triedAllSubchannels=!1)}connectToAddressList(){for(let e of(this.resetSubchannelList(),c("Connect to address list "+this.latestAddressList.map(e=>o.subchannelAddressToString(e))),this.subchannels=this.latestAddressList.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels))e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let e of this.subchannels)if(e.addConnectivityStateListener(this.subchannelStateListener),this.subchannelStateCounts[e.getConnectivityState()]+=1,e.getConnectivityState()===i.ConnectivityState.READY){this.pickSubchannel(e),this.resetSubchannelList();return}for(let[e,t]of this.subchannels.entries()){let n=t.getConnectivityState();if(n===i.ConnectivityState.IDLE||n===i.ConnectivityState.CONNECTING){this.startConnecting(e),null===this.currentPick&&this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this));return}}null===this.currentPick&&this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker)}updateAddressList(e,t){0!==this.subchannels.length&&this.latestAddressList.every((t,n)=>e[n]===t)||(this.latestAddressList=e,this.connectToAddressList())}exitIdle(){for(let e of((this.currentState===i.ConnectivityState.IDLE||this.triedAllSubchannels)&&this.channelControlHelper.requestReresolution(),this.subchannels))e.startConnecting();this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList.length>0&&this.connectToAddressList()}resetBackoff(){}destroy(){if(this.resetSubchannelList(),null!==this.currentPick){let e=this.currentPick;e.unref(),e.removeConnectivityStateListener(this.pickedSubchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}getTypeName(){return h}}function m(){r.registerLoadBalancerType(h,g,p),r.registerDefaultLoadBalancerType(h)}t.PickFirstLoadBalancer=g,t.setup=m},14556:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.RoundRobinLoadBalancer=void 0;let r=n(69884),i=n(72409),s=n(2352),o=n(74955),a=n(25792),l=n(19572),u="round_robin";function c(e){a.trace(l.LogVerbosity.DEBUG,u,e)}let h="round_robin";class d{getLoadBalancerName(){return h}constructor(){}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new d}}class p{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,extraFilterFactories:[],onCallStarted:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class f{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.subchannelStateCounts={[i.ConnectivityState.CONNECTING]:0,[i.ConnectivityState.IDLE]:0,[i.ConnectivityState.READY]:0,[i.ConnectivityState.SHUTDOWN]:0,[i.ConnectivityState.TRANSIENT_FAILURE]:0},this.subchannelStateListener=(e,t,n)=>{this.subchannelStateCounts[t]-=1,this.subchannelStateCounts[n]+=1,this.calculateAndUpdateState(),(n===i.ConnectivityState.TRANSIENT_FAILURE||n===i.ConnectivityState.IDLE)&&(this.channelControlHelper.requestReresolution(),e.startConnecting())}}calculateAndUpdateState(){if(this.subchannelStateCounts[i.ConnectivityState.READY]>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new p(e,t))}else this.subchannelStateCounts[i.ConnectivityState.CONNECTING]>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.subchannelStateCounts[i.ConnectivityState.TRANSIENT_FAILURE]>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannelStateCounts={[i.ConnectivityState.CONNECTING]:0,[i.ConnectivityState.IDLE]:0,[i.ConnectivityState.READY]:0,[i.ConnectivityState.SHUTDOWN]:0,[i.ConnectivityState.TRANSIENT_FAILURE]:0},this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),c("Connect to address list "+e.map(e=>o.subchannelAddressToString(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();this.subchannelStateCounts[e]+=1,(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return h}}function g(){r.registerLoadBalancerType(h,f,d)}t.RoundRobinLoadBalancer=f,t.setup=g},69884:(e,t)=>{"use strict";function n(e,t){var n,r,i,s,o,a,l,u,c,h;return{createSubchannel:null!==(r=null===(n=t.createSubchannel)||void 0===n?void 0:n.bind(t))&&void 0!==r?r:e.createSubchannel.bind(e),updateState:null!==(s=null===(i=t.updateState)||void 0===i?void 0:i.bind(t))&&void 0!==s?s:e.updateState.bind(e),requestReresolution:null!==(a=null===(o=t.requestReresolution)||void 0===o?void 0:o.bind(t))&&void 0!==a?a:e.requestReresolution.bind(e),addChannelzChild:null!==(u=null===(l=t.addChannelzChild)||void 0===l?void 0:l.bind(t))&&void 0!==u?u:e.addChannelzChild.bind(e),removeChannelzChild:null!==(h=null===(c=t.removeChannelzChild)||void 0===c?void 0:c.bind(t))&&void 0!==h?h:e.removeChannelzChild.bind(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.isLoadBalancerNameRegistered=t.createLoadBalancer=t.registerDefaultLoadBalancerType=t.registerLoadBalancerType=t.createChildChannelControlHelper=void 0,t.createChildChannelControlHelper=n;let r={},i=null;function s(e,t,n){r[e]={LoadBalancer:t,LoadBalancingConfig:n}}function o(e){i=e}function a(e,t){let n=e.getLoadBalancerName();return n in r?new r[n].LoadBalancer(t):null}function l(e){return e in r}function u(e,t=!1){for(let t of e)if(t.getLoadBalancerName() in r)return t;return t&&i?new r[i].LoadBalancingConfig:null}function c(e){if(!(null!==e&&"object"==typeof e))throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let n=t[0];if(n in r)return r[n].LoadBalancingConfig.createFromJson(e[n]);throw Error(`Unrecognized load balancing config name ${n}`)}t.registerLoadBalancerType=s,t.registerDefaultLoadBalancerType=o,t.createLoadBalancer=a,t.isLoadBalancerNameRegistered=l,t.getFirstUsableConfig=u,t.validateLoadBalancingConfig=c},25792:(e,t,n)=>{"use strict";var r,i,s,o;Object.defineProperty(t,"__esModule",{value:!0}),t.isTracerEnabled=t.trace=t.log=t.setLoggerVerbosity=t.setLogger=t.getLogger=void 0;let a=n(19572),l={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},u=a.LogVerbosity.ERROR;switch((null!==(i=null!==(r=process.env.GRPC_NODE_VERBOSITY)&&void 0!==r?r:process.env.GRPC_VERBOSITY)&&void 0!==i?i:"").toUpperCase()){case"DEBUG":u=a.LogVerbosity.DEBUG;break;case"INFO":u=a.LogVerbosity.INFO;break;case"ERROR":u=a.LogVerbosity.ERROR;break;case"NONE":u=a.LogVerbosity.NONE}t.getLogger=()=>l,t.setLogger=e=>{l=e},t.setLoggerVerbosity=e=>{u=e},t.log=(e,...t)=>{let n;if(e>=u){switch(e){case a.LogVerbosity.DEBUG:n=l.debug;break;case a.LogVerbosity.INFO:n=l.info;break;case a.LogVerbosity.ERROR:n=l.error}n||(n=l.error),n&&n.bind(l)(...t)}};let c=null!==(o=null!==(s=process.env.GRPC_NODE_TRACE)&&void 0!==s?s:process.env.GRPC_TRACE)&&void 0!==o?o:"",h=new Set,d=new Set;for(let e of c.split(","))e.startsWith("-")?d.add(e.substring(1)):h.add(e);let p=h.has("all");function f(e,n,r){g(n)&&t.log(e,new Date().toISOString()+" | "+n+" | "+r)}function g(e){return!d.has(e)&&(p||h.has(e))}t.trace=f,t.isTracerEnabled=g},54529:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadPackageDefinition=t.makeClientConstructor=void 0;let r=n(91865),i={unary:r.Client.prototype.makeUnaryRequest,server_stream:r.Client.prototype.makeServerStreamRequest,client_stream:r.Client.prototype.makeClientStreamRequest,bidi:r.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function o(e,t,n){n||(n={});class o extends r.Client{}return Object.keys(e).forEach(t=>{let n;if(s(t))return;let r=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");n=r.requestStream?r.responseStream?"bidi":"client_stream":r.responseStream?"server_stream":"unary";let l=r.requestSerialize,u=r.responseDeserialize,c=a(i[n],r.path,l,u);o.prototype[t]=c,Object.assign(o.prototype[t],r),r.originalName&&!s(r.originalName)&&(o.prototype[r.originalName]=o.prototype[t])}),o.service=e,o.serviceName=t,o}function a(e,t,n,r){return function(...i){return e.call(this,t,n,r,...i)}}function l(e){return"format"in e}function u(e){let t={};for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n],i=n.split(".");if(i.some(e=>s(e)))continue;let a=i[i.length-1],u=t;for(let e of i.slice(0,-1))u[e]||(u[e]={}),u=u[e];l(r)?u[a]=r:u[a]=o(r,a,{})}return t}t.makeClientConstructor=o,t.loadPackageDefinition=u},82313:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MaxMessageSizeFilterFactory=t.MaxMessageSizeFilter=void 0;let r=n(53223),i=n(19572);class s extends r.BaseFilter{constructor(e,t){super(),this.options=e,this.callStream=t,this.maxSendMessageSize=i.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=i.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}async sendMessage(e){if(-1===this.maxSendMessageSize)return e;{let t=await e;return t.message.length>this.maxSendMessageSize?(this.callStream.cancelWithStatus(i.Status.RESOURCE_EXHAUSTED,`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`),Promise.reject("Message too large")):t}}async receiveMessage(e){if(-1===this.maxReceiveMessageSize)return e;{let t=await e;return t.length>this.maxReceiveMessageSize?(this.callStream.cancelWithStatus(i.Status.RESOURCE_EXHAUSTED,`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`),Promise.reject("Message too large")):t}}}t.MaxMessageSizeFilter=s;class o{constructor(e){this.options=e}createFilter(e){return new s(this.options,e)}}t.MaxMessageSizeFilterFactory=o},6281:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;let r=n(25792),i=n(19572),s=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function a(e){return s.test(e)}function l(e){return o.test(e)}function u(e){return e.endsWith("-bin")}function c(e){return!e.startsWith("grpc-")}function h(e){return e.toLowerCase()}function d(e,t){if(!a(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t){if(u(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!l(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}}class p{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){d(e=h(e),t),this.internalRepr.set(e,[t])}add(e,t){d(e=h(e),t);let n=this.internalRepr.get(e);void 0===n?this.internalRepr.set(e,[t]):n.push(t)}remove(e){e=h(e),this.internalRepr.delete(e)}get(e){return e=h(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,n]of this.internalRepr)if(n.length>0){let r=n[0];e[t]=Buffer.isBuffer(r)?Buffer.from(r):r}return e}clone(){let e=new p(this.options),t=e.internalRepr;for(let[e,n]of this.internalRepr){let r=n.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,r)}return e}merge(e){for(let[t,n]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(n);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,n]of this.internalRepr)e[t]=n.map(f);return e}_getCoreRepresentation(){return this.internalRepr}toJSON(){let e={};for(let[t,n]of this.internalRepr)e[t]=n;return e}static fromHttp2Headers(e){let t=new p;for(let n of Object.keys(e)){if(":"===n.charAt(0))continue;let s=e[n];try{u(n)?Array.isArray(s)?s.forEach(e=>{t.add(n,Buffer.from(e,"base64"))}):void 0!==s&&(c(n)?s.split(",").forEach(e=>{t.add(n,Buffer.from(e.trim(),"base64"))}):t.add(n,Buffer.from(s,"base64"))):Array.isArray(s)?s.forEach(e=>{t.add(n,e)}):void 0!==s&&t.add(n,s)}catch(t){let e=`Failed to add metadata entry ${n}: ${s}. ${t.message}. For more information see https://github.com/grpc/grpc-node/issues/1173`;r.log(i.LogVerbosity.ERROR,e)}}return t}}t.Metadata=p;let f=e=>Buffer.isBuffer(e)?e.toString("base64"):e},2352:(e,t,n)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.QueuePicker=t.UnavailablePicker=t.PickResultType=void 0;let i=n(6281),s=n(19572);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(r=t.PickResultType||(t.PickResultType={}));class o{constructor(e){void 0!==e?this.status=e:this.status={code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata}}pick(e){return{pickResultType:r.TRANSIENT_FAILURE,subchannel:null,status:this.status,extraFilterFactories:[],onCallStarted:null}}}t.UnavailablePicker=o;class a{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:r.QUEUE,subchannel:null,status:null,extraFilterFactories:[],onCallStarted:null}}}t.QueuePicker=a},48501:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(84063),i=n(9523),s=n(73837),o=n(94298),a=n(19572),l=n(6281),u=n(25792),c=n(19572),h=n(55541),d=n(41808),p=n(1742),f="dns_resolver";function g(e){u.trace(c.LogVerbosity.DEBUG,f,e)}let m=443,y=3e4,v=s.promisify(i.resolveTxt),_=s.promisify(i.lookup);function b(...e){let t=[];for(let n=0;n<Math.max.apply(null,e.map(e=>e.length));n++)for(let r of e)n<r.length&&t.push(r[n]);return t}class S{constructor(e,t,n){var r,i,s;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,g("Resolver constructed for target "+h.uriToString(e));let o=h.splitHostPort(e.path);null===o?(this.ipResult=null,this.dnsHostname=null,this.port=null):d.isIPv4(o.host)||d.isIPv6(o.host)?(this.ipResult=[{host:o.host,port:null!==(r=o.port)&&void 0!==r?r:m}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=o.host,this.port=null!==(i=o.port)&&void 0!==i?i:m),this.percentage=100*Math.random(),this.defaultResolutionError={code:a.Status.UNAVAILABLE,details:`Name resolution failed for target ${h.uriToString(this.target)}`,metadata:new l.Metadata};let u={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new p.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},u),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!==(s=n["grpc.dns_min_time_between_resolutions_ms"])&&void 0!==s?s:y,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){g("Returning IP address for target "+h.uriToString(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.backoff.stop(),this.backoff.reset();return}if(null===this.dnsHostname)g("Failed to parse DNS address "+h.uriToString(this.target)),setImmediate(()=>{this.listener.onError({code:a.Status.UNAVAILABLE,details:`Failed to parse DNS address ${h.uriToString(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;g("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=_(e,{all:!0}),this.pendingLookupPromise.then(e=>{this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),n=e.filter(e=>6===e.family);this.latestLookupResult=b(n,t).map(e=>({host:e.address,port:+this.port}));let r="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";if(g("Resolved addresses for target "+h.uriToString(this.target)+": "+r),0===this.latestLookupResult.length){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{g("Resolution error for target "+h.uriToString(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError)}),null===this.pendingTxtPromise&&(this.pendingTxtPromise=v(e),this.pendingTxtPromise.then(e=>{this.pendingTxtPromise=null;try{this.latestServiceConfig=o.extractAndSelectServiceConfig(e,this.percentage)}catch(e){this.latestServiceConfigError={code:a.Status.UNAVAILABLE,details:"Parsing service config failed",metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null===(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)||void 0===t?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.startResolution(),this.backoff.runOnce(),this.startNextResolutionTimer())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?this.continueResolving=!0:this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.stop(),this.stopNextResolutionTimer()}static getDefaultAuthority(e){return e.path}}function w(){r.registerResolver("dns",S),r.registerDefaultScheme("dns")}t.setup=w},63988:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(41808),i=n(19572),s=n(6281),o=n(84063),a=n(55541),l=n(25792),u="ip_resolver";function c(e){l.trace(i.LogVerbosity.DEBUG,u,e)}let h="ipv4",d="ipv6",p=443;class f{constructor(e,t,n){var o;this.target=e,this.listener=t,this.addresses=[],this.error=null,c("Resolver constructed for target "+a.uriToString(e));let l=[];if(!(e.scheme===h||e.scheme===d)){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(let t of e.path.split(",")){let n=a.splitHostPort(t);if(null===n||e.scheme===h&&!r.isIPv4(n.host)||e.scheme===d&&!r.isIPv6(n.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:n.host,port:null!==(o=n.port)&&void 0!==o?o:p})}this.addresses=l,c("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})})}destroy(){}static getDefaultAuthority(e){return e.path.split(",")[0]}}function g(){o.registerResolver(h,f),o.registerResolver(d,f)}t.setup=g},47255:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(84063);class i{constructor(e,t,n){let r;this.listener=t,this.addresses=[],r=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:r}]}updateResolution(){process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{})}destroy(){}static getDefaultAuthority(e){return"localhost"}}function s(){r.registerResolver("unix",i)}t.setup=s},84063:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapUriDefaultScheme=t.getDefaultAuthority=t.createResolver=t.registerDefaultScheme=t.registerResolver=void 0;let r=n(55541),i={},s=null;function o(e,t){i[e]=t}function a(e){s=e}function l(e,t,n){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,n);throw Error(`No resolver could be created for target ${r.uriToString(e)}`)}function u(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${r.uriToString(e)}`)}function c(e){return void 0!==e.scheme&&e.scheme in i?e:null!==s?{scheme:s,authority:void 0,path:r.uriToString(e)}:null}t.registerResolver=o,t.registerDefaultScheme=a,t.createResolver=l,t.getDefaultAuthority=u,t.mapUriDefaultScheme=c},77661:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingLoadBalancer=void 0;let r=n(69884),i=n(94298),s=n(72409),o=n(84063),a=n(2352),l=n(1742),u=n(19572),c=n(6281),h=n(25792),d=n(19572),p=n(55541),f=n(56372),g="resolving_load_balancer";function m(e){h.trace(d.LogVerbosity.DEBUG,g,e)}function y(e){return function(t,n){var r,i;let s=t.split("/").filter(e=>e.length>0),o=null!==(r=s[0])&&void 0!==r?r:"",a=null!==(i=s[1])&&void 0!==i?i:"";if(e&&e.methodConfig){for(let t of e.methodConfig)for(let e of t.name)if(e.service===o&&(void 0===e.method||e.method===a))return{methodConfig:t,pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}}class v{constructor(e,t,n,h,d){this.target=e,this.channelControlHelper=t,this.channelOptions=n,this.onSuccessfulResolution=h,this.onFailedResolution=d,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new a.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,n["grpc.service_config"]?this.defaultServiceConfig=i.validateServiceConfig(JSON.parse(n["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new a.QueuePicker(this)),this.childLoadBalancer=new f.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=o.createResolver(e,{onSuccessfulResolution:(e,t,n,i,s)=>{var o;let a=null;null===t?null===n?(this.previousServiceConfig=null,a=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(n):a=this.previousServiceConfig:(a=t,this.previousServiceConfig=t);let l=null!==(o=null==a?void 0:a.loadBalancingConfig)&&void 0!==o?o:[],h=r.getFirstUsableConfig(l,!0);if(null===h){this.handleResolutionFailure({code:u.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new c.Metadata});return}this.childLoadBalancer.updateAddressList(e,h,s);let d=null!=a?a:this.defaultServiceConfig;this.onSuccessfulResolution(null!=i?i:y(d))},onError:e=>{this.handleResolutionFailure(e)}},n);let p={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},p),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new a.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){m(p.uriToString(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new a.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new a.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.updateState(s.ConnectivityState.SHUTDOWN,new a.UnavailablePicker)}getTypeName(){return"resolving_load_balancer"}}t.ResolvingLoadBalancer=v},92025:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2ServerCallStream=t.ServerDuplexStreamImpl=t.ServerWritableStreamImpl=t.ServerReadableStreamImpl=t.ServerUnaryCallImpl=void 0;let r=n(82361),i=n(85158),s=n(12781),o=n(59796),a=n(73837),l=n(19572),u=n(6281),c=n(80615),h=n(25792),d="server_call",p=a.promisify(o.unzip),f=a.promisify(o.inflate);function g(e){h.trace(l.LogVerbosity.DEBUG,d,e)}let m="grpc-message",y="grpc-status",v="grpc-timeout",_=/(\d{1,8})\s*([HMSmun])/,b={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},S={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity",[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},w={waitForTrailers:!0};class T extends r.EventEmitter{constructor(e,t,n){super(),this.call=e,this.metadata=t,this.request=n,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerUnaryCallImpl=T;class E extends s.Readable{constructor(e,t,n,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=n,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,r)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerReadableStreamImpl=E;class C extends s.Writable{constructor(e,t,n,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=n,this.request=r,this.cancelled=!1,this.trailingMetadata=new u.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,n){try{let t=this.call.serializeMessage(e);if(!this.call.write(t)){this.call.once("drain",n);return}}catch(e){e.code=l.Status.INTERNAL,this.emit("error",e)}n()}_final(e){this.call.sendStatus({code:l.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerWritableStreamImpl=C;class I extends s.Duplex{constructor(e,t,n,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=n,this.deserialize=r,this.cancelled=!1,this.trailingMetadata=new u.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerDuplexStreamImpl=I,I.prototype._read=E.prototype._read,I.prototype._write=C.prototype._write,I.prototype._final=C.prototype._final;class k extends r.EventEmitter{constructor(e,t,n){super(),this.stream=e,this.handler=t,this.options=n,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=l.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=l.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;g("Request to method "+(null===(e=this.handler)||void 0===e?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:l.Status.CANCELLED,details:"Cancelled by client",metadata:null}))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in n&&(this.maxSendMessageSize=n["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in n&&(this.maxReceiveMessageSize=n["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return"deflate"===t?f(e.subarray(5)):"gzip"===t?p(e.subarray(5)):"identity"===t?e.subarray(5):Promise.reject({code:l.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,n=Object.assign(Object.assign({},S),t);this.stream.respond(n,w)}receiveMetadata(e){let t=u.Metadata.fromHttp2Headers(e);h.isTracerEnabled(d)&&g("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let n=t.get(v);if(n.length>0){let e=n[0].toString().match(_);if(null===e){let e=Error("Invalid deadline");return e.code=l.Status.OUT_OF_RANGE,this.sendError(e),t}let r=+e[1]*b[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+r),this.deadlineTimer=setTimeout(R,r,this),t.remove(v)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e,t){let{stream:n}=this,r=0,i=this,s=[],o=this.maxReceiveMessageSize;function a(e){if(r+=e.byteLength,-1!==o&&r>o){n.removeListener("data",a),n.removeListener("end",u),n.removeListener("error",u),t({code:l.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${r} vs. ${o})`});return}s.push(e)}function u(o){if(n.removeListener("data",a),n.removeListener("end",u),n.removeListener("error",u),void 0!==o){t({code:l.Status.INTERNAL,details:o.message});return}if(0===r){t({code:l.Status.INTERNAL,details:"received empty unary message"});return}i.emit("receiveMessage");let c=Buffer.concat(s,r),h=1===c.readUInt8(0)?e:"identity",d=i.getDecompressedMessage(c,h);if(Buffer.isBuffer(d)){i.safeDeserializeMessage(d,t);return}d.then(e=>i.safeDeserializeMessage(e,t),n=>t(n.code?n:{code:l.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}n.on("data",a),n.on("end",u),n.on("error",u)}safeDeserializeMessage(e,t){try{t(null,this.deserializeMessage(e))}catch(e){e.code=l.Status.INTERNAL,t(e)}}serializeMessage(e){let t=this.handler.serialize(e),n=t.byteLength,r=Buffer.allocUnsafe(n+5);return r.writeUInt8(0,0),r.writeUInt32BE(n,1),t.copy(r,5),r}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,n,r){if(!this.checkCancelled()){if(void 0===n&&(n=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&n&&(e.metadata=n),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:l.Status.OK,details:"OK",metadata:n})}catch(e){e.code=l.Status.INTERNAL,this.sendError(e)}}}sendStatus(e){var t;this.emit("callEnd",e.code),this.emit("streamEnd",e.code===l.Status.OK),!this.checkCancelled()&&(g("Request to method "+(null===(t=this.handler)||void 0===t?void 0:t.path)+" ended with status code: "+l.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let n=Object.assign({[y]:e.code,[m]:encodeURI(e.details)},null===(t=e.metadata)||void 0===t?void 0:t.toHttp2Headers());this.stream.sendTrailers(n),this.statusSent=!0}),this.sendMetadata(),this.stream.end()))}sendError(e){let t={code:l.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(-1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize){this.sendError({code:l.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let n=new c.StreamDecoder,r=!1,i=!1,s=!1,o=()=>{s||!r||i||(s=!0,this.pushOrBufferMessage(e,null))};this.stream.on("data",async r=>{let s=n.write(r);for(let n of(i=!0,this.stream.pause(),s)){if(-1!==this.maxReceiveMessageSize&&n.length>this.maxReceiveMessageSize){this.sendError({code:l.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${n.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let r=1===n.readUInt8(0)?t:"identity",i=await this.getDecompressedMessage(n,r);if(!i)return;this.pushOrBufferMessage(e,i)}i=!1,this.stream.resume(),o()}),this.stream.once("end",()=>{r=!0,o()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),n=e.push(t);if(null===t||!1===n){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){g("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}g("Received message of length "+t.length),this.isPushPending=!0;try{let n=await this.deserializeMessage(t);this.canPush?e.push(n)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(n)}catch(t){this.bufferedMessages.length=0,"code"in t&&"number"==typeof t.code&&Number.isInteger(t.code)&&t.code>=l.Status.OK&&t.code<=l.Status.UNAUTHENTICATED||(t.code=l.Status.INTERNAL),e.emit("error",t)}this.isPushPending=!1,this.bufferedMessages.length>0&&this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){let e=this.stream.session.socket;return e.remoteAddress?e.remotePort?`${e.remoteAddress}:${e.remotePort}`:e.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function R(e){let t=Error("Deadline exceeded");t.code=l.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}t.Http2ServerCallStream=k},43783:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerCredentials=void 0;let r=n(80606);class i{static createInsecure(){return new s}static createSsl(e,t,n=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof n)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let n=t[e];if(null===n||"object"!=typeof n)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(n.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(n.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(n.cert_chain),s.push(n.private_key)}return new o({ca:e||r.getDefaultRootsData()||void 0,cert:i,key:s,requestCert:n,ciphers:r.CIPHER_SUITES})}}t.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class o extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},66418:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;let r=n(85158),i=n(19572),s=n(92025),o=n(43783),a=n(84063),l=n(25792),u=n(74955),c=n(55541),h=n(65962),{HTTP2_HEADER_PATH:d}=r.constants,p="server";function f(){}function g(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function m(e,t){let n=g(t);switch(e){case"unary":return(e,t)=>{t(n,null)};case"clientStream":return(e,t)=>{t(n,null)};case"serverStream":return e=>{e.emit("error",n)};case"bidi":return e=>{e.emit("error",n)};default:throw Error(`Invalid handlerType ${e}`)}}class y{constructor(e){this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new h.ChannelzTrace,this.callTracker=new h.ChannelzCallTracker,this.listenerChildrenTracker=new h.ChannelzChildrenTracker,this.sessionChildrenTracker=new h.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=h.registerChannelzServer(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,n,r;let i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?u.stringToSubchannelAddress(o.remoteAddress,o.remotePort):null,l=o.localAddress?u.stringToSubchannelAddress(o.localAddress,o.localPort):null;if(e.encrypted){let e=o,n=e.getCipher(),r=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!==(t=n.standardName)&&void 0!==t?t:null,cipherSuiteOtherName:n.standardName?null:n.name,localCertificate:r&&"raw"in r?r.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:a,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(n=e.state.localWindowSize)&&void 0!==n?n:null,remoteFlowControlWindow:null!==(r=e.state.remoteWindowSize)&&void 0!==r?r:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,p,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let n=Object.keys(e);if(0===n.length)throw Error("Cannot add an empty service to a server");n.forEach(n=>{let r,i;let s=e[n];r=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let o=t[n];if(void 0===o&&"string"==typeof s.originalName&&(o=t[s.originalName]),i=void 0!==o?o.bind(t):m(r,n),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,r))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let n=e[t];this.unregister(n.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,n){if(!0===this.started)throw Error("server is already started");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof o.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof n)throw TypeError("callback must be a function");let s=c.parseUri(e);if(null===s)throw Error(`Could not parse port "${e}"`);let d=a.mapUriDefaultScheme(s);if(null===d)throw Error(`Could not get a default scheme for port "${e}"`);let p={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?p.maxSessionMemory=this.options["grpc-node.max_session_memory"]:p.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(p.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let g=(e,t)=>{process.nextTick(()=>n(e,t))},m=()=>{let e;if(t._isSecure()){let n=Object.assign(p,t._getSettings());(e=r.createSecureServer(n)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=r.createServer(p);return e.setTimeout(0,f),this._setupHandlers(e),e},y=(e,t,n)=>0===e.length?Promise.resolve({port:t,count:n}):Promise.all(e.map(e=>{let n;this.trace("Attempting to bind "+u.subchannelAddressToString(e)),n=u.isTcpSubchannelAddress(e)?{host:e.host,port:t}:e;let r=m();return new Promise((i,s)=>{let o=t=>{this.trace("Failed to bind "+u.subchannelAddressToString(e)+" with error "+t.message),i(t)};r.once("error",o),r.listen(n,()=>{let e,n;let s=r.address();e="string"==typeof s?{path:s}:{host:s.address,port:s.port},n=h.registerChannelzSocket(u.subchannelAddressToString(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled),this.channelzEnabled&&this.listenerChildrenTracker.refChild(n),this.http2ServerList.push({server:r,channelzRef:n}),this.trace("Successfully bound "+u.subchannelAddressToString(e)),i("port"in e?e.port:t),r.removeListener("error",o)})})})).then(e=>{let r=0;for(let n of e)if("number"==typeof n&&(r+=1,n!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:r+n}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],n=m();return new Promise((r,i)=>{let s=n=>{this.trace("Failed to bind "+u.subchannelAddressToString(t)+" with error "+n.message),r(v(e.slice(1)))};n.once("error",s),n.listen(t,()=>{let t;let i=n.address(),o={host:i.address,port:i.port};t=h.registerChannelzSocket(u.subchannelAddressToString(o),()=>({localAddress:o,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled),this.channelzEnabled&&this.listenerChildrenTracker.refChild(t),this.http2ServerList.push({server:n,channelzRef:t}),this.trace("Successfully bound "+u.subchannelAddressToString(o)),r(y(e.slice(1),i.port,1)),n.removeListener("error",s)})})},_={onSuccessfulResolution:(t,n,r)=>{let s;if(_.onSuccessfulResolution=()=>{},0===t.length){g(Error(`No addresses resolved for port ${e}`),0);return}(s=u.isTcpSubchannelAddress(t[0])?0===t[0].port?v(t):y(t,t[0].port,0):y(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),g(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),g(null,e.port)},e=>{let n=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,n),g(Error(n),0)})},onError:e=>{g(Error(e.details),0)}};a.createResolver(d,_,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),h.unregisterChannelzRef(t))});this.started=!1,this.sessions.forEach((e,t)=>{t.destroy(r.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&h.unregisterChannelzRef(this.channelzRef)}register(e,t,n,r,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:n,deserialize:r,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&h.unregisterChannelzRef(this.channelzRef),e(t)},n=0;function r(){0==--n&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.http2ServerList))e.listening&&(n++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),h.unregisterChannelzRef(t)),r()}));this.sessions.forEach((e,t)=>{t.closed||(n+=1,t.close(r))}),0===n&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let n=t[r.constants.HTTP2_HEADER_CONTENT_TYPE];return!!("string"==typeof n&&n.startsWith("application/grpc"))||(e.respond({[r.constants.HTTP2_HEADER_STATUS]:r.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){let t=e[d];this.trace("Received call to method "+t+" at address "+this.serverAddressString);let n=this.handlers.get(t);if(void 0===n)throw this.trace("No handler registered for method "+t+". Sending UNIMPLEMENTED status."),g(t);return n}_respondWithError(e,t,n=null){let r=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==n||n.streamTracker.addCallFailed()),r.sendError(e)}_channelzHandler(e,t){let n;let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==r||r.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed();return}try{n=this._retrieveHandler(t)}catch(t){this._respondWithError(t,e,r);return}let o=new s.Http2ServerCallStream(e,n,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",e=>{e?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,n,t)||(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`}))}_streamHandler(e,t){let n;if(!0!==this._verifyContentType(e,t))return;try{n=this._retrieveHandler(t)}catch(t){this._respondWithError(t,e,null);return}let r=new s.Http2ServerCallStream(e,n,this.options);this._runHandlerForCall(r,n,t)||r.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`})}_runHandlerForCall(e,t,n){var r;let i=e.receiveMetadata(n),s=null!==(r=i.get("grpc-encoding")[0])&&void 0!==r?r:"identity";i.remove("grpc-encoding");let{type:o}=t;if("unary"===o)v(e,t,i,s);else if("clientStream"===o)_(e,t,i,s);else if("serverStream"===o)b(e,t,i,s);else{if("bidi"!==o)return!1;S(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),n="null";t&&(n="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=n;let r=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",r.bind(this)),e.on("session",e=>{var t;let n;if(!this.started){e.destroy();return}let r={ref:n=h.registerChannelzSocket(null!==(t=e.socket.remoteAddress)&&void 0!==t?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),streamTracker:new h.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,r);let i=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+i),this.sessionChildrenTracker.refChild(n)),e.on("close",()=>{this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+i),this.sessionChildrenTracker.unrefChild(n),h.unregisterChannelzRef(n)),this.sessions.delete(e)})})}}function v(e,t,n,r){e.receiveUnaryMessage(r,(r,i)=>{if(r){e.sendError(r);return}if(void 0===i||e.cancelled)return;let o=new s.ServerUnaryCallImpl(e,n,i);t.func(o,(t,n,r,i)=>{e.sendUnaryMessage(t,n,r,i)})})}function _(e,t,n,r){let i=new s.ServerReadableStreamImpl(e,n,t.deserialize,r);function o(t,n,r,s){i.destroy(),e.sendUnaryMessage(t,n,r,s)}e.cancelled||(i.on("error",o),t.func(i,o))}function b(e,t,n,r){e.receiveUnaryMessage(r,(r,i)=>{if(r){e.sendError(r);return}if(void 0===i||e.cancelled)return;let o=new s.ServerWritableStreamImpl(e,n,t.serialize,i);t.func(o)})}function S(e,t,n,r){let i=new s.ServerDuplexStreamImpl(e,n,t.serialize,t.deserialize,r);e.cancelled||t.func(i)}t.Server=y},94298:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndSelectServiceConfig=t.validateServiceConfig=void 0;let r=n(22037),i=n(69884),s=/^\d+(\.\d{1,9})?s$/,o="node";function a(e){if(!("service"in e)||"string"!=typeof e.service)throw Error("Invalid method config name: invalid service");let t={service:e.service};if("method"in e){if("string"==typeof e.method)t.method=e.method;else throw Error("Invalid method config name: invalid method")}return t}function l(e){var t;let n={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)n.name.push(a(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");n.waitForReady=e.waitForReady}if("timeout"in e){if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");n.timeout=e.timeout}else if("string"==typeof e.timeout&&s.test(e.timeout)){let r=e.timeout.substring(0,e.timeout.length-1).split(".");n.timeout={seconds:0|r[0],nanos:(null!==(t=r[1])&&void 0!==t?t:0)|0}}else throw Error("Invalid method config: invalid timeout")}if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");n.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");n.maxResponseBytes=e.maxResponseBytes}return n}function u(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e){if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy")}if("loadBalancingConfig"in e){if(Array.isArray(e.loadBalancingConfig))for(let n of e.loadBalancingConfig)t.loadBalancingConfig.push(i.validateLoadBalancingConfig(n));else throw Error("Invalid service config: invalid loadBalancingConfig")}if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let n of e.methodConfig)t.methodConfig.push(l(n));let n=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of n)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);n.push(t)}return t}function c(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:u(e.serviceConfig)};if("clientLanguage"in e){if(Array.isArray(e.clientLanguage))for(let n of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof n)t.clientLanguage.push(n);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage")}if("clientHostname"in e){if(Array.isArray(e.clientHostname))for(let n of(t.clientHostname=[],e.clientHostname))if("string"==typeof n)t.clientHostname.push(n);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname")}if("percentage"in e){if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage")}let n=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!n.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function h(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let n of e){let e=c(n);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let n of e.clientHostname)n===r.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let n of e.clientLanguage)n===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}function d(e,t){for(let n of e)if(n.length>0&&n[0].startsWith("grpc_config="))return h(JSON.parse(n.join("").substring(12)),t);return null}t.validateServiceConfig=u,t.extractAndSelectServiceConfig=d},14339:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusBuilder=void 0;class n{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}t.StatusBuilder=n},80615:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(n||(n={}));class r{constructor(){this.readState=n.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,r=0,i=[];for(;r<e.length;)switch(this.readState){case n.NO_DATA:this.readCompressFlag=e.slice(r,r+1),r+=1,this.readState=n.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case n.READING_SIZE:if(t=Math.min(e.length-r,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,r,r+t),this.readSizeRemaining-=t,r+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=n.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=n.NO_DATA,i.push(e)}}break;case n.READING_MESSAGE:if(t=Math.min(e.length-r,this.readMessageRemaining),this.readPartialMessage.push(e.slice(r,r+t)),this.readMessageRemaining-=t,r+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=n.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}t.StreamDecoder=r},74955:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringToSubchannelAddress=t.subchannelAddressToString=t.subchannelAddressEqual=t.isTcpSubchannelAddress=void 0;let r=n(41808);function i(e){return"port"in e}function s(e,t){return i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path}function o(e){return i(e)?e.host+":"+e.port:e.path}t.isTcpSubchannelAddress=i,t.subchannelAddressEqual=s,t.subchannelAddressToString=o;let a=443;function l(e,t){return r.isIP(e)?{host:e,port:null!=t?t:a}:{path:e}}t.stringToSubchannelAddress=l},40487:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseSubchannelWrapper=void 0;class n{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}}t.BaseSubchannelWrapper=n},87328:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSubchannelPool=t.SubchannelPool=void 0;let r=n(89455),i=n(20389),s=n(74955),o=n(55541),a=1e4;class l{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let n=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());n.length>0&&(e=!1),this.pool[t]=n}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},a),null===(t=(e=this.cleanupTimer).unref)||void 0===t||t.call(e))}getOrCreateSubchannel(e,t,n,a){this.ensureCleanupTask();let l=o.uriToString(e);if(l in this.pool){for(let e of this.pool[l])if(s.subchannelAddressEqual(t,e.subchannelAddress)&&r.channelOptionsEqual(n,e.channelArguments)&&a._equals(e.channelCredentials))return e.subchannel}let u=new i.Subchannel(e,t,n,a);return l in this.pool||(this.pool[l]=[]),this.pool[l].push({subchannelAddress:t,channelArguments:n,channelCredentials:a,subchannel:u}),u.ref(),u}}t.SubchannelPool=l;let u=new l;function c(e){return e?u:new l}t.getSubchannelPool=c},20389:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subchannel=void 0;let r=n(85158),i=n(24404),s=n(72409),o=n(1742),a=n(84063),l=n(25792),u=n(19572),c=n(85242),h=n(41808),d=n(55541),p=n(74955),f=n(65962),g=n(81513).i8,m="subchannel",y="subchannel_flowctrl",v=2147483647,_=2e4,{HTTP2_HEADER_AUTHORITY:b,HTTP2_HEADER_CONTENT_TYPE:S,HTTP2_HEADER_METHOD:w,HTTP2_HEADER_PATH:T,HTTP2_HEADER_TE:E,HTTP2_HEADER_USER_AGENT:C}=r.constants,I=Buffer.from("too_many_pings","ascii");class k{constructor(e,t,n,r){this.channelTarget=e,this.subchannelAddress=t,this.options=n,this.credentials=r,this.connectivityState=s.ConnectivityState.IDLE,this.session=null,this.continueConnecting=!1,this.stateListeners=[],this.disconnectListeners=new Set,this.keepaliveTimeMs=v,this.keepaliveTimeoutMs=_,this.keepaliveWithoutCalls=!1,this.callRefcount=0,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new f.ChannelzCallTracker,this.childrenTracker=new f.ChannelzChildrenTracker,this.channelzSocketRef=null,this.remoteName=null,this.streamTracker=new f.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.userAgent=[n["grpc.primary_user_agent"],`grpc-node-js/${g}`,n["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in n&&(this.keepaliveTimeMs=n["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in n&&(this.keepaliveTimeoutMs=n["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in n?this.keepaliveWithoutCalls=1===n["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,this.keepaliveIntervalId=setTimeout(()=>{},0),clearTimeout(this.keepaliveIntervalId),this.keepaliveTimeoutId=setTimeout(()=>{},0),clearTimeout(this.keepaliveTimeoutId);let i={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new o.BackoffTimeout(()=>{this.handleBackoffTimer()},i),this.subchannelAddressString=p.subchannelAddressToString(t),0===n["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new f.ChannelzTrace,this.channelzRef=f.registerChannelzSubchannel(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(n,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}getChannelzSocketInfo(){var e,t,n;let r;if(null===this.session)return null;let i=this.session.socket,s=i.remoteAddress?p.stringToSubchannelAddress(i.remoteAddress,i.remotePort):null,o=i.localAddress?p.stringToSubchannelAddress(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,n=t.getCipher(),s=t.getCertificate(),o=t.getPeerCertificate();r={cipherSuiteStandardName:null!==(e=n.standardName)&&void 0!==e?e:null,cipherSuiteOtherName:n.standardName?null:n.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:o&&"raw"in o?o.raw:null}}else r=null;return{remoteAddress:s,localAddress:o,security:r,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(t=this.session.state.localWindowSize)&&void 0!==t?t:null,remoteFlowControlWindow:null!==(n=this.session.state.remoteWindowSize)&&void 0!==n?n:null}}resetChannelzSocketInfo(){this.channelzEnabled&&(this.channelzSocketRef&&(f.unregisterChannelzRef(this.channelzSocketRef),this.childrenTracker.unrefChild(this.channelzSocketRef),this.channelzSocketRef=null),this.remoteName=null,this.streamTracker=new f.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null)}trace(e){l.trace(u.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){l.trace(u.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(u.LogVerbosity.DEBUG,y,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(u.LogVerbosity.DEBUG,"subchannel_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(u.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([s.ConnectivityState.TRANSIENT_FAILURE],s.ConnectivityState.CONNECTING):this.transitionToState([s.ConnectivityState.TRANSIENT_FAILURE],s.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}sendPing(){var e,t;this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null===(t=(e=this.keepaliveTimeoutId).unref)||void 0===t||t.call(e);try{this.session.ping((e,t,n)=>{this.keepaliveTrace("Received ping response"),clearTimeout(this.keepaliveTimeoutId)})}catch(e){this.transitionToState([s.ConnectivityState.READY],s.ConnectivityState.TRANSIENT_FAILURE)}}startKeepalivePings(){var e,t;this.keepaliveIntervalId=setInterval(()=>{this.sendPing()},this.keepaliveTimeMs),null===(t=(e=this.keepaliveIntervalId).unref)||void 0===t||t.call(e)}stopKeepalivePings(){clearInterval(this.keepaliveIntervalId),clearTimeout(this.keepaliveTimeoutId)}createSession(e){var t,n,o;e.realTarget?(this.remoteName=d.uriToString(e.realTarget),this.trace("creating HTTP/2 session through proxy to "+e.realTarget)):(this.remoteName=null,this.trace("creating HTTP/2 session"));let c=a.getDefaultAuthority(null!==(t=e.realTarget)&&void 0!==t?t:this.channelTarget),p=this.credentials._getConnectionOptions()||{};p.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in this.options?p.maxSessionMemory=this.options["grpc-node.max_session_memory"]:p.maxSessionMemory=Number.MAX_SAFE_INTEGER;let g="http://";if("secureContext"in p){if(g="https://",this.options["grpc.ssl_target_name_override"]){let e=this.options["grpc.ssl_target_name_override"];p.checkServerIdentity=(t,n)=>i.checkServerIdentity(e,n),p.servername=e}else{let e=null!==(o=null===(n=d.splitHostPort(c))||void 0===n?void 0:n.host)&&void 0!==o?o:"localhost";p.servername=e}e.socket&&(p.createConnection=(t,n)=>e.socket)}else p.createConnection=(t,n)=>e.socket?e.socket:h.connect(this.subchannelAddress);p=Object.assign(Object.assign({},p),this.subchannelAddress);let y=r.connect(g+c,p);this.session=y,this.channelzSocketRef=f.registerChannelzSocket(this.subchannelAddressString,()=>this.getChannelzSocketInfo(),this.channelzEnabled),this.channelzEnabled&&this.childrenTracker.refChild(this.channelzSocketRef),y.unref(),y.once("connect",()=>{this.session===y&&this.transitionToState([s.ConnectivityState.CONNECTING],s.ConnectivityState.READY)}),y.once("close",()=>{this.session===y&&(this.trace("connection closed"),this.transitionToState([s.ConnectivityState.CONNECTING],s.ConnectivityState.TRANSIENT_FAILURE),this.transitionToState([s.ConnectivityState.READY],s.ConnectivityState.IDLE))}),y.once("goaway",(e,t,n)=>{this.session===y&&(e===r.constants.NGHTTP2_ENHANCE_YOUR_CALM&&n.equals(I)&&(this.keepaliveTimeMs=Math.min(2*this.keepaliveTimeMs,v),l.log(u.LogVerbosity.ERROR,`Connection to ${d.uriToString(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTimeMs} ms`)),this.trace("connection closed by GOAWAY with code "+e),this.transitionToState([s.ConnectivityState.CONNECTING,s.ConnectivityState.READY],s.ConnectivityState.IDLE))}),y.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(m)&&(y.on("remoteSettings",e=>{this.trace("new settings received"+(this.session!==y?" on the old connection":"")+": "+JSON.stringify(e))}),y.on("localSettings",e=>{this.trace("local settings acknowledged by remote"+(this.session!==y?" on the old connection":"")+": "+JSON.stringify(e))}))}startConnectingInternal(){var e,t;let n=this.credentials._getConnectionOptions()||{};if("secureContext"in n){if(n.ALPNProtocols=["h2"],this.options["grpc.ssl_target_name_override"]){let e=this.options["grpc.ssl_target_name_override"];n.checkServerIdentity=(t,n)=>i.checkServerIdentity(e,n),n.servername=e}else if("grpc.http_connect_target"in this.options){let r=a.getDefaultAuthority(null!==(e=d.parseUri(this.options["grpc.http_connect_target"]))&&void 0!==e?e:{path:"localhost"}),i=d.splitHostPort(r);n.servername=null!==(t=null==i?void 0:i.host)&&void 0!==t?t:r}}c.getProxiedConnection(this.subchannelAddress,this.options,n).then(e=>{this.createSession(e)},e=>{this.transitionToState([s.ConnectivityState.CONNECTING],s.ConnectivityState.TRANSIENT_FAILURE)})}handleDisconnect(){for(let e of(this.transitionToState([s.ConnectivityState.READY],s.ConnectivityState.TRANSIENT_FAILURE),this.disconnectListeners.values()))e()}transitionToState(e,t){if(-1===e.indexOf(this.connectivityState))return!1;this.trace(s.ConnectivityState[this.connectivityState]+" -> "+s.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO",s.ConnectivityState[this.connectivityState]+" -> "+s.ConnectivityState[t]);let n=this.connectivityState;switch(this.connectivityState=t,t){case s.ConnectivityState.READY:this.stopBackoff();let r=this.session;r.socket.once("close",()=>{this.session===r&&this.handleDisconnect()}),this.keepaliveWithoutCalls&&this.startKeepalivePings();break;case s.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case s.ConnectivityState.TRANSIENT_FAILURE:this.session&&this.session.close(),this.session=null,this.resetChannelzSocketInfo(),this.stopKeepalivePings(),this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case s.ConnectivityState.IDLE:this.session&&this.session.close(),this.session=null,this.resetChannelzSocketInfo(),this.stopKeepalivePings();break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of[...this.stateListeners])e(this,n,t);return!0}checkBothRefcounts(){0===this.callRefcount&&0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.transitionToState([s.ConnectivityState.CONNECTING,s.ConnectivityState.READY],s.ConnectivityState.IDLE),this.channelzEnabled&&f.unregisterChannelzRef(this.channelzRef))}callRef(){this.refTrace("callRefcount "+this.callRefcount+" -> "+(this.callRefcount+1)),0!==this.callRefcount||(this.session&&this.session.ref(),this.backoffTimeout.ref(),this.keepaliveWithoutCalls||this.startKeepalivePings()),this.callRefcount+=1}callUnref(){this.refTrace("callRefcount "+this.callRefcount+" -> "+(this.callRefcount-1)),this.callRefcount-=1,0===this.callRefcount&&(this.session&&this.session.unref(),this.backoffTimeout.unref(),this.keepaliveWithoutCalls||clearInterval(this.keepaliveIntervalId),this.checkBothRefcounts())}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.checkBothRefcounts()}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}startCallStream(e,t,n){let r,i;let o=e.toHttp2Headers();o[b]=t.getHost(),o[C]=this.userAgent,o[S]="application/grpc",o[w]="POST",o[T]=t.getMethod(),o[E]="trailers";try{r=this.session.request(o)}catch(e){throw this.transitionToState([s.ConnectivityState.READY],s.ConnectivityState.TRANSIENT_FAILURE),e}let a="";for(let e of Object.keys(o))a+="		"+e+": "+o[e]+"\n";l.trace(u.LogVerbosity.DEBUG,"call_stream","Starting stream ["+t.getCallNumber()+"] on subchannel ("+this.channelzRef.id+") "+this.subchannelAddressString+" with headers\n"+a),this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize);let c=this.session;this.internalsTrace("session.closed="+c.closed+" session.destroyed="+c.destroyed+" session.socket.destroyed="+c.socket.destroyed),this.channelzEnabled?(this.callTracker.addCallStarted(),t.addStatusWatcher(e=>{e.code===u.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),this.streamTracker.addCallStarted(),t.addStreamEndWatcher(e=>{c===this.session&&(e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed())}),i={addMessageSent:()=>{this.messagesSent+=1,this.lastMessageSentTimestamp=new Date},addMessageReceived:()=>{this.messagesReceived+=1}}):i={addMessageSent:()=>{},addMessageReceived:()=>{}},t.attachHttp2Stream(r,this,n,i)}startConnecting(){this.transitionToState([s.ConnectivityState.IDLE],s.ConnectivityState.CONNECTING)||this.connectivityState!==s.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}addDisconnectListener(e){this.disconnectListeners.add(e)}removeDisconnectListener(e){this.disconnectListeners.delete(e)}resetBackoff(){this.backoffTimeout.reset(),this.transitionToState([s.ConnectivityState.TRANSIENT_FAILURE],s.ConnectivityState.CONNECTING)}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}}t.Subchannel=k},80606:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultRootsData=t.CIPHER_SUITES=void 0;let r=n(57147);t.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;function o(){return i?(null===s&&(s=r.readFileSync(i)),s):null}t.getDefaultRootsData=o},55541:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uriToString=t.splitHostPort=t.parseUri=void 0;let n=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function r(e){let t=n.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}}t.parseUri=r;let i=/^\d+$/;function s(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let n=e.substring(1,t);if(-1===n.indexOf(":"))return null;if(!(e.length>t+1))return{host:n};if(":"!==e[t+1])return null;{let r=e.substring(t+2);return i.test(r)?{host:n,port:+r}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}}function o(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}t.splitHostPort=s,t.uriToString=o},69361:(e,t,n)=>{"use strict";var r;/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */r={value:!0},r=r=r=t.J_=r=r=r=void 0;let i=n(89739),s=n(18612),o=n(56037),a=n(80143);r=n(92897),r=function(e){return"@type"in e&&"string"==typeof e["@type"]};let l={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function u(e,t){return""===e?t:e+"."+t}function c(e){return e instanceof s.Service||e instanceof s.Type||e instanceof s.Enum}function h(e){return e instanceof s.Namespace||e instanceof s.Root}function d(e,t){let n=u(t,e.name);return c(e)?[[n,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>d(e.nested[t],n)).reduce((e,t)=>e.concat(t),[]):[]}function p(e,t){return function(n){return e.toObject(e.decode(n),t)}}function f(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let n=e.fromObject(t);return e.encode(n).finish()}}function g(e,t,n,r){let s=e.resolvedRequestType,o=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:f(s),requestDeserialize:p(s,n),responseSerialize:f(o),responseDeserialize:p(o,n),originalName:i(e.name),requestType:y(s,r),responseType:y(o,r)}}function m(e,t,n,r){let i={};for(let s of e.methodsArray)i[s.name]=g(s,t,n,r);return i}function y(e,t){let n=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:n.$type.toObject(n,l),fileDescriptorProtos:t}}function v(e,t){let n=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:n.$type.toObject(n,l),fileDescriptorProtos:t}}function _(e,t,n,r){if(e instanceof s.Service)return m(e,t,n,r);if(e instanceof s.Type)return y(e,r);if(e instanceof s.Enum)return v(e,r);throw Error("Type mismatch in reflection object handling")}function b(e,t){let n={};e.resolveAll();let r=e.toDescriptor("proto3").file.map(e=>Buffer.from(o.FileDescriptorProto.encode(e).finish()));for(let[i,s]of d(e,""))n[i]=_(s,i,t,r);return n}function S(e,t){t=t||{};let n=s.Root.fromDescriptor(e);return n.resolveAll(),b(n,t)}function w(e,t){return b((0,a.loadProtosWithOptionsSync)(e,t),t)}r=function(e,t){return(0,a.loadProtosWithOptions)(e,t).then(e=>b(e,t))},t.J_=w,r=function(e,t){t=t||{};let n=s.Root.fromJSON(e);return n.resolveAll(),b(n,t)},r=function(e,t){return S(o.FileDescriptorSet.decode(e),t)},r=function(e,t){return S(o.FileDescriptorSet.fromObject(e),t)},(0,a.addCommonProtos)()},80143:(e,t,n)=>{"use strict";/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */Object.defineProperty(t,"__esModule",{value:!0}),t.addCommonProtos=t.loadProtosWithOptionsSync=t.loadProtosWithOptions=void 0;let r=n(57147),i=n(71017),s=n(18612);function o(e,t){let n=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return r.accessSync(t,r.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),n(e,s)}}async function a(e,t){let n=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));o(n,t.includeDirs)}let r=await n.load(e,t);return r.resolveAll(),r}function l(e,t){let n=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");o(n,t.includeDirs)}let r=n.loadSync(e,t);return r.resolveAll(),r}function u(){let e=n(38883),t=n(53242),r=n(88681),i=n(58702);s.common("api",e.nested.google.nested.protobuf.nested),s.common("descriptor",t.nested.google.nested.protobuf.nested),s.common("source_context",r.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}t.loadProtosWithOptions=a,t.loadProtosWithOptionsSync=l,t.addCommonProtos=u},56037:(e,t,n)=>{"use strict";var r=n(18612);e.exports=t=r.descriptor=r.Root.fromJSON(n(53242)).lookup(".google.protobuf");var i=r.Namespace,s=r.Root,o=r.Enum,a=r.Type,l=r.Field,u=r.MapField,c=r.OneOf,h=r.Service,d=r.Method;function p(e,n,r){var u=t.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});r&&(u.syntax=r),e instanceof s||(u.package=e.fullName.substring(1));for(var c,d=0;d<e.nestedArray.length;++d)(c=e._nestedArray[d])instanceof a?u.messageType.push(c.toDescriptor(r)):c instanceof o?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(r)):c instanceof h?u.service.push(c.toDescriptor()):c instanceof i&&p(c,n,r);u.options=E(e.options,t.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&n.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.FileDescriptorSet.decode(e));var n=new s;if(e.file)for(var r,i,u,c=0;c<e.file.length;++c){if(i=n,(r=e.file[c]).package&&r.package.length&&(i=n.define(r.package)),r.name&&r.name.length&&n.files.push(i.filename=r.name),r.messageType)for(u=0;u<r.messageType.length;++u)i.add(a.fromDescriptor(r.messageType[u],r.syntax));if(r.enumType)for(u=0;u<r.enumType.length;++u)i.add(o.fromDescriptor(r.enumType[u]));if(r.extension)for(u=0;u<r.extension.length;++u)i.add(l.fromDescriptor(r.extension[u]));if(r.service)for(u=0;u<r.service.length;++u)i.add(h.fromDescriptor(r.service[u]));var d=T(r.options,t.FileOptions);if(d){var p=Object.keys(d);for(u=0;u<p.length;++u)i.setOption(p[u],d[p[u]])}}return n},s.prototype.toDescriptor=function(e){var n=t.FileDescriptorSet.create();return p(this,n.file,e),n};var f=0;a.fromDescriptor=function(e,n){"number"==typeof e.length&&(e=t.DescriptorProto.decode(e));var r,i=new a(e.name.length?e.name:"Type"+f++,T(e.options,t.MessageOptions));if(e.oneofDecl)for(r=0;r<e.oneofDecl.length;++r)i.add(c.fromDescriptor(e.oneofDecl[r]));if(e.field)for(r=0;r<e.field.length;++r){var s=l.fromDescriptor(e.field[r],n);i.add(s),e.field[r].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[r].oneofIndex].add(s)}if(e.extension)for(r=0;r<e.extension.length;++r)i.add(l.fromDescriptor(e.extension[r],n));if(e.nestedType)for(r=0;r<e.nestedType.length;++r)i.add(a.fromDescriptor(e.nestedType[r],n)),e.nestedType[r].options&&e.nestedType[r].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(r=0;r<e.enumType.length;++r)i.add(o.fromDescriptor(e.enumType[r]));if(e.extensionRange&&e.extensionRange.length)for(r=0,i.extensions=[];r<e.extensionRange.length;++r)i.extensions.push([e.extensionRange[r].start,e.extensionRange[r].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(r=0;r<e.reservedRange.length;++r)i.reserved.push([e.reservedRange[r].start,e.reservedRange[r].end]);if(e.reservedName)for(r=0;r<e.reservedName.length;++r)i.reserved.push(e.reservedName[r])}return i},a.prototype.toDescriptor=function(e){var n,r,i=t.DescriptorProto.create({name:this.name});for(r=0;r<this.fieldsArray.length;++r)if(i.field.push(n=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof u){var s=w(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),c=w(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),h=11===c||14===c?this._fieldsArray[r].resolvedType&&C(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;i.nestedType.push(t.DescriptorProto.create({name:n.typeName,field:[t.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),t.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:h})],options:t.MessageOptions.create({mapEntry:!0})}))}for(r=0;r<this.oneofsArray.length;++r)i.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof l?i.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof a?i.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof o&&i.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)i.extensionRange.push(t.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)"string"==typeof this.reserved[r]?i.reservedName.push(this.reserved[r]):i.reservedRange.push(t.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return i.options=E(this.options,t.MessageOptions),i};var g=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,n){if("number"==typeof e.length&&(e=t.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(r=e.typeName&&e.typeName.length?e.typeName:b(e.type),e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var r,i,s=e.extendee;void 0!==e.extendee&&(s=s.length?s:void 0);var o=new l(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=T(e.options,t.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:g.exec(a)&&(a=parseInt(a))}o.setOption("default",a)}return S(e.type)&&("proto3"===n?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o},l.prototype.toDescriptor=function(e){var n=t.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)n.type=11,n.typeName=r.util.ucFirst(this.name),n.label=3;else{switch(n.type=w(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:n.typeName=this.resolvedType?C(this.parent,this.resolvedType):this.type}switch(this.rule){case"repeated":n.label=3;break;case"required":n.label=2;break;default:n.label=1}}if(n.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(n.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(n.options=E(this.options,t.FieldOptions),null!=this.options.default&&(n.defaultValue=String(this.options.default))),"proto3"===e?this.packed||((n.options||(n.options=t.FieldOptions.create())).packed=!1):this.packed&&((n.options||(n.options=t.FieldOptions.create())).packed=!0),n};var m=0;o.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.EnumDescriptorProto.decode(e));var n={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;n[i&&i.length?i:"NAME"+s]=s}return new o(e.name&&e.name.length?e.name:"Enum"+m++,n,T(e.options,t.EnumOptions))},o.prototype.toDescriptor=function(){for(var e=[],n=0,r=Object.keys(this.values);n<r.length;++n)e.push(t.EnumValueDescriptorProto.create({name:r[n],number:this.values[r[n]]}));return t.EnumDescriptorProto.create({name:this.name,value:e,options:E(this.options,t.EnumOptions)})};var y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return t.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.ServiceDescriptorProto.decode(e));var n=new h(e.name&&e.name.length?e.name:"Service"+v++,T(e.options,t.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)n.add(d.fromDescriptor(e.method[r]));return n},h.prototype.toDescriptor=function(){for(var e=[],n=0;n<this.methodsArray.length;++n)e.push(this._methodsArray[n].toDescriptor());return t.ServiceDescriptorProto.create({name:this.name,method:e,options:E(this.options,t.ServiceOptions)})};var _=0;function b(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function S(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function w(e,t){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof o)return 14;if(t instanceof a)return t.group?10:11;throw Error("illegal type: "+e)}function T(e,t){if(e){for(var n,i,s,a=[],l=0;l<t.fieldsArray.length;++l)"uninterpretedOption"!==(i=(n=t._fieldsArray[l]).name)&&e.hasOwnProperty(i)&&(s=e[i],n.resolvedType instanceof o&&"number"==typeof s&&void 0!==n.resolvedType.valuesById[s]&&(s=n.resolvedType.valuesById[s]),a.push(I(i),s));return a.length?r.util.toObject(a):void 0}}function E(e,t){if(e){for(var n,i,s=[],o=0,a=Object.keys(e);o<a.length;++o)if(i=e[n=a[o]],"default"!==n){var l=t.fields[n];(l||(l=t.fields[n=r.util.camelCase(n)]))&&s.push(n,i)}return s.length?t.fromObject(r.util.toObject(s)):void 0}}function C(e,t){var n=e.fullName.split("."),r=t.fullName.split("."),o=0,a=0,l=r.length-1;if(!(e instanceof s)&&t instanceof i)for(;o<n.length&&a<l&&n[o]===r[a];){var u=t.lookup(n[o++],!0);if(null!==u&&u!==t)break;++a}else for(;o<n.length&&a<l&&n[o]===r[a];++o,++a);return r.slice(a).join(".")}function I(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+_++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,T(e.options,t.MethodOptions))},d.prototype.toDescriptor=function(){return t.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:E(this.options,t.MethodOptions)})}},18612:(e,t,n)=>{"use strict";e.exports=n(94779)},90463:e=>{"use strict";e.exports=r;var t,n=/\/|\./;function r(e,t){n.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),r[e]=t}r("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),r("duration",{Duration:t={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),r("timestamp",{Timestamp:t}),r("empty",{Empty:{fields:{}}}),r("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),r("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),r("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),r.get=function(e){return r[e]||null}},90556:(e,t,n)=>{"use strict";var r=t,i=n(62206),s=n(15269);function o(e,t,n,r){var s=!1;if(t.resolvedType){if(t.resolvedType instanceof i){e("switch(d%s){",r);for(var o=t.resolvedType.values,a=Object.keys(o),l=0;l<a.length;++l)o[a[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),t.repeated||e("break"),s=!0),e("case%j:",a[l])("case %i:",o[a[l]])("m%s=%j",r,o[a[l]])("break");e("}")}else e('if(typeof d%s!=="object")',r)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,n,r)}else{var u=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",r,r);break;case"uint64":u=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,u)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,u?"true":"");break;case"bytes":e('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":e("m%s=String(d%s)",r,r);break;case"bool":e("m%s=Boolean(d%s)",r,r)}}return e}function a(e,t,n,r){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,n,r,r,n,r,r):e("d%s=types[%i].toObject(m%s,o)",r,n,r);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,s?"true":"",r);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:e("d%s=m%s",r,r)}}return e}r.fromObject=function(e){var t=e.fieldsArray,n=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return n("return new this.ctor");n("var m=new this.ctor");for(var r=0;r<t.length;++r){var a=t[r].resolve(),l=s.safeProp(a.name);a.map?(n("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",a.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),o(n,a,r,l+"[ks[i]]")("}")("}")):a.repeated?(n("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",a.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),o(n,a,r,l+"[i]")("}")("}")):(a.resolvedType instanceof i||n("if(d%s!=null){",l),o(n,a,r,l),a.resolvedType instanceof i||n("}"))}return n("return m")},r.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var n=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],o=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?r:t[u].map?o:l).push(t[u]);if(r.length){for(n("if(o.arrays||o.defaults){"),u=0;u<r.length;++u)n("d%s=[]",s.safeProp(r[u].name));n("}")}if(o.length){for(n("if(o.objects||o.defaults){"),u=0;u<o.length;++u)n("d%s={}",s.safeProp(o[u].name));n("}")}if(l.length){for(n("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],h=s.safeProp(c.name);if(c.resolvedType instanceof i)n("d%s=o.enums===String?%j:%j",h,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else n("d%s=%j",h,c.typeDefault)}n("}")}var p=!1;for(u=0;u<t.length;++u){var c=t[u],f=e._fieldsArray.indexOf(c),h=s.safeProp(c.name);c.map?(p||(p=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),a(n,c,f,h+"[ks2[j]]")("}")):c.repeated?(n("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),a(n,c,f,h+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",h,c.name),a(n,c,f,h),c.partOf&&n("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),n("}")}return n("return d")}},36643:(e,t,n)=>{"use strict";e.exports=a;var r=n(62206),i=n(20360),s=n(15269);function o(e){return"missing required '"+e.name+"'"}function a(e){var t=s.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),l=a.resolvedType instanceof r?"int32":a.type,u="m"+s.safeProp(a.name);t("case %i: {",a.id),a.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[a.keyType]?t("k=%j",i.defaults[a.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",a.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",n):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),t(void 0!==i.long[a.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",u)):a.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,n):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,n):t("%s=r.%s()",u,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var c=e._fieldsArray[n];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",o(c))}return t("return m")}},38566:(e,t,n)=>{"use strict";e.exports=a;var r=n(62206),i=n(20360),s=n(15269);function o(e,t,n,r){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,(t.id<<3|2)>>>0)}function a(e){for(var t,n,a=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var u=l[t].resolve(),c=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof r?"int32":u.type,d=i.basic[h];n="m"+s.safeProp(u.name),u.map?(a("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",n,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",n)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===d?a("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,n):a(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,n),a("}")("}")):u.repeated?(a("if(%s!=null&&%s.length){",n,n),u.packed&&void 0!==i.packed[h]?a("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",n)("w.%s(%s[i])",h,n)("w.ldelim()"):(a("for(var i=0;i<%s.length;++i)",n),void 0===d?o(a,u,c,n+"[i]"):a("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,n)),a("}")):(u.optional&&a("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",n,u.name),void 0===d?o(a,u,c,n):a("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,n))}return a("return w")}},62206:(e,t,n)=>{"use strict";e.exports=o;var r=n(90876);((o.prototype=Object.create(r.prototype)).constructor=o).className="Enum";var i=n(6815),s=n(15269);function o(e,t,n,i,s,o){if(r.call(this,e,n),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=o,this.reserved=void 0,t)for(var a=Object.keys(t),l=0;l<a.length;++l)"number"==typeof t[a[l]]&&(this.valuesById[this.values[a[l]]=t[a[l]]]=a[l])}o.fromJSON=function(e,t){var n=new o(e,t.values,t.options,t.comment,t.comments);return n.reserved=t.reserved,n},o.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},o.prototype.add=function(e,t,n,r){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return r&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=r||null),this.comments[e]=n||null,this},o.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},o.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},o.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},43437:(e,t,n)=>{"use strict";e.exports=u;var r,i=n(90876);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var s=n(62206),o=n(20360),a=n(15269),l=/^required|optional|repeated$/;function u(e,t,n,r,s,u,c){if(a.isObject(r)?(c=s,u=r,r=s=void 0):a.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!a.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!a.isString(n))throw TypeError("type must be a string");if(void 0!==r&&!l.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!a.isString(s))throw TypeError("extend must be a string");"proto3_optional"===r&&(r="optional"),this.rule=r&&"optional"!==r?r:void 0,this.type=n,this.id=t,this.extend=s||void 0,this.required="required"===r,this.optional=!this.required,this.repeated="repeated"===r,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!a.Long&&void 0!==o.long[n],this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=c}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,n){return"packed"===e&&(this._packed=null),i.prototype.setOption.call(this,e,t,n)},u.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return a.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=o.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof r?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=a.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;a.base64.test(this.typeDefault)?a.base64.decode(this.typeDefault,e=a.newBuffer(a.base64.length(this.typeDefault)),0):a.utf8.write(this.typeDefault,e=a.newBuffer(a.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=a.emptyObject:this.repeated?this.defaultValue=a.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof r&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.d=function(e,t,n,r){return"function"==typeof t?t=a.decorateType(t).name:t&&"object"==typeof t&&(t=a.decorateEnum(t).name),function(i,s){a.decorateType(i.constructor).add(new u(s,e,t,n,{default:r}))}},u._configure=function(e){r=e}},94024:(e,t,n)=>{"use strict";var r=e.exports=n(4394);function i(e,t,n){return"function"==typeof t?(n=t,t=new r.Root):t||(t=new r.Root),t.load(e,n)}function s(e,t){return t||(t=new r.Root),t.loadSync(e)}r.build="light",r.load=i,r.loadSync=s,r.encoder=n(38566),r.decoder=n(36643),r.verifier=n(30007),r.converter=n(90556),r.ReflectionObject=n(90876),r.Namespace=n(6815),r.Root=n(33928),r.Enum=n(62206),r.Type=n(71646),r.Field=n(43437),r.OneOf=n(29108),r.MapField=n(19281),r.Service=n(21187),r.Method=n(37951),r.Message=n(14675),r.wrappers=n(95343),r.types=n(20360),r.util=n(15269),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)},4394:(e,t,n)=>{"use strict";var r=t;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(57847),r.BufferWriter=n(69022),r.Reader=n(55377),r.BufferReader=n(79226),r.util=n(62231),r.rpc=n(35857),r.roots=n(92784),r.configure=i,i()},94779:(e,t,n)=>{"use strict";var r=e.exports=n(94024);r.build="full",r.tokenize=n(22670),r.parse=n(72890),r.common=n(90463),r.Root._configure(r.Type,r.parse,r.common)},19281:(e,t,n)=>{"use strict";e.exports=o;var r=n(43437);((o.prototype=Object.create(r.prototype)).constructor=o).className="MapField";var i=n(20360),s=n(15269);function o(e,t,n,i,o,a){if(r.call(this,e,t,i,void 0,void 0,o,a),!s.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}o.fromJSON=function(e,t){return new o(e,t.id,t.keyType,t.type,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},o.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},o.d=function(e,t,n){return"function"==typeof n?n=s.decorateType(n).name:n&&"object"==typeof n&&(n=s.decorateEnum(n).name),function(r,i){s.decorateType(r.constructor).add(new o(i,e,t,n))}}},14675:(e,t,n)=>{"use strict";e.exports=i;var r=n(62231);function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)this[t[n]]=e[t[n]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},37951:(e,t,n)=>{"use strict";e.exports=s;var r=n(90876);((s.prototype=Object.create(r.prototype)).constructor=s).className="Method";var i=n(15269);function s(e,t,n,s,o,a,l,u,c){if(i.isObject(o)?(l=o,o=a=void 0):i.isObject(a)&&(l=a,a=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(n))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");r.call(this,e,l),this.type=t||"rpc",this.requestType=n,this.requestStream=!!o||void 0,this.responseType=s,this.responseStream=!!a||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}},6815:(e,t,n)=>{"use strict";e.exports=h;var r,i,s,o=n(90876);((h.prototype=Object.create(o.prototype)).constructor=h).className="Namespace";var a=n(43437),l=n(15269),u=n(29108);function c(e,t){if(e&&e.length){for(var n={},r=0;r<e.length;++r)n[e[r].name]=e[r].toJSON(t);return n}}function h(e,t){o.call(this,e,t),this.nested=void 0,this._nestedArray=null}function d(e){return e._nestedArray=null,e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=c,h.isReservedId=function(e,t){if(e){for(var n=0;n<e.length;++n)if("string"!=typeof e[n]&&e[n][0]<=t&&e[n][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var n=0;n<e.length;++n)if(e[n]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),h.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var n,o=Object.keys(e),l=0;l<o.length;++l)n=e[o[l]],t.add((void 0!==n.fields?r.fromJSON:void 0!==n.values?s.fromJSON:void 0!==n.methods?i.fromJSON:void 0!==n.id?a.fromJSON:h.fromJSON)(o[l],n));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof a&&void 0!==e.extend||e instanceof r||e instanceof u||e instanceof s||e instanceof i||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(t instanceof h&&e instanceof h&&!(t instanceof r||t instanceof i)){for(var n=t.nestedArray,o=0;o<n.length;++o)e.add(n[o]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof o))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var n=this;e.length>0;){var r=e.shift();if(n.nested&&n.nested[r]){if(!((n=n.nested[r])instanceof h))throw Error("path conflicts with non-namespace objects")}else n.add(n=new h(r))}return t&&n.addJSON(t),n},h.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this.resolve()},h.prototype.lookup=function(e,t,n){if("boolean"==typeof t?(n=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(1===e.length){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof h&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof h&&(r=this._nestedArray[i].lookup(e,t,!0)))return r;return null===this.parent||n?null:this.parent.lookup(e,t)},h.prototype.lookupType=function(e){var t=this.lookup(e,[r]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[r,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,n){r=e,i=t,s=n}},90876:(e,t,n)=>{"use strict";e.exports=s,s.className="ReflectionObject";var r,i=n(15269);function s(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(s.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),s.prototype.toJSON=function(){throw Error()},s.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof r&&t._handleAdd(this)},s.prototype.onRemove=function(e){var t=e.root;t instanceof r&&t._handleRemove(this),this.parent=null,this.resolved=!1},s.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},s.prototype.getOption=function(e){if(this.options)return this.options[e]},s.prototype.setOption=function(e,t,n){return n&&this.options&&void 0!==this.options[e]||((this.options||(this.options={}))[e]=t),this},s.prototype.setParsedOption=function(e,t,n){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(n){var s=r.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(s){var o=s[e];i.setProperty(o,n,t)}else(s={})[e]=i.setProperty({},n,t),r.push(s)}else{var a={};a[e]=t,r.push(a)}return this},s.prototype.setOptions=function(e,t){if(e)for(var n=Object.keys(e),r=0;r<n.length;++r)this.setOption(n[r],e[n[r]],t);return this},s.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},s._configure=function(e){r=e}},29108:(e,t,n)=>{"use strict";e.exports=o;var r=n(90876);((o.prototype=Object.create(r.prototype)).constructor=o).className="OneOf";var i=n(43437),s=n(15269);function o(e,t,n,i){if(Array.isArray(t)||(n=t,t=void 0),r.call(this,e,n),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function a(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}o.fromJSON=function(e,t){return new o(e,t.oneof,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},o.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,a(this),this},o.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},o.prototype.onAdd=function(e){r.prototype.onAdd.call(this,e);for(var t=this,n=0;n<this.oneof.length;++n){var i=e.get(this.oneof[n]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}a(this)},o.prototype.onRemove=function(e){for(var t,n=0;n<this.fieldsArray.length;++n)(t=this.fieldsArray[n]).parent&&t.parent.remove(t);r.prototype.onRemove.call(this,e)},o.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,n){s.decorateType(t.constructor).add(new o(n,e)),Object.defineProperty(t,n,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},72890:(e,t,n)=>{"use strict";e.exports=E,E.filename=null,E.defaults={keepCase:!1};var r=n(22670),i=n(33928),s=n(71646),o=n(43437),a=n(19281),l=n(29108),u=n(62206),c=n(21187),h=n(37951),d=n(20360),p=n(15269),f=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,m=/^0[x][0-9a-fA-F]+$/,y=/^-?0[x][0-9a-fA-F]+$/,v=/^0[0-7]+$/,_=/^-?0[0-7]+$/,b=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,S=/^[a-zA-Z_][a-zA-Z_0-9]*$/,w=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,T=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function E(e,t,n){t instanceof i||(n=t,t=new i),n||(n=E.defaults);var C,I,k,R,O,N=n.preferTrailingComment||!1,A=r(e,n.alternateCommentMode||!1),x=A.next,D=A.push,P=A.peek,M=A.skip,L=A.cmnt,F=!0,B=!1,j=t,U=n.keepCase?function(e){return e}:p.camelCase;function q(e,t,n){var r=E.filename;return n||(E.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(r?r+", ":"")+"line "+A.line+")")}function V(){var e,t=[];do{if('"'!==(e=x())&&"'"!==e)throw q(e);t.push(x()),M(e),e=P()}while('"'===e||"'"===e);return t.join("")}function z(e){var t=x();switch(t){case"'":case'"':return D(t),V();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return $(t,!0)}catch(n){if(e&&w.test(t))return t;throw q(t,"value")}}function W(e,t){var n,r;do t&&('"'===(n=P())||"'"===n)?e.push(V()):e.push([r=G(x()),M("to",!0)?G(x()):r]);while(M(",",!0));M(";")}function $(e,t){var n=1;switch("-"===e.charAt(0)&&(n=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*n;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(f.test(e))return n*parseInt(e,10);if(m.test(e))return n*parseInt(e,16);if(v.test(e))return n*parseInt(e,8);if(b.test(e))return n*parseFloat(e);throw q(e,"number",t)}function G(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw q(e,"id");if(g.test(e))return parseInt(e,10);if(y.test(e))return parseInt(e,16);if(_.test(e))return parseInt(e,8);throw q(e,"id")}function H(){if(void 0!==I)throw q("package");if(I=x(),!w.test(I))throw q(I,"name");j=j.define(I),M(";")}function K(){var e,t=P();switch(t){case"weak":e=R||(R=[]),x();break;case"public":x();default:e=k||(k=[])}t=V(),M(";"),e.push(t)}function Q(){if(M("="),!(B="proto3"===(O=V()))&&"proto2"!==O)throw q(O,"syntax");M(";")}function Y(e,t){switch(t){case"option":return es(e,t),M(";"),!0;case"message":return X(e,t),!0;case"enum":return er(e,t),!0;case"service":return ec(e,t),!0;case"extend":return ed(e,t),!0}return!1}function J(e,t,n){var r,i=A.line;if(e&&("string"!=typeof e.comment&&(e.comment=L()),e.filename=E.filename),M("{",!0)){for(;"}"!==(r=x());)t(r);M(";",!0)}else n&&n(),M(";"),e&&("string"!=typeof e.comment||N)&&(e.comment=L(i)||e.comment)}function X(e,t){if(!S.test(t=x()))throw q(t,"type name");var n=new s(t);J(n,function(e){if(!Y(n,e))switch(e){case"map":et(n,e);break;case"required":case"repeated":Z(n,e);break;case"optional":B?Z(n,"proto3_optional"):Z(n,"optional");break;case"oneof":en(n,e);break;case"extensions":W(n.extensions||(n.extensions=[]));break;case"reserved":W(n.reserved||(n.reserved=[]),!0);break;default:if(!B||!w.test(e))throw q(e);D(e),Z(n,"optional")}}),e.add(n)}function Z(e,t,n){var r=x();if("group"===r){ee(e,t);return}for(;r.endsWith(".")||P().startsWith(".");)r+=x();if(!w.test(r))throw q(r,"type");var i=x();if(!S.test(i))throw q(i,"name");i=U(i),M("=");var s=new o(i,G(x()),r,t,n);if(J(s,function(e){if("option"===e)es(s,e),M(";");else throw q(e)},function(){eu(s)}),"proto3_optional"===t){var a=new l("_"+i);s.setOption("proto3_optional",!0),a.add(s),e.add(a)}else e.add(s);!B&&s.repeated&&(void 0!==d.packed[r]||void 0===d.basic[r])&&s.setOption("packed",!1,!0)}function ee(e,t){var n=x();if(!S.test(n))throw q(n,"name");var r=p.lcFirst(n);n===r&&(n=p.ucFirst(n)),M("=");var i=G(x()),a=new s(n);a.group=!0;var l=new o(r,i,n,t);l.filename=E.filename,J(a,function(e){switch(e){case"option":es(a,e),M(";");break;case"required":case"repeated":Z(a,e);break;case"optional":B?Z(a,"proto3_optional"):Z(a,"optional");break;case"message":X(a,e);break;case"enum":er(a,e);break;default:throw q(e)}}),e.add(a).add(l)}function et(e){M("<");var t=x();if(void 0===d.mapKey[t])throw q(t,"type");M(",");var n=x();if(!w.test(n))throw q(n,"type");M(">");var r=x();if(!S.test(r))throw q(r,"name");M("=");var i=new a(U(r),G(x()),t,n);J(i,function(e){if("option"===e)es(i,e),M(";");else throw q(e)},function(){eu(i)}),e.add(i)}function en(e,t){if(!S.test(t=x()))throw q(t,"name");var n=new l(U(t));J(n,function(e){"option"===e?(es(n,e),M(";")):(D(e),Z(n,"optional"))}),e.add(n)}function er(e,t){if(!S.test(t=x()))throw q(t,"name");var n=new u(t);J(n,function(e){switch(e){case"option":es(n,e),M(";");break;case"reserved":W(n.reserved||(n.reserved=[]),!0);break;default:ei(n,e)}}),e.add(n)}function ei(e,t){if(!S.test(t))throw q(t,"name");M("=");var n=G(x(),!0),r={options:void 0};r.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},J(r,function(e){if("option"===e)es(r,e),M(";");else throw q(e)},function(){eu(r)}),e.add(t,n,r.comment,r.options)}function es(e,t){var n,r=M("(",!0);if(!w.test(t=x()))throw q(t,"name");var i=t,s=i;r&&(M(")"),s=i="("+i+")",t=P(),T.test(t)&&(n=t.slice(1),i+=t,x())),M("=");var o=eo(e,i);el(e,s,o,n)}function eo(e,t){if(M("{",!0)){for(var n={};!M("}",!0);){if(!S.test(C=x()))throw q(C,"name");if(null===C)throw q(C,"end of input");var r,i,s=C;if(M(":",!0),"{"===P())r=eo(e,t+"."+C);else if("["===P()){if(r=[],M("[",!0)){do i=z(!0),r.push(i);while(M(",",!0));M("]"),void 0!==i&&ea(e,t+"."+C,i)}}else r=z(!0),ea(e,t+"."+C,r);var o=n[s];o&&(r=[].concat(o).concat(r)),n[s]=r,M(",",!0),M(";",!0)}return n}var a=z(!0);return ea(e,t,a),a}function ea(e,t,n){e.setOption&&e.setOption(t,n)}function el(e,t,n,r){e.setParsedOption&&e.setParsedOption(t,n,r)}function eu(e){if(M("[",!0)){do es(e,"option");while(M(",",!0));M("]")}return e}function ec(e,t){if(!S.test(t=x()))throw q(t,"service name");var n=new c(t);J(n,function(e){if(!Y(n,e)){if("rpc"===e)eh(n,e);else throw q(e)}}),e.add(n)}function eh(e,t){var n=L(),r=t;if(!S.test(t=x()))throw q(t,"name");var i,s,o,a,l=t;if(M("("),M("stream",!0)&&(s=!0),!w.test(t=x())||(i=t,M(")"),M("returns"),M("("),M("stream",!0)&&(a=!0),!w.test(t=x())))throw q(t);o=t,M(")");var u=new h(l,r,i,o,s,a);u.comment=n,J(u,function(e){if("option"===e)es(u,e),M(";");else throw q(e)}),e.add(u)}function ed(e,t){if(!w.test(t=x()))throw q(t,"reference");var n=t;J(null,function(t){switch(t){case"required":case"repeated":Z(e,t,n);break;case"optional":B?Z(e,"proto3_optional",n):Z(e,"optional",n);break;default:if(!B||!w.test(t))throw q(t);D(t),Z(e,"optional",n)}})}for(;null!==(C=x());)switch(C){case"package":if(!F)throw q(C);H();break;case"import":if(!F)throw q(C);K();break;case"syntax":if(!F)throw q(C);Q();break;case"option":es(j,C),M(";");break;default:if(Y(j,C)){F=!1;continue}throw q(C)}return E.filename=null,{package:I,imports:k,weakImports:R,syntax:O,root:t}}},55377:(e,t,n)=>{"use strict";e.exports=l;var r,i=n(62231),s=i.LongBits,o=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new r(e):u(e)})(e)}:u};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,n);if(t===n){var r=i.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,n)},l.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do if(this.pos>=this.len)throw a(this);while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){r=e,l.create=c(),r._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},79226:(e,t,n)=>{"use strict";e.exports=s;var r=n(55377);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(62231);function s(e){r.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},33928:(e,t,n)=>{"use strict";e.exports=h;var r,i,s,o=n(6815);((h.prototype=Object.create(o.prototype)).constructor=h).className="Root";var a=n(43437),l=n(62206),u=n(29108),c=n(15269);function h(e){o.call(this,"",e),this.deferred=[],this.files=[]}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},h.prototype.resolvePath=c.path.resolve,h.prototype.fetch=c.fetch,h.prototype.load=function e(t,n,r){"function"==typeof n&&(r=n,n=void 0);var o=this;if(!r)return c.asPromise(e,o,t,n);var a=r===d;function l(e,t){if(r){var n=r;if(r=null,a)throw e;n(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var n=e.substring(t);if(n in s)return n}return null}function h(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;var r,s=i(t,o,n),h=0;if(s.imports)for(;h<s.imports.length;++h)(r=u(s.imports[h])||o.resolvePath(e,s.imports[h]))&&p(r);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(r=u(s.weakImports[h])||o.resolvePath(e,s.weakImports[h]))&&p(r,!0)}else o.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}a||f||l(null,o)}function p(e,t){if(e=u(e)||e,!(o.files.indexOf(e)>-1)){if(o.files.push(e),e in s){a?h(e,s[e]):(++f,setTimeout(function(){--f,h(e,s[e])}));return}if(a){var n;try{n=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,n)}else++f,o.fetch(e,function(n,i){if(--f,r){if(n){t?f||l(null,o):l(n);return}h(e,i)}})}}var f=0;c.isString(t)&&(t=[t]);for(var g,m=0;m<t.length;++m)(g=o.resolvePath("",t[m]))&&p(g);if(a)return o;f||l(null,o)},h.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return o.prototype.resolveAll.call(this)};var p=/^[A-Z]/;function f(e,t){var n=t.parent.lookup(t.extend);if(n){var r=new a(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!n.get(r.name)||(r.declaringField=t,t.extensionField=r,n.add(r),!0)}return!1}h.prototype._handleAdd=function(e){if(e instanceof a)void 0===e.extend||e.extensionField||f(this,e)||this.deferred.push(e);else if(e instanceof l)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof r)for(var t=0;t<this.deferred.length;)f(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var n=0;n<e.nestedArray.length;++n)this._handleAdd(e._nestedArray[n]);p.test(e.name)&&(e.parent[e.name]=e)}},h.prototype._handleRemove=function(e){if(e instanceof a){if(void 0!==e.extend){if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}}else if(e instanceof l)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof o){for(var n=0;n<e.nestedArray.length;++n)this._handleRemove(e._nestedArray[n]);p.test(e.name)&&delete e.parent[e.name]}},h._configure=function(e,t,n){r=e,i=t,s=n}},92784:e=>{"use strict";e.exports={}},35857:(e,t,n)=>{"use strict";t.Service=n(25280)},25280:(e,t,n)=>{"use strict";e.exports=i;var r=n(62231);function i(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,n,i,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,i,s);if(!a.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,n){if(e)return a.emit("error",e,t),o(e);if(null===n){a.end(!0);return}if(!(n instanceof i))try{n=i[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)})}catch(e){a.emit("error",e,t),setTimeout(function(){o(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},21187:(e,t,n)=>{"use strict";e.exports=a;var r=n(6815);((a.prototype=Object.create(r.prototype)).constructor=a).className="Service";var i=n(37951),s=n(15269),o=n(35857);function a(e,t){r.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}a.fromJSON=function(e,t){var n=new a(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),s=0;s<r.length;++s)n.add(i.fromJSON(r[s],t.methods[r[s]]));return t.nested&&n.addJSON(t.nested),n.comment=t.comment,n},a.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&!!e.keepComments;return s.toObject(["options",t&&t.options||void 0,"methods",r.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},Object.defineProperty(a.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),a.prototype.get=function(e){return this.methods[e]||r.prototype.get.call(this,e)},a.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return r.prototype.resolve.call(this)},a.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):r.prototype.add.call(this,e)},a.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return r.prototype.remove.call(this,e)},a.prototype.create=function(e,t,n){for(var r,i=new o.Service(e,t,n),a=0;a<this.methodsArray.length;++a){var l=s.lcFirst((r=this._methodsArray[a]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return i}},22670:e=>{"use strict";e.exports=h;var t=/[\s{}=;:[\],'"()<>]/g,n=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,r=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,i=/^ *[*/]+ */,s=/^\s*\*?\/*/,o=/\n/g,a=/\s/,l=/\\(.?)/g,u={0:"\0",r:"\r",n:"\n",t:"	"};function c(e){return e.replace(l,function(e,t){switch(t){case"\\":case"":return t;default:return u[t]||""}})}function h(e,l){e=e.toString();var u=0,h=e.length,d=1,p=0,f={},g=[],m=null;function y(e){return Error("illegal "+e+" (line "+d+")")}function v(){var t="'"===m?r:n;t.lastIndex=u-1;var i=t.exec(e);if(!i)throw y("string");return u=t.lastIndex,E(m),m=null,c(i[1])}function _(t){return e.charAt(t)}function b(t,n,r){var a,u,c={type:e.charAt(t++),lineEmpty:!1,leading:r},h=t-(a=l?2:3);do if(--h<0||"\n"===(u=e.charAt(h))){c.lineEmpty=!0;break}while(" "===u||"	"===u);for(var g=e.substring(t,n).split(o),m=0;m<g.length;++m)g[m]=g[m].replace(l?s:i,"").trim();c.text=g.join("\n").trim(),f[d]=c,p=d}function S(t){var n=w(t),r=e.substring(t,n);return/^\s*\/\//.test(r)}function w(e){for(var t=e;t<h&&"\n"!==_(t);)t++;return t}function T(){if(g.length>0)return g.shift();if(m)return v();var n,r,i,s,o,c=0===u;do{if(u===h)return null;for(n=!1;a.test(i=_(u));)if("\n"===i&&(c=!0,++d),++u===h)return null;if("/"===_(u)){if(++u===h)throw y("comment");if("/"===_(u)){if(l){if(s=u,o=!1,S(u-1)){o=!0;do if((u=w(u))===h||(u++,!c))break;while(S(u))}else u=Math.min(h,w(u)+1);o&&(b(s,u,c),c=!0),d++,n=!0}else{for(o="/"===_(s=u+1);"\n"!==_(++u);)if(u===h)return null;++u,o&&(b(s,u-1,c),c=!0),++d,n=!0}}else{if("*"!==(i=_(u)))return"/";s=u+1,o=l||"*"===_(s);do{if("\n"===i&&++d,++u===h)throw y("comment");r=i,i=_(u)}while("*"!==r||"/"!==i);++u,o&&(b(s,u-2,c),c=!0),n=!0}}}while(n);var p=u;if(t.lastIndex=0,!t.test(_(p++)))for(;p<h&&!t.test(_(p));)++p;var f=e.substring(u,u=p);return('"'===f||"'"===f)&&(m=f),f}function E(e){g.push(e)}function C(){if(!g.length){var e=T();if(null===e)return null;E(e)}return g[0]}function I(e,t){var n=C();if(n===e)return T(),!0;if(!t)throw y("token '"+n+"', '"+e+"' expected");return!1}function k(e){var t,n=null;return void 0===e?(t=f[d-1],delete f[d-1],t&&(l||"*"===t.type||t.lineEmpty)&&(n=t.leading?t.text:null)):(p<e&&C(),t=f[e],delete f[e],t&&!t.lineEmpty&&(l||"/"===t.type)&&(n=t.leading?null:t.text)),n}return Object.defineProperty({next:T,peek:C,push:E,skip:I,cmnt:k},"line",{get:function(){return d}})}h.unescape=c},71646:(e,t,n)=>{"use strict";e.exports=v;var r=n(6815);((v.prototype=Object.create(r.prototype)).constructor=v).className="Type";var i=n(62206),s=n(29108),o=n(43437),a=n(19281),l=n(21187),u=n(14675),c=n(55377),h=n(57847),d=n(15269),p=n(38566),f=n(36643),g=n(30007),m=n(90556),y=n(95343);function v(e,t){r.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function _(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var n=this.fields[e[t]],r=n.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=n}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var n=0;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();var r={};for(n=0;n<this.oneofsArray.length;++n)r[this._oneofsArray[n].resolve().name]={get:d.oneOfGetter(this._oneofsArray[n].oneof),set:d.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(e.prototype,r)}}}),v.generateConstructor=function(e){for(var t,n=d.codegen(["p"],e.name),r=0;r<e.fieldsArray.length;++r)(t=e._fieldsArray[r]).map?n("this%s={}",d.safeProp(t.name)):t.repeated&&n("this%s=[]",d.safeProp(t.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var n=new v(e,t.options);n.extensions=t.extensions,n.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)n.add((void 0!==t.fields[u[c]].keyType?a.fromJSON:o.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)n.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var h=t.nested[u[c]];n.add((void 0!==h.id?o.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:r.fromJSON)(u[c],h))}return t.extensions&&t.extensions.length&&(n.extensions=t.extensions),t.reserved&&t.reserved.length&&(n.reserved=t.reserved),t.group&&(n.group=!0),t.comment&&(n.comment=t.comment),n},v.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&!!e.keepComments;return d.toObject(["options",t&&t.options||void 0,"oneofs",r.arrayToJSON(this.oneofsArray,e),"fields",r.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},v.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var n=this.oneofsArray;for(t=0;t<n.length;)n[t++].resolve();return r.prototype.resolveAll.call(this)},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof o&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),_(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),_(this)):r.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof o&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),_(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),_(this)}return r.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],n=0;n<this.fieldsArray.length;++n)t.push(this._fieldsArray[n].resolve().resolvedType);this.encode=p(this)({Writer:h,types:t,util:d}),this.decode=f(this)({Reader:c,types:t,util:d}),this.verify=g(this)({types:t,util:d}),this.fromObject=m.fromObject(this)({types:t,util:d}),this.toObject=m.toObject(this)({types:t,util:d});var r=y[e];if(r){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(i),i.toObject=this.toObject,this.toObject=r.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},20360:(e,t,n)=>{"use strict";var r=t,i=n(15269),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function o(e,t){var n=0,r={};for(t|=0;n<e.length;)r[s[n+t]]=e[n++];return r}r.basic=o([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=o([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),r.long=o([0,0,0,1,1],7),r.mapKey=o([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=o([1,5,0,0,0,5,5,0,0,0,1,1,0])},15269:(e,t,n)=>{"use strict";var r,i,s=e.exports=n(62231),o=n(92784);s.codegen=n(696),s.fetch=n(37828),s.path=n(62727),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),n=Array(t.length),r=0;r<t.length;)n[r]=e[t[r++]];return n}return[]},s.toObject=function(e){for(var t={},n=0;n<e.length;){var r=e[n++],i=e[n++];void 0!==i&&(t[r]=i)}return t};var a=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(a,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(s.decorateRoot.remove(e.$type),e.$type.name=t,s.decorateRoot.add(e.$type)),e.$type;r||(r=n(71646));var i=new r(t||e.name);return s.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;s.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=n(62206));var t=new i("Enum"+c++,e);return s.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},s.setProperty=function(e,t,n){function r(e,t,n){var i=t.shift();if("__proto__"===i||"prototype"===i)return e;if(t.length>0)e[i]=r(e[i]||{},t,n);else{var s=e[i];s&&(n=[].concat(s).concat(n)),e[i]=n}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return r(e,t=t.split("."),n)},Object.defineProperty(s,"decorateRoot",{get:function(){return o.decorated||(o.decorated=new(n(33928)))}})},34041:(e,t,n)=>{"use strict";e.exports=i;var r=n(62231);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===o?s:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},62231:function(e,t,n){"use strict";var r=t;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function s(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),n&&i(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(61417),r.base64=n(75386),r.EventEmitter=n(33478),r.float=n(65256),r.inquire=n(71374),r.utf8=n(93670),r.pool=n(26733),r.LongBits=n(34041),r.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),r.global=r.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!!(null!=n&&e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;if(!e){r._Buffer_from=r._Buffer_allocUnsafe=null;return}r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},30007:(e,t,n)=>{"use strict";e.exports=l;var r=n(62206),i=n(15269);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function o(e,t,n,i){if(t.resolvedType){if(t.resolvedType instanceof r){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var o=Object.keys(t.resolvedType.values),a=0;a<o.length;++a)e("case %i:",t.resolvedType.values[o[a]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",n,i)("if(e)")("return%j+e",t.name+".")("}")}else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function a(e,t,n){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",n)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",n)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",n)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n=e.oneofsArray,r={};n.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),a(t,u,"k[i]"),o(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),o(t,u,l,c+"[i]")("}");else{if(u.partOf){var h=i.safeProp(u.partOf.name);1===r[u.partOf.name]&&t("if(p%s===1)",h)("return%j",u.partOf.name+": multiple values"),r[u.partOf.name]=1,t("p%s=1",h)}o(t,u,l,c)}u.optional&&t("}")}return t("return null")}},95343:(e,t,n)=>{"use strict";var r=t,i=n(14675);r[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),n=this.lookup(t);if(n){var r="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===r.indexOf("/")&&(r="/"+r),this.create({type_url:r,value:n.encode(n.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var n="type.googleapis.com/",r="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),r=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var o=this.lookup(s);o&&(e=o.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var a=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===r&&(r=n),s=r+l,a["@type"]=s,a}return this.toObject(e,t)}}},57847:(e,t,n)=>{"use strict";e.exports=h;var r,i=n(62231),s=i.LongBits,o=i.base64,a=i.utf8;function l(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function f(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}function g(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function y(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new l(e,t,n),this.len+=t,this},g.prototype=Object.create(l.prototype),g.prototype.fn=f,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new g((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=d(),r._configure()}},69022:(e,t,n)=>{"use strict";e.exports=s;var r=n(57847);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(62231);function s(){r.call(this)}function o(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},s._configure()},13716:(e,t,n)=>{"use strict";var r;/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */r={value:!0};let i=n(89739),s=n(11101),o=n(92607),a=n(68720);r=n(96508),r=function(e){return"@type"in e&&"string"==typeof e["@type"]};let l={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function u(e,t){return""===e?t:e+"."+t}function c(e){return e instanceof s.Service||e instanceof s.Type||e instanceof s.Enum}function h(e){return e instanceof s.Namespace||e instanceof s.Root}function d(e,t){let n=u(t,e.name);return c(e)?[[n,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>d(e.nested[t],n)).reduce((e,t)=>e.concat(t),[]):[]}function p(e,t){return function(n){return e.toObject(e.decode(n),t)}}function f(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let n=e.fromObject(t);return e.encode(n).finish()}}function g(e,t,n,r){let s=e.resolvedRequestType,o=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:f(s),requestDeserialize:p(s,n),responseSerialize:f(o),responseDeserialize:p(o,n),originalName:i(e.name),requestType:y(s,r),responseType:y(o,r)}}function m(e,t,n,r){let i={};for(let s of e.methodsArray)i[s.name]=g(s,t,n,r);return i}function y(e,t){let n=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:n.$type.toObject(n,l),fileDescriptorProtos:t}}function v(e,t){let n=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:n.$type.toObject(n,l),fileDescriptorProtos:t}}function _(e,t,n,r){if(e instanceof s.Service)return m(e,t,n,r);if(e instanceof s.Type)return y(e,r);if(e instanceof s.Enum)return v(e,r);throw Error("Type mismatch in reflection object handling")}function b(e,t){let n={};e.resolveAll();let r=e.toDescriptor("proto3").file.map(e=>Buffer.from(o.FileDescriptorProto.encode(e).finish()));for(let[i,s]of d(e,""))n[i]=_(s,i,t,r);return n}function S(e,t){t=t||{};let n=s.Root.fromDescriptor(e);return n.resolveAll(),b(n,t)}function w(e,t){t=t||{};let n=s.Root.fromJSON(e);return n.resolveAll(),b(n,t)}r=function(e,t){return a.loadProtosWithOptions(e,t).then(e=>b(e,t))},r=function(e,t){return b(a.loadProtosWithOptionsSync(e,t),t)},t.im=w,r=function(e,t){return S(o.FileDescriptorSet.decode(e),t)},r=function(e,t){return S(o.FileDescriptorSet.fromObject(e),t)},a.addCommonProtos()},68720:(e,t,n)=>{"use strict";/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */Object.defineProperty(t,"__esModule",{value:!0});let r=n(57147),i=n(71017),s=n(11101);function o(e,t){let n=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return r.accessSync(t,r.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),n(e,s)}}async function a(e,t){let n=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));o(n,t.includeDirs)}let r=await n.load(e,t);return r.resolveAll(),r}function l(e,t){let n=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");o(n,t.includeDirs)}let r=n.loadSync(e,t);return r.resolveAll(),r}function u(){let e=n(56541),t=n(89987),r=n(57674),i=n(73795);s.common("api",e.nested.google.nested.protobuf.nested),s.common("descriptor",t.nested.google.nested.protobuf.nested),s.common("source_context",r.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}t.loadProtosWithOptions=a,t.loadProtosWithOptionsSync=l,t.addCommonProtos=u},61417:e=>{"use strict";function t(e,t){for(var n=Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,o){n[r]=function(e){if(s){if(s=!1,e)o(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}}};try{e.apply(t||null,n)}catch(e){s&&(s=!1,o(e))}})}e.exports=t},75386:(e,t)=>{"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=Array(64),i=Array(123),s=0;s<64;)i[r[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;n.encode=function(e,t,n){for(var i,s=null,o=[],a=0,l=0;t<n;){var u=e[t++];switch(l){case 0:o[a++]=r[u>>2],i=(3&u)<<4,l=1;break;case 1:o[a++]=r[i|u>>4],i=(15&u)<<2,l=2;break;case 2:o[a++]=r[i|u>>6],o[a++]=r[63&u],l=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return(l&&(o[a++]=r[i],o[a++]=61,1===l&&(o[a++]=61)),s)?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var o="invalid encoding";n.decode=function(e,t,n){for(var r,s=n,a=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&a>1)break;if(void 0===(u=i[u]))throw Error(o);switch(a){case 0:r=u,a=1;break;case 1:t[n++]=r<<2|(48&u)>>4,r=u,a=2;break;case 2:t[n++]=(15&r)<<4|(60&u)>>2,r=u,a=3;break;case 3:t[n++]=(3&r)<<6|u,a=0}}if(1===a)throw Error(o);return n-s},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},696:e=>{"use strict";function t(e,n){"string"==typeof e&&(n=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var n=s();if(t.verbose&&console.log("codegen: "+n),n="return "+n,e){for(var o=Object.keys(e),a=Array(o.length+1),l=Array(o.length),u=0;u<o.length;)a[u]=o[u],l[u]=e[o[u++]];return a[u]=n,Function.apply(null,a).apply(null,l)}return Function(n)()}for(var c=Array(arguments.length-1),h=0;h<c.length;)c[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,function(e,t){var n=c[h++];switch(t){case"d":case"f":return String(Number(n));case"i":return String(Math.floor(n));case"j":return JSON.stringify(n);case"s":return String(n)}return"%"}),h!==c.length)throw Error("parameter count mismatch");return r.push(e),i}function s(t){return"function "+(t||n||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=s,i}e.exports=t,t.verbose=!1},33478:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},37828:(e,t,n)=>{"use strict";e.exports=s;var r=n(61417),i=n(71374)("fs");function s(e,t,n){return("function"==typeof t?(n=t,t={}):t||(t={}),n)?!t.xhr&&i&&i.readFile?i.readFile(e,function(r,i){return r&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,n):r?n(r):n(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,n):r(s,this,e,t)}s.xhr=function(e,t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){if(0!==r.status&&200!==r.status)return n(Error("status "+r.status));if(t.binary){var e=r.response;if(!e){e=[];for(var i=0;i<r.responseText.length;++i)e.push(255&r.responseText.charCodeAt(i))}return n(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return n(null,r.responseText)}},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}},65256:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function s(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function o(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function a(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:s,e.writeFloatBE=r?s:i,e.readFloatLE=r?o:a,e.readFloatBE=r?a:o}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var s=Math.floor(Math.log(t)/Math.LN2),o=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|o)>>>0,n,r)}}function o(e,t,n){var r=e(t,n),i=(r>>31)*2+1,s=r>>>23&255,o=8388607&r;return 255===s?o?NaN:1/0*i:0===s?1401298464324817e-60*i*o:i*Math.pow(2,s-150)*(o+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,r),e.readFloatLE=o.bind(null,i),e.readFloatBE=o.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function s(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function o(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function a(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:s,e.writeDoubleBE=r?s:i,e.readDoubleLE=r?o:a,e.readDoubleBE=r?a:o}():function(){function t(e,t,n,r,i,s){var o,a=r<0?1:0;if(a&&(r=-r),0===r)e(0,i,s+t),e(1/r>0?0:2147483648,i,s+n);else if(isNaN(r))e(0,i,s+t),e(2146959360,i,s+n);else if(r>17976931348623157e292)e(0,i,s+t),e((a<<31|2146435072)>>>0,i,s+n);else if(r<22250738585072014e-324)e((o=r/5e-324)>>>0,i,s+t),e((a<<31|o/4294967296)>>>0,i,s+n);else{var l=Math.floor(Math.log(r)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(o=r*Math.pow(2,-l))>>>0,i,s+t),e((a<<31|l+1023<<20|1048576*o&1048575)>>>0,i,s+n)}}function o(e,t,n,r,i){var s=e(r,i+t),o=e(r,i+n),a=(o>>31)*2+1,l=o>>>20&2047,u=4294967296*(1048575&o)+s;return 2047===l?u?NaN:1/0*a:0===l?5e-324*a*u:a*Math.pow(2,l-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,r,4,0),e.readDoubleLE=o.bind(null,i,0,4),e.readDoubleBE=o.bind(null,s,4,0)}(),e}function n(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function r(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},71374:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},62727:(e,t)=>{"use strict";var n=t,r=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),n=r(e),i="";n&&(i=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):n?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return i+t.join("/")};n.resolve=function(e,t,n){return(n||(t=i(t)),r(t))?t:(n||(e=i(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t)}},26733:e=>{"use strict";function t(e,t,n){var r=n||8192,i=r>>>1,s=null,o=r;return function(n){if(n<1||n>i)return e(n);o+n>r&&(s=e(r),o=0);var a=t.call(s,o,o+=n);return 7&o&&(o=(7|o)+1),a}}e.exports=t},93670:(e,t)=>{"use strict";var n=t;n.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:(64512&n)==55296&&(64512&e.charCodeAt(r+1))==56320?(++r,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,s=[],o=0;t<n;)(r=e[t++])<128?s[o++]=r:r>191&&r<224?s[o++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(r>>10),s[o++]=56320+(1023&r)):s[o++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))},n.write=function(e,t,n){for(var r,i,s=n,o=0;o<e.length;++o)(r=e.charCodeAt(o))<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&(64512&(i=e.charCodeAt(o+1)))==56320?(r=65536+((1023&r)<<10)+(1023&i),++o,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-s}},29901:(e,t,n)=>{"use strict";var r=n(12781).Stream,i=n(73837),s=n(18679),o=n(15766),a=n(97861),l=n(68374),u=n(62949),c=function(e,t,n){this.writable=!0,n=n||{},this._stream=t.socket,this._ping=n.ping||this.DEFAULT_PING,this._retry=n.retry||this.DEFAULT_RETRY;var r=s.isSecureRequest(e)?"https:":"http:";this.url=r+"//"+e.headers.host+e.url,this.lastEventId=e.headers["last-event-id"]||"",this.readyState=a.CONNECTING;var i=new o,l=this;if(n.headers)for(var u in n.headers)i.set(u,n.headers[u]);if(this._stream&&this._stream.writable){process.nextTick(function(){l._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var c="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+i.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(c),this._stream.on("drain",function(){l.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){l.ping()},1e3*this._ping)),["error","end"].forEach(function(e){l._stream.on(e,function(){l.close()})})}};i.inherits(c,r),c.isEventSource=function(e){return"GET"===e.method&&(e.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var h={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(e){if(!this.writable)return!1;try{return this._stream.write(e,"utf8")}catch(e){return!1}},_open:function(){if(this.readyState===a.CONNECTING){this.readyState=a.OPEN;var e=new u("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.write(e),this.close()},send:function(e,t){if(this.readyState>a.OPEN)return!1;e=String(e).replace(/(\r\n|\r|\n)/g,"$1data: ");var n="";return(t=t||{}).event&&(n+="event: "+t.event+"\r\n"),t.id&&(n+="id: "+t.id+"\r\n"),n+="data: "+e+"\r\n\r\n",this._write(n)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>a.OPEN)return!1;this.readyState=a.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var e=new u("close");return e.initEvent("close",!1,!1),this.dispatchEvent(e),!0}};for(var d in h)c.prototype[d]=h[d];for(var p in l)c.prototype[p]=l[p];e.exports=c},83968:(e,t,n)=>{"use strict";var r=n(73837),i=n(18679),s=n(97861),o=function(e,t,n,r,o){o=o||{},this._stream=t,this._driver=i.http(e,{maxLength:o.maxLength,protocols:r});var a=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var l=function(){a._stream.removeListener("data",l)};this._stream.on("data",l),s.call(this,o),process.nextTick(function(){a._driver.start(),a._driver.io.write(n)})}};r.inherits(o,s),o.isWebSocket=function(e){return i.isWebSocket(e)},o.validateOptions=function(e,t){i.validateOptions(e,t)},o.WebSocket=o,o.Client=n(1282),o.EventSource=n(29901),e.exports=o},97861:(e,t,n)=>{"use strict";var r=n(12781).Stream,i=n(73837),s=n(18679),o=n(68374),a=n(62949),l=function(e){e=e||{},s.validateOptions(e,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var t=e.headers;if(t)for(var n in t)this._driver.setHeader(n,t[n]);var r=e.extensions;r&&[].concat(r).forEach(this._driver.addExtension,this._driver),this._ping=e.ping,this._pingId=0,this.readyState=l.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var i=this;this._driver.on("open",function(e){i._open()}),this._driver.on("message",function(e){i._receiveMessage(e.data)}),this._driver.on("close",function(e){i._beginClose(e.reason,e.code)}),this._driver.on("error",function(e){i._emitError(e.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i._pingId+=1,i.ping(i._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};i.inherits(l,r),l.CONNECTING=0,l.OPEN=1,l.CLOSING=2,l.CLOSED=3,l.CLOSE_TIMEOUT=3e4;var u={write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.send(e),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(e){return!(this.readyState>l.OPEN)&&(e instanceof Buffer||(e=String(e)),this._driver.messages.write(e))},ping:function(e,t){return!(this.readyState>l.OPEN)&&this._driver.ping(e,t)},close:function(e,t){if(void 0===e&&(e=1e3),void 0===t&&(t=""),1e3!==e&&(e<3e3||e>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+e+" is neither.");if(this.readyState<l.CLOSING){var n=this;this._closeTimer=setTimeout(function(){n._beginClose("",1006)},l.CLOSE_TIMEOUT)}this.readyState!==l.CLOSED&&(this.readyState=l.CLOSING),this._driver.close(t,e)},_configureStream:function(){var e=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(t){this._stream.on(t,function(){e._finalizeClose()})},this),this._stream.on("error",function(t){e._emitError("Network error: "+e.url+": "+t.message),e._finalizeClose()})},_open:function(){if(this.readyState===l.CONNECTING){this.readyState=l.OPEN,this.protocol=this._driver.protocol||"";var e=new a("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},_receiveMessage:function(e){if(this.readyState>l.OPEN)return!1;this.readable&&this.emit("data",e);var t=new a("message",{data:e});t.initEvent("message",!1,!1),this.dispatchEvent(t)},_emitError:function(e){if(!(this.readyState>=l.CLOSING)){var t=new a("error",{message:e});t.initEvent("error",!1,!1),this.dispatchEvent(t)}},_beginClose:function(e,t){this.readyState!==l.CLOSED&&(this.readyState=l.CLOSING,this._closeParams=[e,t],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==l.CLOSED){this.readyState=l.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var e=this._closeParams?this._closeParams[0]:"",t=this._closeParams?this._closeParams[1]:1006,n=new a("close",{code:t,reason:e});n.initEvent("close",!1,!1),this.dispatchEvent(n)}}};for(var c in u)l.prototype[c]=u[c];for(var h in o)l.prototype[h]=o[h];e.exports=l},62949:e=>{"use strict";var t=function(e,t){for(var n in this.type=e,t)this[n]=t[n]};t.prototype.initEvent=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n},t.prototype.stopPropagation=function(){},t.prototype.preventDefault=function(){},t.CAPTURING_PHASE=1,t.AT_TARGET=2,t.BUBBLING_PHASE=3,e.exports=t},68374:(e,t,n)=>{"use strict";var r=n(62949),i={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(e,t,n){this.on(e,t)},removeEventListener:function(e,t,n){this.removeListener(e,t)},dispatchEvent:function(e){e.target=e.currentTarget=this,e.eventPhase=r.AT_TARGET,this["on"+e.type]&&this["on"+e.type](e),this.emit(e.type,e)}};e.exports=i},1282:(e,t,n)=>{"use strict";var r=n(73837),i=n(41808),s=n(24404),o=n(57310),a=n(18679),l=n(97861);n(62949);var u={"http:":80,"https:":443,"ws:":80,"wss:":443},c=["https:","wss:"],h=function(e,t,n){n=n||{},this.url=e,this._driver=a.client(this.url,{maxLength:n.maxLength,protocols:t}),["open","error"].forEach(function(e){this._driver.on(e,function(){v.headers=v._driver.headers,v.statusCode=v._driver.statusCode})},this);var r=n.proxy||{},h=o.parse(r.origin||this.url),d=h.port||u[h.protocol],p=c.indexOf(h.protocol)>=0,f=function(){v._onConnect()},g=n.net||{},m=n.tls||{},y=r.origin?r.tls||{}:m,v=this;g.host=y.host=h.hostname,g.port=y.port=d,m.ca=m.ca||n.ca,y.servername=y.servername||h.hostname,this._stream=p?s.connect(y,f):i.connect(g,f),r.origin&&this._configureProxy(r,m),l.call(this,n)};r.inherits(h,l),h.prototype._onConnect=function(){(this._proxy||this._driver).start()},h.prototype._configureProxy=function(e,t){var n,r=o.parse(this.url),i=c.indexOf(r.protocol)>=0,a=this;if(this._proxy=this._driver.proxy(e.origin),e.headers)for(n in e.headers)this._proxy.setHeader(n,e.headers[n]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(i){var e={socket:a._stream,servername:r.hostname};for(n in t)e[n]=t[n];a._stream=s.connect(e),a._configureStream()}a._driver.io.pipe(a._stream),a._stream.pipe(a._driver.io),a._driver.start()}),this._proxy.on("error",function(e){a._driver.emit("error",e)})},e.exports=h},15433:(e,t,n)=>{var r,i=n(39491);function s(e){i.ok(e===s.REQUEST||e===s.RESPONSE||void 0===e),void 0===e||this.initialize(e),this.maxHeaderSize=s.maxHeaderSize}t.m=s,s.prototype.initialize=function(e,t){i.ok(e===s.REQUEST||e===s.RESPONSE),this.type=e,this.state=e+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},s.encoding="ascii",s.maxHeaderSize=81920,s.REQUEST="REQUEST",s.RESPONSE="RESPONSE";var o=s.kOnHeaders=1,a=s.kOnHeadersComplete=2,l=s.kOnBody=3,u=s.kOnMessageComplete=4;s.prototype[o]=s.prototype[a]=s.prototype[l]=s.prototype[u]=function(){};var c=!0;Object.defineProperty(s,"kOnExecute",{get:function(){return c=!1,99}});var h=r=s.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],d=h.indexOf("CONNECT");s.prototype.reinitialize=s,s.prototype.close=s.prototype.pause=s.prototype.resume=s.prototype.free=function(){},s.prototype._compatMode0_11=!1,s.prototype.getAsyncId=function(){return 0};var p={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};s.prototype.execute=function(e,t,n){if(!(this instanceof s))throw TypeError("not a HTTPParser");t=t||0,n="number"==typeof n?n:e.length,this.chunk=e,this.offset=t;var r=this.end=t+n;try{for(;this.offset<r&&!this[this.state](););}catch(e){if(this.isUserCall)throw e;return this.hadError=!0,e}return(this.chunk=null,n=this.offset-t,p[this.state]&&(this.headerSize+=n,this.headerSize>(this.maxHeaderSize||s.maxHeaderSize)))?Error("max header size exceeded"):n};var f={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};s.prototype.finish=function(){if(!this.hadError){if(!f[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[u]())}},s.prototype.consume=s.prototype.unconsume=s.prototype.getCurrentBuffer=function(){},s.prototype.userCall=function(){this.isUserCall=!0;var e=this;return function(t){return e.isUserCall=!1,t}},s.prototype.nextRequest=function(){this.userCall()(this[u]()),this.reinitialize(this.type)},s.prototype.consumeLine=function(){for(var e=this.end,t=this.chunk,n=this.offset;n<e;n++)if(10===t[n]){var r=this.line+t.toString(s.encoding,this.offset,n);return"\r"===r.charAt(r.length-1)&&(r=r.substr(0,r.length-1)),this.line="",this.offset=n+1,r}this.line+=t.toString(s.encoding,this.offset,this.end),this.offset=this.end};var g=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,m=/^[ \t]+(.*[^ \t])/;s.prototype.parseHeader=function(e,t){if(-1!==e.indexOf("\r"))throw _("HPE_LF_EXPECTED");var n=g.exec(e),r=n&&n[1];if(r)t.push(r),t.push(n[2]);else{var i=m.exec(e);i&&t.length&&(t[t.length-1]&&(t[t.length-1]+=" "),t[t.length-1]+=i[1])}};var y=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;s.prototype.REQUEST_LINE=function(){var e=this.consumeLine();if(e){var t=y.exec(e);if(null===t)throw _("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?t[1]:h.indexOf(t[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=t[2],this.info.versionMajor=+t[3],this.info.versionMinor=+t[4],this.body_bytes=0,this.state="HEADER"}};var v=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function _(e){var t=Error("Parse Error");return t.code=e,t}s.prototype.RESPONSE_LINE=function(){var e=this.consumeLine();if(e){var t=v.exec(e);if(null===t)throw _("HPE_INVALID_CONSTANT");this.info.versionMajor=+t[1],this.info.versionMinor=+t[2];var n=this.info.statusCode=+t[3];this.info.statusMessage=t[4],((n/100|0)==1||204===n||304===n)&&(this.body_bytes=0),this.state="HEADER"}},s.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},s.prototype.HEADER=function(){var e=this.consumeLine();if(void 0!==e){var t=this.info;if(e)this.parseHeader(e,t.headers);else{for(var n,r,i=t.headers,o=!1,l=!1,u=0;u<i.length;u+=2)switch(i[u].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===i[u+1].toLowerCase();break;case"content-length":if(n=+i[u+1],o){if(n!==this.body_bytes)throw _("HPE_UNEXPECTED_CONTENT_LENGTH")}else o=!0,this.body_bytes=n;break;case"connection":this.connection+=i[u+1].toLowerCase();break;case"upgrade":l=!0}if(this.isChunked&&o&&(o=!1,this.body_bytes=null),l&&-1!=this.connection.indexOf("upgrade")?t.upgrade=this.type===s.REQUEST||101===t.statusCode:t.upgrade=t.method===d,this.isChunked&&t.upgrade&&(this.isChunked=!1),t.shouldKeepAlive=this.shouldKeepAlive(),2===(r=c?this.userCall()(this[a](t)):this.userCall()(this[a](t.versionMajor,t.versionMinor,t.headers,t.method,t.url,t.statusCode,t.statusMessage,t.upgrade,t.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!r)this.state="BODY_CHUNKHEAD";else{if(r||0===this.body_bytes)return this.nextRequest(),t.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},s.prototype.BODY_CHUNKHEAD=function(){var e=this.consumeLine();void 0!==e&&(this.body_bytes=parseInt(e,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},s.prototype.BODY_CHUNK=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[l](this.chunk,this.offset,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},s.prototype.BODY_CHUNKEMPTYLINE=function(){var e=this.consumeLine();void 0!==e&&(i.equal(e,""),this.state="BODY_CHUNKHEAD")},s.prototype.BODY_CHUNKTRAILERS=function(){var e=this.consumeLine();void 0!==e&&(e?this.parseHeader(e,this.trailers):(this.trailers.length&&this.userCall()(this[o](this.trailers,"")),this.nextRequest()))},s.prototype.BODY_RAW=function(){var e=this.end-this.offset;this.userCall()(this[l](this.chunk,this.offset,e)),this.offset=this.end},s.prototype.BODY_SIZED=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[l](this.chunk,this.offset,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(e){var t=s["kOn"+e];Object.defineProperty(s.prototype,"on"+e,{get:function(){return this[t]},set:function(e){return this._compatMode0_11=!0,d="CONNECT",this[t]=e}})})},89739:e=>{var t=1/0,n="[object Symbol]",r=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,i=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,s="\ud800-\udfff",o="\\u0300-\\u036f\\ufe20-\\ufe23",a="\\u20d0-\\u20f0",l="\\u2700-\\u27bf",u="a-z\\xdf-\\xf6\\xf8-\\xff",c="A-Z\\xc0-\\xd6\\xd8-\\xde",h="\\ufe0e\\ufe0f",d="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",p="['’]",f="["+s+"]",g="["+d+"]",m="["+o+a+"]",y="\\d+",v="["+l+"]",_="["+u+"]",b="[^"+s+d+y+l+u+c+"]",S="\ud83c[\udffb-\udfff]",w="[^"+s+"]",T="(?:\ud83c[\udde6-\uddff]){2}",E="[\ud800-\udbff][\udc00-\udfff]",C="["+c+"]",I="\\u200d",k="(?:"+_+"|"+b+")",R="(?:"+C+"|"+b+")",O="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",N="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",A="(?:"+m+"|"+S+")?",x="["+h+"]?",D="(?:"+I+"(?:"+[w,T,E].join("|")+")"+x+A+")*",P=x+A+D,M="(?:"+[v,T,E].join("|")+")"+P,L="(?:"+[w+m+"?",m,T,E,f].join("|")+")",F=RegExp(p,"g"),B=RegExp(m,"g"),j=RegExp(S+"(?="+S+")|"+L+P,"g"),U=RegExp([C+"?"+_+"+"+O+"(?="+[g,C,"$"].join("|")+")",R+"+"+N+"(?="+[g,C+k,"$"].join("|")+")",C+"?"+k+"+"+O,C+"+"+N,y,M].join("|"),"g"),q=RegExp("["+I+s+o+a+h+"]"),V=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,z={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"ss"},W="object"==typeof global&&global&&global.Object===Object&&global,$="object"==typeof self&&self&&self.Object===Object&&self,G=W||$||Function("return this")();function H(e,t,n,r){var i=-1,s=e?e.length:0;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function K(e){return e.split("")}function Q(e){return e.match(r)||[]}var Y=function(e){return function(t){return null==e?void 0:e[t]}}(z);function J(e){return q.test(e)}function X(e){return V.test(e)}function Z(e){return J(e)?ee(e):K(e)}function ee(e){return e.match(j)||[]}function et(e){return e.match(U)||[]}var en=Object.prototype.toString,er=G.Symbol,ei=er?er.prototype:void 0,es=ei?ei.toString:void 0;function eo(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function ea(e){if("string"==typeof e)return e;if(eh(e))return es?es.call(e):"";var n=e+"";return"0"==n&&1/e==-t?"-0":n}function el(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:eo(e,t,n)}function eu(e){return function(t){var n=J(t=ed(t))?Z(t):void 0,r=n?n[0]:t.charAt(0),i=n?el(n,1).join(""):t.slice(1);return r[e]()+i}}function ec(e){return!!e&&"object"==typeof e}function eh(e){return"symbol"==typeof e||ec(e)&&en.call(e)==n}function ed(e){return null==e?"":ea(e)}var ep=function(e){return function(t){return H(ey(eg(t).replace(F,"")),e,"")}}(function(e,t,n){return t=t.toLowerCase(),e+(n?ef(t):t)});function ef(e){return em(ed(e).toLowerCase())}function eg(e){return(e=ed(e))&&e.replace(i,Y).replace(B,"")}var em=eu("toUpperCase");function ey(e,t,n){return(e=ed(e),void 0===(t=n?void 0:t))?X(e)?et(e):Q(e):e.match(t)||[]}e.exports=ep},96508:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var i={},s={};function o(e,t){var n,r,o;return t?(e>>>=0,(o=0<=e&&e<256)&&(r=s[e]))?r:(n=l(e,(0|e)<0?-1:0,!0),o&&(s[e]=n),n):(e|=0,(o=-128<=e&&e<128)&&(r=i[e]))?r:(n=l(e,e<0?-1:0,!1),o&&(i[e]=n),n)}function a(e,t){if(isNaN(e))return t?y:m;if(t){if(e<0)return y;if(e>=p)return w}else{if(e<=-f)return T;if(e+1>=f)return S}return e<0?a(-e,t).neg():l(e%d|0,e/d|0,t)}function l(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=a,n.fromBits=l;var u=Math.pow;function c(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(e.substring(1),t,n).neg();for(var r,i=a(u(n,8)),s=m,o=0;o<e.length;o+=8){var l=Math.min(8,e.length-o),h=parseInt(e.substring(o,o+l),n);if(l<8){var d=a(u(n,l));s=s.mul(d).add(a(h))}else s=(s=s.mul(i)).add(a(h))}return s.unsigned=t,s}function h(e,t){return"number"==typeof e?a(e,t):"string"==typeof e?c(e,t):l(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=c,n.fromValue=h;var d=4294967296,p=18446744073709552e3,f=0x7fffffffffffffff,g=o(16777216),m=o(0);n.ZERO=m;var y=o(0,!0);n.UZERO=y;var v=o(1);n.ONE=v;var _=o(1,!0);n.UONE=_;var b=o(-1);n.NEG_ONE=b;var S=l(-1,2147483647,!1);n.MAX_VALUE=S;var w=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var T=l(0,-2147483648,!1);n.MIN_VALUE=T;var E=n.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},E.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(T))return"-"+this.neg().toString(e);var t=a(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}for(var i=a(u(e,6),this.unsigned),s=this,o="";;){var l=s.div(i),c=(s.sub(l.mul(i)).toInt()>>>0).toString(e);if((s=l).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},E.isZero=function(){return 0===this.high&&0===this.low},E.eqz=E.isZero,E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return(1&this.low)==1},E.isEven=function(){return(1&this.low)==0},E.equals=function(e){return r(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},E.eq=E.equals,E.notEquals=function(e){return!this.eq(e)},E.neq=E.notEquals,E.ne=E.notEquals,E.lessThan=function(e){return 0>this.comp(e)},E.lt=E.lessThan,E.lessThanOrEqual=function(e){return 0>=this.comp(e)},E.lte=E.lessThanOrEqual,E.le=E.lessThanOrEqual,E.greaterThan=function(e){return this.comp(e)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(e){return this.comp(e)>=0},E.gte=E.greaterThanOrEqual,E.ge=E.greaterThanOrEqual,E.compare=function(e){if(r(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(v)},E.neg=E.negate,E.add=function(e){r(e)||(e=h(e));var t,n,i=this.high>>>16,s=65535&this.high,o=this.low>>>16,a=65535&this.low,u=e.high>>>16,c=65535&e.high,d=e.low>>>16,p=65535&e.low,f=0,g=0;return t=0+((n=0+(a+p))>>>16),n&=65535,t+=o+d,g+=t>>>16,t&=65535,g+=s+c,f+=g>>>16,g&=65535,f+=i+u,l(t<<16|n,(f&=65535)<<16|g,this.unsigned)},E.subtract=function(e){return r(e)||(e=h(e)),this.add(e.neg())},E.sub=E.subtract,E.multiply=function(e){if(this.isZero())return m;if(r(e)||(e=h(e)),t)return l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(T))return e.isOdd()?T:m;if(e.eq(T))return this.isOdd()?T:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return a(this.toNumber()*e.toNumber(),this.unsigned);var n,i,s=this.high>>>16,o=65535&this.high,u=this.low>>>16,c=65535&this.low,d=e.high>>>16,p=65535&e.high,f=e.low>>>16,y=65535&e.low,v=0,_=0;return n=0+((i=0+c*y)>>>16),i&=65535,n+=u*y,_+=n>>>16,n&=65535,n+=c*f,_+=n>>>16,n&=65535,_+=o*y,v+=_>>>16,_&=65535,_+=u*f,v+=_>>>16,_&=65535,_+=c*p,v+=_>>>16,_&=65535,v+=s*y+o*f+u*p+c*d,l(n<<16|i,(v&=65535)<<16|_,this.unsigned)},E.mul=E.multiply,E.divide=function(e){if(r(e)||(e=h(e)),e.isZero())throw Error("division by zero");if(t){var n,i,s;return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?y:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return _;s=y}else{if(this.eq(T))return e.eq(v)||e.eq(b)?T:e.eq(T)?v:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?v:b:(i=this.sub(e.mul(n)),s=n.add(i.div(e)));if(e.eq(T))return this.unsigned?y:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=m}for(i=this;i.gte(e);){for(var o=Math.ceil(Math.log(n=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),c=o<=48?1:u(2,o-48),d=a(n),p=d.mul(e);p.isNegative()||p.gt(i);)n-=c,p=(d=a(n,this.unsigned)).mul(e);d.isZero()&&(d=v),s=s.add(d),i=i.sub(p)}return s},E.div=E.divide,E.modulo=function(e){return(r(e)||(e=h(e)),t)?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},E.mod=E.modulo,E.rem=E.modulo,E.not=function(){return l(~this.low,~this.high,this.unsigned)},E.and=function(e){return r(e)||(e=h(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},E.or=function(e){return r(e)||(e=h(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},E.xor=function(e){return r(e)||(e=h(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},E.shiftLeft=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):32===e?l(t,0,this.unsigned):l(t>>>e-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.shr_u=E.shiftRightUnsigned,E.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},E.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},E.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},35047:(e,t,n)=>{"use strict";var r=n(77389);n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},46242:(e,t,n)=>{"use strict";var r;r={value:!0},Object.defineProperty(t,"$",{enumerable:!0,get:function(){return s}});let i=n(15424);function s(e){let{createServerReference:t}=n(56493);return t(e,i.callServer)}},92607:(e,t,n)=>{"use strict";var r=n(11101);e.exports=t=r.descriptor=r.Root.fromJSON(n(89987)).lookup(".google.protobuf");var i=r.Namespace,s=r.Root,o=r.Enum,a=r.Type,l=r.Field,u=r.MapField,c=r.OneOf,h=r.Service,d=r.Method;function p(e,n,r){var u=t.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});r&&(u.syntax=r),e instanceof s||(u.package=e.fullName.substring(1));for(var c,d=0;d<e.nestedArray.length;++d)(c=e._nestedArray[d])instanceof a?u.messageType.push(c.toDescriptor(r)):c instanceof o?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(r)):c instanceof h?u.service.push(c.toDescriptor()):c instanceof i&&p(c,n,r);u.options=E(e.options,t.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&n.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.FileDescriptorSet.decode(e));var n=new s;if(e.file)for(var r,i,u,c=0;c<e.file.length;++c){if(i=n,(r=e.file[c]).package&&r.package.length&&(i=n.define(r.package)),r.name&&r.name.length&&n.files.push(i.filename=r.name),r.messageType)for(u=0;u<r.messageType.length;++u)i.add(a.fromDescriptor(r.messageType[u],r.syntax));if(r.enumType)for(u=0;u<r.enumType.length;++u)i.add(o.fromDescriptor(r.enumType[u]));if(r.extension)for(u=0;u<r.extension.length;++u)i.add(l.fromDescriptor(r.extension[u]));if(r.service)for(u=0;u<r.service.length;++u)i.add(h.fromDescriptor(r.service[u]));var d=T(r.options,t.FileOptions);if(d){var p=Object.keys(d);for(u=0;u<p.length;++u)i.setOption(p[u],d[p[u]])}}return n},s.prototype.toDescriptor=function(e){var n=t.FileDescriptorSet.create();return p(this,n.file,e),n};var f=0;a.fromDescriptor=function(e,n){"number"==typeof e.length&&(e=t.DescriptorProto.decode(e));var r,i=new a(e.name.length?e.name:"Type"+f++,T(e.options,t.MessageOptions));if(e.oneofDecl)for(r=0;r<e.oneofDecl.length;++r)i.add(c.fromDescriptor(e.oneofDecl[r]));if(e.field)for(r=0;r<e.field.length;++r){var s=l.fromDescriptor(e.field[r],n);i.add(s),e.field[r].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[r].oneofIndex].add(s)}if(e.extension)for(r=0;r<e.extension.length;++r)i.add(l.fromDescriptor(e.extension[r],n));if(e.nestedType)for(r=0;r<e.nestedType.length;++r)i.add(a.fromDescriptor(e.nestedType[r],n)),e.nestedType[r].options&&e.nestedType[r].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(r=0;r<e.enumType.length;++r)i.add(o.fromDescriptor(e.enumType[r]));if(e.extensionRange&&e.extensionRange.length)for(r=0,i.extensions=[];r<e.extensionRange.length;++r)i.extensions.push([e.extensionRange[r].start,e.extensionRange[r].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(r=0;r<e.reservedRange.length;++r)i.reserved.push([e.reservedRange[r].start,e.reservedRange[r].end]);if(e.reservedName)for(r=0;r<e.reservedName.length;++r)i.reserved.push(e.reservedName[r])}return i},a.prototype.toDescriptor=function(e){var n,r,i=t.DescriptorProto.create({name:this.name});for(r=0;r<this.fieldsArray.length;++r)if(i.field.push(n=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof u){var s=w(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),c=w(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),h=11===c||14===c?this._fieldsArray[r].resolvedType&&C(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;i.nestedType.push(t.DescriptorProto.create({name:n.typeName,field:[t.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),t.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:h})],options:t.MessageOptions.create({mapEntry:!0})}))}for(r=0;r<this.oneofsArray.length;++r)i.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof l?i.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof a?i.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof o&&i.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)i.extensionRange.push(t.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)"string"==typeof this.reserved[r]?i.reservedName.push(this.reserved[r]):i.reservedRange.push(t.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return i.options=E(this.options,t.MessageOptions),i};var g=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,n){if("number"==typeof e.length&&(e=t.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(r=e.typeName&&e.typeName.length?e.typeName:b(e.type),e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var r,i,s=e.extendee;void 0!==e.extendee&&(s=s.length?s:void 0);var o=new l(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=T(e.options,t.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:g.exec(a)&&(a=parseInt(a))}o.setOption("default",a)}return S(e.type)&&("proto3"===n?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o},l.prototype.toDescriptor=function(e){var n=t.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)n.type=11,n.typeName=r.util.ucFirst(this.name),n.label=3;else{switch(n.type=w(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:n.typeName=this.resolvedType?C(this.parent,this.resolvedType):this.type}switch(this.rule){case"repeated":n.label=3;break;case"required":n.label=2;break;default:n.label=1}}if(n.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(n.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(n.options=E(this.options,t.FieldOptions),null!=this.options.default&&(n.defaultValue=String(this.options.default))),"proto3"===e?this.packed||((n.options||(n.options=t.FieldOptions.create())).packed=!1):this.packed&&((n.options||(n.options=t.FieldOptions.create())).packed=!0),n};var m=0;o.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.EnumDescriptorProto.decode(e));var n={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;n[i&&i.length?i:"NAME"+s]=s}return new o(e.name&&e.name.length?e.name:"Enum"+m++,n,T(e.options,t.EnumOptions))},o.prototype.toDescriptor=function(){for(var e=[],n=0,r=Object.keys(this.values);n<r.length;++n)e.push(t.EnumValueDescriptorProto.create({name:r[n],number:this.values[r[n]]}));return t.EnumDescriptorProto.create({name:this.name,value:e,options:E(this.options,t.EnumOptions)})};var y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return t.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.ServiceDescriptorProto.decode(e));var n=new h(e.name&&e.name.length?e.name:"Service"+v++,T(e.options,t.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)n.add(d.fromDescriptor(e.method[r]));return n},h.prototype.toDescriptor=function(){for(var e=[],n=0;n<this.methodsArray.length;++n)e.push(this._methodsArray[n].toDescriptor());return t.ServiceDescriptorProto.create({name:this.name,method:e,options:E(this.options,t.ServiceOptions)})};var _=0;function b(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function S(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function w(e,t){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof o)return 14;if(t instanceof a)return t.group?10:11;throw Error("illegal type: "+e)}function T(e,t){if(e){for(var n,i,s,a=[],l=0;l<t.fieldsArray.length;++l)"uninterpretedOption"!==(i=(n=t._fieldsArray[l]).name)&&e.hasOwnProperty(i)&&(s=e[i],n.resolvedType instanceof o&&"number"==typeof s&&void 0!==n.resolvedType.valuesById[s]&&(s=n.resolvedType.valuesById[s]),a.push(I(i),s));return a.length?r.util.toObject(a):void 0}}function E(e,t){if(e){for(var n,i,s=[],o=0,a=Object.keys(e);o<a.length;++o)if(i=e[n=a[o]],"default"!==n){var l=t.fields[n];(l||(l=t.fields[n=r.util.camelCase(n)]))&&s.push(n,i)}return s.length?t.fromObject(r.util.toObject(s)):void 0}}function C(e,t){var n=e.fullName.split("."),r=t.fullName.split("."),o=0,a=0,l=r.length-1;if(!(e instanceof s)&&t instanceof i)for(;o<n.length&&a<l&&n[o]===r[a];){var u=t.lookup(n[o++],!0);if(null!==u&&u!==t)break;++a}else for(;o<n.length&&a<l&&n[o]===r[a];++o,++a);return r.slice(a).join(".")}function I(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+_++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,T(e.options,t.MethodOptions))},d.prototype.toDescriptor=function(){return t.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:E(this.options,t.MethodOptions)})}},11101:(e,t,n)=>{"use strict";e.exports=n(28582)},23980:e=>{"use strict";e.exports=r;var t,n=/\/|\./;function r(e,t){n.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),r[e]=t}r("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),r("duration",{Duration:t={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),r("timestamp",{Timestamp:t}),r("empty",{Empty:{fields:{}}}),r("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),r("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),r("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),r.get=function(e){return r[e]||null}},85711:(e,t,n)=>{"use strict";var r=t,i=n(71114),s=n(84615);function o(e,t,n,r){if(t.resolvedType){if(t.resolvedType instanceof i){e("switch(d%s){",r);for(var s=t.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)t.repeated&&s[o[a]]===t.typeDefault&&e("default:"),e("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");e("}")}else e('if(typeof d%s!=="object")',r)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,n,r)}else{var l=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":e('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length)",r)("m%s=d%s",r,r);break;case"string":e("m%s=String(d%s)",r,r);break;case"bool":e("m%s=Boolean(d%s)",r,r)}}return e}function a(e,t,n,r){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",r,n,r,r):e("d%s=types[%i].toObject(m%s,o)",r,n,r);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,s?"true":"",r);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:e("d%s=m%s",r,r)}}return e}r.fromObject=function(e){var t=e.fieldsArray,n=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return n("return new this.ctor");n("var m=new this.ctor");for(var r=0;r<t.length;++r){var a=t[r].resolve(),l=s.safeProp(a.name);a.map?(n("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",a.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),o(n,a,r,l+"[ks[i]]")("}")("}")):a.repeated?(n("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",a.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),o(n,a,r,l+"[i]")("}")("}")):(a.resolvedType instanceof i||n("if(d%s!=null){",l),o(n,a,r,l),a.resolvedType instanceof i||n("}"))}return n("return m")},r.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var n=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],o=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?r:t[u].map?o:l).push(t[u]);if(r.length){for(n("if(o.arrays||o.defaults){"),u=0;u<r.length;++u)n("d%s=[]",s.safeProp(r[u].name));n("}")}if(o.length){for(n("if(o.objects||o.defaults){"),u=0;u<o.length;++u)n("d%s={}",s.safeProp(o[u].name));n("}")}if(l.length){for(n("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],h=s.safeProp(c.name);if(c.resolvedType instanceof i)n("d%s=o.enums===String?%j:%j",h,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else n("d%s=%j",h,c.typeDefault)}n("}")}var p=!1;for(u=0;u<t.length;++u){var c=t[u],f=e._fieldsArray.indexOf(c),h=s.safeProp(c.name);c.map?(p||(p=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),a(n,c,f,h+"[ks2[j]]")("}")):c.repeated?(n("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),a(n,c,f,h+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",h,c.name),a(n,c,f,h),c.partOf&&n("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),n("}")}return n("return d")}},31526:(e,t,n)=>{"use strict";e.exports=a;var r=n(71114),i=n(76160),s=n(84615);function o(e){return"missing required '"+e.name+"'"}function a(e){var t=s.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),l=a.resolvedType instanceof r?"int32":a.type,u="m"+s.safeProp(a.name);t("case %i:",a.id),a.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[a.keyType]?t("k=%j",i.defaults[a.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",a.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",n):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),t(void 0!==i.long[a.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",u)):a.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,n):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,n):t("%s=r.%s()",u,l),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var c=e._fieldsArray[n];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",o(c))}return t("return m")}},38455:(e,t,n)=>{"use strict";e.exports=a;var r=n(71114),i=n(76160),s=n(84615);function o(e,t,n,r){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,(t.id<<3|2)>>>0)}function a(e){for(var t,n,a=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var u=l[t].resolve(),c=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof r?"int32":u.type,d=i.basic[h];n="m"+s.safeProp(u.name),u.map?(a("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",n,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",n)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===d?a("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,n):a(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,n),a("}")("}")):u.repeated?(a("if(%s!=null&&%s.length){",n,n),u.packed&&void 0!==i.packed[h]?a("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",n)("w.%s(%s[i])",h,n)("w.ldelim()"):(a("for(var i=0;i<%s.length;++i)",n),void 0===d?o(a,u,c,n+"[i]"):a("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,n)),a("}")):(u.optional&&a("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",n,u.name),void 0===d?o(a,u,c,n):a("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,n))}return a("return w")}},71114:(e,t,n)=>{"use strict";e.exports=o;var r=n(3514);((o.prototype=Object.create(r.prototype)).constructor=o).className="Enum";var i=n(4943),s=n(84615);function o(e,t,n,i,s){if(r.call(this,e,n),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.reserved=void 0,t)for(var o=Object.keys(t),a=0;a<o.length;++a)"number"==typeof t[o[a]]&&(this.valuesById[this.values[o[a]]=t[o[a]]]=o[a])}o.fromJSON=function(e,t){var n=new o(e,t.values,t.options,t.comment,t.comments);return n.reserved=t.reserved,n},o.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},o.prototype.add=function(e,t,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return this.comments[e]=n||null,this},o.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this},o.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},o.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},37510:(e,t,n)=>{"use strict";e.exports=u;var r,i=n(3514);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var s=n(71114),o=n(76160),a=n(84615),l=/^required|optional|repeated$/;function u(e,t,n,r,s,u,c){if(a.isObject(r)?(c=s,u=r,r=s=void 0):a.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!a.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!a.isString(n))throw TypeError("type must be a string");if(void 0!==r&&!l.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!a.isString(s))throw TypeError("extend must be a string");"proto3_optional"===r&&(r="optional"),this.rule=r&&"optional"!==r?r:void 0,this.type=n,this.id=t,this.extend=s||void 0,this.required="required"===r,this.optional=!this.required,this.repeated="repeated"===r,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!a.Long&&void 0!==o.long[n],this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=c}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,n){return"packed"===e&&(this._packed=null),i.prototype.setOption.call(this,e,t,n)},u.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return a.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=o.defaults[this.type])&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof r?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=a.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;a.base64.test(this.typeDefault)?a.base64.decode(this.typeDefault,e=a.newBuffer(a.base64.length(this.typeDefault)),0):a.utf8.write(this.typeDefault,e=a.newBuffer(a.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=a.emptyObject:this.repeated?this.defaultValue=a.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof r&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.d=function(e,t,n,r){return"function"==typeof t?t=a.decorateType(t).name:t&&"object"==typeof t&&(t=a.decorateEnum(t).name),function(i,s){a.decorateType(i.constructor).add(new u(s,e,t,n,{default:r}))}},u._configure=function(e){r=e}},34630:(e,t,n)=>{"use strict";var r=e.exports=n(38690);function i(e,t,n){return"function"==typeof t?(n=t,t=new r.Root):t||(t=new r.Root),t.load(e,n)}function s(e,t){return t||(t=new r.Root),t.loadSync(e)}r.build="light",r.load=i,r.loadSync=s,r.encoder=n(38455),r.decoder=n(31526),r.verifier=n(91506),r.converter=n(85711),r.ReflectionObject=n(3514),r.Namespace=n(4943),r.Root=n(54343),r.Enum=n(71114),r.Type=n(3839),r.Field=n(37510),r.OneOf=n(92695),r.MapField=n(79538),r.Service=n(31631),r.Method=n(26539),r.Message=n(92936),r.wrappers=n(39579),r.types=n(76160),r.util=n(84615),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)},38690:(e,t,n)=>{"use strict";var r=t;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(98458),r.BufferWriter=n(68386),r.Reader=n(42279),r.BufferReader=n(80424),r.util=n(90745),r.rpc=n(84774),r.roots=n(59694),r.configure=i,i()},28582:(e,t,n)=>{"use strict";var r=e.exports=n(34630);r.build="full",r.tokenize=n(99867),r.parse=n(16614),r.common=n(23980),r.Root._configure(r.Type,r.parse,r.common)},79538:(e,t,n)=>{"use strict";e.exports=o;var r=n(37510);((o.prototype=Object.create(r.prototype)).constructor=o).className="MapField";var i=n(76160),s=n(84615);function o(e,t,n,i,o,a){if(r.call(this,e,t,i,void 0,void 0,o,a),!s.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}o.fromJSON=function(e,t){return new o(e,t.id,t.keyType,t.type,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},o.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},o.d=function(e,t,n){return"function"==typeof n?n=s.decorateType(n).name:n&&"object"==typeof n&&(n=s.decorateEnum(n).name),function(r,i){s.decorateType(r.constructor).add(new o(i,e,t,n))}}},92936:(e,t,n)=>{"use strict";e.exports=i;var r=n(90745);function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)this[t[n]]=e[t[n]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},26539:(e,t,n)=>{"use strict";e.exports=s;var r=n(3514);((s.prototype=Object.create(r.prototype)).constructor=s).className="Method";var i=n(84615);function s(e,t,n,s,o,a,l,u,c){if(i.isObject(o)?(l=o,o=a=void 0):i.isObject(a)&&(l=a,a=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(n))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");r.call(this,e,l),this.type=t||"rpc",this.requestType=n,this.requestStream=!!o||void 0,this.responseType=s,this.responseStream=!!a||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}},4943:(e,t,n)=>{"use strict";e.exports=h;var r,i,s,o=n(3514);((h.prototype=Object.create(o.prototype)).constructor=h).className="Namespace";var a=n(37510),l=n(92695),u=n(84615);function c(e,t){if(e&&e.length){for(var n={},r=0;r<e.length;++r)n[e[r].name]=e[r].toJSON(t);return n}}function h(e,t){o.call(this,e,t),this.nested=void 0,this._nestedArray=null}function d(e){return e._nestedArray=null,e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=c,h.isReservedId=function(e,t){if(e){for(var n=0;n<e.length;++n)if("string"!=typeof e[n]&&e[n][0]<=t&&e[n][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var n=0;n<e.length;++n)if(e[n]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=u.toArray(this.nested))}}),h.prototype.toJSON=function(e){return u.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var n,o=Object.keys(e),l=0;l<o.length;++l)n=e[o[l]],t.add((void 0!==n.fields?r.fromJSON:void 0!==n.values?s.fromJSON:void 0!==n.methods?i.fromJSON:void 0!==n.id?a.fromJSON:h.fromJSON)(o[l],n));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof a&&void 0!==e.extend||e instanceof r||e instanceof s||e instanceof i||e instanceof h||e instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(t instanceof h&&e instanceof h&&!(t instanceof r||t instanceof i)){for(var n=t.nestedArray,o=0;o<n.length;++o)e.add(n[o]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof o))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(u.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var n=this;e.length>0;){var r=e.shift();if(n.nested&&n.nested[r]){if(!((n=n.nested[r])instanceof h))throw Error("path conflicts with non-namespace objects")}else n.add(n=new h(r))}return t&&n.addJSON(t),n},h.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this.resolve()},h.prototype.lookup=function(e,t,n){if("boolean"==typeof t?(n=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),u.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(1===e.length){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof h&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof h&&(r=this._nestedArray[i].lookup(e,t,!0)))return r;return null===this.parent||n?null:this.parent.lookup(e,t)},h.prototype.lookupType=function(e){var t=this.lookup(e,[r]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[r,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,n){r=e,i=t,s=n}},3514:(e,t,n)=>{"use strict";e.exports=s,s.className="ReflectionObject";var r,i=n(84615);function s(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(s.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),s.prototype.toJSON=function(){throw Error()},s.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof r&&t._handleAdd(this)},s.prototype.onRemove=function(e){var t=e.root;t instanceof r&&t._handleRemove(this),this.parent=null,this.resolved=!1},s.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},s.prototype.getOption=function(e){if(this.options)return this.options[e]},s.prototype.setOption=function(e,t,n){return n&&this.options&&void 0!==this.options[e]||((this.options||(this.options={}))[e]=t),this},s.prototype.setParsedOption=function(e,t,n){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(n){var s=r.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(s){var o=s[e];i.setProperty(o,n,t)}else(s={})[e]=i.setProperty({},n,t),r.push(s)}else{var a={};a[e]=t,r.push(a)}return this},s.prototype.setOptions=function(e,t){if(e)for(var n=Object.keys(e),r=0;r<n.length;++r)this.setOption(n[r],e[n[r]],t);return this},s.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},s._configure=function(e){r=e}},92695:(e,t,n)=>{"use strict";e.exports=o;var r=n(3514);((o.prototype=Object.create(r.prototype)).constructor=o).className="OneOf";var i=n(37510),s=n(84615);function o(e,t,n,i){if(Array.isArray(t)||(n=t,t=void 0),r.call(this,e,n),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function a(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}o.fromJSON=function(e,t){return new o(e,t.oneof,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},o.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,a(this),this},o.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},o.prototype.onAdd=function(e){r.prototype.onAdd.call(this,e);for(var t=this,n=0;n<this.oneof.length;++n){var i=e.get(this.oneof[n]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}a(this)},o.prototype.onRemove=function(e){for(var t,n=0;n<this.fieldsArray.length;++n)(t=this.fieldsArray[n]).parent&&t.parent.remove(t);r.prototype.onRemove.call(this,e)},o.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,n){s.decorateType(t.constructor).add(new o(n,e)),Object.defineProperty(t,n,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},16614:(e,t,n)=>{"use strict";e.exports=E,E.filename=null,E.defaults={keepCase:!1};var r=n(99867),i=n(54343),s=n(3839),o=n(37510),a=n(79538),l=n(92695),u=n(71114),c=n(31631),h=n(26539),d=n(76160),p=n(84615),f=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,m=/^0[x][0-9a-fA-F]+$/,y=/^-?0[x][0-9a-fA-F]+$/,v=/^0[0-7]+$/,_=/^-?0[0-7]+$/,b=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,S=/^[a-zA-Z_][a-zA-Z_0-9]*$/,w=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,T=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function E(e,t,n){t instanceof i||(n=t,t=new i),n||(n=E.defaults);var C,I,k,R,O,N=n.preferTrailingComment||!1,A=r(e,n.alternateCommentMode||!1),x=A.next,D=A.push,P=A.peek,M=A.skip,L=A.cmnt,F=!0,B=!1,j=t,U=n.keepCase?function(e){return e}:p.camelCase;function q(e,t,n){var r=E.filename;return n||(E.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(r?r+", ":"")+"line "+A.line+")")}function V(){var e,t=[];do{if('"'!==(e=x())&&"'"!==e)throw q(e);t.push(x()),M(e),e=P()}while('"'===e||"'"===e);return t.join("")}function z(e){var t=x();switch(t){case"'":case'"':return D(t),V();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return $(t,!0)}catch(n){if(e&&w.test(t))return t;throw q(t,"value")}}function W(e,t){var n,r;do t&&('"'===(n=P())||"'"===n)?e.push(V()):e.push([r=G(x()),M("to",!0)?G(x()):r]);while(M(",",!0));M(";")}function $(e,t){var n=1;switch("-"===e.charAt(0)&&(n=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*n;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(f.test(e))return n*parseInt(e,10);if(m.test(e))return n*parseInt(e,16);if(v.test(e))return n*parseInt(e,8);if(b.test(e))return n*parseFloat(e);throw q(e,"number",t)}function G(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw q(e,"id");if(g.test(e))return parseInt(e,10);if(y.test(e))return parseInt(e,16);if(_.test(e))return parseInt(e,8);throw q(e,"id")}function H(){if(void 0!==I)throw q("package");if(I=x(),!w.test(I))throw q(I,"name");j=j.define(I),M(";")}function K(){var e,t=P();switch(t){case"weak":e=R||(R=[]),x();break;case"public":x();default:e=k||(k=[])}t=V(),M(";"),e.push(t)}function Q(){if(M("="),!(B="proto3"===(O=V()))&&"proto2"!==O)throw q(O,"syntax");M(";")}function Y(e,t){switch(t){case"option":return es(e,t),M(";"),!0;case"message":return X(e,t),!0;case"enum":return er(e,t),!0;case"service":return ec(e,t),!0;case"extend":return ed(e,t),!0}return!1}function J(e,t,n){var r,i=A.line;if(e&&("string"!=typeof e.comment&&(e.comment=L()),e.filename=E.filename),M("{",!0)){for(;"}"!==(r=x());)t(r);M(";",!0)}else n&&n(),M(";"),e&&("string"!=typeof e.comment||N)&&(e.comment=L(i)||e.comment)}function X(e,t){if(!S.test(t=x()))throw q(t,"type name");var n=new s(t);J(n,function(e){if(!Y(n,e))switch(e){case"map":et(n,e);break;case"required":case"repeated":Z(n,e);break;case"optional":B?Z(n,"proto3_optional"):Z(n,"optional");break;case"oneof":en(n,e);break;case"extensions":W(n.extensions||(n.extensions=[]));break;case"reserved":W(n.reserved||(n.reserved=[]),!0);break;default:if(!B||!w.test(e))throw q(e);D(e),Z(n,"optional")}}),e.add(n)}function Z(e,t,n){var r=x();if("group"===r){ee(e,t);return}if(!w.test(r))throw q(r,"type");var i=x();if(!S.test(i))throw q(i,"name");i=U(i),M("=");var s=new o(i,G(x()),r,t,n);if(J(s,function(e){if("option"===e)es(s,e),M(";");else throw q(e)},function(){eu(s)}),"proto3_optional"===t){var a=new l("_"+i);s.setOption("proto3_optional",!0),a.add(s),e.add(a)}else e.add(s);!B&&s.repeated&&(void 0!==d.packed[r]||void 0===d.basic[r])&&s.setOption("packed",!1,!0)}function ee(e,t){var n=x();if(!S.test(n))throw q(n,"name");var r=p.lcFirst(n);n===r&&(n=p.ucFirst(n)),M("=");var i=G(x()),a=new s(n);a.group=!0;var l=new o(r,i,n,t);l.filename=E.filename,J(a,function(e){switch(e){case"option":es(a,e),M(";");break;case"required":case"repeated":Z(a,e);break;case"optional":B?Z(a,"proto3_optional"):Z(a,"optional");break;default:throw q(e)}}),e.add(a).add(l)}function et(e){M("<");var t=x();if(void 0===d.mapKey[t])throw q(t,"type");M(",");var n=x();if(!w.test(n))throw q(n,"type");M(">");var r=x();if(!S.test(r))throw q(r,"name");M("=");var i=new a(U(r),G(x()),t,n);J(i,function(e){if("option"===e)es(i,e),M(";");else throw q(e)},function(){eu(i)}),e.add(i)}function en(e,t){if(!S.test(t=x()))throw q(t,"name");var n=new l(U(t));J(n,function(e){"option"===e?(es(n,e),M(";")):(D(e),Z(n,"optional"))}),e.add(n)}function er(e,t){if(!S.test(t=x()))throw q(t,"name");var n=new u(t);J(n,function(e){switch(e){case"option":es(n,e),M(";");break;case"reserved":W(n.reserved||(n.reserved=[]),!0);break;default:ei(n,e)}}),e.add(n)}function ei(e,t){if(!S.test(t))throw q(t,"name");M("=");var n=G(x(),!0),r={};J(r,function(e){if("option"===e)es(r,e),M(";");else throw q(e)},function(){eu(r)}),e.add(t,n,r.comment)}function es(e,t){var n,r=M("(",!0);if(!w.test(t=x()))throw q(t,"name");var i=t,s=i;r&&(M(")"),s=i="("+i+")",t=P(),T.test(t)&&(n=t.substr(1),i+=t,x())),M("=");var o=eo(e,i);el(e,s,o,n)}function eo(e,t){if(M("{",!0)){for(var n={};!M("}",!0);){if(!S.test(C=x()))throw q(C,"name");var r,i=C;"{"===P()?r=eo(e,t+"."+C):(M(":"),"{"===P()?r=eo(e,t+"."+C):(r=z(!0),ea(e,t+"."+C,r)));var s=n[i];s&&(r=[].concat(s).concat(r)),n[i]=r,M(",",!0)}return n}var o=z(!0);return ea(e,t,o),o}function ea(e,t,n){e.setOption&&e.setOption(t,n)}function el(e,t,n,r){e.setParsedOption&&e.setParsedOption(t,n,r)}function eu(e){if(M("[",!0)){do es(e,"option");while(M(",",!0));M("]")}return e}function ec(e,t){if(!S.test(t=x()))throw q(t,"service name");var n=new c(t);J(n,function(e){if(!Y(n,e)){if("rpc"===e)eh(n,e);else throw q(e)}}),e.add(n)}function eh(e,t){var n=L(),r=t;if(!S.test(t=x()))throw q(t,"name");var i,s,o,a,l=t;if(M("("),M("stream",!0)&&(s=!0),!w.test(t=x())||(i=t,M(")"),M("returns"),M("("),M("stream",!0)&&(a=!0),!w.test(t=x())))throw q(t);o=t,M(")");var u=new h(l,r,i,o,s,a);u.comment=n,J(u,function(e){if("option"===e)es(u,e),M(";");else throw q(e)}),e.add(u)}function ed(e,t){if(!w.test(t=x()))throw q(t,"reference");var n=t;J(null,function(t){switch(t){case"required":case"repeated":Z(e,t,n);break;case"optional":B?Z(e,"proto3_optional",n):Z(e,"optional",n);break;default:if(!B||!w.test(t))throw q(t);D(t),Z(e,"optional",n)}})}for(;null!==(C=x());)switch(C){case"package":if(!F)throw q(C);H();break;case"import":if(!F)throw q(C);K();break;case"syntax":if(!F)throw q(C);Q();break;case"option":es(j,C),M(";");break;default:if(Y(j,C)){F=!1;continue}throw q(C)}return E.filename=null,{package:I,imports:k,weakImports:R,syntax:O,root:t}}},42279:(e,t,n)=>{"use strict";e.exports=l;var r,i=n(90745),s=i.LongBits,o=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new r(e):u(e)})(e)}:u};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return(this.pos+=e,Array.isArray(this.buf))?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},l.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do if(this.pos>=this.len)throw a(this);while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){r=e,l.create=c(),r._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},80424:(e,t,n)=>{"use strict";e.exports=s;var r=n(42279);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(90745);function s(e){r.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},54343:(e,t,n)=>{"use strict";e.exports=h;var r,i,s,o=n(4943);((h.prototype=Object.create(o.prototype)).constructor=h).className="Root";var a=n(37510),l=n(71114),u=n(92695),c=n(84615);function h(e){o.call(this,"",e),this.deferred=[],this.files=[]}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},h.prototype.resolvePath=c.path.resolve,h.prototype.fetch=c.fetch,h.prototype.load=function e(t,n,r){"function"==typeof n&&(r=n,n=void 0);var o=this;if(!r)return c.asPromise(e,o,t,n);var a=r===d;function l(e,t){if(r){var n=r;if(r=null,a)throw e;n(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var n=e.substring(t);if(n in s)return n}return null}function h(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;var r,s=i(t,o,n),h=0;if(s.imports)for(;h<s.imports.length;++h)(r=u(s.imports[h])||o.resolvePath(e,s.imports[h]))&&p(r);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(r=u(s.weakImports[h])||o.resolvePath(e,s.weakImports[h]))&&p(r,!0)}else o.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}a||f||l(null,o)}function p(e,t){if(!(o.files.indexOf(e)>-1)){if(o.files.push(e),e in s){a?h(e,s[e]):(++f,setTimeout(function(){--f,h(e,s[e])}));return}if(a){var n;try{n=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,n)}else++f,o.fetch(e,function(n,i){if(--f,r){if(n){t?f||l(null,o):l(n);return}h(e,i)}})}}var f=0;c.isString(t)&&(t=[t]);for(var g,m=0;m<t.length;++m)(g=o.resolvePath("",t[m]))&&p(g);if(a)return o;f||l(null,o)},h.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return o.prototype.resolveAll.call(this)};var p=/^[A-Z]/;function f(e,t){var n=t.parent.lookup(t.extend);if(n){var r=new a(t.fullName,t.id,t.type,t.rule,void 0,t.options);return r.declaringField=t,t.extensionField=r,n.add(r),!0}return!1}h.prototype._handleAdd=function(e){if(e instanceof a)void 0===e.extend||e.extensionField||f(this,e)||this.deferred.push(e);else if(e instanceof l)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof r)for(var t=0;t<this.deferred.length;)f(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var n=0;n<e.nestedArray.length;++n)this._handleAdd(e._nestedArray[n]);p.test(e.name)&&(e.parent[e.name]=e)}},h.prototype._handleRemove=function(e){if(e instanceof a){if(void 0!==e.extend){if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}}else if(e instanceof l)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof o){for(var n=0;n<e.nestedArray.length;++n)this._handleRemove(e._nestedArray[n]);p.test(e.name)&&delete e.parent[e.name]}},h._configure=function(e,t,n){r=e,i=t,s=n}},59694:e=>{"use strict";e.exports={}},84774:(e,t,n)=>{"use strict";t.Service=n(83829)},83829:(e,t,n)=>{"use strict";e.exports=i;var r=n(90745);function i(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,n,i,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,i,s);if(!a.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,n){if(e)return a.emit("error",e,t),o(e);if(null===n){a.end(!0);return}if(!(n instanceof i))try{n=i[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)})}catch(e){a.emit("error",e,t),setTimeout(function(){o(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},31631:(e,t,n)=>{"use strict";e.exports=a;var r=n(4943);((a.prototype=Object.create(r.prototype)).constructor=a).className="Service";var i=n(26539),s=n(84615),o=n(84774);function a(e,t){r.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}a.fromJSON=function(e,t){var n=new a(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),s=0;s<r.length;++s)n.add(i.fromJSON(r[s],t.methods[r[s]]));return t.nested&&n.addJSON(t.nested),n.comment=t.comment,n},a.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&!!e.keepComments;return s.toObject(["options",t&&t.options||void 0,"methods",r.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},Object.defineProperty(a.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),a.prototype.get=function(e){return this.methods[e]||r.prototype.get.call(this,e)},a.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return r.prototype.resolve.call(this)},a.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):r.prototype.add.call(this,e)},a.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return r.prototype.remove.call(this,e)},a.prototype.create=function(e,t,n){for(var r,i=new o.Service(e,t,n),a=0;a<this.methodsArray.length;++a){var l=s.lcFirst((r=this._methodsArray[a]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return i}},99867:e=>{"use strict";e.exports=h;var t=/[\s{}=;:[\],'"()<>]/g,n=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,r=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,i=/^ *[*/]+ */,s=/^\s*\*?\/*/,o=/\n/g,a=/\s/,l=/\\(.?)/g,u={0:"\0",r:"\r",n:"\n",t:"	"};function c(e){return e.replace(l,function(e,t){switch(t){case"\\":case"":return t;default:return u[t]||""}})}function h(e,l){e=e.toString();var u=0,h=e.length,d=1,p=null,f=null,g=0,m=!1,y=!1,v=[],_=null;function b(e){return Error("illegal "+e+" (line "+d+")")}function S(){var t="'"===_?r:n;t.lastIndex=u-1;var i=t.exec(e);if(!i)throw b("string");return u=t.lastIndex,k(_),_=null,c(i[1])}function w(t){return e.charAt(t)}function T(t,n,r){p=e.charAt(t++),g=d,m=!1,y=r;var a,u,c=t-(a=l?2:3);do if(--c<0||"\n"===(u=e.charAt(c))){m=!0;break}while(" "===u||"	"===u);for(var h=e.substring(t,n).split(o),v=0;v<h.length;++v)h[v]=h[v].replace(l?s:i,"").trim();f=h.join("\n").trim()}function E(t){var n=C(t),r=e.substring(t,n);return/^\s*\/{1,2}/.test(r)}function C(e){for(var t=e;t<h&&"\n"!==w(t);)t++;return t}function I(){if(v.length>0)return v.shift();if(_)return S();var n,r,i,s,o,c=0===u;do{if(u===h)return null;for(n=!1;a.test(i=w(u));)if("\n"===i&&(c=!0,++d),++u===h)return null;if("/"===w(u)){if(++u===h)throw b("comment");if("/"===w(u)){if(l){if(s=u,o=!1,E(u)){o=!0;do{if((u=C(u))===h)break;u++}while(E(u))}else u=Math.min(h,C(u)+1);o&&T(s,u,c),d++,n=!0}else{for(o="/"===w(s=u+1);"\n"!==w(++u);)if(u===h)return null;++u,o&&T(s,u-1,c),++d,n=!0}}else{if("*"!==(i=w(u)))return"/";s=u+1,o=l||"*"===w(s);do{if("\n"===i&&++d,++u===h)throw b("comment");r=i,i=w(u)}while("*"!==r||"/"!==i);++u,o&&T(s,u-2,c),n=!0}}}while(n);var p=u;if(t.lastIndex=0,!t.test(w(p++)))for(;p<h&&!t.test(w(p));)++p;var f=e.substring(u,u=p);return('"'===f||"'"===f)&&(_=f),f}function k(e){v.push(e)}function R(){if(!v.length){var e=I();if(null===e)return null;k(e)}return v[0]}function O(e,t){var n=R();if(n===e)return I(),!0;if(!t)throw b("token '"+n+"', '"+e+"' expected");return!1}function N(e){var t=null;return void 0===e?g===d-1&&(l||"*"===p||m)&&(t=y?f:null):(g<e&&R(),g===e&&!m&&(l||"/"===p)&&(t=y?null:f)),t}return Object.defineProperty({next:I,peek:R,push:k,skip:O,cmnt:N},"line",{get:function(){return d}})}h.unescape=c},3839:(e,t,n)=>{"use strict";e.exports=v;var r=n(4943);((v.prototype=Object.create(r.prototype)).constructor=v).className="Type";var i=n(71114),s=n(92695),o=n(37510),a=n(79538),l=n(31631),u=n(92936),c=n(42279),h=n(98458),d=n(84615),p=n(38455),f=n(31526),g=n(91506),m=n(85711),y=n(39579);function v(e,t){r.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function _(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var n=this.fields[e[t]],r=n.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=n}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var n=0;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();var r={};for(n=0;n<this.oneofsArray.length;++n)r[this._oneofsArray[n].resolve().name]={get:d.oneOfGetter(this._oneofsArray[n].oneof),set:d.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(e.prototype,r)}}}),v.generateConstructor=function(e){for(var t,n=d.codegen(["p"],e.name),r=0;r<e.fieldsArray.length;++r)(t=e._fieldsArray[r]).map?n("this%s={}",d.safeProp(t.name)):t.repeated&&n("this%s=[]",d.safeProp(t.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var n=new v(e,t.options);n.extensions=t.extensions,n.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)n.add((void 0!==t.fields[u[c]].keyType?a.fromJSON:o.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)n.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var h=t.nested[u[c]];n.add((void 0!==h.id?o.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:r.fromJSON)(u[c],h))}return t.extensions&&t.extensions.length&&(n.extensions=t.extensions),t.reserved&&t.reserved.length&&(n.reserved=t.reserved),t.group&&(n.group=!0),t.comment&&(n.comment=t.comment),n},v.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&!!e.keepComments;return d.toObject(["options",t&&t.options||void 0,"oneofs",r.arrayToJSON(this.oneofsArray,e),"fields",r.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},v.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var n=this.oneofsArray;for(t=0;t<n.length;)n[t++].resolve();return r.prototype.resolveAll.call(this)},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof o&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),_(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),_(this)):r.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof o&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),_(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),_(this)}return r.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],n=0;n<this.fieldsArray.length;++n)t.push(this._fieldsArray[n].resolve().resolvedType);this.encode=p(this)({Writer:h,types:t,util:d}),this.decode=f(this)({Reader:c,types:t,util:d}),this.verify=g(this)({types:t,util:d}),this.fromObject=m.fromObject(this)({types:t,util:d}),this.toObject=m.toObject(this)({types:t,util:d});var r=y[e];if(r){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(i),i.toObject=this.toObject,this.toObject=r.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},76160:(e,t,n)=>{"use strict";var r=t,i=n(84615),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function o(e,t){var n=0,r={};for(t|=0;n<e.length;)r[s[n+t]]=e[n++];return r}r.basic=o([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=o([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),r.long=o([0,0,0,1,1],7),r.mapKey=o([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=o([1,5,0,0,0,5,5,0,0,0,1,1,0])},84615:(e,t,n)=>{"use strict";var r,i,s=e.exports=n(90745),o=n(59694);s.codegen=n(696),s.fetch=n(37828),s.path=n(62727),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),n=Array(t.length),r=0;r<t.length;)n[r]=e[t[r++]];return n}return[]},s.toObject=function(e){for(var t={},n=0;n<e.length;){var r=e[n++],i=e[n++];void 0!==i&&(t[r]=i)}return t};var a=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(a,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(s.decorateRoot.remove(e.$type),e.$type.name=t,s.decorateRoot.add(e.$type)),e.$type;r||(r=n(3839));var i=new r(t||e.name);return s.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;s.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=n(71114));var t=new i("Enum"+c++,e);return s.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},s.setProperty=function(e,t,n){function r(e,t,n){var i=t.shift();if("__proto__"===i||"prototype"===i)return e;if(t.length>0)e[i]=r(e[i]||{},t,n);else{var s=e[i];s&&(n=[].concat(s).concat(n)),e[i]=n}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return r(e,t=t.split("."),n)},Object.defineProperty(s,"decorateRoot",{get:function(){return o.decorated||(o.decorated=new(n(54343)))}})},33674:(e,t,n)=>{"use strict";e.exports=i;var r=n(90745);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===o?s:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},90745:function(e,t,n){"use strict";var r=t;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function s(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),n&&i(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=n(61417),r.base64=n(75386),r.EventEmitter=n(33478),r.float=n(65256),r.inquire=n(71374),r.utf8=n(93670),r.pool=n(26733),r.LongBits=n(33674),r.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),r.global=r.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!!(null!=n&&e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;if(!e){r._Buffer_from=r._Buffer_allocUnsafe=null;return}r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},91506:(e,t,n)=>{"use strict";e.exports=l;var r=n(71114),i=n(84615);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function o(e,t,n,i){if(t.resolvedType){if(t.resolvedType instanceof r){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var o=Object.keys(t.resolvedType.values),a=0;a<o.length;++a)e("case %i:",t.resolvedType.values[o[a]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",n,i)("if(e)")("return%j+e",t.name+".")("}")}else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function a(e,t,n){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",n)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",n)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",n)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n=e.oneofsArray,r={};n.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),a(t,u,"k[i]"),o(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),o(t,u,l,c+"[i]")("}");else{if(u.partOf){var h=i.safeProp(u.partOf.name);1===r[u.partOf.name]&&t("if(p%s===1)",h)("return%j",u.partOf.name+": multiple values"),r[u.partOf.name]=1,t("p%s=1",h)}o(t,u,l,c)}u.optional&&t("}")}return t("return null")}},39579:(e,t,n)=>{"use strict";var r=t,i=n(92936);r[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),n=this.lookup(t);if(n){var r="."===e["@type"].charAt(0)?e["@type"].substr(1):e["@type"];return -1===r.indexOf("/")&&(r="/"+r),this.create({type_url:r,value:n.encode(n.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var n="type.googleapis.com/",r="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),r=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var o=this.lookup(s);o&&(e=o.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var a=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.substr(1):e.$type.fullName;return""===r&&(r=n),s=r+l,a["@type"]=s,a}return this.toObject(e,t)}}},98458:(e,t,n)=>{"use strict";e.exports=h;var r,i=n(90745),s=i.LongBits,o=i.base64,a=i.utf8;function l(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function f(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}function g(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function y(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new l(e,t,n),this.len+=t,this},g.prototype=Object.create(l.prototype),g.prototype.fn=f,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new g((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=d(),r._configure()}},68386:(e,t,n)=>{"use strict";e.exports=s;var r=n(98458);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(90745);function s(){r.call(this)}function o(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},s._configure()},90892:(e,t,n)=>{/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var r=n(14300),i=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=o),o.prototype=Object.create(i.prototype),s(i,o),o.from=function(e,t,n){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return r.SlowBuffer(e)}},18679:(e,t,n)=>{"use strict";var r=n(86070),i=n(7729),s=n(92949),o={client:function(e,t){return void 0===(t=t||{}).masking&&(t.masking=!0),new i(e,t)},server:function(e){return void 0===(e=e||{}).requireMasking&&(e.requireMasking=!0),new s(e)},http:function(){return s.http.apply(s,arguments)},isSecureRequest:function(e){return s.isSecureRequest(e)},isWebSocket:function(e){return r.isWebSocket(e)},validateOptions:function(e,t){r.validateOptions(e,t)}};e.exports=o},86070:(e,t,n)=>{"use strict";var r=n(90892).Buffer,i=n(82361).EventEmitter,s=n(73837),o=n(49242),a=n(15766),l=n(15828),u=function(e,t,n){i.call(this),u.validateOptions(n||{},["maxLength","masking","requireMasking","protocols"]),this._request=e,this._reader=new l,this._options=n||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new a,this.__queue=[],this.readyState=0,this.url=t,this.io=new o.IO(this),this.messages=new o.Messages(this),this._bindEventListeners()};s.inherits(u,i),u.isWebSocket=function(e){var t=e.headers.connection||"",n=e.headers.upgrade||"";return"GET"===e.method&&t.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===n.toLowerCase()},u.validateOptions=function(e,t){for(var n in e)if(0>t.indexOf(n))throw Error("Unrecognized option: "+n)};var c={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var e=this;this.messages.on("error",function(){}),this.on("message",function(t){var n=e.messages;n.readable&&n.emit("data",t.data)}),this.on("error",function(t){var n=e.messages;n.readable&&n.emit("error",t)}),this.on("close",function(){var t=e.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(e){return!1},setHeader:function(e,t){return!(this.readyState>0)&&(this._headers.set(e,t),!0)},start:function(){var e;if(0!==this.readyState)return!1;if(!u.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{e=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(e),-1!==this._stage&&this._open(),!0},_failHandshake:function(e){var t=new a;return t.set("Content-Type","text/plain"),t.set("Content-Length",r.byteLength(e.message,"utf8")),t=["HTTP/1.1 400 Bad Request",t.toString(),e.message],this._write(r.from(t.join("\r\n"),"utf8")),this._fail("protocol_error",e.message),!1},text:function(e){return this.frame(e)},binary:function(e){return!1},ping:function(){return!1},pong:function(){return!1},close:function(e,t){return 1===this.readyState&&(this.readyState=3,this.emit("close",new u.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(e){this.frame.apply(this,e)},this),this.__queue=[],this.emit("open",new u.OpenEvent)},_queue:function(e){return this.__queue.push(e),!0},_write:function(e){var t=this.io;t.readable&&t.emit("data",e)},_fail:function(e,t){this.readyState=2,this.emit("error",Error(t)),this.close()}};for(var h in c)u.prototype[h]=c[h];u.ConnectEvent=function(){},u.OpenEvent=function(){},u.CloseEvent=function(e,t){this.code=e,this.reason=t},u.MessageEvent=function(e){this.data=e},u.PingEvent=function(e){this.data=e},u.PongEvent=function(e){this.data=e},e.exports=u},7729:(e,t,n)=>{"use strict";var r=n(90892).Buffer,i=n(6113),s=n(57310),o=n(73837),a=n(11258),l=n(86070),u=n(45270),c=n(64967),h=function(e,t){this.version="hybi-"+u.VERSION,u.call(this,null,e,t),this.readyState=-1,this._key=h.generateKey(),this._accept=u.generateAccept(this._key),this._http=new a("response");var n=s.parse(this.url),i=n.auth&&r.from(n.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(n.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(n.pathname||"/")+(n.search||""),this._headers.set("Host",n.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",u.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),i&&this._headers.set("Authorization","Basic "+i)};o.inherits(h,u),h.generateKey=function(){return i.randomBytes(16).toString("base64")};var d={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(e,t){return new c(this,e,t)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(e){if(3!==this.readyState){if(this.readyState>0)return u.prototype.parse.call(this,e);this._http.parse(e),this._http.isComplete()&&(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var e=this._extensions.generateOffer();e&&this._headers.set("Sec-WebSocket-Extensions",e);var t=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return r.from(t.join("\r\n"),"utf8")},_failHandshake:function(e){e="Error during WebSocket handshake: "+e,this.readyState=3,this.emit("error",Error(e)),this.emit("close",new l.CloseEvent(this.ERRORS.protocol_error,e))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var e=this._http.headers,t=e.upgrade||"",n=e.connection||"",r=e["sec-websocket-accept"]||"",i=e["sec-websocket-protocol"]||"";if(""===t)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==t.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===n)return this._failHandshake("'Connection' header is missing");if("upgrade"!==n.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(r!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==i){if(0>this._protocols.indexOf(i))return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=i}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(e){return this._failHandshake(e.message)}}};for(var p in d)h.prototype[p]=d[p];e.exports=h},2441:(e,t,n)=>{"use strict";var r=n(90892).Buffer,i=n(86070),s=n(73837),o=function(e,t,n){i.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};s.inherits(o,i);var a={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new i.CloseEvent(null,null)),!0)},parse:function(e){this.readyState>1||(this._reader.put(e),this._reader.eachByte(function(e){var t;switch(this._stage){case -1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(127&e)+128*this._length,this._closing&&0===this._length)return this.close();(128&e)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===e)this._stage=0,t=r.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new i.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(e){if(0===this.readyState)return this._queue([e]);if(this.readyState>1)return!1;"string"!=typeof e&&(e=e.toString());var t=r.byteLength(e),n=r.allocUnsafe(t+2);return n[0]=0,n.write(e,1),n[n.length-1]=255,this._write(n),!0},_handshakeResponse:function(){var e=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return r.from(e.join("\r\n"),"utf8")},_parseLeadingByte:function(e){(128&e)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var l in a)o.prototype[l]=a[l];e.exports=o},13376:(e,t,n)=>{"use strict";var r=n(90892).Buffer,i=n(86070),s=n(2441),o=n(6113),a=n(73837),l=function(e){return parseInt((e.match(/[0-9]/g)||[]).join(""),10)},u=function(e){return(e.match(/ /g)||[]).length},c=function(e,t,n){s.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};a.inherits(c,s);var h={BODY_SIZE:8,start:function(){return!!s.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(r.from([255,0])),this.readyState=3,this.emit("close",new i.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var e=this._request.headers,t=e["sec-websocket-key1"],n=e["sec-websocket-key2"];if(!t)throw Error("Missing required header: Sec-WebSocket-Key1");if(!n)throw Error("Missing required header: Sec-WebSocket-Key2");var i=l(t),s=u(t),o=l(n),a=u(n);if(i%s!=0||o%a!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[i/s,o/a];var e=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return r.from(e.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var e=o.createHash("md5"),t=r.allocUnsafe(8+this.BODY_SIZE);return t.writeUInt32BE(this._keyValues[0],0),t.writeUInt32BE(this._keyValues[1],4),r.from(this._body).copy(t,8,0,this.BODY_SIZE),e.update(t),r.from(e.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var e=this._handshakeSignature();e&&(this._write(e),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(e){if(255!==e)return s.prototype._parseLeadingByte.call(this,e);this._closing=!0,this._length=0,this._stage=1}};for(var d in h)c.prototype[d]=h[d];e.exports=c},15766:e=>{"use strict";var t=function(){this.clear()};t.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],t.prototype.clear=function(){this._sent={},this._lines=[]},t.prototype.set=function(e,t){if(void 0!==t){e=this._strip(e),t=this._strip(t);var n=e.toLowerCase();(!this._sent.hasOwnProperty(n)||this.ALLOWED_DUPLICATES.indexOf(n)>=0)&&(this._sent[n]=!0,this._lines.push(e+": "+t+"\r\n"))}},t.prototype.toString=function(){return this._lines.join("")},t.prototype._strip=function(e){return e.toString().replace(/^ */,"").replace(/ *$/,"")},e.exports=t},45270:(e,t,n)=>{"use strict";var r=n(90892).Buffer,i=n(6113),s=n(73837),o=n(55056),a=n(86070),l=n(34722),u=n(38996),c=function(e,t,n){if(a.apply(this,arguments),this._extensions=new o,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var r=this._request.headers["sec-websocket-protocol"],i=this._protocols;void 0!==r&&("string"==typeof r&&(r=r.split(/ *, */)),this.protocol=r.filter(function(e){return i.indexOf(e)>=0})[0]),this.version="hybi-"+c.VERSION}};s.inherits(c,a),c.VERSION="13",c.mask=function(e,t,n){if(!t||0===t.length)return e;n=n||0;for(var r=0,i=e.length-n;r<i;r++)e[n+r]=e[n+r]^t[r%4];return e},c.generateAccept=function(e){var t=i.createHash("sha1");return t.update(e+c.GUID),t.digest("base64")},c.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var h={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(e){return this._extensions.add(e),!0},parse:function(e){this._reader.put(e);for(var t=!0;t;)switch(this._stage){case 0:(t=this._reader.read(1))&&this._parseOpcode(t[0]);break;case 1:(t=this._reader.read(1))&&this._parseLength(t[0]);break;case 2:(t=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(t);break;case 3:(t=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=t);break;case 4:(t=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(t));break;default:t=null}},text:function(e){return!(this.readyState>1)&&this.frame(e,"text")},binary:function(e){return!(this.readyState>1)&&this.frame(e,"binary")},ping:function(e,t){return!(this.readyState>1)&&(e=e||"",t&&(this._pingCallbacks[e]=t),this.frame(e,"ping"))},pong:function(e){return!(this.readyState>1)&&(e=e||"",this.frame(e,"pong"))},close:function(e,t){return(e=e||"",t=t||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new a.CloseEvent(t,e)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(e,"close",t)},this),!0)},frame:function(e,t,n){if(this.readyState<=0)return this._queue([e,t,n]);if(this.readyState>2)return!1;e instanceof Array&&(e=r.from(e)),"number"==typeof e&&(e=e.toString());var s,o,a=new u,c="string"==typeof e;a.rsv1=a.rsv2=a.rsv3=!1,a.opcode=this.OPCODES[t||(c?"text":"binary")],s=c?r.from(e,"utf8"):e,n&&(o=s,(s=r.allocUnsafe(2+o.length)).writeUInt16BE(n,0),o.copy(s,2)),a.data=s;var h=function(e){var t=new l;t.final=!0,t.rsv1=e.rsv1,t.rsv2=e.rsv2,t.rsv3=e.rsv3,t.opcode=e.opcode,t.masked=!!this._masking,t.length=e.data.length,t.payload=e.data,t.masked&&(t.maskingKey=i.randomBytes(4)),this._sendFrame(t)};return this.MESSAGE_OPCODES.indexOf(a.opcode)>=0?this._extensions.processOutgoingMessage(a,function(e,t){if(e)return this._fail("extension_error",e.message);h.call(this,t)},this):h.call(this,a),!0},_sendFrame:function(e){var t=e.length,n=t<=125?2:t<=65535?4:10,i=n+(e.masked?4:0),s=r.allocUnsafe(i+t),o=e.masked?this.MASK:0;s[0]=(e.final?this.FIN:0)|(e.rsv1?this.RSV1:0)|(e.rsv2?this.RSV2:0)|(e.rsv3?this.RSV3:0)|e.opcode,t<=125?s[1]=o|t:t<=65535?(s[1]=126|o,s.writeUInt16BE(t,2)):(s[1]=127|o,s.writeUInt32BE(Math.floor(t/4294967296),2),s.writeUInt32BE(t%4294967296,6)),e.payload.copy(s,i),e.masked&&(e.maskingKey.copy(s,n),c.mask(s,e.maskingKey,i)),this._write(s)},_handshakeResponse:function(){var e=this._request.headers["sec-websocket-key"],t=this._request.headers["sec-websocket-version"];if(t!==c.VERSION)throw Error("Unsupported WebSocket version: "+t);if("string"!=typeof e)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",c.generateAccept(e)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var n=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);n&&this._headers.set("Sec-WebSocket-Extensions",n);var i=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return r.from(i.join("\r\n"),"utf8")},_shutdown:function(e,t,n){delete this._frame,delete this._message,this._stage=5;var r=1===this.readyState;this.readyState=2,this._extensions.close(function(){r&&this.frame(t,"close",e),this.readyState=3,n&&this.emit("error",Error(t)),this.emit("close",new a.CloseEvent(e,t))},this)},_fail:function(e,t){this.readyState>1||this._shutdown(this.ERRORS[e],t,!0)},_parseOpcode:function(e){var t=[this.RSV1,this.RSV2,this.RSV3].map(function(t){return(e&t)===t}),n=this._frame=new l;return(n.final=(e&this.FIN)===this.FIN,n.rsv1=t[0],n.rsv2=t[1],n.rsv3=t[2],n.opcode=e&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(n))?0>this.OPCODE_CODES.indexOf(n.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+n.opcode):0>this.MESSAGE_OPCODES.indexOf(n.opcode)&&!n.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+n.opcode):this._message&&this.OPENING_OPCODES.indexOf(n.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(n.rsv1?1:0)+", reserved2 = "+(n.rsv2?1:0)+", reserved3 = "+(n.rsv3?1:0))},_parseLength:function(e){var t=this._frame;if(t.masked=(e&this.MASK)===this.MASK,t.length=e&this.LENGTH,t.length>=0&&t.length<=125){if(this._stage=t.masked?3:4,!this._checkFrameLength())return}else this._stage=2,t.lengthBytes=126===t.length?2:8;if(this._requireMasking&&!t.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(e){var t=this._frame;if(t.length=this._readUInt(e),this._stage=t.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(t.opcode)&&t.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+t.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(e){var t,n,r,i,s,o=this._frame,l=o.payload=c.mask(e,o.maskingKey),h=o.opcode;if(delete this._frame,h===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(o)}if((h===this.OPCODES.text||h===this.OPCODES.binary)&&(this._message=new u,this._message.pushFrame(o)),o.final&&this.MESSAGE_OPCODES.indexOf(h)>=0)return this._emitMessage(this._message);h===this.OPCODES.close&&(n=l.length>=2?l.readUInt16BE(0):null,r=l.length>2?this._encode(l.slice(2)):null,0!==l.length&&!(null!==n&&n>=this.MIN_RESERVED_ERROR&&n<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(n)&&(n=this.ERRORS.protocol_error),(l.length>125||l.length>2&&!r)&&(n=this.ERRORS.protocol_error),this._shutdown(n||this.DEFAULT_ERROR_CODE,r||"")),h===this.OPCODES.ping&&(this.frame(l,"pong"),this.emit("ping",new a.PingEvent(l.toString()))),h===this.OPCODES.pong&&(s=(i=this._pingCallbacks)[t=this._encode(l)],delete i[t],s&&s(),this.emit("pong",new a.PongEvent(l.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(e,t){if(e)return this._fail("extension_error",e.message);var n=t.data;if(t.opcode===this.OPCODES.text&&(n=this._encode(n)),null===n)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new a.MessageEvent(n))},this)},_encode:function(e){try{var t=e.toString("binary",0,e.length);if(!this.UTF8_MATCH.test(t))return null}catch(e){}return e.toString("utf8",0,e.length)},_readUInt:function(e){return 2===e.length?e.readUInt16BE(0):4294967296*e.readUInt32BE(0)+e.readUInt32BE(4)}};for(var d in h)c.prototype[d]=h[d];e.exports=c},34722:e=>{"use strict";var t=function(){},n={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var r in n)t.prototype[r]=n[r];e.exports=t},38996:(e,t,n)=>{"use strict";var r=n(90892).Buffer,i=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},s={read:function(){return this.data=this.data||r.concat(this._chunks,this.length)},pushFrame:function(e){this.rsv1=this.rsv1||e.rsv1,this.rsv2=this.rsv2||e.rsv2,this.rsv3=this.rsv3||e.rsv3,null===this.opcode&&(this.opcode=e.opcode),this._chunks.push(e.payload),this.length+=e.length}};for(var o in s)i.prototype[o]=s[o];e.exports=i},64967:(e,t,n)=>{"use strict";var r=n(90892).Buffer,i=n(12781).Stream,s=n(57310),o=n(73837),a=n(86070),l=n(15766),u=n(11258),c={"ws:":80,"wss:":443},h=function(e,t,n){this._client=e,this._http=new u("response"),this._origin="object"==typeof e.url?e.url:s.parse(e.url),this._url="object"==typeof t?t:s.parse(t),this._options=n||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new l,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var i=this._url.auth&&r.from(this._url.auth,"utf8").toString("base64");i&&this._headers.set("Proxy-Authorization","Basic "+i)};o.inherits(h,i);var d={setHeader:function(e,t){return 0===this._state&&(this._headers.set(e,t),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var e=this._origin,t=e.port||c[e.protocol],n=["CONNECT "+e.hostname+":"+t+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",r.from(n.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(e){if(!this.writable)return!1;if(this._http.parse(e),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new a.ConnectEvent);else{var t="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(t))}return this.end(),!this._paused},end:function(e){this.writable&&(void 0!==e&&this.write(e),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var p in d)h.prototype[p]=d[p];e.exports=h},92949:(e,t,n)=>{"use strict";var r=n(73837),i=n(11258),s=n(86070),o=n(2441),a=n(13376),l=n(45270),u=function(e){s.call(this,null,null,e),this._http=new i("request")};r.inherits(u,s);var c={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(e){if(this._delegate)return this._delegate.parse(e);if(this._http.parse(e),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var t=this;this._delegate=u.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(e){this._delegate.on(e,function(n){t.emit(e,n)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new s.ConnectEvent)}},_open:function(){this.__queue.forEach(function(e){this._delegate[e[0]].apply(this._delegate,e[1])},this),this.__queue=[]}};for(var h in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(e){c[e]=function(){return this._delegate?this._delegate[e].apply(this._delegate,arguments):(this.__queue.push([e,arguments]),!0)}}),c)u.prototype[h]=c[h];u.isSecureRequest=function(e){if(e.connection&&void 0!==e.connection.authorized||e.socket&&e.socket.secure)return!0;var t=e.headers;return!!t&&("on"===t.https||"on"===t["x-forwarded-ssl"]||"https"===t["x-forwarded-scheme"]||"https"===t["x-forwarded-proto"])},u.determineUrl=function(e){return(this.isSecureRequest(e)?"wss:":"ws:")+"//"+e.headers.host+e.url},u.http=function(e,t){void 0===(t=t||{}).requireMasking&&(t.requireMasking=!0);var n=e.headers,r=n["sec-websocket-version"],i=n["sec-websocket-key"],s=n["sec-websocket-key1"],u=n["sec-websocket-key2"],c=this.determineUrl(e);return r||i?new l(e,c,t):s||u?new a(e,c,t):new o(e,c,t)},e.exports=u},15828:(e,t,n)=>{"use strict";var r=n(90892).Buffer,i=function(){this._queue=[],this._queueSize=0,this._offset=0};i.prototype.put=function(e){e&&0!==e.length&&(r.isBuffer(e)||(e=r.from(e)),this._queue.push(e),this._queueSize+=e.length)},i.prototype.read=function(e){if(e>this._queueSize)return null;if(0===e)return r.alloc(0);this._queueSize-=e;var t,n,i=this._queue,s=e,o=i[0];if(o.length>=e)return o.length===e?i.shift():(n=o.slice(0,e),i[0]=o.slice(e),n);for(var a=0,l=i.length;a<l&&!(s<i[a].length);a++)s-=i[a].length;return t=i.splice(0,a),s>0&&i.length>0&&(t.push(i[0].slice(0,s)),i[0]=i[0].slice(s)),r.concat(t,e)},i.prototype.eachByte=function(e,t){for(var n,r,i;this._queue.length>0;){for(r=(n=this._queue[0]).length;this._offset<r;)i=this._offset,this._offset+=1,e.call(t,n[i]);this._offset=0,this._queue.shift()}},e.exports=i},11258:(e,t,n)=>{"use strict";var r=n(15433).m,i=n(90892).Buffer,s={request:r.REQUEST||"request",response:r.RESPONSE||"response"},o=function(e){this._type=e,this._parser=new r(s[e]),this._complete=!1,this.headers={};var t=null,n=this;this._parser.onHeaderField=function(e,n,r){t=e.toString("utf8",n,n+r).toLowerCase()},this._parser.onHeaderValue=function(e,r,i){var s=e.toString("utf8",r,r+i);n.headers.hasOwnProperty(t)?n.headers[t]+=", "+s:n.headers[t]=s},this._parser.onHeadersComplete=this._parser[r.kOnHeadersComplete]=function(e,t,r,i,s,a){var l=arguments[0];if("object"==typeof l&&(i=l.method,s=l.url,a=l.statusCode,r=l.headers),n.method="number"==typeof i?o.METHODS[i]:i,n.statusCode=a,n.url=s,r){for(var u,c,h=0,d=r.length;h<d;h+=2)u=r[h].toLowerCase(),c=r[h+1],n.headers.hasOwnProperty(u)?n.headers[u]+=", "+c:n.headers[u]=c;n._complete=!0}}};o.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var a=process.version?process.version.match(/[0-9]+/g).map(function(e){return parseInt(e,10)}):[];0===a[0]&&12===a[1]&&(o.METHODS[16]="REPORT",o.METHODS[17]="MKACTIVITY",o.METHODS[18]="CHECKOUT",o.METHODS[19]="MERGE",o.METHODS[20]="M-SEARCH",o.METHODS[21]="NOTIFY",o.METHODS[22]="SUBSCRIBE",o.METHODS[23]="UNSUBSCRIBE",o.METHODS[24]="PATCH",o.METHODS[25]="PURGE"),o.prototype.isComplete=function(){return this._complete},o.prototype.parse=function(e){var t=this._parser.execute(e,0,e.length);if("number"!=typeof t){this.error=t,this._complete=!0;return}this._complete&&(this.body=t<e.length?e.slice(t):i.alloc(0))},e.exports=o},49242:(e,t,n)=>{"use strict";var r=n(12781).Stream,i=n(73837),s=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};i.inherits(s,r),s.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},s.prototype.resume=function(){this._paused=!1,this.emit("drain");var e=this._driver.messages;e._paused=!1,e.emit("drain")},s.prototype.write=function(e){return!!this.writable&&(this._driver.parse(e),!this._paused)},s.prototype.end=function(e){if(this.writable){void 0!==e&&this.write(e),this.writable=!1;var t=this._driver.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))}},s.prototype.destroy=function(){this.end()};var o=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};i.inherits(o,r),o.prototype.pause=function(){this._driver.io._paused=!0},o.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},o.prototype.write=function(e){return!!this.writable&&("string"==typeof e?this._driver.text(e):this._driver.binary(e),!this._paused)},o.prototype.end=function(e){void 0!==e&&this.write(e)},o.prototype.destroy=function(){},t.IO=s,t.Messages=o},74432:e=>{"use strict";var t=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,n=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,r=RegExp(t.source+"(?:=(?:"+t.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),i=RegExp(t.source+"(?: *; *"+r.source+")*","g"),s=RegExp("^"+i.source+"(?: *, *"+i.source+")*$"),o=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,a=Object.prototype.hasOwnProperty,l={parseHeader:function(e){var t=new u;if(""===e||void 0===e)return t;if(!s.test(e))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);return e.match(i).forEach(function(e){var n=e.match(RegExp(r.source,"g")),i=n.shift(),s={};n.forEach(function(e){var t,n=e.match(r),i=n[1];t=void 0!==n[2]?n[2]:void 0===n[3]||n[3].replace(/\\/g,""),o.test(t)&&(t=parseFloat(t)),a.call(s,i)?(s[i]=[].concat(s[i]),s[i].push(t)):s[i]=t},this),t.push(i,s)},this),t},serializeParams:function(e,t){var r=[],i=function(e,t){t instanceof Array?t.forEach(function(t){i(e,t)}):!0===t?r.push(e):"number"==typeof t?r.push(e+"="+t):n.test(t)?r.push(e+'="'+t.replace(/"/g,'\\"')+'"'):r.push(e+"="+t)};for(var s in t)i(s,t[s]);return[e].concat(r).join("; ")}},u=function(){this._byName={},this._inOrder=[]};u.prototype.push=function(e,t){a.call(this._byName,e)||(this._byName[e]=[]),this._byName[e].push(t),this._inOrder.push({name:e,params:t})},u.prototype.eachOffer=function(e,t){for(var n=this._inOrder,r=0,i=n.length;r<i;r++)e.call(t,n[r].name,n[r].params)},u.prototype.byName=function(e){return this._byName[e]||[]},u.prototype.toArray=function(){return this._inOrder.slice()},e.exports=l},36383:(e,t,n)=>{"use strict";var r=n(6251),i=n(43892),s=function(e){this._ext=e[0],this._session=e[1],this._functors={incoming:new r(this._session,"processIncomingMessage"),outgoing:new r(this._session,"processOutgoingMessage")}};s.prototype.pending=function(e){var t=this._functors[e];t._stopped||(t.pending+=1)},s.prototype.incoming=function(e,t,n,r){this._exec("incoming",e,t,n,r)},s.prototype.outgoing=function(e,t,n,r){this._exec("outgoing",e,t,n,r)},s.prototype.close=function(){return this._closed=this._closed||new i,this._doClose(),this._closed},s.prototype._exec=function(e,t,n,r,i){this._functors[e].call(t,n,function(e,t){e&&(e.message=this._ext.name+": "+e.message),r.call(i,e,t),this._doClose()},this)},s.prototype._doClose=function(){var e=this._functors.incoming,t=this._functors.outgoing;this._closed&&e.pending+t.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},e.exports=s},6251:(e,t,n)=>{"use strict";var r=n(99210),i=function(e,t){this._session=e,this._method=t,this._queue=new r(i.QUEUE_SIZE),this._stopped=!1,this.pending=0};i.QUEUE_SIZE=8,i.prototype.call=function(e,t,n,r){if(!this._stopped){var i={error:e,message:t,callback:n,context:r,done:!1},s=!1,o=this;if(this._queue.push(i),i.error)return i.done=!0,this._stop(),this._flushQueue();var a=function(e,t){s^(s=!0)&&(e?(o._stop(),i.error=e,i.message=null):i.message=t,i.done=!0,o._flushQueue())};try{this._session[this._method](t,a)}catch(e){a(e)}}},i.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},i.prototype._flushQueue=function(){for(var e,t=this._queue;t.length>0&&t.peek().done;)(e=t.shift()).error?(this.pending=0,t.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)},e.exports=i},57935:(e,t,n)=>{"use strict";var r=n(36383),i=n(43892),s=function(e){this._cells=e.map(function(e){return new r(e)}),this._stopped={incoming:!1,outgoing:!1}};s.prototype.processIncomingMessage=function(e,t,n){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,e,t,n)},s.prototype.processOutgoingMessage=function(e,t,n){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,e,t,n)},s.prototype.close=function(e,t){this._stopped={incoming:!0,outgoing:!0};var n=this._cells.map(function(e){return e.close()});e&&i.all(n).then(function(){e.call(t)})},s.prototype._loop=function(e,t,n,r,i,s,o){for(var a=this._cells,l=a.length,u=this;l--;)a[l].pending(e);var c=function(t,i,l){if(t===n)return s.call(o,i,l);a[t][e](i,l,function(n,i){n&&(u._stopped[e]=!0),c(t+r,n,i)})};c(t,null,i)},e.exports=s},43892:(e,t,n)=>{"use strict";var r=n(99210),i=function(){this._complete=!1,this._callbacks=new r(i.QUEUE_SIZE)};i.QUEUE_SIZE=4,i.all=function(e){var t=new i,n=e.length,r=n;for(0===n&&t.done();r--;)e[r].then(function(){0==(n-=1)&&t.done()});return t},i.prototype.then=function(e){this._complete?e():this._callbacks.push(e)},i.prototype.done=function(){this._complete=!0;for(var e,t=this._callbacks;e=t.shift();)e()},e.exports=i},99210:e=>{"use strict";var t=function(e){this._bufferSize=e,this.clear()};t.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},t.prototype.push=function(e){var t=!1,n=!1;this._ringSize<this._bufferSize?t=0===this._tail:this._ringOffset===this._ringSize&&(t=!0,n=0===this._tail),t&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,n&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=e,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},t.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},t.prototype.shift=function(){if(0!==this.length){var e=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,e}},e.exports=t},55056:(e,t,n)=>{"use strict";var r=n(74432),i=n(57935),s=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};s.MESSAGE_OPCODES=[1,2];var o={add:function(e){if("string"!=typeof e.name)throw TypeError("extension.name must be a string");if("permessage"!==e.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof e.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof e.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof e.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(e.name))throw TypeError('An extension with name "'+e.name+'" is already registered');this._byName[e.name]=e,this._inOrder.push(e)},generateOffer:function(){var e=[],t=[],n={};return this._inOrder.forEach(function(i){var s=i.createClientSession();if(s){var o=[i,s];e.push(o),n[i.name]=o;var a=s.generateOffer();a=a?[].concat(a):[],a.forEach(function(e){t.push(r.serializeParams(i.name,e))},this)}},this),this._sessions=e,this._index=n,t.length>0?t.join(", "):null},activate:function(e){var t=r.parseHeader(e),n=[];t.eachOffer(function(e,t){var i=this._index[e];if(!i)throw Error('Server sent an extension response for unknown extension "'+e+'"');var s=i[0],o=i[1],a=this._reserved(s);if(a)throw Error("Server sent two extension responses that use the RSV"+a[0]+' bit: "'+a[1]+'" and "'+s.name+'"');if(!0!==o.activate(t))throw Error("Server sent unacceptable extension parameters: "+r.serializeParams(e,t));this._reserve(s),n.push(i)},this),this._sessions=n,this._pipeline=new i(n)},generateResponse:function(e){var t=[],n=[],s=r.parseHeader(e);return this._inOrder.forEach(function(e){var i=s.byName(e.name);if(!(0===i.length||this._reserved(e))){var o=e.createServerSession(i);o&&(this._reserve(e),t.push([e,o]),n.push(r.serializeParams(e.name,o.generateResponse())))}},this),this._sessions=t,this._pipeline=new i(t),n.length>0?n.join(", "):null},validFrameRsv:function(e){var t,n={rsv1:!1,rsv2:!1,rsv3:!1};if(s.MESSAGE_OPCODES.indexOf(e.opcode)>=0)for(var r=0,i=this._sessions.length;r<i;r++)t=this._sessions[r][0],n.rsv1=n.rsv1||t.rsv1,n.rsv2=n.rsv2||t.rsv2,n.rsv3=n.rsv3||t.rsv3;return(n.rsv1||!e.rsv1)&&(n.rsv2||!e.rsv2)&&(n.rsv3||!e.rsv3)},processIncomingMessage:function(e,t,n){this._pipeline.processIncomingMessage(e,t,n)},processOutgoingMessage:function(e,t,n){this._pipeline.processOutgoingMessage(e,t,n)},close:function(e,t){if(!this._pipeline)return e.call(t);this._pipeline.close(e,t)},_reserve:function(e){this._rsv1=this._rsv1||e.rsv1&&e.name,this._rsv2=this._rsv2||e.rsv2&&e.name,this._rsv3=this._rsv3||e.rsv3&&e.name},_reserved:function(e){return this._rsv1&&e.rsv1?[1,this._rsv1]:this._rsv2&&e.rsv2?[2,this._rsv2]:!!this._rsv3&&!!e.rsv3&&[3,this._rsv3]}};for(var a in o)s.prototype[a]=o[a];e.exports=s},53973:(e,t,n)=>{"use strict";var r=n(51188);n.o(r,"cookies")&&n.d(t,{cookies:function(){return r.cookies}})},85723:(e,t)=>{"use strict";var n;function r(e){for(let t=0;t<e.length;t++){let n=e[t];if("function"!=typeof n)throw Error(`A "use server" file can only export async functions, found ${typeof n}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`)}}n={value:!0},Object.defineProperty(t,"ensureServerEntryExports",{enumerable:!0,get:function(){return r}})},27745:(e,t,n)=>{"use strict";var r;r={value:!0},Object.defineProperty(t,"registerServerReference",{enumerable:!0,get:function(){return s}});let i=n(96012);function s(e,t){return(0,i.registerServerReference)(t,e,null)}},32444:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DraftMode",{enumerable:!0,get:function(){return s}});let r=n(45869),i=n(89565);class s{get isEnabled(){return this._provider.isEnabled}enable(){let e=r.staticGenerationAsyncStorage.getStore();return e&&(0,i.trackDynamicDataAccessed)(e,"draftMode().enable()"),this._provider.enable()}disable(){let e=r.staticGenerationAsyncStorage.getStore();return e&&(0,i.trackDynamicDataAccessed)(e,"draftMode().disable()"),this._provider.disable()}constructor(e){this._provider=e}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},51188:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{cookies:function(){return d},draftMode:function(){return p},headers:function(){return h}});let r=n(98450),i=n(99042),s=n(4465),o=n(72934),a=n(32444),l=n(89565),u=n(45869),c=n(54580);function h(){let e="headers",t=u.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return i.HeadersAdapter.seal(new Headers({}));(0,l.trackDynamicDataAccessed)(t,e)}return(0,c.getExpectedRequestStore)(e).headers}function d(){let e="cookies",t=u.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return r.RequestCookiesAdapter.seal(new s.RequestCookies(new Headers({})));(0,l.trackDynamicDataAccessed)(t,e)}let n=(0,c.getExpectedRequestStore)(e),i=o.actionAsyncStorage.getStore();return(null==i?void 0:i.isAction)||(null==i?void 0:i.isAppRoute)?n.mutableCookies:n.cookies}function p(){let e="draftMode",t=(0,c.getExpectedRequestStore)(e);return new a.DraftMode(t.draftMode)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},61946:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{DynamicServerError:function(){return r},isDynamicServerError:function(){return i}});let n="DYNAMIC_SERVER_USAGE";class r extends Error{constructor(e){super("Dynamic server usage: "+e),this.description=e,this.digest=n}}function i(e){return"object"==typeof e&&null!==e&&"digest"in e&&"string"==typeof e.digest&&e.digest===n}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},27389:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{StaticGenBailoutError:function(){return r},isStaticGenBailoutError:function(){return i}});let n="NEXT_STATIC_GEN_BAILOUT";class r extends Error{constructor(...e){super(...e),this.code=n}}function i(e){return"object"==typeof e&&null!==e&&"code"in e&&e.code===n}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},58063:e=>{"use strict";var t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s=(e,s,o,a)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let l of r(s))i.call(e,l)||l===o||t(e,l,{get:()=>s[l],enumerable:!(a=n(s,l))||a.enumerable});return e},o=e=>s(t({},"__esModule",{value:!0}),e),a={};function l(e){var t;let n=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),r=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===n.length?r:`${r}; ${n.join("; ")}`}function u(e){let t=new Map;for(let n of e.split(/; */)){if(!n)continue;let e=n.indexOf("=");if(-1===e){t.set(n,"true");continue}let[r,i]=[n.slice(0,e),n.slice(e+1)];try{t.set(r,decodeURIComponent(null!=i?i:"true"))}catch{}}return t}function c(e){if(!e)return;let[[t,n],...r]=u(e),{domain:i,expires:s,httponly:o,maxage:a,path:l,samesite:c,secure:d,partitioned:f,priority:m}=Object.fromEntries(r.map(([e,t])=>[e.toLowerCase(),t]));return h({name:t,value:decodeURIComponent(n),domain:i,...s&&{expires:new Date(s)},...o&&{httpOnly:!0},..."string"==typeof a&&{maxAge:Number(a)},path:l,...c&&{sameSite:p(c)},...d&&{secure:!0},...m&&{priority:g(m)},...f&&{partitioned:!0}})}function h(e){let t={};for(let n in e)e[n]&&(t[n]=e[n]);return t}((e,n)=>{for(var r in n)t(e,r,{get:n[r],enumerable:!0})})(a,{RequestCookies:()=>y,ResponseCookies:()=>v,parseCookie:()=>u,parseSetCookie:()=>c,stringifyCookie:()=>l}),e.exports=o(a);var d=["strict","lax","none"];function p(e){return e=e.toLowerCase(),d.includes(e)?e:void 0}var f=["low","medium","high"];function g(e){return e=e.toLowerCase(),f.includes(e)?e:void 0}function m(e){if(!e)return[];var t,n,r,i,s,o=[],a=0;function l(){for(;a<e.length&&/\s/.test(e.charAt(a));)a+=1;return a<e.length}function u(){return"="!==(n=e.charAt(a))&&";"!==n&&","!==n}for(;a<e.length;){for(t=a,s=!1;l();)if(","===(n=e.charAt(a))){for(r=a,a+=1,l(),i=a;a<e.length&&u();)a+=1;a<e.length&&"="===e.charAt(a)?(s=!0,a=i,o.push(e.substring(t,r)),t=a):a=r+1}else a+=1;(!s||a>=e.length)&&o.push(e.substring(t,e.length))}return o}var y=class{constructor(e){this._parsed=new Map,this._headers=e;let t=e.get("cookie");if(t)for(let[e,n]of u(t))this._parsed.set(e,{name:e,value:n})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let n=Array.from(this._parsed);if(!e.length)return n.map(([e,t])=>t);let r="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return n.filter(([e])=>e===r).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,n]=1===e.length?[e[0].name,e[0].value]:e,r=this._parsed;return r.set(t,{name:t,value:n}),this._headers.set("cookie",Array.from(r).map(([e,t])=>l(t)).join("; ")),this}delete(e){let t=this._parsed,n=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>l(t)).join("; ")),n}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},v=class{constructor(e){var t,n,r;this._parsed=new Map,this._headers=e;let i=null!=(r=null!=(n=null==(t=e.getSetCookie)?void 0:t.call(e))?n:e.get("set-cookie"))?r:[];for(let e of Array.isArray(i)?i:m(i)){let t=c(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let n=Array.from(this._parsed.values());if(!e.length)return n;let r="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return n.filter(e=>e.name===r)}has(e){return this._parsed.has(e)}set(...e){let[t,n,r]=1===e.length?[e[0].name,e[0].value,e[0]]:e,i=this._parsed;return i.set(t,b({name:t,value:n,...r})),_(i,this._headers),this}delete(...e){let[t,n,r]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:n,domain:r,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(l).join("; ")}};function _(e,t){for(let[,n]of(t.delete("set-cookie"),e)){let e=l(n);t.append("set-cookie",e)}}function b(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}},98601:e=>{(()=>{"use strict";var t={491:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextAPI=void 0;let r=n(223),i=n(172),s=n(930),o="context",a=new r.NoopContextManager;class l{constructor(){}static getInstance(){return this._instance||(this._instance=new l),this._instance}setGlobalContextManager(e){return(0,i.registerGlobal)(o,e,s.DiagAPI.instance())}active(){return this._getContextManager().active()}with(e,t,n,...r){return this._getContextManager().with(e,t,n,...r)}bind(e,t){return this._getContextManager().bind(e,t)}_getContextManager(){return(0,i.getGlobal)(o)||a}disable(){this._getContextManager().disable(),(0,i.unregisterGlobal)(o,s.DiagAPI.instance())}}t.ContextAPI=l},930:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagAPI=void 0;let r=n(56),i=n(912),s=n(957),o=n(172),a="diag";class l{constructor(){function e(e){return function(...t){let n=(0,o.getGlobal)("diag");if(n)return n[e](...t)}}let t=this,n=(e,n={logLevel:s.DiagLogLevel.INFO})=>{var r,a,l;if(e===t){let e=Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=e.stack)&&void 0!==r?r:e.message),!1}"number"==typeof n&&(n={logLevel:n});let u=(0,o.getGlobal)("diag"),c=(0,i.createLogLevelDiagLogger)(null!==(a=n.logLevel)&&void 0!==a?a:s.DiagLogLevel.INFO,e);if(u&&!n.suppressOverrideMessage){let e=null!==(l=Error().stack)&&void 0!==l?l:"<failed to generate stacktrace>";u.warn(`Current logger will be overwritten from ${e}`),c.warn(`Current logger will overwrite one already registered from ${e}`)}return(0,o.registerGlobal)("diag",c,t,!0)};t.setLogger=n,t.disable=()=>{(0,o.unregisterGlobal)(a,t)},t.createComponentLogger=e=>new r.DiagComponentLogger(e),t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}static instance(){return this._instance||(this._instance=new l),this._instance}}t.DiagAPI=l},653:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsAPI=void 0;let r=n(660),i=n(172),s=n(930),o="metrics";class a{constructor(){}static getInstance(){return this._instance||(this._instance=new a),this._instance}setGlobalMeterProvider(e){return(0,i.registerGlobal)(o,e,s.DiagAPI.instance())}getMeterProvider(){return(0,i.getGlobal)(o)||r.NOOP_METER_PROVIDER}getMeter(e,t,n){return this.getMeterProvider().getMeter(e,t,n)}disable(){(0,i.unregisterGlobal)(o,s.DiagAPI.instance())}}t.MetricsAPI=a},181:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropagationAPI=void 0;let r=n(172),i=n(874),s=n(194),o=n(277),a=n(369),l=n(930),u="propagation",c=new i.NoopTextMapPropagator;class h{constructor(){this.createBaggage=a.createBaggage,this.getBaggage=o.getBaggage,this.getActiveBaggage=o.getActiveBaggage,this.setBaggage=o.setBaggage,this.deleteBaggage=o.deleteBaggage}static getInstance(){return this._instance||(this._instance=new h),this._instance}setGlobalPropagator(e){return(0,r.registerGlobal)(u,e,l.DiagAPI.instance())}inject(e,t,n=s.defaultTextMapSetter){return this._getGlobalPropagator().inject(e,t,n)}extract(e,t,n=s.defaultTextMapGetter){return this._getGlobalPropagator().extract(e,t,n)}fields(){return this._getGlobalPropagator().fields()}disable(){(0,r.unregisterGlobal)(u,l.DiagAPI.instance())}_getGlobalPropagator(){return(0,r.getGlobal)(u)||c}}t.PropagationAPI=h},997:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceAPI=void 0;let r=n(172),i=n(846),s=n(139),o=n(607),a=n(930),l="trace";class u{constructor(){this._proxyTracerProvider=new i.ProxyTracerProvider,this.wrapSpanContext=s.wrapSpanContext,this.isSpanContextValid=s.isSpanContextValid,this.deleteSpan=o.deleteSpan,this.getSpan=o.getSpan,this.getActiveSpan=o.getActiveSpan,this.getSpanContext=o.getSpanContext,this.setSpan=o.setSpan,this.setSpanContext=o.setSpanContext}static getInstance(){return this._instance||(this._instance=new u),this._instance}setGlobalTracerProvider(e){let t=(0,r.registerGlobal)(l,this._proxyTracerProvider,a.DiagAPI.instance());return t&&this._proxyTracerProvider.setDelegate(e),t}getTracerProvider(){return(0,r.getGlobal)(l)||this._proxyTracerProvider}getTracer(e,t){return this.getTracerProvider().getTracer(e,t)}disable(){(0,r.unregisterGlobal)(l,a.DiagAPI.instance()),this._proxyTracerProvider=new i.ProxyTracerProvider}}t.TraceAPI=u},277:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteBaggage=t.setBaggage=t.getActiveBaggage=t.getBaggage=void 0;let r=n(491),i=(0,n(780).createContextKey)("OpenTelemetry Baggage Key");function s(e){return e.getValue(i)||void 0}function o(){return s(r.ContextAPI.getInstance().active())}function a(e,t){return e.setValue(i,t)}function l(e){return e.deleteValue(i)}t.getBaggage=s,t.getActiveBaggage=o,t.setBaggage=a,t.deleteBaggage=l},993:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaggageImpl=void 0;class n{constructor(e){this._entries=e?new Map(e):new Map}getEntry(e){let t=this._entries.get(e);if(t)return Object.assign({},t)}getAllEntries(){return Array.from(this._entries.entries()).map(([e,t])=>[e,t])}setEntry(e,t){let r=new n(this._entries);return r._entries.set(e,t),r}removeEntry(e){let t=new n(this._entries);return t._entries.delete(e),t}removeEntries(...e){let t=new n(this._entries);for(let n of e)t._entries.delete(n);return t}clear(){return new n}}t.BaggageImpl=n},830:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baggageEntryMetadataSymbol=void 0,t.baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata")},369:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baggageEntryMetadataFromString=t.createBaggage=void 0;let r=n(930),i=n(993),s=n(830),o=r.DiagAPI.instance();function a(e={}){return new i.BaggageImpl(new Map(Object.entries(e)))}function l(e){return"string"!=typeof e&&(o.error(`Cannot create baggage metadata from unknown type: ${typeof e}`),e=""),{__TYPE__:s.baggageEntryMetadataSymbol,toString:()=>e}}t.createBaggage=a,t.baggageEntryMetadataFromString=l},67:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.context=void 0;let r=n(491);t.context=r.ContextAPI.getInstance()},223:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopContextManager=void 0;let r=n(780);class i{active(){return r.ROOT_CONTEXT}with(e,t,n,...r){return t.call(n,...r)}bind(e,t){return t}enable(){return this}disable(){return this}}t.NoopContextManager=i},780:(e,t)=>{function n(e){return Symbol.for(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.ROOT_CONTEXT=t.createContextKey=void 0,t.createContextKey=n;class r{constructor(e){let t=this;t._currentContext=e?new Map(e):new Map,t.getValue=e=>t._currentContext.get(e),t.setValue=(e,n)=>{let i=new r(t._currentContext);return i._currentContext.set(e,n),i},t.deleteValue=e=>{let n=new r(t._currentContext);return n._currentContext.delete(e),n}}}t.ROOT_CONTEXT=new r},506:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diag=void 0;let r=n(930);t.diag=r.DiagAPI.instance()},56:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagComponentLogger=void 0;let r=n(172);class i{constructor(e){this._namespace=e.namespace||"DiagComponentLogger"}debug(...e){return s("debug",this._namespace,e)}error(...e){return s("error",this._namespace,e)}info(...e){return s("info",this._namespace,e)}warn(...e){return s("warn",this._namespace,e)}verbose(...e){return s("verbose",this._namespace,e)}}function s(e,t,n){let i=(0,r.getGlobal)("diag");if(i)return n.unshift(t),i[e](...n)}t.DiagComponentLogger=i},972:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagConsoleLogger=void 0;let n=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}];class r{constructor(){function e(e){return function(...t){if(console){let n=console[e];if("function"!=typeof n&&(n=console.log),"function"==typeof n)return n.apply(console,t)}}}for(let t=0;t<n.length;t++)this[n[t].n]=e(n[t].c)}}t.DiagConsoleLogger=r},912:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLogLevelDiagLogger=void 0;let r=n(957);function i(e,t){function n(n,r){let i=t[n];return"function"==typeof i&&e>=r?i.bind(t):function(){}}return e<r.DiagLogLevel.NONE?e=r.DiagLogLevel.NONE:e>r.DiagLogLevel.ALL&&(e=r.DiagLogLevel.ALL),t=t||{},{error:n("error",r.DiagLogLevel.ERROR),warn:n("warn",r.DiagLogLevel.WARN),info:n("info",r.DiagLogLevel.INFO),debug:n("debug",r.DiagLogLevel.DEBUG),verbose:n("verbose",r.DiagLogLevel.VERBOSE)}}t.createLogLevelDiagLogger=i},957:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.DiagLogLevel=void 0,function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(n=t.DiagLogLevel||(t.DiagLogLevel={}))},172:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unregisterGlobal=t.getGlobal=t.registerGlobal=void 0;let r=n(200),i=n(521),s=n(130),o=i.VERSION.split(".")[0],a=Symbol.for(`opentelemetry.js.api.${o}`),l=r._globalThis;function u(e,t,n,r=!1){var s;let o=l[a]=null!==(s=l[a])&&void 0!==s?s:{version:i.VERSION};if(!r&&o[e]){let t=Error(`@opentelemetry/api: Attempted duplicate registration of API: ${e}`);return n.error(t.stack||t.message),!1}if(o.version!==i.VERSION){let t=Error(`@opentelemetry/api: Registration of version v${o.version} for ${e} does not match previously registered API v${i.VERSION}`);return n.error(t.stack||t.message),!1}return o[e]=t,n.debug(`@opentelemetry/api: Registered a global for ${e} v${i.VERSION}.`),!0}function c(e){var t,n;let r=null===(t=l[a])||void 0===t?void 0:t.version;if(r&&(0,s.isCompatible)(r))return null===(n=l[a])||void 0===n?void 0:n[e]}function h(e,t){t.debug(`@opentelemetry/api: Unregistering a global for ${e} v${i.VERSION}.`);let n=l[a];n&&delete n[e]}t.registerGlobal=u,t.getGlobal=c,t.unregisterGlobal=h},130:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCompatible=t._makeCompatibilityCheck=void 0;let r=n(521),i=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function s(e){let t=new Set([e]),n=new Set,r=e.match(i);if(!r)return()=>!1;let s={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(null!=s.prerelease)return function(t){return t===e};function o(e){return n.add(e),!1}function a(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;let r=e.match(i);if(!r)return o(e);let l={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};return null!=l.prerelease||s.major!==l.major?o(e):0===s.major?s.minor===l.minor&&s.patch<=l.patch?a(e):o(e):s.minor<=l.minor?a(e):o(e)}}t._makeCompatibilityCheck=s,t.isCompatible=s(r.VERSION)},886:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.metrics=void 0;let r=n(653);t.metrics=r.MetricsAPI.getInstance()},901:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ValueType=void 0,function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(n=t.ValueType||(t.ValueType={}))},102:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createNoopMeter=t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=t.NOOP_OBSERVABLE_GAUGE_METRIC=t.NOOP_OBSERVABLE_COUNTER_METRIC=t.NOOP_UP_DOWN_COUNTER_METRIC=t.NOOP_HISTOGRAM_METRIC=t.NOOP_COUNTER_METRIC=t.NOOP_METER=t.NoopObservableUpDownCounterMetric=t.NoopObservableGaugeMetric=t.NoopObservableCounterMetric=t.NoopObservableMetric=t.NoopHistogramMetric=t.NoopUpDownCounterMetric=t.NoopCounterMetric=t.NoopMetric=t.NoopMeter=void 0;class n{constructor(){}createHistogram(e,n){return t.NOOP_HISTOGRAM_METRIC}createCounter(e,n){return t.NOOP_COUNTER_METRIC}createUpDownCounter(e,n){return t.NOOP_UP_DOWN_COUNTER_METRIC}createObservableGauge(e,n){return t.NOOP_OBSERVABLE_GAUGE_METRIC}createObservableCounter(e,n){return t.NOOP_OBSERVABLE_COUNTER_METRIC}createObservableUpDownCounter(e,n){return t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC}addBatchObservableCallback(e,t){}removeBatchObservableCallback(e){}}t.NoopMeter=n;class r{}t.NoopMetric=r;class i extends r{add(e,t){}}t.NoopCounterMetric=i;class s extends r{add(e,t){}}t.NoopUpDownCounterMetric=s;class o extends r{record(e,t){}}t.NoopHistogramMetric=o;class a{addCallback(e){}removeCallback(e){}}t.NoopObservableMetric=a;class l extends a{}t.NoopObservableCounterMetric=l;class u extends a{}t.NoopObservableGaugeMetric=u;class c extends a{}function h(){return t.NOOP_METER}t.NoopObservableUpDownCounterMetric=c,t.NOOP_METER=new n,t.NOOP_COUNTER_METRIC=new i,t.NOOP_HISTOGRAM_METRIC=new o,t.NOOP_UP_DOWN_COUNTER_METRIC=new s,t.NOOP_OBSERVABLE_COUNTER_METRIC=new l,t.NOOP_OBSERVABLE_GAUGE_METRIC=new u,t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=new c,t.createNoopMeter=h},660:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NOOP_METER_PROVIDER=t.NoopMeterProvider=void 0;let r=n(102);class i{getMeter(e,t,n){return r.NOOP_METER}}t.NoopMeterProvider=i,t.NOOP_METER_PROVIDER=new i},200:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(46),t)},651:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t._globalThis=void 0,t._globalThis="object"==typeof globalThis?globalThis:global},46:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(651),t)},939:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.propagation=void 0;let r=n(181);t.propagation=r.PropagationAPI.getInstance()},874:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTextMapPropagator=void 0;class n{inject(e,t){}extract(e,t){return e}fields(){return[]}}t.NoopTextMapPropagator=n},194:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultTextMapSetter=t.defaultTextMapGetter=void 0,t.defaultTextMapGetter={get(e,t){if(null!=e)return e[t]},keys:e=>null==e?[]:Object.keys(e)},t.defaultTextMapSetter={set(e,t,n){null!=e&&(e[t]=n)}}},845:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.trace=void 0;let r=n(997);t.trace=r.TraceAPI.getInstance()},403:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NonRecordingSpan=void 0;let r=n(476);class i{constructor(e=r.INVALID_SPAN_CONTEXT){this._spanContext=e}spanContext(){return this._spanContext}setAttribute(e,t){return this}setAttributes(e){return this}addEvent(e,t){return this}setStatus(e){return this}updateName(e){return this}end(e){}isRecording(){return!1}recordException(e,t){}}t.NonRecordingSpan=i},614:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTracer=void 0;let r=n(491),i=n(607),s=n(403),o=n(139),a=r.ContextAPI.getInstance();class l{startSpan(e,t,n=a.active()){if(null==t?void 0:t.root)return new s.NonRecordingSpan;let r=n&&(0,i.getSpanContext)(n);return u(r)&&(0,o.isSpanContextValid)(r)?new s.NonRecordingSpan(r):new s.NonRecordingSpan}startActiveSpan(e,t,n,r){let s,o,l;if(arguments.length<2)return;2==arguments.length?l=t:3==arguments.length?(s=t,l=n):(s=t,o=n,l=r);let u=null!=o?o:a.active(),c=this.startSpan(e,s,u),h=(0,i.setSpan)(u,c);return a.with(h,l,void 0,c)}}function u(e){return"object"==typeof e&&"string"==typeof e.spanId&&"string"==typeof e.traceId&&"number"==typeof e.traceFlags}t.NoopTracer=l},124:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTracerProvider=void 0;let r=n(614);class i{getTracer(e,t,n){return new r.NoopTracer}}t.NoopTracerProvider=i},125:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyTracer=void 0;let r=new(n(614)).NoopTracer;class i{constructor(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}startSpan(e,t,n){return this._getTracer().startSpan(e,t,n)}startActiveSpan(e,t,n,r){let i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)}_getTracer(){if(this._delegate)return this._delegate;let e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):r}}t.ProxyTracer=i},846:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyTracerProvider=void 0;let r=n(125),i=new(n(124)).NoopTracerProvider;class s{getTracer(e,t,n){var i;return null!==(i=this.getDelegateTracer(e,t,n))&&void 0!==i?i:new r.ProxyTracer(this,e,t,n)}getDelegate(){var e;return null!==(e=this._delegate)&&void 0!==e?e:i}setDelegate(e){this._delegate=e}getDelegateTracer(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,n)}}t.ProxyTracerProvider=s},996:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SamplingDecision=void 0,function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(n=t.SamplingDecision||(t.SamplingDecision={}))},607:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSpanContext=t.setSpanContext=t.deleteSpan=t.setSpan=t.getActiveSpan=t.getSpan=void 0;let r=n(780),i=n(403),s=n(491),o=(0,r.createContextKey)("OpenTelemetry Context Key SPAN");function a(e){return e.getValue(o)||void 0}function l(){return a(s.ContextAPI.getInstance().active())}function u(e,t){return e.setValue(o,t)}function c(e){return e.deleteValue(o)}function h(e,t){return u(e,new i.NonRecordingSpan(t))}function d(e){var t;return null===(t=a(e))||void 0===t?void 0:t.spanContext()}t.getSpan=a,t.getActiveSpan=l,t.setSpan=u,t.deleteSpan=c,t.setSpanContext=h,t.getSpanContext=d},325:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceStateImpl=void 0;let r=n(564),i=32,s=512,o=",",a="=";class l{constructor(e){this._internalState=new Map,e&&this._parse(e)}set(e,t){let n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n}unset(e){let t=this._clone();return t._internalState.delete(e),t}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce((e,t)=>(e.push(t+a+this.get(t)),e),[]).join(o)}_parse(e){!(e.length>s)&&(this._internalState=e.split(o).reverse().reduce((e,t)=>{let n=t.trim(),i=n.indexOf(a);if(-1!==i){let s=n.slice(0,i),o=n.slice(i+1,t.length);(0,r.validateKey)(s)&&(0,r.validateValue)(o)&&e.set(s,o)}return e},new Map),this._internalState.size>i&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,i))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){let e=new l;return e._internalState=new Map(this._internalState),e}}t.TraceStateImpl=l},564:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateValue=t.validateKey=void 0;let n="[_0-9a-z-*/]",r=`[a-z]${n}{0,255}`,i=`[a-z0-9]${n}{0,240}@[a-z]${n}{0,13}`,s=RegExp(`^(?:${r}|${i})$`),o=/^[ -~]{0,255}[!-~]$/,a=/,|=/;function l(e){return s.test(e)}function u(e){return o.test(e)&&!a.test(e)}t.validateKey=l,t.validateValue=u},98:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTraceState=void 0;let r=n(325);function i(e){return new r.TraceStateImpl(e)}t.createTraceState=i},476:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.INVALID_SPAN_CONTEXT=t.INVALID_TRACEID=t.INVALID_SPANID=void 0;let r=n(475);t.INVALID_SPANID="0000000000000000",t.INVALID_TRACEID="00000000000000000000000000000000",t.INVALID_SPAN_CONTEXT={traceId:t.INVALID_TRACEID,spanId:t.INVALID_SPANID,traceFlags:r.TraceFlags.NONE}},357:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SpanKind=void 0,function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(n=t.SpanKind||(t.SpanKind={}))},139:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wrapSpanContext=t.isSpanContextValid=t.isValidSpanId=t.isValidTraceId=void 0;let r=n(476),i=n(403),s=/^([0-9a-f]{32})$/i,o=/^[0-9a-f]{16}$/i;function a(e){return s.test(e)&&e!==r.INVALID_TRACEID}function l(e){return o.test(e)&&e!==r.INVALID_SPANID}function u(e){return a(e.traceId)&&l(e.spanId)}function c(e){return new i.NonRecordingSpan(e)}t.isValidTraceId=a,t.isValidSpanId=l,t.isSpanContextValid=u,t.wrapSpanContext=c},847:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SpanStatusCode=void 0,function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(n=t.SpanStatusCode||(t.SpanStatusCode={}))},475:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TraceFlags=void 0,function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(n=t.TraceFlags||(t.TraceFlags={}))},521:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="1.6.0"}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}},o=!0;try{t[e].call(s.exports,s,s.exports,r),o=!1}finally{o&&delete n[e]}return s.exports}r.ab=__dirname+"/";var i={};(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.trace=e.propagation=e.metrics=e.diag=e.context=e.INVALID_SPAN_CONTEXT=e.INVALID_TRACEID=e.INVALID_SPANID=e.isValidSpanId=e.isValidTraceId=e.isSpanContextValid=e.createTraceState=e.TraceFlags=e.SpanStatusCode=e.SpanKind=e.SamplingDecision=e.ProxyTracerProvider=e.ProxyTracer=e.defaultTextMapSetter=e.defaultTextMapGetter=e.ValueType=e.createNoopMeter=e.DiagLogLevel=e.DiagConsoleLogger=e.ROOT_CONTEXT=e.createContextKey=e.baggageEntryMetadataFromString=void 0;var t=r(369);Object.defineProperty(e,"baggageEntryMetadataFromString",{enumerable:!0,get:function(){return t.baggageEntryMetadataFromString}});var n=r(780);Object.defineProperty(e,"createContextKey",{enumerable:!0,get:function(){return n.createContextKey}}),Object.defineProperty(e,"ROOT_CONTEXT",{enumerable:!0,get:function(){return n.ROOT_CONTEXT}});var s=r(972);Object.defineProperty(e,"DiagConsoleLogger",{enumerable:!0,get:function(){return s.DiagConsoleLogger}});var o=r(957);Object.defineProperty(e,"DiagLogLevel",{enumerable:!0,get:function(){return o.DiagLogLevel}});var a=r(102);Object.defineProperty(e,"createNoopMeter",{enumerable:!0,get:function(){return a.createNoopMeter}});var l=r(901);Object.defineProperty(e,"ValueType",{enumerable:!0,get:function(){return l.ValueType}});var u=r(194);Object.defineProperty(e,"defaultTextMapGetter",{enumerable:!0,get:function(){return u.defaultTextMapGetter}}),Object.defineProperty(e,"defaultTextMapSetter",{enumerable:!0,get:function(){return u.defaultTextMapSetter}});var c=r(125);Object.defineProperty(e,"ProxyTracer",{enumerable:!0,get:function(){return c.ProxyTracer}});var h=r(846);Object.defineProperty(e,"ProxyTracerProvider",{enumerable:!0,get:function(){return h.ProxyTracerProvider}});var d=r(996);Object.defineProperty(e,"SamplingDecision",{enumerable:!0,get:function(){return d.SamplingDecision}});var p=r(357);Object.defineProperty(e,"SpanKind",{enumerable:!0,get:function(){return p.SpanKind}});var f=r(847);Object.defineProperty(e,"SpanStatusCode",{enumerable:!0,get:function(){return f.SpanStatusCode}});var g=r(475);Object.defineProperty(e,"TraceFlags",{enumerable:!0,get:function(){return g.TraceFlags}});var m=r(98);Object.defineProperty(e,"createTraceState",{enumerable:!0,get:function(){return m.createTraceState}});var y=r(139);Object.defineProperty(e,"isSpanContextValid",{enumerable:!0,get:function(){return y.isSpanContextValid}}),Object.defineProperty(e,"isValidTraceId",{enumerable:!0,get:function(){return y.isValidTraceId}}),Object.defineProperty(e,"isValidSpanId",{enumerable:!0,get:function(){return y.isValidSpanId}});var v=r(476);Object.defineProperty(e,"INVALID_SPANID",{enumerable:!0,get:function(){return v.INVALID_SPANID}}),Object.defineProperty(e,"INVALID_TRACEID",{enumerable:!0,get:function(){return v.INVALID_TRACEID}}),Object.defineProperty(e,"INVALID_SPAN_CONTEXT",{enumerable:!0,get:function(){return v.INVALID_SPAN_CONTEXT}});let _=r(67);Object.defineProperty(e,"context",{enumerable:!0,get:function(){return _.context}});let b=r(506);Object.defineProperty(e,"diag",{enumerable:!0,get:function(){return b.diag}});let S=r(886);Object.defineProperty(e,"metrics",{enumerable:!0,get:function(){return S.metrics}});let w=r(939);Object.defineProperty(e,"propagation",{enumerable:!0,get:function(){return w.propagation}});let T=r(845);Object.defineProperty(e,"trace",{enumerable:!0,get:function(){return T.trace}}),e.default={context:_.context,diag:b.diag,metrics:S.metrics,propagation:w.propagation,trace:T.trace}})(),e.exports=i})()},10189:(e,t,n)=>{"use strict";var r=n(49634),i={stream:!0};function s(e,t){if(e){var n=e[t[0]];if(e=n[t[2]])n=e.name;else{if(!(e=n["*"]))throw Error('Could not find the module "'+t[0]+'" in the React SSR Manifest. This is probably a bug in the React Server Components bundler.');n=t[2]}return 4===t.length?[e.id,e.chunks,n,1]:[e.id,e.chunks,n]}return t}var o=new Map;function a(e){var t=globalThis.__next_require__(e);return"function"!=typeof t.then||"fulfilled"===t.status?null:(t.then(function(e){t.status="fulfilled",t.value=e},function(e){t.status="rejected",t.reason=e}),t)}function l(){}function u(e){for(var t=e[1],r=[],i=0;i<t.length;){var s=t[i++];t[i++];var u=o.get(s);if(void 0===u){u=n.e(s),r.push(u);var c=o.set.bind(o,s,null);u.then(c,l),o.set(s,u)}else null!==u&&r.push(u)}return 4===e.length?0===r.length?a(e[0]):Promise.all(r).then(function(){return a(e[0])}):0<r.length?Promise.all(r):null}function c(e,t,n){if(null!==e)for(var r=1;r<t.length;r+=2){var i=n,s=h.current;if(s){var o=s.preinitScript,a=e.prefix+t[r],l=e.crossOrigin;l="string"==typeof l?"use-credentials"===l?l:"":void 0,o.call(s,a,{crossOrigin:l,nonce:i})}}}var h=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Dispatcher,d=Symbol.for("react.element"),p=Symbol.for("react.lazy"),f=Symbol.iterator;function g(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}var m=Array.isArray,y=Object.getPrototypeOf,v=Object.prototype,_=new WeakMap;function b(e){return Number.isFinite(e)?0===e&&-1/0==1/e?"$-0":e:1/0===e?"$Infinity":-1/0===e?"$-Infinity":"$NaN"}function S(e,t,n,r){function i(e,l){if(null===l)return null;if("object"==typeof l){if("function"==typeof l.then){null===a&&(a=new FormData),o++;var u=s++;return l.then(function(e){e=JSON.stringify(e,i);var r=a;r.append(t+u,e),0==--o&&n(r)},function(e){r(e)}),"$@"+u.toString(16)}if(m(l))return l;if(l instanceof FormData){null===a&&(a=new FormData);var c=a,h=t+(e=s++)+"_";return l.forEach(function(e,t){c.append(h+t,e)}),"$K"+e.toString(16)}if(l instanceof Map)return l=JSON.stringify(Array.from(l),i),null===a&&(a=new FormData),e=s++,a.append(t+e,l),"$Q"+e.toString(16);if(l instanceof Set)return l=JSON.stringify(Array.from(l),i),null===a&&(a=new FormData),e=s++,a.append(t+e,l),"$W"+e.toString(16);if(g(l))return Array.from(l);if((e=y(l))!==v&&(null===e||null!==y(e)))throw Error("Only plain objects, and a few built-ins, can be passed to Server Actions. Classes or null prototypes are not supported.");return l}if("string"==typeof l)return"Z"===l[l.length-1]&&this[e]instanceof Date?"$D"+l:l="$"===l[0]?"$"+l:l;if("boolean"==typeof l)return l;if("number"==typeof l)return b(l);if(void 0===l)return"$undefined";if("function"==typeof l){if(void 0!==(l=_.get(l)))return l=JSON.stringify(l,i),null===a&&(a=new FormData),e=s++,a.set(t+e,l),"$F"+e.toString(16);throw Error("Client Functions cannot be passed directly to Server Functions. Only Functions passed from the Server can be passed back again.")}if("symbol"==typeof l){if(Symbol.for(e=l.description)!==l)throw Error("Only global symbols received from Symbol.for(...) can be passed to Server Functions. The symbol Symbol.for("+l.description+") cannot be found among global symbols.");return"$S"+e}if("bigint"==typeof l)return"$n"+l.toString(10);throw Error("Type "+typeof l+" is not supported as an argument to a Server Function.")}var s=1,o=0,a=null;e=JSON.stringify(e,i),null===a?n(e):(a.set(t+"0",e),0===o&&n(a))}var w=new WeakMap;function T(e){var t,n,r=new Promise(function(e,r){t=e,n=r});return S(e,"",function(e){if("string"==typeof e){var n=new FormData;n.append("0",e),e=n}r.status="fulfilled",r.value=e,t(e)},function(e){r.status="rejected",r.reason=e,n(e)}),r}function E(e){var t=_.get(this);if(!t)throw Error("Tried to encode a Server Action from a different instance than the encoder is from. This is a bug in React.");var n=null;if(null!==t.bound){if((n=w.get(t))||(n=T(t),w.set(t,n)),"rejected"===n.status)throw n.reason;if("fulfilled"!==n.status)throw n;t=n.value;var r=new FormData;t.forEach(function(t,n){r.append("$ACTION_"+e+":"+n,t)}),n=r,t="$ACTION_REF_"+e}else t="$ACTION_ID_"+t.id;return{name:t,method:"POST",encType:"multipart/form-data",data:n}}function C(e,t){var n=_.get(this);if(!n)throw Error("Tried to encode a Server Action from a different instance than the encoder is from. This is a bug in React.");if(n.id!==e)return!1;var r=n.bound;if(null===r)return 0===t;switch(r.status){case"fulfilled":return r.value.length===t;case"pending":throw r;case"rejected":throw r.reason;default:throw"string"!=typeof r.status&&(r.status="pending",r.then(function(e){r.status="fulfilled",r.value=e},function(e){r.status="rejected",r.reason=e})),r}}function I(e,t,n){Object.defineProperties(e,{$$FORM_ACTION:{value:void 0===n?E:function(){var e=_.get(this);if(!e)throw Error("Tried to encode a Server Action from a different instance than the encoder is from. This is a bug in React.");var t=e.bound;return null===t&&(t=Promise.resolve([])),n(e.id,t)}},$$IS_SIGNATURE_EQUAL:{value:C},bind:{value:O}}),_.set(e,t)}var k=Function.prototype.bind,R=Array.prototype.slice;function O(){var e=k.apply(this,arguments),t=_.get(this);if(t){var n=R.call(arguments,1),r=null;r=null!==t.bound?Promise.resolve(t.bound).then(function(e){return e.concat(n)}):Promise.resolve(n),Object.defineProperties(e,{$$FORM_ACTION:{value:this.$$FORM_ACTION},$$IS_SIGNATURE_EQUAL:{value:C},bind:{value:O}}),_.set(e,{id:t.id,bound:r})}return e}function N(e,t,n){function r(){var n=Array.prototype.slice.call(arguments);return t(e,n)}return I(r,{id:e,bound:null},n),r}function A(e,t,n,r){this.status=e,this.value=t,this.reason=n,this._response=r}function x(e){switch(e.status){case"resolved_model":j(e);break;case"resolved_module":U(e)}switch(e.status){case"fulfilled":return e.value;case"pending":case"blocked":case"cyclic":throw e;default:throw e.reason}}function D(e,t){for(var n=0;n<e.length;n++)(0,e[n])(t)}function P(e,t,n){switch(e.status){case"fulfilled":D(t,e.value);break;case"pending":case"blocked":case"cyclic":e.value=t,e.reason=n;break;case"rejected":n&&D(n,e.reason)}}function M(e,t){if("pending"===e.status||"blocked"===e.status){var n=e.reason;e.status="rejected",e.reason=t,null!==n&&D(n,t)}}function L(e,t){if("pending"===e.status||"blocked"===e.status){var n=e.value,r=e.reason;e.status="resolved_module",e.value=t,null!==n&&(U(e),P(e,n,r))}}A.prototype=Object.create(Promise.prototype),A.prototype.then=function(e,t){switch(this.status){case"resolved_model":j(this);break;case"resolved_module":U(this)}switch(this.status){case"fulfilled":e(this.value);break;case"pending":case"blocked":case"cyclic":e&&(null===this.value&&(this.value=[]),this.value.push(e)),t&&(null===this.reason&&(this.reason=[]),this.reason.push(t));break;default:t(this.reason)}};var F=null,B=null;function j(e){var t=F,n=B;F=e,B=null;var r=e.value;e.status="cyclic",e.value=null,e.reason=null;try{var i=JSON.parse(r,e._response._fromJSON);if(null!==B&&0<B.deps)B.value=i,e.status="blocked",e.value=null,e.reason=null;else{var s=e.value;e.status="fulfilled",e.value=i,null!==s&&D(s,i)}}catch(t){e.status="rejected",e.reason=t}finally{F=t,B=n}}function U(e){try{var t=e.value,n=globalThis.__next_require__(t[0]);if(4===t.length&&"function"==typeof n.then){if("fulfilled"===n.status)n=n.value;else throw n.reason}var r="*"===t[2]?n:""===t[2]?n.__esModule?n.default:n:n[t[2]];e.status="fulfilled",e.value=r}catch(t){e.status="rejected",e.reason=t}}function q(e,t){e._chunks.forEach(function(e){"pending"===e.status&&M(e,t)})}function V(e,t){var n=e._chunks,r=n.get(t);return r||(r=new A("pending",null,null,e),n.set(t,r)),r}function z(e,t,n,r){if(B){var i=B;r||i.deps++}else i=B={deps:r?0:1,value:null};return function(r){t[n]=r,i.deps--,0===i.deps&&"blocked"===e.status&&(r=e.value,e.status="fulfilled",e.value=i.value,null!==r&&D(r,i.value))}}function W(e){return function(t){return M(e,t)}}function $(e,t){function n(){var e=Array.prototype.slice.call(arguments),n=t.bound;return n?"fulfilled"===n.status?r(t.id,n.value.concat(e)):Promise.resolve(n).then(function(n){return r(t.id,n.concat(e))}):r(t.id,e)}var r=e._callServer;return I(n,t,e._encodeFormAction),n}function G(e,t){if("resolved_model"===(e=V(e,t)).status&&j(e),"fulfilled"===e.status)return e.value;throw e.reason}function H(e,t,n,r){if("$"===r[0]){if("$"===r)return d;switch(r[1]){case"$":return r.slice(1);case"L":return{$$typeof:p,_payload:e=V(e,t=parseInt(r.slice(2),16)),_init:x};case"@":if(2===r.length)return new Promise(function(){});return V(e,t=parseInt(r.slice(2),16));case"S":return Symbol.for(r.slice(2));case"F":return t=G(e,t=parseInt(r.slice(2),16)),$(e,t);case"Q":return new Map(e=G(e,t=parseInt(r.slice(2),16)));case"W":return new Set(e=G(e,t=parseInt(r.slice(2),16)));case"I":return 1/0;case"-":return"$-0"===r?-0:-1/0;case"N":return NaN;case"u":return;case"D":return new Date(Date.parse(r.slice(2)));case"n":return BigInt(r.slice(2));default:switch((e=V(e,r=parseInt(r.slice(1),16))).status){case"resolved_model":j(e);break;case"resolved_module":U(e)}switch(e.status){case"fulfilled":return e.value;case"pending":case"blocked":case"cyclic":return r=F,e.then(z(r,t,n,"cyclic"===e.status),W(r)),null;default:throw e.reason}}}return r}function K(){throw Error('Trying to call a function from "use server" but the callServer option was not implemented in your router runtime.')}function Q(e,t,n){var r=e._chunks,i=r.get(t);n=JSON.parse(n,e._fromJSON);var o=s(e._bundlerConfig,n);if(c(e._moduleLoading,n[1],e._nonce),n=u(o)){if(i){var a=i;a.status="blocked"}else a=new A("blocked",null,null,e),r.set(t,a);n.then(function(){return L(a,o)},function(e){return M(a,e)})}else i?L(i,o):r.set(t,new A("resolved_module",o,null,e))}function Y(e){return function(t,n){return"string"==typeof n?H(e,this,t,n):"object"==typeof n&&null!==n?t=n[0]===d?{$$typeof:d,type:n[1],key:n[2],ref:null,props:n[3],_owner:null}:n:n}}function J(){throw Error("Server Functions cannot be called during initial render. This would create a fetch waterfall. Try to use a Server Component to pass data to Client Components instead.")}function X(e){var t=e.ssrManifest.moduleMap;return(t={_bundlerConfig:t,_moduleLoading:e.ssrManifest.moduleLoading,_callServer:void 0!==J?J:K,_encodeFormAction:e.encodeFormAction,_nonce:e="string"==typeof e.nonce?e.nonce:void 0,_chunks:new Map,_stringDecoder:new TextDecoder,_fromJSON:null,_rowState:0,_rowID:0,_rowTag:0,_rowLength:0,_buffer:[]})._fromJSON=Y(t),t}function Z(e,t){function n(t){var o=t.value;if(t.done)q(e,Error("Connection closed."));else{var a=0,l=e._rowState,u=e._rowID,c=e._rowTag,d=e._rowLength;t=e._buffer;for(var p=o.length;a<p;){var f=-1;switch(l){case 0:58===(f=o[a++])?l=1:u=u<<4|(96<f?f-87:f-48);continue;case 1:84===(l=o[a])?(c=l,l=2,a++):64<l&&91>l?(c=l,l=3,a++):(c=0,l=3);continue;case 2:44===(f=o[a++])?l=4:d=d<<4|(96<f?f-87:f-48);continue;case 3:f=o.indexOf(10,a);break;case 4:(f=a+d)>o.length&&(f=-1)}var g=o.byteOffset+a;if(-1<f){a=new Uint8Array(o.buffer,g,f-a),d=e,g=c;var m=d._stringDecoder;c="";for(var y=0;y<t.length;y++)c+=m.decode(t[y],i);switch(c+=m.decode(a),g){case 73:Q(d,u,c);break;case 72:if(u=c[0],d=JSON.parse(c=c.slice(1),d._fromJSON),c=h.current)switch(u){case"D":c.prefetchDNS(d);break;case"C":"string"==typeof d?c.preconnect(d):c.preconnect(d[0],d[1]);break;case"L":u=d[0],a=d[1],3===d.length?c.preload(u,a,d[2]):c.preload(u,a);break;case"m":"string"==typeof d?c.preloadModule(d):c.preloadModule(d[0],d[1]);break;case"S":"string"==typeof d?c.preinitStyle(d):c.preinitStyle(d[0],0===d[1]?void 0:d[1],3===d.length?d[2]:void 0);break;case"X":"string"==typeof d?c.preinitScript(d):c.preinitScript(d[0],d[1]);break;case"M":"string"==typeof d?c.preinitModuleScript(d):c.preinitModuleScript(d[0],d[1])}break;case 69:a=(c=JSON.parse(c)).digest,(c=Error("An error occurred in the Server Components render. The specific message is omitted in production builds to avoid leaking sensitive details. A digest property is included on this error instance which may provide additional details about the nature of the error.")).stack="Error: "+c.message,c.digest=a,(g=(a=d._chunks).get(u))?M(g,c):a.set(u,new A("rejected",null,c,d));break;case 84:d._chunks.set(u,new A("fulfilled",c,null,d));break;case 68:case 87:throw Error("Failed to read a RSC payload created by a development version of React on the server while using a production version on the client. Always use matching versions on the server and the client.");default:(g=(a=d._chunks).get(u))?(d=g,u=c,"pending"===d.status&&(c=d.value,a=d.reason,d.status="resolved_model",d.value=u,null!==c&&(j(d),P(d,c,a)))):a.set(u,new A("resolved_model",c,null,d))}a=f,3===l&&a++,d=u=c=l=0,t.length=0}else{o=new Uint8Array(o.buffer,g,o.byteLength-a),t.push(o),d-=o.byteLength;break}}return e._rowState=l,e._rowID=u,e._rowTag=c,e._rowLength=d,s.read().then(n).catch(r)}}function r(t){q(e,t)}var s=t.getReader();s.read().then(n).catch(r)}t.createFromFetch=function(e,t){var n=X(t);return e.then(function(e){Z(n,e.body)},function(e){q(n,e)}),V(n,0)},t.createFromReadableStream=function(e,t){return Z(t=X(t),e),V(t,0)},t.createServerReference=function(e){return N(e,J)},t.encodeReply=function(e){return new Promise(function(t,n){S(e,"",t,n)})}},85668:(e,t,n)=>{"use strict";e.exports=n(10189)},83204:()=>{},808:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DetachedPromise",{enumerable:!0,get:function(){return n}});class n{constructor(){let e,t;this.promise=new Promise((n,r)=>{e=n,t=r}),this.resolve=e,this.reject=t}}},89061:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{atLeastOneTask:function(){return i},scheduleImmediate:function(){return r},scheduleOnNextTick:function(){return n}});let n=e=>{Promise.resolve().then(()=>{process.nextTick(e)})},r=e=>{setImmediate(e)};function i(){return new Promise(e=>r(e))}},35720:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{getPathname:function(){return i},isFullStringUrl:function(){return s},parseUrl:function(){return o}});let n="http://n";function r(e){return new URL(e,n)}function i(e){return r(e).pathname}function s(e){return/https?:\/\//.test(e)}function o(e){let t;try{t=new URL(e,n)}catch{}return t}},89565:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{Postpone:function(){return d},createPostponedAbortSignal:function(){return v},createPrerenderState:function(){return u},formatDynamicAPIAccesses:function(){return m},markCurrentScopeAsDynamic:function(){return c},trackDynamicDataAccessed:function(){return h},trackDynamicFetch:function(){return p},usedDynamicAPIs:function(){return g}});let r=a(n(49739)),i=n(61946),s=n(27389),o=n(35720);function a(e){return e&&e.__esModule?e:{default:e}}let l="function"==typeof r.default.unstable_postpone;function u(e){return{isDebugSkeleton:e,dynamicAccesses:[]}}function c(e,t){let n=(0,o.getPathname)(e.urlPathname);if(!e.isUnstableCacheCallback){if(e.dynamicShouldError)throw new s.StaticGenBailoutError(`Route ${n} with \`dynamic = "error"\` couldn't be rendered statically because it used \`${t}\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`);if(e.prerenderState)f(e.prerenderState,t,n);else if(e.revalidate=0,e.isStaticGeneration){let r=new i.DynamicServerError(`Route ${n} couldn't be rendered statically because it used ${t}. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`);throw e.dynamicUsageDescription=t,e.dynamicUsageStack=r.stack,r}}}function h(e,t){let n=(0,o.getPathname)(e.urlPathname);if(e.isUnstableCacheCallback)throw Error(`Route ${n} used "${t}" inside a function cached with "unstable_cache(...)". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "${t}" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`);if(e.dynamicShouldError)throw new s.StaticGenBailoutError(`Route ${n} with \`dynamic = "error"\` couldn't be rendered statically because it used \`${t}\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`);if(e.prerenderState)f(e.prerenderState,t,n);else if(e.revalidate=0,e.isStaticGeneration){let r=new i.DynamicServerError(`Route ${n} couldn't be rendered statically because it used \`${t}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`);throw e.dynamicUsageDescription=t,e.dynamicUsageStack=r.stack,r}}function d({reason:e,prerenderState:t,pathname:n}){f(t,e,n)}function p(e,t){e.prerenderState&&f(e.prerenderState,t,e.urlPathname)}function f(e,t,n){y();let i=`Route ${n} needs to bail out of prerendering at this point because it used ${t}. React throws this special object to indicate where. It should not be caught by your own try/catch. Learn more: https://nextjs.org/docs/messages/ppr-caught-error`;e.dynamicAccesses.push({stack:e.isDebugSkeleton?Error().stack:void 0,expression:t}),r.default.unstable_postpone(i)}function g(e){return e.dynamicAccesses.length>0}function m(e){return e.dynamicAccesses.filter(e=>"string"==typeof e.stack&&e.stack.length>0).map(({expression:e,stack:t})=>(t=t.split("\n").slice(4).filter(e=>!(e.includes("node_modules/next/")||e.includes(" (<anonymous>)")||e.includes(" (node:"))).join("\n"),`Dynamic API Usage Debug - ${e}:
${t}`))}function y(){if(!l)throw Error("Invariant: React.unstable_postpone is not defined. This suggests the wrong version of React was loaded. This is a bug in Next.js")}function v(e){y();let t=new AbortController;try{r.default.unstable_postpone(e)}catch(e){t.abort(e)}return t.signal}},49597:(e,t)=>{"use strict";let n,r;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{arrayBufferToString:function(){return s},decrypt:function(){return l},encrypt:function(){return a},generateEncryptionKeyBase64:function(){return u},getActionEncryptionKey:function(){return f},getClientReferenceManifestSingleton:function(){return p},getServerModuleMap:function(){return d},setReferenceManifestsSingleton:function(){return h},stringToUint8Array:function(){return o}});let i=null;function s(e){let t=new Uint8Array(e),n=t.byteLength;if(n<65535)return String.fromCharCode.apply(null,t);let r="";for(let e=0;e<n;e++)r+=String.fromCharCode(t[e]);return r}function o(e){let t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n}function a(e,t,n){return crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,n)}function l(e,t,n){return crypto.subtle.decrypt({name:"AES-GCM",iv:t},e,n)}async function u(e){if(e&&void 0!==r)return r;i||(i=new Promise(async(e,t)=>{try{let t=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),n=await crypto.subtle.exportKey("raw",t),r=btoa(s(n));e([t,r])}catch(e){t(e)}}));let[t,o]=await i;return n=t,e&&(r=o),o}let c=Symbol.for("next.server.action-manifests");function h({clientReferenceManifest:e,serverActionsManifest:t,serverModuleMap:n}){globalThis[c]={clientReferenceManifest:e,serverActionsManifest:t,serverModuleMap:n}}function d(){let e=globalThis[c];if(!e)throw Error("Missing manifest for Server Actions. This is a bug in Next.js");return e.serverModuleMap}function p(){let e=globalThis[c];if(!e)throw Error("Missing manifest for Server Actions. This is a bug in Next.js");return e.clientReferenceManifest}async function f(){if(n)return n;let e=globalThis[c];if(!e)throw Error("Missing manifest for Server Actions. This is a bug in Next.js");let t=process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY||e.serverActionsManifest.encryptionKey;if(void 0===t)throw Error("Missing encryption key for Server Actions");return n=await crypto.subtle.importKey("raw",o(atob(t)),"AES-GCM",!0,["encrypt","decrypt"])}},26461:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{decryptActionBoundArgs:function(){return d},encryptActionBoundArgs:function(){return h}}),n(83204);let r=n(96012),i=n(85668),s=n(43598),o=n(49597),a=new TextEncoder,l=new TextDecoder;async function u(e,t){let n=await (0,o.getActionEncryptionKey)();if(void 0===n)throw Error("Missing encryption key for Server Action. This is a bug in Next.js");let r=atob(t),i=r.slice(0,16),s=r.slice(16),a=l.decode(await (0,o.decrypt)(n,(0,o.stringToUint8Array)(i),(0,o.stringToUint8Array)(s)));if(!a.startsWith(e))throw Error("Invalid Server Action payload: failed to decrypt.");return a.slice(e.length)}async function c(e,t){let n=await (0,o.getActionEncryptionKey)();if(void 0===n)throw Error("Missing encryption key for Server Action. This is a bug in Next.js");let r=new Uint8Array(16);crypto.getRandomValues(r);let i=(0,o.arrayBufferToString)(r.buffer),s=await (0,o.encrypt)(n,r,a.encode(e+t));return btoa(i+(0,o.arrayBufferToString)(s))}async function h(e,t){let n=(0,o.getClientReferenceManifestSingleton)(),i=await (0,s.streamToString)((0,r.renderToReadableStream)(t,n.clientModules));return await c(e,i)}async function d(e,t){let n=await u(e,await t),s=await (0,i.createFromReadableStream)(new ReadableStream({start(e){e.enqueue(a.encode(n)),e.close()}}),{ssrManifest:{moduleLoading:{},moduleMap:{}}}),l=(0,o.getServerModuleMap)();return await (0,r.decodeReply)(await (0,i.encodeReply)(s),l)}},49634:(e,t,n)=>{"use strict";e.exports=n(23191).vendored["react-rsc"].ReactDOM},96012:(e,t,n)=>{"use strict";e.exports=n(23191).vendored["react-rsc"].ReactServerDOMWebpackServerEdge},49739:(e,t,n)=>{"use strict";e.exports=n(23191).vendored["react-rsc"].React},98467:(e,t)=>{"use strict";var n,r,i,s,o,a,l,u,c,h,d,p;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{AppRenderSpan:function(){return l},AppRouteRouteHandlersSpan:function(){return h},BaseServerSpan:function(){return n},LoadComponentsSpan:function(){return r},LogSpanAllowList:function(){return g},MiddlewareSpan:function(){return p},NextNodeServerSpan:function(){return s},NextServerSpan:function(){return i},NextVanillaSpanAllowlist:function(){return f},NodeSpan:function(){return c},RenderSpan:function(){return a},ResolveMetadataSpan:function(){return d},RouterSpan:function(){return u},StartServerSpan:function(){return o}}),function(e){e.handleRequest="BaseServer.handleRequest",e.run="BaseServer.run",e.pipe="BaseServer.pipe",e.getStaticHTML="BaseServer.getStaticHTML",e.render="BaseServer.render",e.renderToResponseWithComponents="BaseServer.renderToResponseWithComponents",e.renderToResponse="BaseServer.renderToResponse",e.renderToHTML="BaseServer.renderToHTML",e.renderError="BaseServer.renderError",e.renderErrorToResponse="BaseServer.renderErrorToResponse",e.renderErrorToHTML="BaseServer.renderErrorToHTML",e.render404="BaseServer.render404"}(n||(n={})),function(e){e.loadDefaultErrorComponents="LoadComponents.loadDefaultErrorComponents",e.loadComponents="LoadComponents.loadComponents"}(r||(r={})),function(e){e.getRequestHandler="NextServer.getRequestHandler",e.getServer="NextServer.getServer",e.getServerRequestHandler="NextServer.getServerRequestHandler",e.createServer="createServer.createServer"}(i||(i={})),function(e){e.compression="NextNodeServer.compression",e.getBuildId="NextNodeServer.getBuildId",e.createComponentTree="NextNodeServer.createComponentTree",e.clientComponentLoading="NextNodeServer.clientComponentLoading",e.getLayoutOrPageModule="NextNodeServer.getLayoutOrPageModule",e.generateStaticRoutes="NextNodeServer.generateStaticRoutes",e.generateFsStaticRoutes="NextNodeServer.generateFsStaticRoutes",e.generatePublicRoutes="NextNodeServer.generatePublicRoutes",e.generateImageRoutes="NextNodeServer.generateImageRoutes.route",e.sendRenderResult="NextNodeServer.sendRenderResult",e.proxyRequest="NextNodeServer.proxyRequest",e.runApi="NextNodeServer.runApi",e.render="NextNodeServer.render",e.renderHTML="NextNodeServer.renderHTML",e.imageOptimizer="NextNodeServer.imageOptimizer",e.getPagePath="NextNodeServer.getPagePath",e.getRoutesManifest="NextNodeServer.getRoutesManifest",e.findPageComponents="NextNodeServer.findPageComponents",e.getFontManifest="NextNodeServer.getFontManifest",e.getServerComponentManifest="NextNodeServer.getServerComponentManifest",e.getRequestHandler="NextNodeServer.getRequestHandler",e.renderToHTML="NextNodeServer.renderToHTML",e.renderError="NextNodeServer.renderError",e.renderErrorToHTML="NextNodeServer.renderErrorToHTML",e.render404="NextNodeServer.render404",e.startResponse="NextNodeServer.startResponse",e.route="route",e.onProxyReq="onProxyReq",e.apiResolver="apiResolver",e.internalFetch="internalFetch"}(s||(s={})),function(e){e.startServer="startServer.startServer"}(o||(o={})),function(e){e.getServerSideProps="Render.getServerSideProps",e.getStaticProps="Render.getStaticProps",e.renderToString="Render.renderToString",e.renderDocument="Render.renderDocument",e.createBodyResult="Render.createBodyResult"}(a||(a={})),function(e){e.renderToString="AppRender.renderToString",e.renderToReadableStream="AppRender.renderToReadableStream",e.getBodyResult="AppRender.getBodyResult",e.fetch="AppRender.fetch"}(l||(l={})),function(e){e.executeRoute="Router.executeRoute"}(u||(u={})),function(e){e.runHandler="Node.runHandler"}(c||(c={})),function(e){e.runHandler="AppRouteRouteHandlers.runHandler"}(h||(h={})),function(e){e.generateMetadata="ResolveMetadata.generateMetadata",e.generateViewport="ResolveMetadata.generateViewport"}(d||(d={})),function(e){e.execute="Middleware.execute"}(p||(p={}));let f=["Middleware.execute","BaseServer.handleRequest","Render.getServerSideProps","Render.getStaticProps","AppRender.fetch","AppRender.getBodyResult","Render.renderDocument","Node.runHandler","AppRouteRouteHandlers.runHandler","ResolveMetadata.generateMetadata","ResolveMetadata.generateViewport","NextNodeServer.createComponentTree","NextNodeServer.findPageComponents","NextNodeServer.getLayoutOrPageModule","NextNodeServer.startResponse","NextNodeServer.clientComponentLoading"],g=["NextNodeServer.findPageComponents","NextNodeServer.createComponentTree","NextNodeServer.clientComponentLoading"]},82755:(e,t,n)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{SpanKind:function(){return u},SpanStatusCode:function(){return l},getTracer:function(){return v}});let i=n(98467);try{r=n(98601)}catch(e){r=n(98601)}let{context:s,propagation:o,trace:a,SpanStatusCode:l,SpanKind:u,ROOT_CONTEXT:c}=r,h=e=>null!==e&&"object"==typeof e&&"function"==typeof e.then,d=(e,t)=>{(null==t?void 0:t.bubble)===!0?e.setAttribute("next.bubble",!0):(t&&e.recordException(t),e.setStatus({code:l.ERROR,message:null==t?void 0:t.message})),e.end()},p=new Map,f=r.createContextKey("next.rootSpanId"),g=0,m=()=>g++;class y{getTracerInstance(){return a.getTracer("next.js","0.0.1")}getContext(){return s}getActiveScopeSpan(){return a.getSpan(null==s?void 0:s.active())}withPropagatedContext(e,t,n){let r=s.active();if(a.getSpanContext(r))return t();let i=o.extract(r,e,n);return s.with(i,t)}trace(...e){var t;let[n,r,o]=e,{fn:l,options:u}="function"==typeof r?{fn:r,options:{}}:{fn:o,options:{...r}},g=u.spanName??n;if(!i.NextVanillaSpanAllowlist.includes(n)&&"1"!==process.env.NEXT_OTEL_VERBOSE||u.hideSpan)return l();let y=this.getSpanContext((null==u?void 0:u.parentSpan)??this.getActiveScopeSpan()),v=!1;y?(null==(t=a.getSpanContext(y))?void 0:t.isRemote)&&(v=!0):(y=(null==s?void 0:s.active())??c,v=!0);let _=m();return u.attributes={"next.span_name":g,"next.span_type":n,...u.attributes},s.with(y.setValue(f,_),()=>this.getTracerInstance().startActiveSpan(g,u,e=>{let t="performance"in globalThis?globalThis.performance.now():void 0,r=()=>{p.delete(_),t&&process.env.NEXT_OTEL_PERFORMANCE_PREFIX&&i.LogSpanAllowList.includes(n||"")&&performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-${(n.split(".").pop()||"").replace(/[A-Z]/g,e=>"-"+e.toLowerCase())}`,{start:t,end:performance.now()})};v&&p.set(_,new Map(Object.entries(u.attributes??{})));try{if(l.length>1)return l(e,t=>d(e,t));let t=l(e);if(h(t))return t.then(t=>(e.end(),t)).catch(t=>{throw d(e,t),t}).finally(r);return e.end(),r(),t}catch(t){throw d(e,t),r(),t}}))}wrap(...e){let t=this,[n,r,o]=3===e.length?e:[e[0],{},e[1]];return i.NextVanillaSpanAllowlist.includes(n)||"1"===process.env.NEXT_OTEL_VERBOSE?function(){let e=r;"function"==typeof e&&"function"==typeof o&&(e=e.apply(this,arguments));let i=arguments.length-1,a=arguments[i];if("function"!=typeof a)return t.trace(n,e,()=>o.apply(this,arguments));{let r=t.getContext().bind(s.active(),a);return t.trace(n,e,(e,t)=>(arguments[i]=function(e){return null==t||t(e),r.apply(this,arguments)},o.apply(this,arguments)))}}:o}startSpan(...e){let[t,n]=e,r=this.getSpanContext((null==n?void 0:n.parentSpan)??this.getActiveScopeSpan());return this.getTracerInstance().startSpan(t,n,r)}getSpanContext(e){return e?a.setSpan(s.active(),e):void 0}getRootSpanAttributes(){let e=s.active().getValue(f);return p.get(e)}}let v=(()=>{let e=new y;return()=>e})()},42860:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ENCODED_TAGS",{enumerable:!0,get:function(){return n}});let n={OPENING:{HTML:new Uint8Array([60,104,116,109,108]),BODY:new Uint8Array([60,98,111,100,121])},CLOSED:{HEAD:new Uint8Array([60,47,104,101,97,100,62]),BODY:new Uint8Array([60,47,98,111,100,121,62]),HTML:new Uint8Array([60,47,104,116,109,108,62]),BODY_AND_HTML:new Uint8Array([60,47,98,111,100,121,62,60,47,104,116,109,108,62])}}},43598:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{chainStreams:function(){return h},continueDynamicDataResume:function(){return R},continueDynamicHTMLResume:function(){return k},continueDynamicPrerender:function(){return C},continueFizzStream:function(){return E},continueStaticPrerender:function(){return I},createBufferedTransformStream:function(){return f},createRootLayoutValidatorStream:function(){return w},renderToInitialFizzStream:function(){return m},streamFromString:function(){return d},streamToString:function(){return p}});let r=n(82755),i=n(98467),s=n(808),o=n(89061),a=n(42860),l=n(44192);function u(){}let c=new TextEncoder;function h(...e){if(0===e.length)throw Error("Invariant: chainStreams requires at least one stream");if(1===e.length)return e[0];let{readable:t,writable:n}=new TransformStream,r=e[0].pipeTo(n,{preventClose:!0}),i=1;for(;i<e.length-1;i++){let t=e[i];r=r.then(()=>t.pipeTo(n,{preventClose:!0}))}let s=e[i];return(r=r.then(()=>s.pipeTo(n))).catch(u),t}function d(e){return new ReadableStream({start(t){t.enqueue(c.encode(e)),t.close()}})}async function p(e){let t=new TextDecoder("utf-8",{fatal:!0}),n="";for await(let r of e)n+=t.decode(r,{stream:!0});return n+t.decode()}function f(){let e,t=[],n=0,r=r=>{if(e)return;let i=new s.DetachedPromise;e=i,(0,o.scheduleImmediate)(()=>{try{let e=new Uint8Array(n),i=0;for(let n=0;n<t.length;n++){let r=t[n];e.set(r,i),i+=r.byteLength}t.length=0,n=0,r.enqueue(e)}catch{}finally{e=void 0,i.resolve()}})};return new TransformStream({transform(e,i){t.push(e),n+=e.byteLength,r(i)},flush(){if(e)return e.promise}})}function g(e){return new TransformStream({transform:async(t,n)=>{let r=await e();r&&n.enqueue(c.encode(r)),n.enqueue(t)}})}function m({ReactDOMServer:e,element:t,streamOptions:n}){return(0,r.getTracer)().trace(i.AppRenderSpan.renderToReadableStream,async()=>e.renderToReadableStream(t,n))}function y(e){let t=!1,n=!1,r=!1;return new TransformStream({async transform(i,s){if(r=!0,n){s.enqueue(i);return}let u=await e();if(t){if(u){let e=c.encode(u);s.enqueue(e)}s.enqueue(i),n=!0}else{let e=(0,l.indexOfUint8Array)(i,a.ENCODED_TAGS.CLOSED.HEAD);if(-1!==e){if(u){let t=c.encode(u),n=new Uint8Array(i.length+t.length);n.set(i.slice(0,e)),n.set(t,e),n.set(i.slice(e),e+t.length),s.enqueue(n)}else s.enqueue(i);n=!0,t=!0}}t?(0,o.scheduleImmediate)(()=>{n=!1}):s.enqueue(i)},async flush(t){if(r){let n=await e();n&&t.enqueue(c.encode(n))}}})}function v(e){let t,n=!1,r=n=>{let r=new s.DetachedPromise;t=r,(0,o.scheduleImmediate)(()=>{try{n.enqueue(c.encode(e))}catch{}finally{t=void 0,r.resolve()}})};return new TransformStream({transform(e,t){t.enqueue(e),n||(n=!0,r(t))},flush(r){if(t)return t.promise;n||r.enqueue(c.encode(e))}})}function _(e){let t=null,n=!1;async function r(r){if(t)return;let i=e.getReader();await (0,o.atLeastOneTask)();try{for(;;){let{done:e,value:t}=await i.read();if(e){n=!0;return}r.enqueue(t)}}catch(e){r.error(e)}}return new TransformStream({transform(e,n){n.enqueue(e),t||(t=r(n))},flush(e){if(!n)return t||r(e)}})}function b(e){let t=!1,n=c.encode(e);return new TransformStream({transform(r,i){if(t)return i.enqueue(r);let s=(0,l.indexOfUint8Array)(r,n);if(s>-1){if(t=!0,r.length===e.length)return;let n=r.slice(0,s);if(i.enqueue(n),r.length>e.length+s){let t=r.slice(s+e.length);i.enqueue(t)}}else i.enqueue(r)},flush(e){e.enqueue(n)}})}function S(){return new TransformStream({transform(e,t){(0,l.isEquivalentUint8Arrays)(e,a.ENCODED_TAGS.CLOSED.BODY_AND_HTML)||(0,l.isEquivalentUint8Arrays)(e,a.ENCODED_TAGS.CLOSED.BODY)||(0,l.isEquivalentUint8Arrays)(e,a.ENCODED_TAGS.CLOSED.HTML)||(e=(0,l.removeFromUint8Array)(e,a.ENCODED_TAGS.CLOSED.BODY),e=(0,l.removeFromUint8Array)(e,a.ENCODED_TAGS.CLOSED.HTML),t.enqueue(e))}})}function w(){let e=!1,t=!1;return new TransformStream({async transform(n,r){!e&&(0,l.indexOfUint8Array)(n,a.ENCODED_TAGS.OPENING.HTML)>-1&&(e=!0),!t&&(0,l.indexOfUint8Array)(n,a.ENCODED_TAGS.OPENING.BODY)>-1&&(t=!0),r.enqueue(n)},flush(n){let r=[];e||r.push("html"),t||r.push("body"),r.length&&n.enqueue(c.encode(`<script>self.__next_root_layout_missing_tags=${JSON.stringify(r)}</script>`))}})}function T(e,t){let n=e;for(let e of t)e&&(n=n.pipeThrough(e));return n}async function E(e,{suffix:t,inlinedDataStream:n,isStaticGeneration:r,getServerInsertedHTML:i,serverInsertedHTMLToHead:s,validateRootLayout:o}){let a="</body></html>",l=t?t.split(a,1)[0]:null;return r&&"allReady"in e&&await e.allReady,T(e,[f(),i&&!s?g(i):null,null!=l&&l.length>0?v(l):null,n?_(n):null,o?w():null,b(a),i&&s?y(i):null])}async function C(e,{getServerInsertedHTML:t}){return e.pipeThrough(f()).pipeThrough(S()).pipeThrough(y(t))}async function I(e,{inlinedDataStream:t,getServerInsertedHTML:n}){let r="</body></html>";return e.pipeThrough(f()).pipeThrough(y(n)).pipeThrough(_(t)).pipeThrough(b(r))}async function k(e,{inlinedDataStream:t,getServerInsertedHTML:n}){let r="</body></html>";return e.pipeThrough(f()).pipeThrough(y(n)).pipeThrough(_(t)).pipeThrough(b(r))}async function R(e,{inlinedDataStream:t}){let n="</body></html>";return e.pipeThrough(_(t)).pipeThrough(b(n))}},44192:(e,t)=>{"use strict";function n(e,t){if(0===t.length)return 0;if(0===e.length||t.length>e.length)return -1;for(let n=0;n<=e.length-t.length;n++){let r=!0;for(let i=0;i<t.length;i++)if(e[n+i]!==t[i]){r=!1;break}if(r)return n}return -1}function r(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function i(e,t){let r=n(e,t);if(0===r)return e.subarray(t.length);if(!(r>-1))return e;{let n=new Uint8Array(e.length-t.length);return n.set(e.slice(0,r)),n.set(e.slice(r+t.length),r),n}}Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{indexOfUint8Array:function(){return n},isEquivalentUint8Arrays:function(){return r},removeFromUint8Array:function(){return i}})},99042:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{HeadersAdapter:function(){return s},ReadonlyHeadersError:function(){return i}});let r=n(87901);class i extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new i}}class s extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,n,i){if("symbol"==typeof n)return r.ReflectAdapter.get(t,n,i);let s=n.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===s);if(void 0!==o)return r.ReflectAdapter.get(t,o,i)},set(t,n,i,s){if("symbol"==typeof n)return r.ReflectAdapter.set(t,n,i,s);let o=n.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===o);return r.ReflectAdapter.set(t,a??n,i,s)},has(t,n){if("symbol"==typeof n)return r.ReflectAdapter.has(t,n);let i=n.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===i);return void 0!==s&&r.ReflectAdapter.has(t,s)},deleteProperty(t,n){if("symbol"==typeof n)return r.ReflectAdapter.deleteProperty(t,n);let i=n.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===i);return void 0===s||r.ReflectAdapter.deleteProperty(t,s)}})}static seal(e){return new Proxy(e,{get(e,t,n){switch(t){case"append":case"delete":case"set":return i.callable;default:return r.ReflectAdapter.get(e,t,n)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new s(e)}append(e,t){let n=this.headers[e];"string"==typeof n?this.headers[e]=[n,t]:Array.isArray(n)?n.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[n,r]of this.entries())e.call(t,r,n,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),n=this.get(t);yield[t,n]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},87901:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return n}});class n{static get(e,t,n){let r=Reflect.get(e,t,n);return"function"==typeof r?r.bind(e):r}static set(e,t,n,r){return Reflect.set(e,t,n,r)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},98450:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{MutableRequestCookiesAdapter:function(){return h},ReadonlyRequestCookiesError:function(){return o},RequestCookiesAdapter:function(){return a},appendMutableCookies:function(){return c},getModifiedCookieValues:function(){return u}});let r=n(4465),i=n(87901),s=n(45869);class o extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new o}}class a{static seal(e){return new Proxy(e,{get(e,t,n){switch(t){case"clear":case"delete":case"set":return o.callable;default:return i.ReflectAdapter.get(e,t,n)}}})}}let l=Symbol.for("next.mutated.cookies");function u(e){let t=e[l];return t&&Array.isArray(t)&&0!==t.length?t:[]}function c(e,t){let n=u(t);if(0===n.length)return!1;let i=new r.ResponseCookies(e),s=i.getAll();for(let e of n)i.set(e);for(let e of s)i.set(e);return!0}class h{static wrap(e,t){let n=new r.ResponseCookies(new Headers);for(let t of e.getAll())n.set(t);let o=[],a=new Set,u=()=>{let e=s.staticGenerationAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),o=n.getAll().filter(e=>a.has(e.name)),t){let e=[];for(let t of o){let n=new r.ResponseCookies(new Headers);n.set(t),e.push(n.toString())}t(e)}};return new Proxy(n,{get(e,t,n){switch(t){case l:return o;case"delete":return function(...t){a.add("string"==typeof t[0]?t[0]:t[0].name);try{e.delete(...t)}finally{u()}};case"set":return function(...t){a.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t)}finally{u()}};default:return i.ReflectAdapter.get(e,t,n)}}})}}},4465:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{RequestCookies:function(){return r.RequestCookies},ResponseCookies:function(){return r.ResponseCookies}});let r=n(58063)},92897:(e,t)=>{var n,r=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;/**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   */var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var s={},o={};function a(e,t){var n,r,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(r=o[e]))?r:(n=u(e,0,!0),i&&(o[e]=n),n):(e|=0,(i=-128<=e&&e<128)&&(r=s[e]))?r:(n=u(e,e<0?-1:0,!1),i&&(s[e]=n),n)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=f)return T}else{if(e<=-g)return E;if(e+1>=g)return w}return e<0?l(-e,t).neg():u(e%p|0,e/p|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=a,n.fromNumber=l,n.fromBits=u;var c=Math.pow;function h(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((n=n||10)<2||36<n)throw RangeError("radix");if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return h(e.substring(1),t,n).neg();for(var r,i=l(c(n,8)),s=y,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+a),n);if(a<8){var d=l(c(n,a));s=s.mul(d).add(l(u))}else s=(s=s.mul(i)).add(l(u))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=h,n.fromValue=d;var p=4294967296,f=18446744073709552e3,g=0x7fffffffffffffff,m=a(16777216),y=a(0);n.ZERO=y;var v=a(0,!0);n.UZERO=v;var _=a(1);n.ONE=_;var b=a(1,!0);n.UONE=b;var S=a(-1);n.NEG_ONE=S;var w=u(-1,2147483647,!1);n.MAX_VALUE=w;var T=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=T;var E=u(0,-2147483648,!1);n.MIN_VALUE=E;var C=n.prototype;C.toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},C.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(E))return"-"+this.neg().toString(e);var t=l(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}for(var i=l(c(e,6),this.unsigned),s=this,o="";;){var a=s.div(i),u=(s.sub(a.mul(i)).toInt()>>>0).toString(e);if((s=a).isZero())return u+o;for(;u.length<6;)u="0"+u;o=""+u+o}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},C.isZero=function(){return 0===this.high&&0===this.low},C.eqz=C.isZero,C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return(1&this.low)==1},C.isEven=function(){return(1&this.low)==0},C.equals=function(e){return r(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},C.eq=C.equals,C.notEquals=function(e){return!this.eq(e)},C.neq=C.notEquals,C.ne=C.notEquals,C.lessThan=function(e){return 0>this.comp(e)},C.lt=C.lessThan,C.lessThanOrEqual=function(e){return 0>=this.comp(e)},C.lte=C.lessThanOrEqual,C.le=C.lessThanOrEqual,C.greaterThan=function(e){return this.comp(e)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(e){return this.comp(e)>=0},C.gte=C.greaterThanOrEqual,C.ge=C.greaterThanOrEqual,C.compare=function(e){if(r(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(_)},C.neg=C.negate,C.add=function(e){r(e)||(e=d(e));var t,n,i=this.high>>>16,s=65535&this.high,o=this.low>>>16,a=65535&this.low,l=e.high>>>16,c=65535&e.high,h=e.low>>>16,p=65535&e.low,f=0,g=0;return t=0+((n=0+(a+p))>>>16),n&=65535,t+=o+h,g+=t>>>16,t&=65535,g+=s+c,f+=g>>>16,g&=65535,f+=i+l,u(t<<16|n,(f&=65535)<<16|g,this.unsigned)},C.subtract=function(e){return r(e)||(e=d(e)),this.add(e.neg())},C.sub=C.subtract,C.multiply=function(e){if(this.isZero())return this;if(r(e)||(e=d(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(E))return e.isOdd()?E:y;if(e.eq(E))return this.isOdd()?E:y;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return l(this.toNumber()*e.toNumber(),this.unsigned);var n,i,s=this.high>>>16,o=65535&this.high,a=this.low>>>16,c=65535&this.low,h=e.high>>>16,p=65535&e.high,f=e.low>>>16,g=65535&e.low,_=0,b=0;return n=0+((i=0+c*g)>>>16),i&=65535,n+=a*g,b+=n>>>16,n&=65535,n+=c*f,b+=n>>>16,n&=65535,b+=o*g,_+=b>>>16,b&=65535,b+=a*f,_+=b>>>16,b&=65535,b+=c*p,_+=b>>>16,b&=65535,_+=s*g+o*f+a*p+c*h,u(n<<16|i,(_&=65535)<<16|b,this.unsigned)},C.mul=C.multiply,C.divide=function(e){if(r(e)||(e=d(e)),e.isZero())throw Error("division by zero");if(t){var n,i,s;return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return b;s=v}else{if(this.eq(E))return e.eq(_)||e.eq(S)?E:e.eq(E)?_:(n=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?_:S:(i=this.sub(e.mul(n)),s=n.add(i.div(e)));if(e.eq(E))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var o=Math.ceil(Math.log(n=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),a=o<=48?1:c(2,o-48),h=l(n),p=h.mul(e);p.isNegative()||p.gt(i);)n-=a,p=(h=l(n,this.unsigned)).mul(e);h.isZero()&&(h=_),s=s.add(h),i=i.sub(p)}return s},C.div=C.divide,C.modulo=function(e){return(r(e)||(e=d(e)),t)?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},C.mod=C.modulo,C.rem=C.modulo,C.not=function(){return u(~this.low,~this.high,this.unsigned)},C.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},C.clz=C.countLeadingZeros,C.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},C.ctz=C.countTrailingZeros,C.and=function(e){return r(e)||(e=d(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},C.or=function(e){return r(e)||(e=d(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},C.xor=function(e){return r(e)||(e=d(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},C.shiftLeft=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?u(this.high,0,this.unsigned):u(this.high>>>e-32,0,this.unsigned)},C.shru=C.shiftRightUnsigned,C.shr_u=C.shiftRightUnsigned,C.rotateLeft=function(e){var t;return(r(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,u(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},C.rotl=C.rotateLeft,C.rotateRight=function(e){var t;return(r(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,u(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},C.rotr=C.rotateRight,C.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},C.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},C.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var I=n;return e.default=I,"default"in e?e.default:e}({});void 0!==(n=(function(){return r}).apply(t,[]))&&(e.exports=n)},48876:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var r=n(2377),i=n(77752),s=n(33497),o=n(65036);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a{constructor(e,t){this._delegate=e,this.firebase=t,(0,s._addComponent)(e,new i.wA("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,s.deleteApp)(this._delegate)))}_getService(e,t=s._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();let r=this._delegate.container.getProvider(e);return r.isInitialized()||(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)!=="EXPLICIT"||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=s._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){(0,s._addComponent)(this._delegate,e)}_addOrOverwriteComponent(e){(0,s._addOrOverwriteComponent)(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let l={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},u=new r.LL("app-compat","Firebase",l);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c(e){let t={},n={__esModule:!0,initializeApp:a,app:o,registerVersion:s.registerVersion,setLogLevel:s.setLogLevel,onLog:s.onLog,apps:null,SDK_VERSION:s.SDK_VERSION,INTERNAL:{registerComponent:c,removeApp:i,useAsService:h,modularAPIs:s}};function i(e){delete t[e]}function o(e){if(e=e||s._DEFAULT_ENTRY_NAME,!(0,r.r3)(t,e))throw u.create("no-app",{appName:e});return t[e]}function a(i,o={}){let a=s.initializeApp(i,o);if((0,r.r3)(t,a.name))return t[a.name];let l=new e(a,n);return t[a.name]=l,l}function l(){return Object.keys(t).map(e=>t[e])}function c(t){let i=t.name,a=i.replace("-compat","");if(s._registerComponent(t)&&"PUBLIC"===t.type){let s=(e=o())=>{if("function"!=typeof e[a])throw u.create("invalid-app-argument",{appName:i});return e[a]()};void 0!==t.serviceProps&&(0,r.ZB)(s,t.serviceProps),n[a]=s,e.prototype[a]=function(...e){return this._getService.bind(this,i).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[a]:null}function h(e,t){return"serverAuth"===t?null:t}return n.default=n,Object.defineProperty(n,"apps",{get:l}),o.App=e,n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h(){let e=c(a);function t(t){(0,r.ZB)(e,t)}return e.INTERNAL=Object.assign(Object.assign({},e.INTERNAL),{createFirebaseNamespace:h,extendNamespace:t,createSubscribe:r.ne,ErrorFactory:r.LL,deepExtend:r.ZB}),e}let d=h(),p=new o.Yd("@firebase/app-compat"),f="@firebase/app-compat",g="0.2.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m(e){(0,s.registerVersion)(f,g,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */if((0,r.jU)()&&void 0!==self.firebase){p.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);let e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&p.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}let y=d;m()},93219:(e,t,n)=>{"use strict";n.d(t,{u7:()=>_O,Jj:()=>vw,IX:()=>vs,my:()=>y2,xU:()=>_M,Lz:()=>vT,WA:()=>rR,F8:()=>vC,$q:()=>_L,W:()=>_F,EK:()=>rG,PU:()=>_6,l7:()=>oa,Ky:()=>rZ,Xb:()=>rX,Cf:()=>m5,K9:()=>rC,Me:()=>sZ,yq:()=>rS,Wi:()=>m1,ET:()=>_J,xD:()=>_n,Ab:()=>br,vr:()=>bn,Fc:()=>vp,hJ:()=>y6,B$:()=>y9,at:()=>y1,oe:()=>_Y,AK:()=>be,TF:()=>vm,JU:()=>y5,ST:()=>vc,fH:()=>vh,Ix:()=>vg,Wu:()=>_p,Lx:()=>_d,qY:()=>vl,GL:()=>_0,QT:()=>_q,kl:()=>_z,Xk:()=>_W,PL:()=>_$,UQ:()=>_G,zN:()=>_H,ad:()=>va,nP:()=>bi,b9:()=>_o,vh:()=>_a,Pb:()=>vy,L$:()=>vv,cf:()=>_X,sc:()=>_Z,or:()=>_t,Xo:()=>_i,IO:()=>v5,iE:()=>y8,Eo:()=>y7,i3:()=>_8,Bt:()=>bt,pl:()=>_K,Ub:()=>rv,qK:()=>_U,TQ:()=>_c,e0:()=>_u,r7:()=>_Q,Mx:()=>vf,ar:()=>v8,qs:()=>bs});var r,i,s,o,a,l=n(33497),u=n(77752),c=n(65036),h=n(73837),d=n(2377),p=n(6113),f={},g=g||{},m=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{})||self;function y(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function v(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function _(e){return Object.prototype.hasOwnProperty.call(e,b)&&e[b]||(e[b]=++S)}var b="closure_uid_"+(1e9*Math.random()>>>0),S=0;function w(e,t,n){return e.call.apply(e.bind,arguments)}function T(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function E(e,t,n){return(E=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:T).apply(null,arguments)}function C(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function I(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function k(){this.s=this.s,this.o=this.o}var R=0;k.prototype.s=!1,k.prototype.sa=function(){this.s||(this.s=!0,this.N(),0==R)||_(this)},k.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let O=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function N(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function A(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(y(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function x(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}x.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!m.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{m.addEventListener("test",()=>{},t),m.removeEventListener("test",()=>{},t)}catch(e){}return e}();function P(e){return/^[\s\xa0]*$/.test(e)}function M(){var e=m.navigator;return e&&(e=e.userAgent)?e:""}function L(e){return -1!=M().indexOf(e)}function F(e){return F[" "](e),e}function B(e,t){var n=nZ;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}F[" "]=function(){};var j=L("Opera"),U=L("Trident")||L("MSIE"),q=L("Edge"),V=q||U,z=L("Gecko")&&!(-1!=M().toLowerCase().indexOf("webkit")&&!L("Edge"))&&!(L("Trident")||L("MSIE"))&&!L("Edge"),W=-1!=M().toLowerCase().indexOf("webkit")&&!L("Edge");function $(){var e=m.document;return e?e.documentMode:void 0}e:{var G="",H=function(){var e=M();return z?/rv:([^\);]+)(\)|;)/.exec(e):q?/Edge\/([\d\.]+)/.exec(e):U?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):W?/WebKit\/(\S+)/.exec(e):j?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(H&&(G=H?H[1]:""),U){var K=$();if(null!=K&&K>parseFloat(G)){r=String(K);break e}}r=G}var Q=i=m.document&&U&&($()||parseInt(r,10))||void 0;function Y(e,t){if(x.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(z){e:{try{F(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:J[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Y.$.h.call(this)}}I(Y,x);var J={2:"touch",3:"pen",4:"mouse"};Y.prototype.h=function(){Y.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var X="closure_listenable_"+(1e6*Math.random()|0),Z=0;function ee(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++Z,this.fa=this.ia=!1}function et(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function en(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function er(e,t){for(let n in e)t.call(void 0,e[n],n,e)}function ei(e){let t={};for(let n in e)t[n]=e[n];return t}let es="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function eo(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<es.length;t++)n=es[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function ea(e){this.src=e,this.g={},this.h=0}function el(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=O(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(et(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function eu(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&!!n==s.capture&&s.la==r)return i}return -1}ea.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=eu(e,t,r,i);return -1<o?(t=e[o],n||(t.ia=!1)):((t=new ee(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var ec="closure_lm_"+(1e6*Math.random()|0),eh={};function ed(e,t,n,r,i){if(r&&r.once)return eg(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ed(e,t[s],n,r,i);return null}return n=ew(n),e&&e[X]?e.O(t,n,v(r)?!!r.capture:!!r,i):ep(e,t,n,!1,r,i)}function ep(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=v(i)?!!i.capture:!!i,a=eb(e);if(a||(e[ec]=a=new ea(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=ef(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)D||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ev(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ef(){function e(n){return t.call(e.src,e.listener,n)}let t=e_;return e}function eg(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)eg(e,t[s],n,r,i);return null}return n=ew(n),e&&e[X]?e.P(t,n,v(r)?!!r.capture:!!r,i):ep(e,t,n,!0,r,i)}function em(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)em(e,t[s],n,r,i);else(r=v(r)?!!r.capture:!!r,n=ew(n),e&&e[X])?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=eu(s=e.g[t],n,r,i))&&(et(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=eb(e))&&(t=e.g[t.toString()],e=-1,t&&(e=eu(t,n,r,i)),(n=-1<e?t[e]:null)&&ey(n))}function ey(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[X])el(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ev(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=eb(t))?(el(n,e),0==n.h&&(n.src=null,t[ec]=null)):et(e)}}}function ev(e){return e in eh?eh[e]:eh[e]="on"+e}function e_(e,t){if(e.fa)e=!0;else{t=new Y(t,this);var n=e.listener,r=e.la||e.src;e.ia&&ey(e),e=n.call(r,t)}return e}function eb(e){return(e=e[ec])instanceof ea?e:null}var eS="__closure_events_fn_"+(1e9*Math.random()>>>0);function ew(e){return"function"==typeof e?e:(e[eS]||(e[eS]=function(t){return e.handleEvent(t)}),e[eS])}function eT(){k.call(this),this.i=new ea(this),this.S=this,this.J=null}function eE(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new x(t,e);else if(t instanceof x)t.target=t.target||e;else{var i=t;eo(t=new x(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=eC(o,r,!0,t)&&i}if(i=eC(o=t.g=e,r,!0,t)&&i,i=eC(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=eC(o=t.g=n[s],r,!1,t)&&i}function eC(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&el(e.i,o),i=!1!==a.call(l,r)&&i}}return i&&!r.defaultPrevented}I(eT,k),eT.prototype[X]=!0,eT.prototype.removeEventListener=function(e,t,n,r){em(this,e,t,n,r)},eT.prototype.N=function(){if(eT.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)et(n[r]);delete t.g[e],t.h--}}this.J=null},eT.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},eT.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var eI=m.JSON.stringify;class ek{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function eR(){var e=eL;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}class eO{constructor(){this.h=this.g=null}add(e,t){let n=eN.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var eN=new ek(()=>new eA,e=>e.reset());class eA{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ex(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function eD(e){m.setTimeout(()=>{throw e},0)}let eP,eM=!1,eL=new eO,eF=()=>{let e=m.Promise.resolve(void 0);eP=()=>{e.then(eB)}};var eB=()=>{for(var e;e=eR();){try{e.h.call(e.g)}catch(e){eD(e)}var t=eN;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}eM=!1};function ej(e,t){eT.call(this),this.h=e||1,this.g=t||m,this.j=E(this.qb,this),this.l=Date.now()}function eU(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function eq(e,t,n){if("function"==typeof e)n&&(e=E(e,n));else if(e&&"function"==typeof e.handleEvent)e=E(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:m.setTimeout(e,t||0)}function eV(e){e.g=eq(()=>{e.g=null,e.i&&(e.i=!1,eV(e))},e.j);let t=e.h;e.h=null,e.m.apply(null,t)}I(ej,eT),(a=ej.prototype).ga=!1,a.T=null,a.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),eE(this,"tick"),this.ga&&(eU(this),this.start()))}},a.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},a.N=function(){ej.$.N.call(this),eU(this),delete this.g};class ez extends k{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:eV(this)}N(){super.N(),this.g&&(m.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eW(e){k.call(this),this.h=e,this.g={}}I(eW,k);var e$=[];function eG(e,t,n,r){Array.isArray(n)||(n&&(e$[0]=n.toString()),n=e$);for(var i=0;i<n.length;i++){var s=ed(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function eH(e){en(e.g,function(e,t){this.g.hasOwnProperty(t)&&ey(e)},e),e.g={}}function eK(){this.g=!0}function eQ(e,t,n,r,i,s){e.info(function(){if(e.g){if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var u=a[l].split("=");if(1<u.length){var c=u[0];u=u[1];var h=c.split("_");o=2<=h.length&&"type"==h[1]?o+(c+"=")+u+"&":o+(c+"=redacted&")}}else o=null}else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}function eY(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}function eJ(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+eZ(e,n)+(r?" "+r:"")})}function eX(e,t){e.info(function(){return"TIMEOUT: "+t})}function eZ(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}}return eI(n)}catch(e){return t}}eW.prototype.N=function(){eW.$.N.call(this),eH(this)},eW.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},eK.prototype.Ea=function(){this.g=!1},eK.prototype.info=function(){};var e0={},e1=null;function e2(){return e1=e1||new eT}function e3(e){x.call(this,e0.Ta,e)}function e4(e){let t=e2();eE(t,new e3(t))}function e6(e,t){x.call(this,e0.STAT_EVENT,e),this.stat=t}function e9(e){let t=e2();eE(t,new e6(t,e))}function e5(e,t){x.call(this,e0.Ua,e),this.size=t}function e7(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return m.setTimeout(function(){e()},t)}e0.Ta="serverreachability",I(e3,x),e0.STAT_EVENT="statevent",I(e6,x),e0.Ua="timingevent",I(e5,x);var e8={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},te={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function tt(){}function tn(e){return e.h||(e.h=e.i())}function tr(){}tt.prototype.h=null;var ti={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ts(){x.call(this,"d")}function to(){x.call(this,"c")}function ta(){}function tl(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new eW(this),this.P=tc,e=V?125:void 0,this.V=new ej(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new tu}function tu(){this.i=null,this.g="",this.h=!1}I(ts,x),I(to,x),I(ta,tt),ta.prototype.g=function(){return new XMLHttpRequest},ta.prototype.i=function(){return{}},s=new ta;var tc=45e3,th={},td={};function tp(e,t,n){e.L=1,e.v=tM(tN(t)),e.s=n,e.S=!0,tf(e,null)}function tf(e,t){e.G=Date.now(),tv(e),e.A=tN(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),tK(n.i,"t",r),e.C=0,n=e.l.J,e.h=new tu,e.g=nz(e.l,n?t:null,!e.s),0<e.O&&(e.M=new ez(E(e.Pa,e,e.g),e.O)),eG(e.U,e.g,"readystatechange",e.nb),t=e.I?ei(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),e4(),eQ(e.j,e.u,e.A,e.m,e.W,e.s)}function tg(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function tm(e,t,n){let r=!0,i;for(;!e.J&&e.C<n.length;)if((i=ty(e,n))==td){4==t&&(e.o=4,e9(14),r=!1),eJ(e.j,e.m,null,"[Incomplete Response]");break}else if(i==th){e.o=4,e9(15),eJ(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else eJ(e.j,e.m,i,null),tT(e,i);tg(e)&&i!=td&&i!=th&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,e9(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),nM(t),t.M=!0,e9(11))):(eJ(e.j,e.m,n,"[Invalid Chunked Response]"),tw(e),tS(e))}function ty(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?td:isNaN(n=Number(t.substring(n,r)))?th:(r+=1)+n>t.length?td:(t=t.slice(r,r+n),e.C=r+n,t)}function tv(e){e.Y=Date.now()+e.P,t_(e,e.P)}function t_(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=e7(E(e.lb,e),t)}function tb(e){e.B&&(m.clearTimeout(e.B),e.B=null)}function tS(e){0==e.l.H||e.J||nB(e.l,e)}function tw(e){tb(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,eU(e.V),eH(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function tT(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||t2(n.i,e))){if(!e.K&&t2(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(n.g.G+3e3<e.G)nF(n),nI(n);else break e}nP(n),e9(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=e7(E(n.ib,n),6e3));if(1>=t1(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else nU(n,11)}else if((e.K||n.g==e)&&nF(n),!P(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H){if("c"==u[0]){n.K=u[1],n.pa=u[2];let t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));let i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));let c=u[5];null!=c&&"number"==typeof c&&0<c&&(r=1.5*c,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(t3(s,s.h),s.h=null))}if(r.F){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,tP(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=e;if(r.wa=nV(r,r.J?r.pa:null,r.Y),o.K){t4(r.i,o);var a=o,l=r.L;l&&a.setTimeout(l),a.B&&(tb(a),tv(a)),r.g=o}else nD(r);0<n.j.length&&nR(n)}else"stop"!=u[0]&&"close"!=u[0]||nU(n,7)}else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?nU(n,7):nC(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}}e4(4)}catch(e){}}function tE(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(y(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}function tC(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(y(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}function tI(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(y(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=tC(e),r=tE(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(a=tl.prototype).setTimeout=function(e){this.P=e},a.nb=function(e){e=e.target;let t=this.M;t&&3==nv(e)?t.l():this.Pa(e)},a.Pa=function(e){try{if(e==this.g)e:{let c=nv(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>c)&&(3!=c||V||this.g&&(this.h.h||this.g.ja()||n_(this.g)))){this.J||4!=c||7==t||(8==t||0>=h?e4(3):e4(2)),tb(this);var n=this.g.da();this.ca=n;t:if(tg(this)){var r=n_(this.g);e="";var i=r.length,s=4==nv(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){tw(this),tS(this);var o="";break t}this.h.i=new m.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,eY(this.j,this.u,this.A,this.m,this.W,c,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(a)){var u=a;break t}}u=null}if(n=u)eJ(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,tT(this,n);else{this.i=!1,this.o=3,e9(12),tw(this),tS(this);break e}}this.S?(tm(this,c,o),V&&this.i&&3==c&&(eG(this.U,this.V,"tick",this.mb),this.V.start())):(eJ(this.j,this.m,o,null),tT(this,o)),4==c&&tw(this),this.i&&!this.J&&(4==c?nB(this.l,this):(this.i=!1,tv(this)))}else nb(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,e9(12)):(this.o=0,e9(13)),tw(this),tS(this)}}}catch(e){}finally{}},a.mb=function(){if(this.g){var e=nv(this.g),t=this.g.ja();this.C<t.length&&(tb(this),tm(this,e,t),this.i&&4!=e&&tv(this))}},a.cancel=function(){this.J=!0,tw(this)},a.lb=function(){this.B=null;let e=Date.now();0<=e-this.Y?(eX(this.j,this.A),2!=this.L&&(e4(),e9(17)),tw(this),this.o=2,tS(this)):t_(this,this.Y-e)};var tk=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tR(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function tO(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof tO){this.h=e.h,tA(this,e.j),this.s=e.s,this.g=e.g,tx(this,e.m),this.l=e.l;var t=e.i,n=new tW;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tD(this,n),this.o=e.o}else e&&(t=String(e).match(tk))?(this.h=!1,tA(this,t[1]||"",!0),this.s=tL(t[2]||""),this.g=tL(t[3]||"",!0),tx(this,t[4]),this.l=tL(t[5]||"",!0),tD(this,t[6]||"",!0),this.o=tL(t[7]||"")):(this.h=!1,this.i=new tW(null,this.h))}function tN(e){return new tO(e)}function tA(e,t,n){e.j=n?tL(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tx(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function tD(e,t,n){t instanceof tW?(e.i=t,tY(e.i,e.h)):(n||(t=tF(t,tV)),e.i=new tW(t,e.h))}function tP(e,t,n){e.i.set(t,n)}function tM(e){return tP(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function tL(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tF(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,tB),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function tB(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}tO.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tF(t,tj,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(tF(t,tj,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tF(n,"/"==n.charAt(0)?tq:tU,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tF(n,tz)),e.join("")};var tj=/[#\/\?@]/g,tU=/[#\?:]/g,tq=/[#\?]/g,tV=/[#\?@]/g,tz=/#/g;function tW(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function t$(e){e.g||(e.g=new Map,e.h=0,e.i&&tR(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tG(e,t){t$(e),t=tQ(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tH(e,t){return t$(e),t=tQ(e,t),e.g.has(t)}function tK(e,t,n){tG(e,t),0<n.length&&(e.i=null,e.g.set(tQ(e,t),N(n)),e.h+=n.length)}function tQ(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tY(e,t){t&&!e.j&&(t$(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tG(this,t),tK(this,n,e))},e)),e.j=t}(a=tW.prototype).add=function(e,t){t$(this),this.i=null,e=tQ(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},a.forEach=function(e,t){t$(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},a.ta=function(){t$(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},a.Z=function(e){t$(this);let t=[];if("string"==typeof e)tH(this,e)&&(t=t.concat(this.g.get(tQ(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},a.set=function(e,t){return t$(this),this.i=null,tH(this,e=tQ(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},a.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},a.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var tJ=class{constructor(e,t){this.g=e,this.map=t}};function tX(e){this.l=e||tZ,e=m.PerformanceNavigationTiming?0<(e=m.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(m.g&&m.g.Ka&&m.g.Ka()&&m.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var tZ=10;function t0(e){return!!e.h||!!e.g&&e.g.size>=e.j}function t1(e){return e.h?1:e.g?e.g.size:0}function t2(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function t3(e,t){e.g?e.g.add(t):e.h=t}function t4(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function t6(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return N(e.i)}tX.prototype.cancel=function(){if(this.i=t6(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var t9=class{stringify(e){return m.JSON.stringify(e,void 0)}parse(e){return m.JSON.parse(e,void 0)}};function t5(){this.g=new t9}function t7(e,t,n){let r=n||"";try{tI(e,function(e,n){let i=e;v(e)&&(i=eI(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function t8(e,t){let n=new eK;if(m.Image){let r=new Image;r.onload=C(ne,n,r,"TestLoadImage: loaded",!0,t),r.onerror=C(ne,n,r,"TestLoadImage: error",!1,t),r.onabort=C(ne,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=C(ne,n,r,"TestLoadImage: timeout",!1,t),m.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function ne(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function nt(e){this.l=e.fc||null,this.j=e.ob||!1}function nn(e,t){eT.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=nr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}I(nt,tt),nt.prototype.g=function(){return new nn(this.l,this.j)},nt.prototype.i=function(e){return function(){return e}}({}),I(nn,eT);var nr=0;function ni(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function ns(e){e.readyState=4,e.l=null,e.j=null,e.A=null,no(e)}function no(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(a=nn.prototype).open=function(e,t){if(this.readyState!=nr)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,no(this)},a.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||m).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},a.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ns(this)),this.readyState=nr},a.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,no(this)),this.g&&(this.readyState=3,no(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==m.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ni(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))}},a.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ns(this):no(this),3==this.readyState&&ni(this)}},a.Za=function(e){this.g&&(this.response=this.responseText=e,ns(this))},a.Ya=function(e){this.g&&(this.response=e,ns(this))},a.ka=function(){this.g&&ns(this)},a.setRequestHeader=function(e,t){this.v.append(e,t)},a.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},a.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(nn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var na=m.JSON.parse;function nl(e){eT.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=nu,this.L=this.M=!1}I(nl,eT);var nu="",nc=/^https?$/i,nh=["POST","PUT"];function nd(e){return U&&"number"==typeof e.timeout&&void 0!==e.ontimeout}function np(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,nf(e),nm(e)}function nf(e){e.F||(e.F=!0,eE(e,"complete"),eE(e,"error"))}function ng(e){if(e.h&&void 0!==g&&(!e.C[1]||4!=nv(e)||2!=e.da())){if(e.v&&4==nv(e))eq(e.La,0,e);else if(eE(e,"readystatechange"),4==nv(e)){e.h=!1;try{let o=e.da();switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===o){var i=String(e.I).match(tk)[1]||null;!i&&m.self&&m.self.location&&(i=m.self.location.protocol.slice(0,-1)),n=!nc.test(i?i.toLowerCase():"")}t=n}if(t)eE(e,"complete"),eE(e,"success");else{e.m=6;try{var s=2<nv(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",nf(e)}}finally{nm(e)}}}}function nm(e,t){if(e.g){ny(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||eE(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function ny(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(m.clearTimeout(e.A),e.A=null)}function nv(e){return e.g?e.g.readyState:0}function n_(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case nu:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function nb(e){let t={};e=(e.g&&2<=nv(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(P(e[r]))continue;var n=ex(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}er(t,function(e){return e.join(", ")})}function nS(e){let t="";return en(e,function(e,n){t+=n+":"+e+"\r\n"}),t}function nw(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=nS(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tP(e,t,n))}function nT(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function nE(e){this.Ga=0,this.j=[],this.l=new eK,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=nT("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=nT("baseRetryDelayMs",5e3,e),this.hb=nT("retryDelaySeedMs",1e4,e),this.eb=nT("forwardChannelMaxRetries",2,e),this.xa=nT("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new tX(e&&e.concurrentRequestLimit),this.Ja=new t5,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function nC(e){if(nk(e),3==e.H){var t=e.W++,n=tN(e.I);if(tP(n,"SID",e.K),tP(n,"RID",t),tP(n,"TYPE","terminate"),nA(e,n),(t=new tl(e,e.l,t)).L=2,t.v=tM(tN(n)),n=!1,m.navigator&&m.navigator.sendBeacon)try{n=m.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&m.Image&&((new Image).src=t.v,n=!0),n||(t.g=nz(t.l,null),t.g.ha(t.v)),t.G=Date.now(),tv(t)}nq(e)}function nI(e){e.g&&(nM(e),e.g.cancel(),e.g=null)}function nk(e){nI(e),e.u&&(m.clearTimeout(e.u),e.u=null),nF(e),e.i.cancel(),e.m&&("number"==typeof e.m&&m.clearTimeout(e.m),e.m=null)}function nR(e){if(!t0(e.i)&&!e.m){e.m=!0;var t=e.Na;eP||eF(),eM||(eP(),eM=!0),eL.add(t,e),e.C=0}}function nO(e,t){return!(t1(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.j=t.F.concat(e.j),!0):1!=e.H&&2!=e.H&&!(e.C>=(e.cb?0:e.eb))&&(e.m=e7(E(e.Na,e,t),nj(e,e.C)),e.C++,!0))}function nN(e,t){var n;n=t?t.m:e.W++;let r=tN(e.I);tP(r,"SID",e.K),tP(r,"RID",n),tP(r,"AID",e.V),nA(e,r),e.o&&e.s&&nw(r,e.o,e.s),n=new tl(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=nx(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),t3(e.i,n),tp(n,r,t)}function nA(e,t){e.na&&en(e.na,function(e,n){tP(t,n,e)}),e.h&&tI({},function(e,n){tP(t,n,e)})}function nx(e,t,n){n=Math.min(e.j.length,n);var r=e.h?E(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g,a=i[o].map;if(0>(n-=t))t=Math.max(0,i[o].g-100),s=!1;else try{t7(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function nD(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;eP||eF(),eM||(eP(),eM=!0),eL.add(t,e),e.A=0}}function nP(e){return!e.g&&!e.u&&!(3<=e.A)&&(e.ba++,e.u=e7(E(e.Ma,e),nj(e,e.A)),e.A++,!0)}function nM(e){null!=e.B&&(m.clearTimeout(e.B),e.B=null)}function nL(e){e.g=new tl(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=tN(e.wa);tP(t,"RID","rpc"),tP(t,"SID",e.K),tP(t,"AID",e.V),tP(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&tP(t,"TO",e.qa),tP(t,"TYPE","xmlhttp"),nA(e,t),e.o&&e.s&&nw(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=tM(tN(t)),n.s=null,n.S=!0,tf(n,e)}function nF(e){null!=e.v&&(m.clearTimeout(e.v),e.v=null)}function nB(e,t){var n=null;if(e.g==t){nF(e),nM(e),e.g=null;var r=2}else{if(!t2(e.i,t))return;n=t.F,t4(e.i,t),r=1}if(0!=e.H){if(t.i){if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;eE(r=e2(),new e5(r,n)),nR(e)}else nD(e)}else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&nO(e,t)||2==r&&nP(e)))switch(n&&0<n.length&&((t=e.i).i=t.i.concat(n)),i){case 1:nU(e,5);break;case 4:nU(e,10);break;case 3:nU(e,6);break;default:nU(e,2)}}}function nj(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function nU(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=E(e.pb,e);n||(n=new tO("//www.google.com/images/cleardot.gif"),m.location&&"http"==m.location.protocol||tA(n,"https"),tM(n)),t8(n.toString(),r)}else e9(2);e.H=0,e.h&&e.h.za(t),nq(e),nk(e)}function nq(e){if(e.H=0,e.ma=[],e.h){let t=t6(e.i);(0!=t.length||0!=e.j.length)&&(A(e.ma,t),A(e.ma,e.j),e.i.i.length=0,N(e.j),e.j.length=0),e.h.ya()}}function nV(e,t,n){var r=n instanceof tO?tN(n):new tO(n);if(""!=r.g)t&&(r.g=t+"."+r.g),tx(r,r.m);else{var i=m.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new tO(null);r&&tA(s,r),t&&(s.g=t),i&&tx(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&tP(r,n,t),tP(r,"VER",e.ra),nA(e,r),r}function nz(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new nl(n&&e.Ha&&!e.va?new nt({ob:!0}):e.va)).Oa(e.J),t}function nW(){}function n$(){if(U&&!(10<=Number(Q)))throw Error("Environmental error: no available transport.")}function nG(e,t){eT.call(this),this.g=new nE(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!P(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!P(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new nQ(this)}function nH(e){ts.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function nK(){to.call(this),this.status=1}function nQ(e){this.g=e}function nY(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function nJ(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=s+(i^(t=n+(o<<7&4294967295|o>>>25))&(n^i))+r[1]+3905402710&4294967295,o=i+(n^(s=t+(o<<12&4294967295|o>>>20))&(t^n))+r[2]+606105819&4294967295,o=n+(t^(i=s+(o<<17&4294967295|o>>>15))&(s^t))+r[3]+3250441966&4294967295,o=t+(s^(n=i+(o<<22&4294967295|o>>>10))&(i^s))+r[4]+4118548399&4294967295,o=s+(i^(t=n+(o<<7&4294967295|o>>>25))&(n^i))+r[5]+1200080426&4294967295,o=i+(n^(s=t+(o<<12&4294967295|o>>>20))&(t^n))+r[6]+2821735955&4294967295,o=n+(t^(i=s+(o<<17&4294967295|o>>>15))&(s^t))+r[7]+4249261313&4294967295,o=t+(s^(n=i+(o<<22&4294967295|o>>>10))&(i^s))+r[8]+1770035416&4294967295,o=s+(i^(t=n+(o<<7&4294967295|o>>>25))&(n^i))+r[9]+2336552879&4294967295,o=i+(n^(s=t+(o<<12&4294967295|o>>>20))&(t^n))+r[10]+4294925233&4294967295,o=n+(t^(i=s+(o<<17&4294967295|o>>>15))&(s^t))+r[11]+2304563134&4294967295,o=t+(s^(n=i+(o<<22&4294967295|o>>>10))&(i^s))+r[12]+1804603682&4294967295,o=s+(i^(t=n+(o<<7&4294967295|o>>>25))&(n^i))+r[13]+4254626195&4294967295,o=i+(n^(s=t+(o<<12&4294967295|o>>>20))&(t^n))+r[14]+2792965006&4294967295,o=n+(t^(i=s+(o<<17&4294967295|o>>>15))&(s^t))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(i^s&(n^i))+r[1]+4129170786&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[6]+3225465664&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(n^i))+r[5]+3593408605&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[10]+38016083&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(n^i))+r[9]+568446438&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[14]+3275163606&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(n^i))+r[13]+2850285829&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[2]+4243563512&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[12]+2368359562&4294967295,o=t+((n=i+(o<<20&4294967295|o>>>12))^i^s)+r[5]+4294588738&4294967295,o=s+((t=n+(o<<4&4294967295|o>>>28))^n^i)+r[8]+2272392833&4294967295,o=i+((s=t+(o<<11&4294967295|o>>>21))^t^n)+r[11]+1839030562&4294967295,o=n+((i=s+(o<<16&4294967295|o>>>16))^s^t)+r[14]+4259657740&4294967295,o=t+((n=i+(o<<23&4294967295|o>>>9))^i^s)+r[1]+2763975236&4294967295,o=s+((t=n+(o<<4&4294967295|o>>>28))^n^i)+r[4]+1272893353&4294967295,o=i+((s=t+(o<<11&4294967295|o>>>21))^t^n)+r[7]+4139469664&4294967295,o=n+((i=s+(o<<16&4294967295|o>>>16))^s^t)+r[10]+3200236656&4294967295,o=t+((n=i+(o<<23&4294967295|o>>>9))^i^s)+r[13]+681279174&4294967295,o=s+((t=n+(o<<4&4294967295|o>>>28))^n^i)+r[0]+3936430074&4294967295,o=i+((s=t+(o<<11&4294967295|o>>>21))^t^n)+r[3]+3572445317&4294967295,o=n+((i=s+(o<<16&4294967295|o>>>16))^s^t)+r[6]+76029189&4294967295,o=t+((n=i+(o<<23&4294967295|o>>>9))^i^s)+r[9]+3654602809&4294967295,o=s+((t=n+(o<<4&4294967295|o>>>28))^n^i)+r[12]+3873151461&4294967295,o=i+((s=t+(o<<11&4294967295|o>>>21))^t^n)+r[15]+530742520&4294967295,o=n+((i=s+(o<<16&4294967295|o>>>16))^s^t)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(i^(n|~s))+r[0]+4096336452&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[7]+1126891415&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~s))+r[12]+1700485571&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[3]+2399980690&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~s))+r[8]+1873313359&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[15]+4264355552&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~s))+r[4]+4149444226&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[11]+3174756917&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function nX(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(a=nl.prototype).Oa=function(e){this.M=e},a.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():s.g(),this.C=this.u?tn(this.u):tn(s),this.g.onreadystatechange=E(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){np(this,e);return}if(e=n||"",n=new Map(this.headers),r){if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if("function"==typeof r.keys&&"function"==typeof r.get)for(let e of r.keys())n.set(e,r.get(e));else throw Error("Unknown input type for opt_headers: "+String(r))}for(let[s,o]of(r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=m.FormData&&e instanceof m.FormData,!(0<=O(nh,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{ny(this),0<this.B&&((this.L=nd(this.g))?(this.g.timeout=this.B,this.g.ontimeout=E(this.ua,this)):this.A=eq(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){np(this,e)}},a.ua=function(){void 0!==g&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,eE(this,"timeout"),this.abort(8))},a.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,eE(this,"complete"),eE(this,"abort"),nm(this))},a.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),nm(this,!0)),nl.$.N.call(this)},a.La=function(){this.s||(this.G||this.v||this.l?ng(this):this.kb())},a.kb=function(){ng(this)},a.isActive=function(){return!!this.g},a.da=function(){try{return 2<nv(this)?this.g.status:-1}catch(e){return -1}},a.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},a.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),na(t)}},a.Ia=function(){return this.m},a.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(a=nE.prototype).ra=8,a.H=1,a.Na=function(e){if(this.m){if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let i=new tl(this,this.l,e),s=this.s;if(this.U&&(s?eo(s=ei(s),this.U):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=nx(this,i,t),tP(n=tN(this.I),"RID",e),tP(n,"CVER",22),this.F&&tP(n,"X-HTTP-Session-Id",this.F),nA(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(nS(s)))+"&"+t:this.o&&nw(n,this.o,s)),t3(this.i,i),this.bb&&tP(n,"TYPE","init"),this.P?(tP(n,"$req",t),tP(n,"SID","null"),i.aa=!0,tp(i,n,null)):tp(i,n,t),this.H=2}}else 3==this.H&&(e?nN(this,e):0==this.j.length||t0(this.i)||nN(this))}},a.Ma=function(){if(this.u=null,nL(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=e7(E(this.jb,this),e)}},a.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,e9(10),nI(this),nL(this))},a.ib=function(){null!=this.v&&(this.v=null,nI(this),nP(this),e9(19))},a.pb=function(e){e?(this.l.info("Successfully pinged google.com"),e9(2)):(this.l.info("Failed to ping google.com"),e9(1))},a.isActive=function(){return!!this.h&&this.h.isActive(this)},(a=nW.prototype).Ba=function(){},a.Aa=function(){},a.za=function(){},a.ya=function(){},a.isActive=function(){return!0},a.Va=function(){},n$.prototype.g=function(e,t){return new nG(e,t)},I(nG,eT),nG.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;e9(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=nV(e,null,e.Y),nR(e)},nG.prototype.close=function(){nC(this.g)},nG.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=eI(e),e=n);t.j.push(new tJ(t.fb++,e)),3==t.H&&nR(t)},nG.prototype.N=function(){this.g.h=null,delete this.j,nC(this.g),delete this.g,nG.$.N.call(this)},I(nH,ts),I(nK,to),I(nQ,nW),nQ.prototype.Ba=function(){eE(this.g,"a")},nQ.prototype.Aa=function(e){eE(this.g,new nH(e))},nQ.prototype.za=function(e){eE(this.g,new nK)},nQ.prototype.ya=function(){eE(this.g,"b")},I(nY,function(){this.blockSize=-1}),nY.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},nY.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)nJ(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){nJ(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){nJ(this,r),i=0;break}}this.h=i,this.i+=t},nY.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var nZ={};function n0(e){return -128<=e&&128>e?B(e,function(e){return new nX([0|e],0>e?-1:0)}):new nX([0|e],0>e?-1:0)}function n1(e){if(isNaN(e)||!isFinite(e))return n4;if(0>e)return n8(n1(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=n3;return new nX(t,0)}function n2(e,t){if(0==e.length)throw Error("number format error: empty string");if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return n8(n2(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=n1(Math.pow(t,8)),r=n4,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),o=parseInt(e.substring(i,i+s),t);8>s?(s=n1(Math.pow(t,s)),r=r.R(s).add(n1(o))):r=(r=r.R(n)).add(n1(o))}return r}var n3=4294967296,n4=n0(0),n6=n0(1),n9=n0(16777216);function n5(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function n7(e){return -1==e.h}function n8(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new nX(n,~e.h).add(n6)}function re(e,t){return e.add(n8(t))}function rt(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function rn(e,t){this.g=e,this.h=t}function rr(e,t){if(n5(t))throw Error("division by zero");if(n5(e))return new rn(n4,n4);if(n7(e))return t=rr(n8(e),t),new rn(n8(t.g),n8(t.h));if(n7(t))return t=rr(e,n8(t)),new rn(n8(t.g),t.h);if(30<e.g.length){if(n7(e)||n7(t))throw Error("slowDivide_ only works with positive integers.");for(var n=n6,r=t;0>=r.X(e);)n=ri(n),r=ri(r);var i=rs(n,1),s=rs(r,1);for(r=rs(r,2),n=rs(n,2);!n5(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=rs(r,1),n=rs(n,1)}return t=re(e,i.R(t)),new rn(i,t)}for(i=n4;0<=e.X(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.ea()/t.ea())))/Math.LN2))?1:Math.pow(2,r-48),o=(s=n1(n)).R(t);n7(o)||0<o.X(e);)n-=r,o=(s=n1(n)).R(t);n5(s)&&(s=n6),i=i.add(s),e=re(e,o)}return new rn(i,e)}function ri(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new nX(n,e.h)}function rs(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new nX(i,e.h)}(a=nX.prototype).ea=function(){if(n7(this))return-n8(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:n3+r)*t,t*=n3}return e},a.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(n5(this))return"0";if(n7(this))return"-"+n8(this).toString(e);for(var t=n1(Math.pow(e,6)),n=this,r="";;){var i=rr(n,t).g,s=((0<(n=re(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(n5(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},a.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},a.X=function(e){return n7(e=re(this,e))?-1:n5(e)?0:1},a.abs=function(){return n7(this)?n8(this):this},a.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new nX(n,-2147483648&n[n.length-1]?-1:0)},a.R=function(e){if(n5(this)||n5(e))return n4;if(n7(this))return n7(e)?n8(this).R(n8(e)):n8(n8(this).R(e));if(n7(e))return n8(this.R(n8(e)));if(0>this.X(n9)&&0>e.X(n9))return n1(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,l=65535&e.D(i);n[2*r+2*i]+=o*l,rt(n,2*r+2*i),n[2*r+2*i+1]+=s*l,rt(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,rt(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,rt(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new nX(n,0)},a.gb=function(e){return rr(this,e).h},a.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new nX(n,this.h&e.h)},a.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new nX(n,this.h|e.h)},a.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new nX(n,this.h^e.h)},n$.prototype.createWebChannel=n$.prototype.g,nG.prototype.send=nG.prototype.u,nG.prototype.open=nG.prototype.m,nG.prototype.close=nG.prototype.close,e8.NO_ERROR=0,e8.TIMEOUT=8,e8.HTTP_ERROR=6,te.COMPLETE="complete",tr.EventType=ti,ti.OPEN="a",ti.CLOSE="b",ti.ERROR="c",ti.MESSAGE="d",eT.prototype.listen=eT.prototype.O,nl.prototype.listenOnce=nl.prototype.P,nl.prototype.getLastError=nl.prototype.Sa,nl.prototype.getLastErrorCode=nl.prototype.Ia,nl.prototype.getStatus=nl.prototype.da,nl.prototype.getResponseJson=nl.prototype.Wa,nl.prototype.getResponseText=nl.prototype.ja,nl.prototype.send=nl.prototype.ha,nl.prototype.setWithCredentials=nl.prototype.Oa,nY.prototype.digest=nY.prototype.l,nY.prototype.reset=nY.prototype.reset,nY.prototype.update=nY.prototype.j,nX.prototype.add=nX.prototype.add,nX.prototype.multiply=nX.prototype.R,nX.prototype.modulo=nX.prototype.gb,nX.prototype.compare=nX.prototype.X,nX.prototype.toNumber=nX.prototype.ea,nX.prototype.toString=nX.prototype.toString,nX.prototype.getBits=nX.prototype.D,nX.fromNumber=n1,nX.fromString=n2,f.createWebChannelTransport=function(){return new n$},f.getStatEventTarget=function(){return e2()},f.ErrorCode=e8,f.EventType=te,f.Event=e0,f.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},f.FetchXmlHttpFactory=nt,f.WebChannel=tr,f.XhrIo=nl;var ro=f.Md5=nY,ra=f.Integer=nX,rl=n(1968),ru=n(13716);let rc="@firebase/firestore",rh="3.13.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}rd.UNAUTHENTICATED=new rd(null),rd.GOOGLE_CREDENTIALS=new rd("google-credentials-uid"),rd.FIRST_PARTY=new rd("first-party-uid"),rd.MOCK_USER=new rd("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rp="9.23.0";function rf(e){rp=e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rg(e){return(0,h.inspect)(e,{depth:100})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rm=new c.Yd("@firebase/firestore");function ry(){return rm.logLevel}function rv(e){rm.setLogLevel(e)}function r_(e,...t){if(rm.logLevel<=c.in.DEBUG){let n=t.map(rw);rm.debug(`Firestore (${rp}): ${e}`,...n)}}function rb(e,...t){if(rm.logLevel<=c.in.ERROR){let n=t.map(rw);rm.error(`Firestore (${rp}): ${e}`,...n)}}function rS(e,...t){if(rm.logLevel<=c.in.WARN){let n=t.map(rw);rm.warn(`Firestore (${rp}): ${e}`,...n)}}function rw(e){if("string"==typeof e)return e;try{return rg(e)}catch(t){return e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rT(e="Unexpected state"){let t=`FIRESTORE (${rp}) INTERNAL ASSERTION FAILED: `+e;throw rb(t),Error(t)}function rE(e,t){e||rT()}function rC(e,t){e||rT()}function rI(e,t){return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rk={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rR extends d.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rO{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rA{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(rd.UNAUTHENTICATED))}shutdown(){}}class rx{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rD{constructor(e){this.authProvider=e,this.currentUser=rd.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.tokenCounter,r=e=>this.tokenCounter!==n?(n=this.tokenCounter,t(e)):Promise.resolve(),i=new rO;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new rO,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{r_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.tokenListener),s()};this.authProvider.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?o(e):(r_("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rO)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(r_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(rE("string"==typeof t.accessToken),new rN(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return rE(null===e||"string"==typeof e),new rd(e)}}class rP{constructor(e,t,n){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=n,this.type="FirstParty",this.user=rd.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class rM{constructor(e,t,n){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=n}getToken(){return Promise.resolve(new rP(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(rd.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rL{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rF{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let n=e=>{null!=e.error&&r_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,r_("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{r_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?r(e):r_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(rE("string"==typeof e.token),this.latestAppCheckToken=e.token,new rL(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}}function rB(e){if(!e)return new rA;switch(e.type){case"firstParty":return new rM(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new rR(rk.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rj(e){return(0,p.randomBytes)(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rU{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="",r=20;for(;n.length<r;){let i=rj(40);for(let s=0;s<i.length;++s)n.length<r&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}}function rq(e,t){return e<t?-1:e>t?1:0}function rV(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function rz(e){return e+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rW=-62135596800,r$=1e6;class rG{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new rR(rk.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<rW||e>=253402300800)throw new rR(rk.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return rG.fromMillis(Date.now())}static fromDate(e){return rG.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*r$);return new rG(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/r$}_compareTo(e){return this.seconds===e.seconds?rq(this.nanoseconds,e.nanoseconds):rq(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds-rW).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rH{constructor(e){this.timestamp=e}static fromTimestamp(e){return new rH(e)}static min(){return new rH(new rG(0,0))}static max(){return new rH(new rG(253402300799,1e9-1))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rK="__name__";class rQ{constructor(e,t,n){void 0===t?t=0:t>e.length&&rT(),void 0===n?n=e.length-t:n>e.length-t&&rT(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===rQ.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof rQ?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.get(r),i=t.get(r);if(n<i)return -1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class rY extends rQ{construct(e,t,n){return new rY(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new rR(rk.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new rY(t)}static emptyPath(){return new rY([])}}let rJ=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rX extends rQ{construct(e,t,n){return new rX(e,t,n)}static isValidIdentifier(e){return rJ.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rX.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===rK}static keyField(){return new rX([rK])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new rR(rk.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new rR(rk.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if(!("\\"===t||"."===t||"`"===t))throw new rR(rk.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new rR(rk.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new rX(t)}static emptyPath(){return new rX([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rZ{constructor(e){this.path=e}static fromPath(e){return new rZ(rY.fromString(e))}static fromName(e){return new rZ(rY.fromString(e).popFirst(5))}static empty(){return new rZ(rY.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rY.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rY.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rZ(new rY(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r0=-1,r1=0;class r2{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function r3(e){return e.fields.find(e=>2===e.kind)}function r4(e){return e.fields.filter(e=>2!==e.kind)}function r6(e){let t=r4(e);return 0===t.length?0:t[t.length-1].kind}function r9(e,t){let n=rq(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=r8(e.fields[r],t.fields[r])))return n;return rq(e.fields.length,t.fields.length)}function r5(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}r2.UNKNOWN_ID=-1;class r7{constructor(e,t){this.fieldPath=e,this.kind=t}}function r8(e,t){let n=rX.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:rq(e.kind,t.kind)}class ie{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ie(r1,ii.min())}}function it(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new ii(rH.fromTimestamp(1e9===r?new rG(n+1,0):new rG(n,r)),rZ.empty(),t)}function ir(e){return new ii(e.readTime,e.key,r0)}class ii{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ii(rH.min(),rZ.empty(),r0)}static max(){return new ii(rH.max(),rZ.empty(),r0)}}function is(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=rZ.comparator(e.documentKey,t.documentKey))?n:rq(e.largestBatchId,t.largestBatchId)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let io="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ia{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function il(e){if(e.code===rk.FAILED_PRECONDITION&&e.message===io)r_("LocalStore","Unexpectedly lost primary lease");else throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&rT(),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new iu((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof iu)return t;return iu.resolve(t)}catch(e){return iu.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):iu.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):iu.reject(t)}static resolve(e){return new iu((t,n)=>{t(e)})}static reject(e){return new iu((t,n)=>{n(e)})}static waitFor(e){return new iu((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=iu.resolve(!1);for(let n of e)t=t.next(e=>e?iu.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new iu((n,r)=>{let i=e.length,s=Array(i),o=0;for(let a=0;a<i;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new iu((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ic="SimpleDb",ih=3;class id{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new rO,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new im(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let n=iS(t.target.error);this.completionDeferred.reject(new im(e,n))}}static open(e,t,n,r){try{return new id(t,e.transaction(r,n))}catch(e){throw new im(t,e)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(r_(ic,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new iv(this.transaction.objectStore(e))}}class ip{constructor(e,t,n){this.name=e,this.version=t,this.schemaConverter=n,12.2===ip.getIOSVersion((0,d.z$)())&&rb("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return r_(ic,"Removing database:",e),i_(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!(0,d.hl)())return!1;if(ip.isMockPersistence())return!0;let e=(0,d.z$)(),t=ip.getIOSVersion(e),n=0<t&&t<10,r=ip.getAndroidVersion(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!n&&!i}static isMockPersistence(){var e;return"undefined"!=typeof process&&(null===(e=process.env)||void 0===e?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}static getAndroidVersion(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}async ensureDb(e){return this.db||(r_(ic,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new im(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new rR(rk.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new rR(rk.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new im(e,r))},r.onupgradeneeded=e=>{r_(ic,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,r.transaction,e.oldVersion,this.version).next(()=>{r_(ic,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=id.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),iu.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(n){let e=n,t="FirebaseError"!==e.name&&s<ih;if(r_(ic,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ig{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return i_(this.dbCursor.delete())}}class im extends rR{constructor(e,t){super(rk.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function iy(e){return"IndexedDbTransactionError"===e.name}class iv{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(r_(ic,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(r_(ic,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),i_(n)}add(e){return r_(ic,"ADD",this.store.name,e,e),i_(this.store.add(e))}get(e){return i_(this.store.get(e)).next(t=>(void 0===t&&(t=null),r_(ic,"GET",this.store.name,e,t),t))}delete(e){return r_(ic,"DELETE",this.store.name,e),i_(this.store.delete(e))}count(){return r_(ic,"COUNT",this.store.name),i_(this.store.count())}loadAll(e,t){let n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){let e=this.cursor(n),t=[];return this.iterateCursor(e,(e,n)=>{t.push(n)}).next(()=>t)}{let e=this.store.getAll(n.range);return new iu((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}loadFirst(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new iu((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){r_(ic,"DELETE ALL",this.store.name);let n=this.options(e,t);n.keysOnly=!1;let r=this.cursor(n);return this.iterateCursor(r,(e,t,n)=>n.delete())}iterate(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.iterateCursor(r,t)}iterateSerial(e){let t=this.cursor({});return new iu((n,r)=>{t.onerror=e=>{r(iS(e.target.error))},t.onsuccess=t=>{let r=t.target.result;if(!r){n();return}e(r.primaryKey,r.value).next(e=>{e?r.continue():n()})}})}iterateCursor(e,t){let n=[];return new iu((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i){r();return}let s=new ig(i),o=t(i.primaryKey,i.value,s);if(o instanceof iu){let e=o.catch(e=>(s.done(),iu.reject(e)));n.push(e)}s.isDone?r():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>iu.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let n=this.store.index(e.index);return e.keysOnly?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}}}function i_(e){return new iu((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(iS(e.target.error))}})}let ib=!1;function iS(e){let t=ip.getIOSVersion((0,d.z$)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new rR("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ib||(ib=!0,setTimeout(()=>{throw e},0)),e}}return e}let iw="IndexBackiller",iT=15e3,iE=6e4,iC=50;class iI{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(iT)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){r_(iw,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();r_(iw,`Documents written: ${e}`)}catch(e){iy(e)?r_(iw,"Ignoring IndexedDB error during index backfill: ",e):await il(e)}await this.schedule(iE)})}}class ik{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=iC){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let n=new Set,r=t,i=!0;return iu.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||n.has(t)))return r_(iw,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}writeEntriesForCollectionGroup(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(r,n)).next(n=>(r_(iw,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}getNewOffset(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=ir(t);is(r,n)>0&&(n=r)}),new ii(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}iR.INVALID=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iO="\x01",iN="\x01",iA="\x10",ix="\x11";function iD(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=iM(t)),t=iP(e.get(n),t);return iM(t)}function iP(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+=iO+iA;break;case iO:n+=iO+ix;break;default:n+=r}}return n}function iM(e){return e+iO+iN}function iL(e){let t=e.length;if(rE(t>=2),2===t)return rE(e.charAt(0)===iO&&e.charAt(1)===iN),rY.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf(iO,s);switch((t<0||t>n)&&rT(),e.charAt(t+1)){case iN:let o;let a=e.substring(s,t);0===i.length?o=a:(i+=a,o=i,i=""),r.push(o);break;case iA:i+=e.substring(s,t)+"\0";break;case ix:i+=e.substring(s,t+1);break;default:rT()}s=t+2}return new rY(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iF="remoteDocuments",iB="owner",ij="owner",iU="mutationQueues",iq="userId",iV="mutations",iz="batchId",iW="userMutationsIndex",i$=["userId","batchId"];function iG(e){return[e]}function iH(e,t){return[e,iD(t)]}function iK(e,t,n){return[e,iD(t),n]}let iQ={},iY="documentMutations",iJ="remoteDocumentsV14",iX=["prefixPath","collectionGroup","readTime","documentId"],iZ="documentKeyIndex",i0=["prefixPath","collectionGroup","documentId"],i1="collectionGroupIndex",i2=["collectionGroup","readTime","prefixPath","documentId"],i3="remoteDocumentGlobal",i4="remoteDocumentGlobalKey",i6="targets",i9="targetId",i5="queryTargetsIndex",i7=["canonicalId","targetId"],i8="targetDocuments",se=["targetId","path"],st="documentTargetsIndex",sn=["path","targetId"],sr="targetGlobalKey",si="targetGlobal",ss="collectionParents",so=["collectionId","parent"],sa="clientMetadata",sl="clientId",su="bundles",sc="bundleId",sh="namedQueries",sd="name",sp="indexConfiguration",sf="indexId",sg="collectionGroupIndex",sm="collectionGroup",sy="indexState",sv=["indexId","uid"],s_="sequenceNumberIndex",sb=["uid","sequenceNumber"],sS="indexEntries",sw=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],sT="documentKeyIndex",sE=["indexId","uid","orderedDocumentKey"],sC="documentOverlays",sI=["userId","collectionPath","documentId"],sk="collectionPathOverlayIndex",sR=["userId","collectionPath","largestBatchId"],sO="collectionGroupOverlayIndex",sN=["userId","collectionGroup","largestBatchId"],sA=[iU,iV,iY,iF,i6,iB,si,i8,sa,i3,ss,su,sh],sx=[...sA,sC],sD=[iU,iV,iY,iJ,i6,iB,si,i8,sa,i3,ss,su,sh,sC],sP=sD,sM=[...sP,sp,sy,sS];function sL(e){return 15===e?sM:14===e?sP:13===e?sD:12===e?sx:11===e?sA:void rT()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sF extends ia{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function sB(e,t){let n=rI(e);return ip.getStore(n.simpleDbTransaction,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sj(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function sU(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function sq(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sV{constructor(e,t){this.comparator=e,this.root=t||sW.EMPTY}insert(e,t){return new sV(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sW.BLACK,null,null))}remove(e){return new sV(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sW.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sz(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sz(this.root,e,this.comparator,!1)}getReverseIterator(){return new sz(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sz(this.root,e,this.comparator,!0)}}class sz{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sW{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:sW.RED,this.left=null!=r?r:sW.EMPTY,this.right=null!=i?i:sW.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new sW(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return sW.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n;let r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return sW.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,sW.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,sW.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw rT();let e=this.left.check();if(e===this.right.check())return e+(this.isRed()?0:1);throw rT()}}sW.EMPTY=null,sW.RED=!0,sW.BLACK=!1;class s${constructor(){this.size=0}get key(){throw rT()}get value(){throw rT()}get color(){throw rT()}get left(){throw rT()}get right(){throw rT()}copy(e,t,n,r,i){return this}insert(e,t,n){return new sW(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}sW.EMPTY=new s$;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sG{constructor(e){this.comparator=e,this.data=new sV(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sH(this.data.getIterator())}getIteratorFrom(e){return new sH(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof sG)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new sG(this.comparator);return t.data=e,t}}class sH{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sK(e,t,n,r,i){let s=e.getIterator(),o=t.getIterator(),a=sQ(s),l=sQ(o);for(;a||l;){let e=!1,t=!1;if(a&&l){let r=n(a,l);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(l),l=sQ(o)):t?(i(a),a=sQ(s)):(a=sQ(s),l=sQ(o))}}function sQ(e){return e.hasNext()?e.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sY{constructor(e){this.fields=e,e.sort(rX.comparator)}static empty(){return new sY([])}unionWith(e){let t=new sG(rX.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new sY(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rV(this.fields,e.fields,(e,t)=>e.isEqual(t))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sJ(e){return Buffer.from(e,"base64").toString("binary")}function sX(e){return Buffer.from(e,"binary").toString("base64")}function sZ(){return!0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(e){this.binaryString=e}static fromBase64String(e){return new s0(sJ(e))}static fromUint8Array(e){return new s0(s1(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return sX(this.binaryString)}toUint8Array(){return s2(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rq(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function s1(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}function s2(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}s0.EMPTY_BYTE_STRING=new s0("");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let s3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function s4(e){if(rE(!!e),"string"==typeof e){let t=0,n=s3.exec(e);if(rE(!!n),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:s6(e.seconds),nanos:s6(e.nanos)}}function s6(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function s9(e){return"string"==typeof e?s0.fromBase64String(e):s0.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let s5="server_timestamp",s7="__type__",s8="__previous_value__",oe="__local_write_time__";function ot(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[s7])||void 0===n?void 0:n.stringValue)===s5}function on(e,t){let n={fields:{[s7]:{stringValue:s5},[oe]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ot(t)&&(t=or(t)),t&&(n.fields[s8]=t),{mapValue:n}}function or(e){let t=e.mapValue.fields[s8];return ot(t)?or(t):t}function oi(e){let t=s4(e.mapValue.fields[oe].timestampValue);return new rG(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(e,t,n,r,i,s,o,a,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l}}let oo="(default)";class oa{constructor(e,t){this.projectId=e,this.database=t||oo}static empty(){return new oa("","")}get isDefaultDatabase(){return this.database===oo}isEqual(e){return e instanceof oa&&e.projectId===this.projectId&&e.database===this.database}}function ol(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rR(rk.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oa(e.options.projectId,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ou=-1;function oc(e){return null==e}function oh(e){return 0===e&&1/e==-1/0}function od(e){return"number"==typeof e&&Number.isInteger(e)&&!oh(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let op="__max__",of={mapValue:{fields:{__type__:{stringValue:op}}}},og={nullValue:"NULL_VALUE"};function om(e){if("nullValue"in e)return 0;if("booleanValue"in e)return 1;if("integerValue"in e||"doubleValue"in e)return 2;if("timestampValue"in e)return 3;if("stringValue"in e)return 5;if("bytesValue"in e)return 6;if("referenceValue"in e)return 7;else if("geoPointValue"in e)return 8;else if("arrayValue"in e)return 9;else if(!("mapValue"in e))return rT();else return ot(e)?4:oX(e)?9007199254740991:10}function oy(e,t){if(e===t)return!0;let n=om(e);if(n!==om(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return oi(e).isEqual(oi(t));case 3:return ov(e,t);case 5:return e.stringValue===t.stringValue;case 6:return ob(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return o_(e,t);case 2:return oS(e,t);case 9:return rV(e.arrayValue.values||[],t.arrayValue.values||[],oy);case 10:return ow(e,t);default:return rT()}}function ov(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=s4(e.timestampValue),r=s4(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}function o_(e,t){return s6(e.geoPointValue.latitude)===s6(t.geoPointValue.latitude)&&s6(e.geoPointValue.longitude)===s6(t.geoPointValue.longitude)}function ob(e,t){return s9(e.bytesValue).isEqual(s9(t.bytesValue))}function oS(e,t){if("integerValue"in e&&"integerValue"in t)return s6(e.integerValue)===s6(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=s6(e.doubleValue),r=s6(t.doubleValue);return n===r?oh(n)===oh(r):isNaN(n)&&isNaN(r)}return!1}function ow(e,t){let n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(sj(n)!==sj(r))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!oy(n[e],r[e])))return!1;return!0}function oT(e,t){return void 0!==(e.values||[]).find(e=>oy(e,t))}function oE(e,t){if(e===t)return 0;let n=om(e),r=om(t);if(n!==r)return rq(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return rq(e.booleanValue,t.booleanValue);case 2:return oC(e,t);case 3:return oI(e.timestampValue,t.timestampValue);case 4:return oI(oi(e),oi(t));case 5:return rq(e.stringValue,t.stringValue);case 6:return oO(e.bytesValue,t.bytesValue);case 7:return ok(e.referenceValue,t.referenceValue);case 8:return oR(e.geoPointValue,t.geoPointValue);case 9:return oN(e.arrayValue,t.arrayValue);case 10:return oA(e.mapValue,t.mapValue);default:throw rT()}}function oC(e,t){let n=s6(e.integerValue||e.doubleValue),r=s6(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}function oI(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rq(e,t);let n=s4(e),r=s4(t),i=rq(n.seconds,r.seconds);return 0!==i?i:rq(n.nanos,r.nanos)}function ok(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=rq(n[e],r[e]);if(0!==t)return t}return rq(n.length,r.length)}function oR(e,t){let n=rq(s6(e.latitude),s6(t.latitude));return 0!==n?n:rq(s6(e.longitude),s6(t.longitude))}function oO(e,t){let n=s9(e),r=s9(t);return n.compareTo(r)}function oN(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=oE(n[e],r[e]);if(t)return t}return rq(n.length,r.length)}function oA(e,t){if(e===of.mapValue&&t===of.mapValue)return 0;if(e===of.mapValue)return 1;if(t===of.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=rq(r[e],s[e]);if(0!==t)return t;let o=oE(n[r[e]],i[s[e]]);if(0!==o)return o}return rq(r.length,s.length)}function ox(e){return oD(e)}function oD(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return oM(e.timestampValue);if("stringValue"in e)return e.stringValue;if("bytesValue"in e)return oP(e.bytesValue);else if("referenceValue"in e)return oF(e.referenceValue);else if("geoPointValue"in e)return oL(e.geoPointValue);else if("arrayValue"in e)return oj(e.arrayValue);else if("mapValue"in e)return oB(e.mapValue);else return rT()}function oP(e){return s9(e).toBase64()}function oM(e){let t=s4(e);return`time(${t.seconds},${t.nanos})`}function oL(e){return`geo(${e.latitude},${e.longitude})`}function oF(e){return rZ.fromName(e).toString()}function oB(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${oD(e.fields[i])}`;return n+"}"}function oj(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=oD(r);return t+"]"}function oU(e){switch(om(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=or(e);return t?16+oU(t):16;case 5:return 2*e.stringValue.length;case 6:return s9(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return oV(e.arrayValue);case 10:return oq(e.mapValue);default:throw rT()}}function oq(e){let t=0;return sU(e.fields,(e,n)=>{t+=e.length+oU(n)}),t}function oV(e){return(e.values||[]).reduce((e,t)=>e+oU(t),0)}function oz(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function oW(e){return!!e&&"integerValue"in e}function o$(e){return!!e&&"doubleValue"in e}function oG(e){return oW(e)||o$(e)}function oH(e){return!!e&&"arrayValue"in e}function oK(e){return!!e&&"nullValue"in e}function oQ(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function oY(e){return!!e&&"mapValue"in e}function oJ(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return sU(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=oJ(n)),t}{if(!e.arrayValue)return Object.assign({},e);let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=oJ(e.arrayValue.values[n]);return t}}function oX(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===op}function oZ(e){if("nullValue"in e)return og;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};if("bytesValue"in e)return{bytesValue:""};if("referenceValue"in e)return oz(oa.empty(),rZ.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if("mapValue"in e)return{mapValue:{}};else return rT()}function o0(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};if("bytesValue"in e)return oz(oa.empty(),rZ.empty());if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return{mapValue:{}};else if("mapValue"in e)return of;else return rT()}function o1(e,t){let n=oE(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function o2(e,t){let n=oE(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o3{constructor(e){this.value=e}static empty(){return new o3({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!oY(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=oJ(t)}setAll(e){let t=rX.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=oJ(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());oY(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return oy(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];oY(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(sU(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new o3(oJ(this.value))}}function o4(e){let t=[];return sU(e.fields,(e,n)=>{let r=new rX([e]);if(oY(n)){let e=o4(n.mapValue).fields;if(0===e.length)t.push(r);else for(let n of e)t.push(r.child(n))}else t.push(r)}),new sY(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o6{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new o6(e,0,rH.min(),rH.min(),rH.min(),o3.empty(),0)}static newFoundDocument(e,t,n,r){return new o6(e,1,t,rH.min(),n,r,0)}static newNoDocument(e,t){return new o6(e,2,t,rH.min(),rH.min(),o3.empty(),0)}static newUnknownDocument(e,t){return new o6(e,3,t,rH.min(),rH.min(),o3.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(rH.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=o3.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=o3.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rH.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof o6&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new o6(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function o9(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?oE(r,i):rT()}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5{constructor(e,t){this.position=e,this.inclusive=t}}function o7(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],o=e.position[i];if(r=s.field.isKeyField()?rZ.comparator(rZ.fromName(o.referenceValue),n.key):oE(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function o8(e,t,n){let r=o7(e,t,n);return e.inclusive?r>=0:r>0}function ae(e,t,n){let r=o7(e,t,n);return e.inclusive?r<=0:r<0}function at(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!oy(e.position[n],t.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e,t="asc"){this.field=e,this.dir=t}}function ar(e){return e.field.canonicalString()+e.dir}function ai(e){return`${e.field.canonicalString()} (${e.dir})`}function as(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{}class aa extends ao{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new aS(e,t,n):"array-contains"===t?new aC(e,n):"in"===t?new aI(e,n):"not-in"===t?new ak(e,n):"array-contains-any"===t?new aR(e,n):new aa(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new aw(e,n):new aT(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(oE(t,this.value)):null!==t&&om(this.value)===om(t)&&this.matchesComparison(oE(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return rT()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class al extends ao{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new al(e,t)}matches(e){return au(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){let e=this.findFirstMatchingFilter(e=>e.isInequality());return null!==e?e.field:null}findFirstMatchingFilter(e){for(let t of this.getFlattenedFilters())if(e(t))return t;return null}}function au(e){return"and"===e.op}function ac(e){return"or"===e.op}function ah(e){return ad(e)&&au(e)}function ad(e){for(let t of e.filters)if(t instanceof al)return!1;return!0}function ap(e){if(e instanceof aa)return e.field.canonicalString()+e.op.toString()+ox(e.value);if(ah(e))return e.filters.map(e=>ap(e)).join(",");{let t=e.filters.map(e=>ap(e)).join(",");return`${e.op}(${t})`}}function af(e,t){return e instanceof aa?ag(e,t):e instanceof al?am(e,t):void rT()}function ag(e,t){return t instanceof aa&&e.op===t.op&&e.field.isEqual(t.field)&&oy(e.value,t.value)}function am(e,t){return t instanceof al&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&af(n,t.filters[r]),!0)}function ay(e,t){let n=e.filters.concat(t);return al.create(n,e.op)}function av(e){return e instanceof aa?ab(e):e instanceof al?a_(e):"Filter"}function a_(e){return e.op.toString()+" {"+e.getFilters().map(av).join(" ,")+"}"}function ab(e){return`${e.field.canonicalString()} ${e.op} ${ox(e.value)}`}class aS extends aa{constructor(e,t,n){super(e,t,n),this.key=rZ.fromName(n.referenceValue)}matches(e){let t=rZ.comparator(e.key,this.key);return this.matchesComparison(t)}}class aw extends aa{constructor(e,t){super(e,"in",t),this.keys=aE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class aT extends aa{constructor(e,t){super(e,"not-in",t),this.keys=aE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function aE(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>rZ.fromName(e.referenceValue))}class aC extends aa{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return oH(t)&&oT(t.arrayValue,this.value)}}class aI extends aa{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&oT(this.value.arrayValue,t)}}class ak extends aa{constructor(e,t){super(e,"not-in",t)}matches(e){if(oT(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!oT(this.value.arrayValue,t)}}class aR extends aa{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!oH(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>oT(this.value.arrayValue,e))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.memoizedCanonicalId=null}}function aN(e,t=null,n=[],r=[],i=null,s=null,o=null){return new aO(e,t,n,r,i,s,o)}function aA(e){let t=rI(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:"+t.filters.map(e=>ap(e)).join(",")+"|ob:"+t.orderBy.map(e=>ar(e)).join(","),oc(t.limit)||(e+="|l:"+t.limit),t.startAt&&(e+="|lb:"+(t.startAt.inclusive?"b:":"a:")+t.startAt.position.map(e=>ox(e)).join(",")),t.endAt&&(e+="|ub:"+(t.endAt.inclusive?"a:":"b:")+t.endAt.position.map(e=>ox(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function ax(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>av(e)).join(", ")}]`),oc(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>ai(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+(e.startAt.inclusive?"b:":"a:")+e.startAt.position.map(e=>ox(e)).join(",")),e.endAt&&(t+=", endAt: "+(e.endAt.inclusive?"a:":"b:")+e.endAt.position.map(e=>ox(e)).join(",")),`Target(${t})`}function aD(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!as(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!af(e.filters[n],t.filters[n]))return!1;return!!(e.collectionGroup===t.collectionGroup&&e.path.isEqual(t.path)&&at(e.startAt,t.startAt))&&at(e.endAt,t.endAt)}function aP(e){return rZ.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function aM(e,t){return e.filters.filter(e=>e instanceof aa&&e.field.isEqual(t))}function aL(e,t){let n=r3(t);if(void 0===n)return null;for(let t of aM(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function aF(e,t){let n=new Map;for(let r of r4(t))for(let t of aM(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}function aB(e,t){let n=[],r=!0;for(let i of r4(t)){let t=0===i.kind?aU(e,i.fieldPath,e.startAt):aq(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new o5(n,r)}function aj(e,t){let n=[],r=!0;for(let i of r4(t)){let t=0===i.kind?aq(e,i.fieldPath,e.endAt):aU(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new o5(n,r)}function aU(e,t,n){let r=og,i=!0;for(let n of aM(e,t)){let e=og,t=!0;switch(n.op){case"<":case"<=":e=oZ(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=og}0>o1({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>o1({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function aq(e,t,n){let r=of,i=!0;for(let n of aM(e,t)){let e=of,t=!0;switch(n.op){case">=":case">":e=o0(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=of}o2({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];o2({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function aV(e){let t=new sG(rX.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}function az(e){return null!==e.limit}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aW{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt,this.endAt}}function a$(e,t,n,r,i,s,o,a){return new aW(e,t,n,r,i,s,o,a)}function aG(e){return new aW(e)}function aH(e,t){return new aW(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function aK(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function aQ(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function aY(e){for(let t of e.filters){let e=t.getFirstInequalityField();if(null!==e)return e}return null}function aJ(e){return new aW(rY.emptyPath(),e)}function aX(e){return rZ.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function aZ(e){return null!==e.collectionGroup}function a0(e){let t=rI(e);if(null===t.memoizedOrderBy){t.memoizedOrderBy=[];let e=aY(t),n=aQ(t);if(null!==e&&null===n)e.isKeyField()||t.memoizedOrderBy.push(new an(e)),t.memoizedOrderBy.push(new an(rX.keyField(),"asc"));else{let e=!1;for(let n of t.explicitOrderBy)t.memoizedOrderBy.push(n),n.field.isKeyField()&&(e=!0);if(!e){let e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.memoizedOrderBy.push(new an(rX.keyField(),e))}}}return t.memoizedOrderBy}function a1(e){let t=rI(e);if(!t.memoizedTarget){if("F"===t.limitType)t.memoizedTarget=aN(t.path,t.collectionGroup,a0(t),t.filters,t.limit,t.startAt,t.endAt);else{let e=[];for(let n of a0(t)){let t="desc"===n.dir?"asc":"desc";e.push(new an(n.field,t))}let n=t.endAt?new o5(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new o5(t.startAt.position,t.startAt.inclusive):null;t.memoizedTarget=aN(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}return t.memoizedTarget}function a2(e,t){t.getFirstInequalityField(),aY(e);let n=e.filters.concat([t]);return new aW(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function a3(e,t){let n=e.explicitOrderBy.concat([t]);return new aW(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function a4(e,t,n){return new aW(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function a6(e,t){return new aW(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function a9(e,t){return new aW(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function a5(e,t){return aD(a1(e),a1(t))&&e.limitType===t.limitType}function a7(e){return`${aA(a1(e))}|lt:${e.limitType}`}function a8(e){return`Query(target=${ax(a1(e))}; limitType=${e.limitType})`}function le(e,t){return t.isFoundDocument()&&lt(e,t)&&ln(e,t)&&lr(e,t)&&li(e,t)}function lt(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):rZ.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}function ln(e,t){for(let n of a0(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}function lr(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}function li(e,t){return(!e.startAt||!!ae(e.startAt,a0(e),t))&&(!e.endAt||!!o8(e.endAt,a0(e),t))}function ls(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function lo(e){return(t,n)=>{let r=!1;for(let i of a0(e)){let e=la(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function la(e,t,n){let r=e.field.isKeyField()?rZ.comparator(t.key,n.key):o9(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return rT()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r){this.inner[n]=[[e,t]],this.innerSize++;return}for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e)){r[n]=[e,t];return}r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){sU(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return sq(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lu=new sV(rZ.comparator);function lc(){return lu}let lh=new sV(rZ.comparator);function ld(...e){let t=lh;for(let n of e)t=t.insert(n.key,n);return t}function lp(){return ly()}function lf(e){let t=lh;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function lg(){return ly()}function lm(){return ly()}function ly(){return new ll(e=>e.toString(),(e,t)=>e.isEqual(t))}let lv=new sV(rZ.comparator);function l_(){return lv}let lb=new sG(rZ.comparator);function lS(...e){let t=lb;for(let n of e)t=t.add(n);return t}let lw=new sG(rq);function lT(){return lw}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lE(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:oh(t)?"-0":t}}function lC(e){return{integerValue:""+e}}function lI(e,t){return od(t)?lC(t):lE(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lk{constructor(){this._=void 0}}function lR(e,t,n){return e instanceof lx?on(n,t):e instanceof lD?lP(e,t):e instanceof lM?lL(e,t):lB(e,t)}function lO(e,t,n){return e instanceof lD?lP(e,t):e instanceof lM?lL(e,t):n}function lN(e,t){return e instanceof lF?oG(t)?t:{integerValue:0}:null}function lA(e,t){return e instanceof lD&&t instanceof lD||e instanceof lM&&t instanceof lM?rV(e.elements,t.elements,oy):e instanceof lF&&t instanceof lF?oy(e.operand,t.operand):e instanceof lx&&t instanceof lx}class lx extends lk{}class lD extends lk{constructor(e){super(),this.elements=e}}function lP(e,t){let n=lU(t);for(let t of e.elements)n.some(e=>oy(e,t))||n.push(t);return{arrayValue:{values:n}}}class lM extends lk{constructor(e){super(),this.elements=e}}function lL(e,t){let n=lU(t);for(let t of e.elements)n=n.filter(e=>!oy(e,t));return{arrayValue:{values:n}}}class lF extends lk{constructor(e,t){super(),this.serializer=e,this.operand=t}}function lB(e,t){let n=lN(e,t),r=lj(n)+lj(e.operand);return oW(n)&&oW(e.operand)?lC(r):lE(e.serializer,r)}function lj(e){return s6(e.integerValue||e.doubleValue)}function lU(e){return oH(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lq{constructor(e,t){this.field=e,this.transform=t}}function lV(e,t){return e.field.isEqual(t.field)&&lA(e.transform,t.transform)}function lz(e,t){return void 0===e&&void 0===t||!!e&&!!t&&rV(e,t,(e,t)=>lV(e,t))}class lW{constructor(e,t){this.version=e,this.transformResults=t}}class l${constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new l$}static exists(e){return new l$(void 0,e)}static updateTime(e){return new l$(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function lG(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class lH{}function lK(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new l7(e.key,l$.none()):new lZ(e.key,e.data,l$.none());{let n=e.data,r=o3.empty(),i=new sG(rX.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new l2(e.key,r,new sY(i.toArray()),l$.none())}}function lQ(e,t,n){e instanceof lZ?l0(e,t,n):e instanceof l2?l3(e,t,n):l8(e,t,n)}function lY(e,t,n,r){return e instanceof lZ?l1(e,t,n,r):e instanceof l2?l4(e,t,n,r):ue(e,t,n)}function lJ(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=lN(r.transform,e||null);null!=i&&(null===n&&(n=o3.empty()),n.set(r.field,i))}return n||null}function lX(e,t){return!!(e.type===t.type&&e.key.isEqual(t.key)&&e.precondition.isEqual(t.precondition)&&lz(e.fieldTransforms,t.fieldTransforms))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class lZ extends lH{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}function l0(e,t,n){let r=e.value.clone(),i=l9(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}function l1(e,t,n,r){if(!lG(e.precondition,t))return n;let i=e.value.clone(),s=l5(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class l2 extends lH{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function l3(e,t,n){if(!lG(e.precondition,t)){t.convertToUnknownDocument(n.version);return}let r=l9(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(l6(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}function l4(e,t,n,r){if(!lG(e.precondition,t))return n;let i=l5(e.fieldTransforms,r,t),s=t.data;return(s.setAll(l6(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function l6(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function l9(e,t,n){let r=new Map;rE(e.length===n.length);for(let i=0;i<n.length;i++){let s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,lO(o,a,n[i]))}return r}function l5(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,lR(e,s,t))}return r}class l7 extends lH{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function l8(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}function ue(e,t,n){return lG(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}class ut extends lH{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&lQ(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=lY(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=lY(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=lm();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,o=this.applyToLocalView(s,i.mutatedFields),a=lK(s,o=t.has(r.key)?null:o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(rH.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),lS())}isEqual(e){return this.batchId===e.batchId&&rV(this.mutations,e.mutations,(e,t)=>lX(e,t))&&rV(this.baseMutations,e.baseMutations,(e,t)=>lX(e,t))}}class ur{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){rE(e.mutations.length===n.length);let r=l_(),i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new ur(e,t,n,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(e,t){this.count=e,this.unchangedNames=t}}function uo(e){switch(e){case rk.OK:return rT();case rk.CANCELLED:case rk.UNKNOWN:case rk.DEADLINE_EXCEEDED:case rk.RESOURCE_EXHAUSTED:case rk.INTERNAL:case rk.UNAVAILABLE:case rk.UNAUTHENTICATED:return!1;case rk.INVALID_ARGUMENT:case rk.NOT_FOUND:case rk.ALREADY_EXISTS:case rk.PERMISSION_DENIED:case rk.FAILED_PRECONDITION:case rk.ABORTED:case rk.OUT_OF_RANGE:case rk.UNIMPLEMENTED:case rk.DATA_LOSS:return!0;default:return rT()}}function ua(e){return uo(e)&&e!==rk.ABORTED}function ul(e){if(void 0===e)return rb("GRPC error has no .code"),rk.UNKNOWN;switch(e){case o.OK:return rk.OK;case o.CANCELLED:return rk.CANCELLED;case o.UNKNOWN:return rk.UNKNOWN;case o.DEADLINE_EXCEEDED:return rk.DEADLINE_EXCEEDED;case o.RESOURCE_EXHAUSTED:return rk.RESOURCE_EXHAUSTED;case o.INTERNAL:return rk.INTERNAL;case o.UNAVAILABLE:return rk.UNAVAILABLE;case o.UNAUTHENTICATED:return rk.UNAUTHENTICATED;case o.INVALID_ARGUMENT:return rk.INVALID_ARGUMENT;case o.NOT_FOUND:return rk.NOT_FOUND;case o.ALREADY_EXISTS:return rk.ALREADY_EXISTS;case o.PERMISSION_DENIED:return rk.PERMISSION_DENIED;case o.FAILED_PRECONDITION:return rk.FAILED_PRECONDITION;case o.ABORTED:return rk.ABORTED;case o.OUT_OF_RANGE:return rk.OUT_OF_RANGE;case o.UNIMPLEMENTED:return rk.UNIMPLEMENTED;case o.DATA_LOSS:return rk.DATA_LOSS;default:return rT()}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(o||(o={}));/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return uh}static getOrCreateInstance(){return null===uh&&(uh=new uc),uh}onExistenceFilterMismatch(e){let t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let uh=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ud(){return new h.TextEncoder}function up(){return new h.TextDecoder("utf-8")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uf=new ra([4294967295,4294967295],0);function ug(e){let t=ud().encode(e),n=new ro;return n.update(t),new Uint8Array(n.digest())}function um(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new ra([n,r],0),new ra([i,s],0)]}class uy{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new uv(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new uv(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new uv(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=ra.fromNumber(this.bitCount)}getBitIndex(e,t,n){let r=e.add(t.multiply(ra.fromNumber(n)));return 1===r.compare(uf)&&(r=new ra([r.getBits(0),r.getBits(1)],0)),r.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,n]=um(ug(e));for(let e=0;e<this.hashCount;e++){let r=this.getBitIndex(t,n,e);if(!this.isBitSet(r))return!1}return!0}static create(e,t,n){let r=e%8==0?0:8-e%8,i=new uy(new Uint8Array(Math.ceil(e/8)),r,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,n]=um(ug(e));for(let e=0;e<this.hashCount;e++){let r=this.getBitIndex(t,n,e);this.setBit(r)}}setBit(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class uv extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u_{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,ub.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new u_(rH.min(),r,new sV(rq),lc(),lS())}}class ub{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ub(n,t,lS(),lS(),lS())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uS{constructor(e,t,n,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=n,this.newDoc=r}}class uw{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class uT{constructor(e,t,n=s0.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class uE{constructor(){this.pendingResponses=0,this.documentChanges=uR(),this._resumeToken=s0.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=lS(),t=lS(),n=lS();return this.documentChanges.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:rT()}}),new ub(this._resumeToken,this._current,e,t,n)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=uR()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let uC="WatchChangeAggregator";class uI{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=lc(),this.pendingDocumentTargetMapping=uk(),this.pendingTargetResets=new sV(rq)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let n=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&n.updateResumeToken(e.resumeToken);break;case 1:n.recordTargetResponse(),n.isPending||n.clearPendingChanges(),n.updateResumeToken(e.resumeToken);break;case 2:n.recordTargetResponse(),n.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(n.markCurrent(),n.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),n.updateResumeToken(e.resumeToken));break;default:rT()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,n)=>{this.isActiveTarget(n)&&t(n)})}handleExistenceFilter(e){var t;let n=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(n);if(i){let s=i.target;if(aP(s)){if(0===r){let e=new rZ(s.path);this.removeDocumentFromTarget(n,e,o6.newNoDocument(e,rH.min()))}else rE(1===r)}else{let i=this.getCurrentDocumentCountForTarget(n);if(i!==r){let r=this.applyBloomFilter(e,i);if(0!==r){this.resetTarget(n);let e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(n,e)}null===(t=uc.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(uO(r,i,e.existenceFilter))}}}}applyBloomFilter(e,t){let n,r;let{unchangedNames:i,count:s}=e.existenceFilter;if(!i||!i.bits)return 1;let{bits:{bitmap:o="",padding:a=0},hashCount:l=0}=i;try{n=s9(o).toUint8Array()}catch(e){if(e instanceof uu)return rS("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{r=new uy(n,a,l)}catch(e){return e instanceof uv?rS("BloomFilter error: ",e):rS("Applying bloom filter failed: ",e),1}return 0===r.bitCount?1:s!==t-this.filterRemovedDocuments(e.targetId,r)?2:0}filterRemovedDocuments(e,t){let n=this.metadataProvider.getRemoteKeysForTarget(e),r=0;return n.forEach(n=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;!t.mightContain(s)&&(this.removeDocumentFromTarget(e,n,null),r++)}),r}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((n,r)=>{let i=this.targetDataForActiveTarget(r);if(i){if(n.current&&aP(i.target)){let t=new rZ(i.target.path);null!==this.pendingDocumentUpdates.get(t)||this.targetContainsDocument(r,t)||this.removeDocumentFromTarget(r,t,o6.newNoDocument(t,e))}n.hasPendingChanges&&(t.set(r,n.toTargetChange()),n.clearPendingChanges())}});let n=lS();this.pendingDocumentTargetMapping.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.pendingDocumentUpdates.forEach((t,n)=>n.setReadTime(e));let r=new u_(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,n);return this.pendingDocumentUpdates=lc(),this.pendingDocumentTargetMapping=uk(),this.pendingTargetResets=new sV(rq),r}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let n=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,n){if(!this.isActiveTarget(e))return;let r=this.ensureTargetState(e);this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,n))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new uE,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new sG(rq),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||r_(uC,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new uE),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function uk(){return new sV(rZ.comparator)}function uR(){return new sV(rZ.comparator)}function uO(e,t,n){var r,i,s,o,a,l;let u={localCacheCount:t,existenceFilterCount:n.count},c=n.unchangedNames;return c&&(u.bloomFilter={applied:0===e,hashCount:null!==(r=null==c?void 0:c.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(o=null===(s=null===(i=null==c?void 0:c.bits)||void 0===i?void 0:i.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(l=null===(a=null==c?void 0:c.bits)||void 0===a?void 0:a.padding)&&void 0!==l?l:0}),u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uN=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),uA=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),ux=(()=>{let e={};return e.and="AND",e.or="OR",e})();class uD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function uP(e){return new rR(void 0===e.code?rk.UNKNOWN:ul(e.code),e.message||"")}function uM(e,t){return e.useProto3Json||oc(t)?t:{value:t}}function uL(e){let t;return oc(t="object"==typeof e?e.value:e)?null:t}function uF(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),n=("000000000"+t.nanoseconds).slice(-9);return`${e}.${n}Z`}}function uB(e){let t=s4(e);return new rG(t.seconds,t.nanos)}function uj(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function uU(e,t){return e.useProto3Json?(rE(void 0===t||"string"==typeof t),s0.fromBase64String(t||"")):(rE(void 0===t||t instanceof Uint8Array),s0.fromUint8Array(t||new Uint8Array))}function uq(e,t){return uF(e,t.toTimestamp())}function uV(e){return rE(!!e),rH.fromTimestamp(uB(e))}function uz(e,t){return uY(e).child("documents").child(t).canonicalString()}function uW(e){let t=rY.fromString(e);return rE(cq(t)),t}function u$(e,t){return uz(e.databaseId,t.path)}function uG(e,t){let n=uW(t);if(n.get(1)!==e.databaseId.projectId)throw new rR(rk.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new rR(rk.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new rZ(uJ(n))}function uH(e,t){return uz(e.databaseId,t)}function uK(e){let t=uW(e);return 4===t.length?rY.emptyPath():uJ(t)}function uQ(e){return new rY(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function uY(e){return new rY(["projects",e.projectId,"databases",e.database])}function uJ(e){return rE(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function uX(e,t,n){return{name:u$(e,t),fields:n.value.mapValue.fields}}function uZ(e,t){return{name:u$(e,t.key),fields:t.data.value.mapValue.fields,updateTime:uF(e,t.version.toTimestamp()),createTime:uF(e,t.createTime.toTimestamp())}}function u0(e,t,n){let r=uG(e,t.name),i=uV(t.updateTime),s=t.createTime?uV(t.createTime):rH.min(),o=new o3({mapValue:{fields:t.fields}}),a=o6.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function u1(e,t){rE(!!t.found),t.found.name,t.found.updateTime;let n=uG(e,t.found.name),r=uV(t.found.updateTime),i=t.found.createTime?uV(t.found.createTime):rH.min(),s=new o3({mapValue:{fields:t.found.fields}});return o6.newFoundDocument(n,r,i,s)}function u2(e,t){rE(!!t.missing),rE(!!t.readTime);let n=uG(e,t.missing),r=uV(t.readTime);return o6.newNoDocument(n,r)}function u3(e,t){return"found"in t?u1(e,t):"missing"in t?u2(e,t):rT()}function u4(e,t){let n;if("targetChange"in t){t.targetChange;let r=u6(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=uU(e,t.targetChange.resumeToken),o=t.targetChange.cause;n=new uT(r,i,s,o&&uP(o)||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=uG(e,r.document.name),s=uV(r.document.updateTime),o=r.document.createTime?uV(r.document.createTime):rH.min(),a=new o3({mapValue:{fields:r.document.fields}}),l=o6.newFoundDocument(i,s,o,a);n=new uS(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=uG(e,r.document),s=r.readTime?uV(r.readTime):rH.min(),o=o6.newNoDocument(i,s);n=new uS([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=uG(e,r.document);n=new uS([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return rT();t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new us(r,i);n=new uw(e.targetId,s)}return n}function u6(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:rT()}function u9(e){if(!("targetChange"in e))return rH.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?rH.min():uV(t.readTime)}function u5(e,t){let n;if(t instanceof lZ)n={update:uX(e,t.key,t.value)};else if(t instanceof l7)n={delete:u$(e,t.key)};else if(t instanceof l2)n={update:uX(e,t.key,t.data),updateMask:cj(t.fieldMask)};else{if(!(t instanceof ut))return rT();n={verify:u$(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(t=>cr(e,t))),t.precondition.isNone||(n.currentDocument=u8(e,t.precondition)),n}function u7(e,t){let n=t.currentDocument?ce(t.currentDocument):l$.none(),r=t.updateTransforms?t.updateTransforms.map(t=>ci(e,t)):[];if(t.update){t.update.name;let i=uG(e,t.update.name),s=new o3({mapValue:{fields:t.update.fields}});return t.updateMask?new l2(i,s,cU(t.updateMask),n,r):new lZ(i,s,n,r)}return t.delete?new l7(uG(e,t.delete),n):t.verify?new ut(uG(e,t.verify),n):rT()}function u8(e,t){return void 0!==t.updateTime?{updateTime:uq(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:rT()}function ce(e){return void 0!==e.updateTime?l$.updateTime(uV(e.updateTime)):void 0!==e.exists?l$.exists(e.exists):l$.none()}function ct(e,t){let n=e.updateTime?uV(e.updateTime):uV(t);return n.isEqual(rH.min())&&(n=uV(t)),new lW(n,e.transformResults||[])}function cn(e,t){return e&&e.length>0?(rE(void 0!==t),e.map(e=>ct(e,t))):[]}function cr(e,t){let n=t.transform;if(n instanceof lx)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof lD)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof lM)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof lF)return{fieldPath:t.field.canonicalString(),increment:n.operand};throw rT()}function ci(e,t){let n=null;return"setToServerValue"in t?(rE("REQUEST_TIME"===t.setToServerValue),n=new lx):"appendMissingElements"in t?n=new lD(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new lM(t.removeAllFromArray.values||[]):"increment"in t?n=new lF(e,t.increment):rT(),new lq(rX.fromServerFormat(t.fieldPath),n)}function cs(e,t){return{documents:[uH(e,t.path)]}}function co(e){return rE(1===e.documents.length),a1(aG(uK(e.documents[0])))}function ca(e,t){let n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=uH(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=uH(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);let i=cf(t.filters);i&&(n.structuredQuery.where=i);let s=cy(t.orderBy);s&&(n.structuredQuery.orderBy=s);let o=uM(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=c_(t.startAt)),t.endAt&&(n.structuredQuery.endAt=cb(t.endAt)),n}function cl(e,t,n){let r=ca(e,t),i={},s=[],o=0;return n.forEach(e=>{let t=`aggregate_${o++}`;i[t]=e.alias,"count"===e.aggregateType?s.push({alias:t,count:{}}):"avg"===e.aggregateType?s.push({alias:t,avg:{field:cO(e.fieldPath)}}):"sum"===e.aggregateType&&s.push({alias:t,sum:{field:cO(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:s,structuredQuery:r.structuredQuery},parent:r.parent},aliasMap:i}}function cu(e){let t=uK(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){rE(1===r);let e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=cg(n.where));let o=[];n.orderBy&&(o=cv(n.orderBy));let a=null;n.limit&&(a=uL(n.limit));let l=null;n.startAt&&(l=cS(n.startAt));let u=null;return n.endAt&&(u=cw(n.endAt)),a$(t,i,o,s,a,"F",l,u)}function cc(e){return a1(cu(e))}function ch(e,t){let n=cd(t.purpose);return null==n?null:{"goog-listen-tags":n}}function cd(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rT()}}function cp(e,t){let n;let r=t.target;if((n=aP(r)?{documents:cs(e,r)}:{query:ca(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=uj(e,t.resumeToken);let r=uM(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(rH.min())>0){n.readTime=uF(e,t.snapshotVersion.toTimestamp());let r=uM(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}function cf(e){if(0!==e.length)return cD(al.create(e,"and"))}function cg(e){let t=cm(e);return t instanceof al&&ah(t)?t.getFilters():[t]}function cm(e){return void 0!==e.unaryFilter?cL(e):void 0!==e.fieldFilter?cF(e):void 0!==e.compositeFilter?cB(e):rT()}function cy(e){if(0!==e.length)return e.map(e=>cA(e))}function cv(e){return e.map(e=>cx(e))}function c_(e){return{before:e.inclusive,values:e.position}}function cb(e){return{before:!e.inclusive,values:e.position}}function cS(e){let t=!!e.before;return new o5(e.values||[],t)}function cw(e){let t=!e.before;return new o5(e.values||[],t)}function cT(e){return uN[e]}function cE(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function cC(e){return uA[e]}function cI(e){return ux[e]}function ck(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return rT()}}function cR(e){switch(e){case"AND":return"and";case"OR":return"or";default:return rT()}}function cO(e){return{fieldPath:e.canonicalString()}}function cN(e){return rX.fromServerFormat(e.fieldPath)}function cA(e){return{field:cO(e.field),direction:cT(e.dir)}}function cx(e){return new an(cN(e.field),cE(e.direction))}function cD(e){return e instanceof aa?cM(e):e instanceof al?cP(e):rT()}function cP(e){let t=e.getFilters().map(e=>cD(e));return 1===t.length?t[0]:{compositeFilter:{op:cI(e.op),filters:t}}}function cM(e){if("=="===e.op){if(oQ(e.value))return{unaryFilter:{field:cO(e.field),op:"IS_NAN"}};if(oK(e.value))return{unaryFilter:{field:cO(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(oQ(e.value))return{unaryFilter:{field:cO(e.field),op:"IS_NOT_NAN"}};if(oK(e.value))return{unaryFilter:{field:cO(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cO(e.field),op:cC(e.op),value:e.value}}}function cL(e){switch(e.unaryFilter.op){case"IS_NAN":let t=cN(e.unaryFilter.field);return aa.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=cN(e.unaryFilter.field);return aa.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=cN(e.unaryFilter.field);return aa.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=cN(e.unaryFilter.field);return aa.create(i,"!=",{nullValue:"NULL_VALUE"});default:return rT()}}function cF(e){return aa.create(cN(e.fieldFilter.field),ck(e.fieldFilter.op),e.fieldFilter.value)}function cB(e){return al.create(e.compositeFilter.filters.map(e=>cm(e)),cR(e.compositeFilter.op))}function cj(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function cU(e){return new sY((e.fieldPaths||[]).map(e=>rX.fromServerFormat(e)))}function cq(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cV{constructor(e,t,n,r,i=rH.min(),s=rH.min(),o=s0.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new cV(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new cV(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cV(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cV(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cz{constructor(e){this.remoteSerializer=e}}function cW(e,t){let n;if(t.document)n=u0(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=rZ.fromSegments(t.noDocument.path),r=cQ(t.noDocument.readTime);n=o6.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return rT();let e=rZ.fromSegments(t.unknownDocument.path),r=cQ(t.unknownDocument.version);n=o6.newUnknownDocument(e,r)}return t.readTime&&n.setReadTime(cH(t.readTime)),n}function c$(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:cG(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=uZ(e.remoteSerializer,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:cK(t.version)};else{if(!t.isUnknownDocument())return rT();r.unknownDocument={path:n.path.toArray(),version:cK(t.version)}}return r}function cG(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function cH(e){let t=new rG(e[0],e[1]);return rH.fromTimestamp(t)}function cK(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function cQ(e){let t=new rG(e.seconds,e.nanoseconds);return rH.fromTimestamp(t)}function cY(e,t,n){let r=n.baseMutations.map(t=>u5(e.remoteSerializer,t)),i=n.mutations.map(t=>u5(e.remoteSerializer,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function cJ(e,t){let n=(t.baseMutations||[]).map(t=>u7(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){let r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}let r=t.mutations.map(t=>u7(e.remoteSerializer,t)),i=rG.fromMillis(t.localWriteTimeMs);return new un(t.batchId,i,n,r)}function cX(e){let t;let n=cQ(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?cQ(e.lastLimboFreeSnapshotVersion):rH.min();return new cV(t=c0(e.query)?co(e.query):cc(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,s0.fromBase64String(e.resumeToken))}function cZ(e,t){let n;let r=cK(t.snapshotVersion),i=cK(t.lastLimboFreeSnapshotVersion);n=aP(t.target)?cs(e.remoteSerializer,t.target):ca(e.remoteSerializer,t.target);let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:aA(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function c0(e){return void 0!==e.documents}function c1(e){return{id:e.bundleId,createTime:cQ(e.createTime),version:e.version}}function c2(e){return{bundleId:e.id,createTime:cK(uV(e.createTime)),version:e.version}}function c3(e){return{name:e.name,query:c6(e.bundledQuery),readTime:cQ(e.readTime)}}function c4(e){return{name:e.name,readTime:cK(uV(e.readTime)),bundledQuery:e.bundledQuery}}function c6(e){let t=cu({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?a4(t,t.limit,"L"):t}function c9(e){return{name:e.name,query:c6(e.bundledQuery),readTime:uV(e.readTime)}}function c5(e){return{id:e.id,version:e.version,createTime:uV(e.createTime)}}function c7(e,t){return new ui(t.largestBatchId,u7(e.remoteSerializer,t.overlayMutation))}function c8(e,t,n){let[r,i,s]=he(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:u5(e.remoteSerializer,n.mutation)}}function he(e,t){let n=t.path.lastSegment();return[e,iD(t.path.popLast()),n]}function ht(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function hn(e,t){let n=t?new ie(t.sequenceNumber,new ii(cQ(t.readTime),new rZ(iL(t.documentKey)),t.largestBatchId)):ie.empty(),r=e.fields.map(([e,t])=>new r7(rX.fromServerFormat(e),t));return new r2(e.indexId,e.collectionGroup,r,n)}function hr(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:cK(r.readTime),documentKey:iD(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi{getBundleMetadata(e,t){return hs(e).get(t).next(e=>{if(e)return c1(e)})}saveBundleMetadata(e,t){return hs(e).put(c2(t))}getNamedQuery(e,t){return ho(e).get(t).next(e=>{if(e)return c3(e)})}saveNamedQuery(e,t){return ho(e).put(c4(t))}}function hs(e){return sB(e,su)}function ho(e){return sB(e,sh)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new ha(e,t.uid||"")}getOverlay(e,t){return hl(e).get(he(this.userId,t)).next(e=>e?c7(this.serializer,e):null)}getOverlays(e,t){let n=lg();return iu.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new ui(t,i);r.push(this.saveOverlay(e,s))}),iu.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(iD(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(hl(e).deleteAll(sk,r))}),iu.waitFor(i)}getOverlaysForCollection(e,t,n){let r=lg(),i=iD(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return hl(e).loadAll(sk,s).next(e=>{for(let t of e){let e=c7(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i;let s=lg(),o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return hl(e).iterate({index:sO,range:o},(e,t,n)=>{let o=c7(this.serializer,t);s.size()<r||o.largestBatchId===i?(s.set(o.getKey(),o),i=o.largestBatchId):n.done()}).next(()=>s)}saveOverlay(e,t){return hl(e).put(c8(this.serializer,this.userId,t))}}function hl(e){return sB(e,sC)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hu=5,hc=10,hh=13,hd=15,hp=20,hf=25,hg=30,hm=37,hy=45,hv=50,h_=55,hb=60,hS=2;class hw{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,hu);else if("booleanValue"in e)this.writeValueTypeLabel(t,hc),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,hd),t.writeNumber(s6(e.integerValue));else if("doubleValue"in e){let n=s6(e.doubleValue);isNaN(n)?this.writeValueTypeLabel(t,hh):(this.writeValueTypeLabel(t,hd),oh(n)?t.writeNumber(0):t.writeNumber(n))}else if("timestampValue"in e){let n=e.timestampValue;this.writeValueTypeLabel(t,hp),"string"==typeof n?t.writeString(n):(t.writeString(`${n.seconds||""}`),t.writeNumber(n.nanos||0))}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,hg),t.writeBytes(s9(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.writeValueTypeLabel(t,hy),t.writeNumber(n.latitude||0),t.writeNumber(n.longitude||0)}else"mapValue"in e?oX(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):rT()}writeIndexString(e,t){this.writeValueTypeLabel(t,hf),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let n=e.fields||{};for(let e of(this.writeValueTypeLabel(t,h_),Object.keys(n)))this.writeIndexString(e,t),this.writeIndexValueAux(n[e],t)}writeIndexArray(e,t){let n=e.values||[];for(let e of(this.writeValueTypeLabel(t,hv),n))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,hm),rZ.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,hb),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(hS)}}hw.INSTANCE=new hw;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hT="\uD800",hE="\uDBFF",hC=0,hI=255,hk=1,hR=255,hO=255,hN=0,hA=64,hx=8,hD=1024;function hP(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function hM(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function hL(e){let t=0;for(let n=0;n<8;++n){let r=hM(255&e[n]);if(t+=r,8!==r)break}return t}function hF(e){return Math.ceil((hA-hL(e))/hx)}class hB{constructor(){this.buffer=new Uint8Array(hD),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.writeByteAscending(n.value),n=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.writeByteDescending(n.value),n=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<hT||hE<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<hT||hE<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),n=hF(t);this.ensureAvailable(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),n=hF(t);this.ensureAvailable(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(hR),this.writeEscapedByteAscending(hO)}writeInfinityDescending(){this.writeEscapedByteDescending(hR),this.writeEscapedByteDescending(hO)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=hP(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}writeByteAscending(e){let t=255&e;t===hC?(this.writeEscapedByteAscending(hC),this.writeEscapedByteAscending(hI)):t===hR?(this.writeEscapedByteAscending(hR),this.writeEscapedByteAscending(hN)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===hC?(this.writeEscapedByteDescending(hC),this.writeEscapedByteDescending(hI)):t===hR?(this.writeEscapedByteDescending(hR),this.writeEscapedByteDescending(hN)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(hC),this.writeEscapedByteAscending(hk)}writeSeparatorDescending(){this.writeEscapedByteDescending(hC),this.writeEscapedByteDescending(hk)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class hj{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class hU{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class hq{constructor(){this.orderedCode=new hB,this.ascending=new hj(this.orderedCode),this.descending=new hU(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hV{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}successor(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new hV(this.indexId,this.documentKey,this.arrayValue,n)}}function hz(e,t){let n=e.indexId-t.indexId;return 0!==n||0!==(n=hW(e.arrayValue,t.arrayValue))||0!==(n=hW(e.directionalValue,t.directionalValue))?n:rZ.comparator(e.documentKey,t.documentKey)}function hW(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h${constructor(e){for(let t of(this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){let e=t;e.isInequality()?this.inequalityFilter=e:this.equalityFilters.push(e)}}servedByIndex(e){rE(e.collectionGroup===this.collectionId);let t=r3(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let n=r4(e),r=new Set,i=0,s=0;for(;i<n.length;++i)if(this.hasMatchingEqualityFilter(n[i]))r=r.add(n[i].fieldPath.canonicalString());else break;if(i===n.length)return!0;if(void 0!==this.inequalityFilter){if(!r.has(this.inequalityFilter.field.canonicalString())){let e=n[i];if(!this.matchesFilter(this.inequalityFilter,e)||!this.matchesOrderBy(this.orderBys[s++],e))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hG(e){var t,n;if(rE(e instanceof aa||e instanceof al),e instanceof aa){if(!(e instanceof aI))return e;{let r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map(t=>aa.create(e.field,"==",t)))||[];return al.create(r,"or")}}let r=e.filters.map(e=>hG(e));return al.create(r,e.op)}function hH(e){if(0===e.getFilters().length)return[];let t=hX(hG(e));return(rE(hY(t)),hK(t)||hQ(t))?[t]:t.getFilters()}function hK(e){return e instanceof aa}function hQ(e){return e instanceof al&&ah(e)}function hY(e){return hK(e)||hQ(e)||hJ(e)}function hJ(e){if(e instanceof al&&ac(e)){for(let t of e.getFilters())if(!hK(t)&&!hQ(t))return!1;return!0}return!1}function hX(e){if(rE(e instanceof aa||e instanceof al),e instanceof aa)return e;if(1===e.filters.length)return hX(e.filters[0]);let t=e.filters.map(e=>hX(e)),n=al.create(t,e.op);return hY(n=h3(n))?n:(rE(n instanceof al),rE(au(n)),rE(n.filters.length>1),n.filters.reduce((e,t)=>hZ(e,t)))}function hZ(e,t){let n;return rE(e instanceof aa||e instanceof al),rE(t instanceof aa||t instanceof al),h3(n=e instanceof aa?t instanceof aa?h0(e,t):h2(e,t):t instanceof aa?h2(t,e):h1(e,t))}function h0(e,t){return al.create([e,t],"and")}function h1(e,t){if(rE(e.filters.length>0&&t.filters.length>0),au(e)&&au(t))return ay(e,t.getFilters());let n=ac(e)?e:t,r=ac(e)?t:e,i=n.filters.map(e=>hZ(e,r));return al.create(i,"or")}function h2(e,t){if(au(t))return ay(t,e.getFilters());{let n=t.filters.map(t=>hZ(e,t));return al.create(n,"or")}}function h3(e){if(rE(e instanceof aa||e instanceof al),e instanceof aa)return e;let t=e.getFilters();if(1===t.length)return h3(t[0]);if(ad(e))return e;let n=t.map(e=>h3(e)),r=[];return(n.forEach(t=>{t instanceof aa?r.push(t):t instanceof al&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length)?r[0]:al.create(r,e.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4{constructor(){this.collectionParentIndex=new h6}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),iu.resolve()}getCollectionParents(e,t){return iu.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return iu.resolve()}deleteFieldIndex(e,t){return iu.resolve()}getDocumentsMatchingTarget(e,t){return iu.resolve(null)}getIndexType(e,t){return iu.resolve(0)}getFieldIndexes(e,t){return iu.resolve([])}getNextCollectionGroupToUpdate(e){return iu.resolve(null)}getMinOffset(e,t){return iu.resolve(ii.min())}getMinOffsetFromCollectionGroup(e,t){return iu.resolve(ii.min())}updateCollectionGroup(e,t,n){return iu.resolve()}updateIndexEntries(e,t){return iu.resolve()}}class h6{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new sG(rY.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new sG(rY.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let h9="IndexedDbIndexManager",h5=new Uint8Array(0);class h7{constructor(e,t){this.user=e,this.databaseId=t,this.collectionParentsCache=new h6,this.targetToDnfSubTargets=new ll(e=>aA(e),(e,t)=>aD(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:n,parent:iD(r)};return h8(e).put(i)}return iu.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[rz(t),""],!1,!0);return h8(e).loadAll(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(iL(r.parent))}return n})}addFieldIndex(e,t){let n=dt(e),r=ht(t);delete r.indexId;let i=n.add(r);if(!t.indexState)return i.next();{let n=dn(e);return i.next(e=>{n.put(hr(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let n=dt(e),r=dn(e),i=de(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){let n=de(e),r=!0,i=new Map;return iu.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(!r)return iu.resolve(null);{let e=lS(),r=[];return iu.forEach(i,(i,s)=>{r_(h9,`Using index ${r5(i)} to execute ${aA(t)}`);let o=aL(s,i),a=aF(s,i),l=aB(s,i),u=aj(s,i),c=this.encodeBound(i,s,l),h=this.encodeBound(i,s,u),d=this.encodeValues(i,s,a),p=this.generateIndexRanges(i.indexId,o,c,l.inclusive,h,u.inclusive,d);return iu.forEach(p,i=>n.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let n=rZ.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:hH(al.create(e.filters,"and")).map(t=>aN(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,n,r,i,s,o){let a=(null!=t?t.length:1)*Math.max(n.length,i.length),l=a/(null!=t?t.length:1),u=[];for(let c=0;c<a;++c){let a=t?this.encodeSingleElement(t[c/l]):h5,h=this.generateLowerBound(e,a,n[c%l],r),d=this.generateUpperBound(e,a,i[c%l],s),p=o.map(t=>this.generateLowerBound(e,a,t,!0));u.push(...this.createRange(h,d,p))}return u}generateLowerBound(e,t,n,r){let i=new hV(e,rZ.empty(),t,n);return r?i:i.successor()}generateUpperBound(e,t,n,r){let i=new hV(e,rZ.empty(),t,n);return r?i.successor():i}getFieldIndex(e,t){let n=new h$(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.servedByIndex(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.getSubTargets(t);return iu.forEach(r,t=>this.getFieldIndex(e,t).next(e=>{e?0!==n&&e.fields.length<aV(t)&&(n=1):n=0})).next(()=>az(t)&&r.length>1&&2===n?1:n)}encodeDirectionalElements(e,t){let n=new hq;for(let r of r4(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.forKind(r.kind);hw.INSTANCE.writeIndexValue(e,i)}return n.encodedBytes()}encodeSingleElement(e){let t=new hq;return hw.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let n=new hq;return hw.INSTANCE.writeIndexValue(oz(this.databaseId,t),n.forKind(r6(e))),n.encodedBytes()}encodeValues(e,t,n){if(null===n)return[];let r=[];r.push(new hq);let i=0;for(let s of r4(e)){let e=n[i++];for(let n of r)if(this.isInFilter(t,s.fieldPath)&&oH(e))r=this.expandIndexValues(r,s,e);else{let t=n.forKind(s.kind);hw.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(r)}encodeBound(e,t,n){return this.encodeValues(e,t,n.position)}getEncodedBytes(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].encodedBytes();return t}expandIndexValues(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new hq;r.seed(n.encodedBytes()),hw.INSTANCE.writeIndexValue(e,r.forKind(t.kind)),i.push(r)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof aa&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=dt(e),r=dn(e);return(t?n.loadAll(sg,IDBKeyRange.bound(t,t)):n.loadAll()).next(e=>{let t=[];return iu.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(hn(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:rq(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=dt(e),i=dn(e);return this.getNextSequenceNumber(e).next(e=>r.loadAll(sg,IDBKeyRange.bound(t,t)).next(t=>iu.forEach(t,t=>i.put(hr(t.indexId,this.user,e,n)))))}updateIndexEntries(e,t){let n=new Map;return iu.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?iu.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),iu.forEach(i,n=>this.getExistingIndexEntries(e,t,n).next(t=>{let i=this.computeIndexEntries(r,n);return t.isEqual(i)?iu.resolve():this.updateEntries(e,r,n,t,i)}))))})}addIndexEntry(e,t,n,r){return de(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(n,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,n,r){return de(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.encodeDirectionalKey(n,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,n){let r=de(e),i=new sG(hz);return r.iterate({index:sT,range:IDBKeyRange.only([n.indexId,this.uid,this.encodeDirectionalKey(n,t)])},(e,r)=>{i=i.add(new hV(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}computeIndexEntries(e,t){let n=new sG(hz),r=this.encodeDirectionalElements(t,e);if(null==r)return n;let i=r3(t);if(null!=i){let s=e.data.field(i.fieldPath);if(oH(s))for(let i of s.arrayValue.values||[])n=n.add(new hV(t.indexId,e.key,this.encodeSingleElement(i),r))}else n=n.add(new hV(t.indexId,e.key,h5,r));return n}updateEntries(e,t,n,r,i){r_(h9,"Updating index entries for document '%s'",t.key);let s=[];return sK(r,i,hz,r=>{s.push(this.addIndexEntry(e,t,n,r))},r=>{s.push(this.deleteIndexEntry(e,t,n,r))}),iu.waitFor(s)}getNextSequenceNumber(e){let t=1;return dn(e).iterate({index:s_,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>hz(e,t)).filter((e,t,n)=>!t||0!==hz(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=hz(i,e),s=hz(i,t);if(0===n)r[0]=e.successor();else if(n>0&&s<0)r.push(i),r.push(i.successor());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.isRangeMatchable(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,h5,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,h5,[]];i.push(IDBKeyRange.bound(t,n))}return i}isRangeMatchable(e,t){return hz(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(dr)}getMinOffset(e,t){return iu.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||rT())).next(dr)}}function h8(e){return sB(e,ss)}function de(e){return sB(e,sS)}function dt(e){return sB(e,sp)}function dn(e){return sB(e,sy)}function dr(e){rE(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>is(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new ii(t.readTime,t.documentKey,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function di(e,t,n){let r=e.store(iV),i=e.store(iY),s=[],o=IDBKeyRange.only(n.batchId),a=0,l=r.iterate({range:o},(e,t,n)=>(a++,n.delete()));s.push(l.next(()=>{rE(1===a)}));let u=[];for(let e of n.mutations){let r=iK(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return iu.waitFor(s).next(()=>u)}function ds(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw rT();return JSON.stringify(t).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}static forUser(e,t,n,r){return rE(""!==e.uid),new da(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return dc(e).iterate({index:iW,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=dh(e),s=dc(e);return s.add({}).next(o=>{rE("number"==typeof o);let a=new un(o,t,n,r),l=cY(this.serializer,this.userId,a),u=[],c=new sG((e,t)=>rq(e.canonicalString(),t.canonicalString()));for(let e of r){let t=iK(this.userId,e.key.path,o);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,iQ))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[o]=a.keys()}),iu.waitFor(u).next(()=>a)})}lookupMutationBatch(e,t){return dc(e).get(t).next(e=>e?(rE(e.userId===this.userId),cJ(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?iu.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let n=e.keys();return this.documentKeysByBatchId[t]=n,n}})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return dc(e).iterate({index:iW,range:r},(e,t,r)=>{t.userId===this.userId&&(rE(t.batchId>=n),i=cJ(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=ou;return dc(e).iterate({index:iW,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,ou],[this.userId,Number.POSITIVE_INFINITY]);return dc(e).loadAll(iW,t).next(e=>e.map(e=>cJ(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=iH(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return dh(e).iterate({range:r},(n,r,s)=>{let[o,a,l]=n,u=iL(a);if(o!==this.userId||!t.path.isEqual(u)){s.done();return}return dc(e).get(l).next(e=>{if(!e)throw rT();rE(e.userId===this.userId),i.push(cJ(this.serializer,e))})}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new sG(rq),r=[];return t.forEach(t=>{let i=iH(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=dh(e).iterate({range:s},(e,r,i)=>{let[s,o,a]=e,l=iL(o);if(s!==this.userId||!t.path.isEqual(l)){i.done();return}n=n.add(a)});r.push(o)}),iu.waitFor(r).next(()=>this.lookupMutationBatches(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=iH(this.userId,n),s=IDBKeyRange.lowerBound(i),o=new sG(rq);return dh(e).iterate({range:s},(e,t,i)=>{let[s,a,l]=e,u=iL(a);if(s!==this.userId||!n.isPrefixOf(u)){i.done();return}u.length===r&&(o=o.add(l))}).next(()=>this.lookupMutationBatches(e,o))}lookupMutationBatches(e,t){let n=[],r=[];return t.forEach(t=>{r.push(dc(e).get(t).next(e=>{if(null===e)throw rT();rE(e.userId===this.userId),n.push(cJ(this.serializer,e))}))}),iu.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return di(e.simpleDbTransaction,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),iu.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return iu.resolve();let n=IDBKeyRange.lowerBound(iG(this.userId)),r=[];return dh(e).iterate({range:n},(e,t,n)=>{if(e[0]!==this.userId){n.done();return}{let t=iL(e[1]);r.push(t)}}).next(()=>{rE(0===r.length)})})}containsKey(e,t){return dl(e,this.userId,t)}getMutationQueueMetadata(e){return dd(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:ou,lastStreamToken:""})}}function dl(e,t,n){let r=iH(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return dh(e).iterate({range:s,keysOnly:!0},(e,n,r)=>{let[s,a,l]=e;s===t&&a===i&&(o=!0),r.done()}).next(()=>o)}function du(e,t){let n=!1;return dd(e).iterateSerial(r=>dl(e,r,t).next(e=>(e&&(n=!0),iu.resolve(!e)))).next(()=>n)}function dc(e){return sB(e,iV)}function dh(e){return sB(e,iY)}function dd(e){return sB(e,iU)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dp=2;class df{constructor(e){this.lastId=e}next(){return this.lastId+=dp,this.lastId}static forTargetCache(){return new df(2-dp)}static forSyncEngine(){return new df(1-dp)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let n=new df(t.highestTargetId);return t.highestTargetId=n.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>rH.fromTimestamp(new rG(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.retrieveMetadata(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.saveMetadata(e,r)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(n=>(n.targetCount+=1,this.updateMetadataFromTargetData(t,n),this.saveMetadata(e,n))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>dm(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(rE(t.targetCount>0),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,n){let r=0,i=[];return dm(e).iterate((s,o)=>{let a=cX(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))}).next(()=>iu.waitFor(i)).next(()=>r)}forEachTarget(e,t){return dm(e).iterate((e,n)=>{t(cX(n))})}retrieveMetadata(e){return dy(e).get(sr).next(e=>(rE(null!==e),e))}saveMetadata(e,t){return dy(e).put(sr,t)}saveTargetData(e,t){return dm(e).put(cZ(this.serializer,t))}updateMetadataFromTargetData(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let n=aA(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return dm(e).iterate({range:r,index:i5},(e,n,r)=>{let s=cX(n);aD(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=dv(e);return t.forEach(t=>{let s=iD(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),iu.waitFor(r)}removeMatchingKeys(e,t,n){let r=dv(e);return iu.forEach(t,t=>{let i=iD(t.path);return iu.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=dv(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=dv(e),i=lS();return r.iterate({range:n,keysOnly:!0},(e,t,n)=>{let r=new rZ(iL(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=iD(t.path),r=IDBKeyRange.bound([n],[rz(n)],!1,!0),i=0;return dv(e).iterate({index:st,keysOnly:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return dm(e).get(t).next(e=>e?cX(e):null)}}function dm(e){return sB(e,i6)}function dy(e){return sB(e,si)}function dv(e){return sB(e,i8)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let d_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},db=-1,dS=41943040;class dw{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new dw(e,dw.DEFAULT_COLLECTION_PERCENTILE,dw.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}dw.DEFAULT_COLLECTION_PERCENTILE=10,dw.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,dw.DEFAULT=new dw(dS,dw.DEFAULT_COLLECTION_PERCENTILE,dw.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),dw.DISABLED=new dw(db,0,0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dT="LruGarbageCollector",dE=1048576,dC=6e4,dI=3e5;function dk([e,t],[n,r]){let i=rq(e,n);return 0===i?rq(t,r):i}class dR{constructor(e){this.maxElements=e,this.buffer=new sG(dk),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>dk(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class dO{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==db&&this.scheduleGC(dC)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){r_(dT,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){iy(e)?r_(dT,"Ignoring IndexedDB error during garbage collection: ",e):await il(e)}await this.scheduleGC(dI)})}}class dN{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return iu.resolve(iR.INVALID);let n=new dR(t);return this.delegate.forEachTarget(e,e=>n.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>n.addElement(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.delegate.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===db?(r_("LruGarbageCollector","Garbage collection skipped; disabled"),iu.resolve(d_)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(r_("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),d_):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let n,r,i,s,o,a,l;let u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(r_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),ry()<=c.in.DEBUG&&r_("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in ${o-s}ms
	Removed ${i} targets in ${a-o}ms
	Removed ${e} documents in ${l-a}ms
Total Duration: ${l-u}ms`),iu.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}function dA(e,t){return new dN(e,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dx{constructor(e,t){this.db=e,this.garbageCollector=dA(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,n)=>t(n))}addReference(e,t,n){return dM(e,n)}removeReference(e,t,n){return dM(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return dM(e,t)}isPinned(e,t){return du(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.forEachOrphanedDocument(e,(s,o)=>{if(o<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,rH.min()),dv(e).delete(dD(s))))});r.push(t)}}).next(()=>iu.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return dM(e,t)}forEachOrphanedDocument(e,t){let n;let r=dv(e),i=iR.INVALID;return r.iterate({index:st},([e,r],{path:s,sequenceNumber:o})=>{0===e?(i!==iR.INVALID&&t(new rZ(iL(n)),i),i=o,n=s):i=iR.INVALID}).next(()=>{i!==iR.INVALID&&t(new rZ(iL(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function dD(e){return[0,iD(e.path)]}function dP(e,t){return{targetId:0,path:iD(e.path),sequenceNumber:t}}function dM(e,t){return dv(e).put(dP(t,e.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dL{constructor(){this.changes=new ll(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,o6.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?iu.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dF{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return dq(e).put(n)}removeEntry(e,t,n){return dq(e).delete(dz(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.setMetadata(e,n)))}getEntry(e,t){let n=o6.newInvalidDocument(t);return dq(e).iterate({index:iZ,range:IDBKeyRange.only(dV(t))},(e,r)=>{n=this.maybeDecodeDocument(t,r)}).next(()=>n)}getSizedEntry(e,t){let n={size:0,document:o6.newInvalidDocument(t)};return dq(e).iterate({index:iZ,range:IDBKeyRange.only(dV(t))},(e,r)=>{n={document:this.maybeDecodeDocument(t,r),size:ds(r)}}).next(()=>n)}getEntries(e,t){let n=lc();return this.forEachDbEntry(e,t,(e,t)=>{let r=this.maybeDecodeDocument(e,t);n=n.insert(e,r)}).next(()=>n)}getSizedEntries(e,t){let n=lc(),r=new sV(rZ.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);n=n.insert(e,i),r=r.insert(e,ds(t))}).next(()=>({documents:n,sizeMap:r}))}forEachDbEntry(e,t,n){if(t.isEmpty())return iu.resolve();let r=new sG(d$);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(dV(r.first()),dV(r.last())),s=r.getIterator(),o=s.getNext();return dq(e).iterate({index:iZ,range:i},(e,t,r)=>{let i=rZ.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&0>d$(o,i);)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.skip(dV(o)):r.done()}).next(()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r){let i=t.path,s=[i.popLast().toArray(),i.lastSegment(),cG(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return dq(e).loadAll(IDBKeyRange.bound(s,o,!0)).next(e=>{let n=lc();for(let i of e){let e=this.maybeDecodeDocument(rZ.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(le(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=lc(),s=dW(t,n),o=dW(t,ii.max());return dq(e).iterate({index:i1,range:IDBKeyRange.bound(s,o,!0)},(e,t,n)=>{let s=this.maybeDecodeDocument(rZ.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new dj(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return dU(e).get(i4).next(e=>(rE(!!e),e))}setMetadata(e,t){return dU(e).put(i4,t)}maybeDecodeDocument(e,t){if(t){let e=cW(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(rH.min())))return e}return o6.newInvalidDocument(e)}}function dB(e){return new dF(e)}class dj extends dL{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new ll(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new sG((e,t)=>rq(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let o=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,o.readTime)),s.isValidDocument()){let a=c$(this.documentCache.serializer,s);r=r.add(i.path.popLast());let l=ds(a);n+=l-o.size,t.push(this.documentCache.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){let n=c$(this.documentCache.serializer,s.convertToNoDocument(rH.min()));t.push(this.documentCache.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.documentCache.updateMetadata(e,n)),iu.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,n)=>{this.documentStates.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function dU(e){return sB(e,i3)}function dq(e){return sB(e,iJ)}function dV(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function dz(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],cG(t),n[n.length-1]]}function dW(e,t){let n=t.documentKey.path.toArray();return[e,cG(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function d$(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=rq(n[e],r[e]))return i;return(i=rq(n.length,r.length))||(i=rq(n[n.length-2],r[r.length-2]))?i:rq(n[n.length-1],r[r.length-1])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dG=15;/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dH{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dK{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&lY(n.mutation,e,sY.empty(),rG.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,lS()).next(()=>t))}getLocalViewOfDocuments(e,t,n=lS()){let r=lg();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=ld();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=lg();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,lS()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=lc(),s=ly(),o=lp();return t.forEach((e,t)=>{let o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof l2)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),lY(o.mutation,t,o.mutation.getFieldMask(),rG.now())):s.set(t.key,sY.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new dH(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){let n=ly(),r=new sV((e,t)=>e-t),i=lS();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||sY.empty();o=i.applyToLocalView(s,o),n.set(e,o);let a=(r.get(i.batchId)||lS()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{let s=[],o=r.getReverseIterator();for(;o.hasNext();){let r=o.getNext(),a=r.key,l=r.value,u=lm();l.forEach(e=>{if(!i.has(e)){let r=lK(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return iu.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n){return aX(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):aZ(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):iu.resolve(lg()),o=r0,a=i;return s.next(t=>iu.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t))?iu.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,lS())).next(e=>({batchId:o,changes:lf(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rZ(t)).next(e=>{let t=ld();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n){let r=t.collectionGroup,i=ld();return this.indexManager.getCollectionParents(e,r).next(s=>iu.forEach(s,s=>{let o=aH(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r))).next(e=>{r.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,o6.newInvalidDocument(r)))});let n=ld();return e.forEach((e,i)=>{let s=r.get(e);void 0!==s&&lY(s.mutation,i,sY.empty(),rG.now()),le(t,i)&&(n=n.insert(e,i))}),n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dQ{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return iu.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,c5(t)),iu.resolve()}getNamedQuery(e,t){return iu.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,c9(t)),iu.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dY{constructor(){this.overlays=new sV(rZ.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return iu.resolve(this.overlays.get(t))}getOverlays(e,t){let n=lg();return iu.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.saveOverlay(e,t,r)}),iu.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.overlayByBatchId.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(n)),iu.resolve()}getOverlaysForCollection(e,t,n){let r=lg(),i=t.length+1,s=new rZ(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return iu.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new sV((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=lg(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=lg(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return iu.resolve(o)}saveOverlay(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.overlayByBatchId.get(r.largestBatchId).delete(n.key);this.overlayByBatchId.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ui(t,n));let i=this.overlayByBatchId.get(t);void 0===i&&(i=lS(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dJ{constructor(){this.refsByKey=new sG(dX.compareByKey),this.refsByTarget=new sG(dX.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let n=new dX(e,t);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new dX(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new rZ(new rY([])),n=new dX(t,e),r=new dX(t,e+1),i=[];return this.refsByTarget.forEachInRange([n,r],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new rZ(new rY([])),n=new dX(t,e),r=new dX(t,e+1),i=lS();return this.refsByTarget.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new dX(e,0),n=this.refsByKey.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class dX{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return rZ.comparator(e.key,t.key)||rq(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return rq(e.targetOrBatchId,t.targetOrBatchId)||rZ.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dZ{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new sG(dX.compareByKey)}checkEmpty(e){return iu.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new un(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new dX(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return iu.resolve(s)}lookupMutationBatch(e,t){return iu.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=this.indexOfBatchId(n),i=r<0?0:r;return iu.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return iu.resolve(0===this.mutationQueue.length?ou:this.nextBatchId-1)}getAllMutationBatches(e){return iu.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new dX(t,0),r=new dX(t,Number.POSITIVE_INFINITY),i=[];return this.batchesByDocumentKey.forEachInRange([n,r],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),iu.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new sG(rq);return t.forEach(e=>{let t=new dX(e,0),r=new dX(e,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([t,r],e=>{n=n.add(e.targetOrBatchId)})}),iu.resolve(this.findMutationBatches(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;rZ.isDocumentKey(i)||(i=i.child(""));let s=new dX(new rZ(i),0),o=new sG(rq);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.targetOrBatchId)),!0)},s),iu.resolve(this.findMutationBatches(o))}findMutationBatches(e){let t=[];return e.forEach(e=>{let n=this.findMutationBatch(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){rE(0===this.indexOfExistingBatchId(t.batchId,"removed")),this.mutationQueue.shift();let n=this.batchesByDocumentKey;return iu.forEach(t.mutations,r=>{let i=new dX(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.batchesByDocumentKey=n})}removeCachedMutationKeys(e){}containsKey(e,t){let n=new dX(t,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return iu.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,iu.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d0(){return new sV(rZ.comparator)}class d1{constructor(e){this.sizer=e,this.docs=d0(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.sizer(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return iu.resolve(n?n.document.mutableCopy():o6.newInvalidDocument(t))}getEntries(e,t){let n=lc();return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():o6.newInvalidDocument(e))}),iu.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=lc(),s=t.path,o=new rZ(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=is(ir(o),n))&&(r.has(o.key)||le(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return iu.resolve(i)}getAllFromCollectionGroup(e,t,n,r){rT()}forEachDocumentKey(e,t){return iu.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new d3(this)}getSize(e){return iu.resolve(this.size)}}function d2(e){return new d1(e)}class d3 extends dL{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.documentCache.addEntry(e,r)):this.documentCache.removeEntry(n)}),iu.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4{constructor(e){this.persistence=e,this.targets=new ll(e=>aA(e),aD),this.lastRemoteSnapshotVersion=rH.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new dJ,this.targetCount=0,this.targetIdGenerator=df.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,n)=>t(n)),iu.resolve()}getLastRemoteSnapshotVersion(e){return iu.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return iu.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),iu.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),iu.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new df(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,iu.resolve()}updateTargetData(e,t){return this.saveTargetData(t),iu.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,iu.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.targets.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),iu.waitFor(i).next(()=>r)}getTargetCount(e){return iu.resolve(this.targetCount)}getTargetData(e,t){let n=this.targets.get(t)||null;return iu.resolve(n)}addMatchingKeys(e,t,n){return this.references.addReferences(t,n),iu.resolve()}removeMatchingKeys(e,t,n){this.references.removeReferences(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),iu.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),iu.resolve()}getMatchingKeysForTargetId(e,t){let n=this.references.referencesForId(t);return iu.resolve(n)}containsKey(e,t){return iu.resolve(this.references.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let d6="MemoryPersistence";class d9{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new iR(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new d4(this);let n=e=>this.referenceDelegate.documentSize(e);this.indexManager=new h4,this.remoteDocumentCache=d2(n),this.serializer=new cz(t),this.bundleCache=new dQ(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dY,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.mutationQueues[e.toKey()];return n||(n=new dZ(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=n),n}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,n){r_(d6,"Starting transaction:",e);let r=new d5(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(r).next(e=>this.referenceDelegate.onTransactionCommitted(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return iu.or(Object.values(this.mutationQueues).map(n=>()=>n.containsKey(e,t)))}}class d5 extends ia{constructor(e){super(),this.currentSequenceNumber=e}}class d7{constructor(e){this.persistence=e,this.localViewReferences=new dJ,this._orphanedDocuments=null}static factory(e){return new d7(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw rT()}addReference(e,t,n){return this.localViewReferences.addReference(n,t),this.orphanedDocuments.delete(n.toString()),iu.resolve()}removeReference(e,t,n){return this.localViewReferences.removeReference(n,t),this.orphanedDocuments.add(n.toString()),iu.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),iu.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return iu.forEach(this.orphanedDocuments,n=>{let r=rZ.fromPath(n);return this.isReferenced(e,r).next(e=>{e||t.removeEntry(r,rH.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return iu.or([()=>iu.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class d8{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new ll(e=>iD(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=dA(this,t)}static factory(e,t){return new d8(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return iu.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return iu.forEach(this.orphanedSequenceNumbers,(n,r)=>this.isPinned(e,n,r).next(e=>e?iu.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.forEachDocumentKey(e,r=>this.isPinned(e,r,t).next(e=>{e||(n++,i.removeEntry(r,rH.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),iu.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.orphanedSequenceNumbers.set(n,e.currentSequenceNumber),iu.resolve()}removeReference(e,t,n){return this.orphanedSequenceNumbers.set(n,e.currentSequenceNumber),iu.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),iu.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=oU(e.data.value)),t}isPinned(e,t,n){return iu.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return iu.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pe{constructor(e){this.serializer=e}createOrUpgrade(e,t,n,r){let i=new id("createOrUpgrade",t);n<1&&r>=1&&(pn(e),pr(e),pl(e),ps(e));let s=iu.resolve();return n<3&&r>=3&&(0!==n&&(pu(e),pl(e)),s=s.next(()=>ph(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>pi(e,i))),s=s.next(()=>{pd(e)})),n<5&&r>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),n<6&&r>=6&&(s=s.next(()=>(pa(e),this.addDocumentGlobal(i)))),n<7&&r>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),n<8&&r>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),n<9&&r>=9&&(s=s.next(()=>{pc(e)})),n<10&&r>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),n<11&&r>=11&&(s=s.next(()=>{pp(e),pf(e)})),n<12&&r>=12&&(s=s.next(()=>{pm(e)})),n<13&&r>=13&&(s=s.next(()=>po(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(iF))),n<14&&r>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),n<15&&r>=15&&(s=s.next(()=>pg(e))),s}addDocumentGlobal(e){let t=0;return e.store(iF).iterate((e,n)=>{t+=ds(n)}).next(()=>{let n={byteSize:t};return e.store(i3).put(i4,n)})}removeAcknowledgedMutations(e){let t=e.store(iU),n=e.store(iV);return t.loadAll().next(t=>iu.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,ou],[t.userId,t.lastAcknowledgedBatchId]);return n.loadAll(iW,r).next(n=>iu.forEach(n,n=>{rE(n.userId===t.userId);let r=cJ(this.serializer,n);return di(e,t.userId,r).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(i8),n=e.store(iF);return e.store(si).get(sr).next(e=>{let r=n=>t.put({targetId:0,path:iD(n),sequenceNumber:e.highestListenSequenceNumber}),i=[];return n.iterate((e,n)=>{let s=new rY(e),o=pt(s);i.push(t.get(o).next(e=>e?iu.resolve():r(s)))}).next(()=>iu.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(ss,{keyPath:so});let n=t.store(ss),r=new h6,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:iD(r)})}};return t.store(iF).iterate({keysOnly:!0},(e,t)=>i(new rY(e).popLast())).next(()=>t.store(iY).iterate({keysOnly:!0},([e,t,n],r)=>i(iL(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(i6);return t.iterate((e,n)=>{let r=cX(n),i=cZ(this.serializer,r);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let n=t.store(iF),r=[];return n.iterate((e,n)=>{let i=t.store(iJ),s=py(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))}).next(()=>iu.waitFor(r))}runOverlayMigration(e,t){let n=t.store(iV),r=dB(this.serializer),i=new d9(d7.factory,this.serializer.remoteSerializer);return n.loadAll().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:lS();cJ(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),iu.forEach(n,(e,n)=>{let s=new rd(n),o=ha.forUser(this.serializer,s),a=i.getIndexManager(s);return new dK(r,da.forUser(s,this.serializer,a,i.referenceDelegate),o,a).recalculateAndSaveOverlaysForDocumentKeys(new sF(t,iR.INVALID),e).next()})})}}function pt(e){return[0,iD(e)]}function pn(e){e.createObjectStore(iB)}function pr(e){e.createObjectStore(iU,{keyPath:iq}),e.createObjectStore(iV,{keyPath:iz,autoIncrement:!0}).createIndex(iW,i$,{unique:!0}),e.createObjectStore(iY)}function pi(e,t){return t.store(iV).loadAll().next(n=>{e.deleteObjectStore(iV),e.createObjectStore(iV,{keyPath:iz,autoIncrement:!0}).createIndex(iW,i$,{unique:!0});let r=t.store(iV),i=n.map(e=>r.put(e));return iu.waitFor(i)})}function ps(e){e.createObjectStore(iF)}function po(e){let t=e.createObjectStore(iJ,{keyPath:iX});t.createIndex(iZ,i0),t.createIndex(i1,i2)}function pa(e){e.createObjectStore(i3)}function pl(e){e.createObjectStore(i8,{keyPath:se}).createIndex(st,sn,{unique:!0}),e.createObjectStore(i6,{keyPath:i9}).createIndex(i5,i7,{unique:!0}),e.createObjectStore(si)}function pu(e){e.deleteObjectStore(i8),e.deleteObjectStore(i6),e.deleteObjectStore(si)}function pc(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function ph(e){let t=e.store(si),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rH.min().toTimestamp(),targetCount:0};return t.put(sr,n)}function pd(e){e.createObjectStore(sa,{keyPath:sl})}function pp(e){e.createObjectStore(su,{keyPath:sc})}function pf(e){e.createObjectStore(sh,{keyPath:sd})}function pg(e){e.createObjectStore(sp,{keyPath:sf,autoIncrement:!0}).createIndex(sg,sm,{unique:!1}),e.createObjectStore(sy,{keyPath:sv}).createIndex(s_,sb,{unique:!1}),e.createObjectStore(sS,{keyPath:sw}).createIndex(sT,sE,{unique:!1})}function pm(e){let t=e.createObjectStore(sC,{keyPath:sI});t.createIndex(sk,sR,{unique:!1}),t.createIndex(sO,sN,{unique:!1})}function py(e){return e.document?new rZ(rY.fromString(e.document.name).popFirst(5)):e.noDocument?rZ.fromSegments(e.noDocument.path):e.unknownDocument?rZ.fromSegments(e.unknownDocument.path):rT()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pv="IndexedDbPersistence",p_=18e5,pb=5e3,pS=4e3,pw="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",pT="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",pE="firestore_zombie",pC="main";class pI{constructor(e,t,n,r,i,s,o,a,l,u,c=dG){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.queue=i,this.window=s,this.document=o,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=e=>Promise.resolve(),!pI.isAvailable())throw new rR(rk.UNIMPLEMENTED,pT);this.referenceDelegate=new dx(this,r),this.dbName=t+pC,this.serializer=new cz(a),this.simpleDb=new ip(this.dbName,this.schemaVersion,new pe(this.serializer)),this.targetCache=new dg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=dB(this.serializer),this.bundleCache=new hi,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===u&&rb(pv,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new rR(rk.FAILED_PRECONDITION,pw);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new iR(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>pR(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(iy(e))return r_(pv,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return r_(pv,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return pk(e).get(ij).next(e=>iu.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return pR(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,p_)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=sB(e,sa);return t.loadAll().next(e=>{let n=this.filterActiveClients(e,p_),r=e.filter(e=>-1===n.indexOf(e));return iu.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",pS,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?iu.resolve(!0):pk(e).get(ij).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,pb)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new rR(rk.FAILED_PRECONDITION,pw);return!1}}return!!this.networkEnabled&&!!this.inForeground||pR(e).loadAll().next(e=>void 0===this.filterActiveClients(e,pb).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&r_(pv,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[iB,sa],e=>{let t=new sF(e,iR.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>pR(e).loadAll().next(e=>this.filterActiveClients(e,p_).map(e=>e.clientId)))}get started(){return this._started}getMutationQueue(e,t){return da.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new h7(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return ha.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,n){let r;r_(pv,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=sL(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(r=new sF(i,this.listenSequence?this.listenSequence.next():iR.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(r).next(e=>!!e||this.canActAsPrimary(r)).next(t=>{if(!t)throw rb(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new rR(rk.FAILED_PRECONDITION,io);return n(r)}).next(e=>this.acquireOrExtendPrimaryLease(r).next(()=>e)):this.verifyAllowTabSynchronization(r).next(()=>n(r))).then(e=>(r.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return pk(e).get(ij).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,pb)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new rR(rk.FAILED_PRECONDITION,pw)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return pk(e).put(ij,t)}static isAvailable(){return ip.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=pk(e);return t.get(ij).next(e=>this.isLocalClient(e)?(r_(pv,"Releasing primary lease."),t.delete(ij)):iu.resolve())}isWithinAge(e,t){let n=Date.now(),r=n-t,i=n;return!(e<r)&&(!(e>i)||(rb(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;(0,d.G6)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let n=(null===(t=this.webStorage)||void 0===t?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return r_(pv,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return rb(pv,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){rb("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${pE}_${this.persistenceKey}_${e}`}}function pk(e){return sB(e,iB)}function pR(e){return sB(e,sa)}function pO(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}async function pN(e){if(!ip.isAvailable())return Promise.resolve();let t=e+pC;await ip.delete(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pA(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,o=t.length,a=0,l=0;for(;a<o&&l<s;){let s=n(e[l],t[a]);s<0?i(e[l++]):s>0?r(t[a++]):(a++,l++)}for(;a<o;)r(t[a++]);for(;l<s;)i(e[l++])}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let px="LocalStore",pD=3e8;class pP{constructor(e,t,n,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new sV(rq),this.targetIdByTarget=new ll(e=>aA(e),aD),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(n)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dK(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function pM(e,t,n,r){return new pP(e,t,n,r)}async function pL(e,t){let n=rI(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.initializeUserComponents(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],o=lS();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return n.localDocuments.getDocuments(e,o).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function pF(e,t){let n,r;let i=rI(e),s=rG.now(),o=t.reduce((e,t)=>e.add(t.key),lS());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=lc(),l=lS();return i.remoteDocuments.getEntries(e,o).next(e=>{(a=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,a)).next(r=>{n=r;let o=[];for(let e of t){let t=lJ(e,n.get(e.key).overlayedDocument);null!=t&&o.push(new l2(e.key,t,o4(t.value.mapValue),l$.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,o,t)}).next(t=>{r=t;let s=t.applyToLocalDocumentSet(n,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:r.batchId,changes:lf(n)}))}function pB(e,t){let n=rI(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});return pZ(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,pj(t))).next(()=>n.localDocuments.getDocuments(e,r))})}function pj(e){let t=lS();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}function pU(e,t){let n=rI(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(rE(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}function pq(e){let t=rI(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}function pV(e){let t=rI(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function pz(e,t){let n=rI(e),r=t.snapshotVersion,i=n.targetDataByTarget;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=n.targetDataByTarget;let o=[];t.targetChanges.forEach((s,a)=>{let l=i.get(a);if(!l)return;o.push(n.targetCache.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.targetCache.addMatchingKeys(e,s.addedDocuments,a)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(s0.EMPTY_BYTE_STRING,rH.min()).withLastLimboFreeSnapshotVersion(rH.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),p$(l,u,s)&&o.push(n.targetCache.updateTargetData(e,u))});let a=lc(),l=lS();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(pW(e,s,t.documentUpdates).next(e=>{a=e.changedDocuments,l=e.existenceChangedKeys})),!r.isEqual(rH.min())){let t=n.targetCache.getLastRemoteSnapshotVersion(e).next(t=>n.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return iu.waitFor(o).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,l)).next(()=>a)}).then(e=>(n.targetDataByTarget=i,e))}function pW(e,t,n){let r=lS(),i=lS();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=lc();return n.forEach((n,s)=>{let o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(rH.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):r_(px,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{changedDocuments:r,existenceChangedKeys:i}})}function p$(e,t,n){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=pD)||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}async function pG(e,t){let n=rI(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>iu.forEach(t,t=>iu.forEach(t.addedKeys,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>iu.forEach(t.removedKeys,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(iy(e))r_(px,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=n.targetDataByTarget.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.targetDataByTarget=n.targetDataByTarget.insert(t,i)}}}function pH(e,t){let n=rI(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=ou),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function pK(e,t){let n=rI(e);return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}function pQ(e,t){let n=rI(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.targetCache.getTargetData(e,t).next(i=>i?(r=i,iu.resolve(r)):n.targetCache.allocateTargetId(e).next(i=>(r=new cV(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.targetCache.addTargetData(e,r).next(()=>r))))}).then(e=>{let r=n.targetDataByTarget.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.targetDataByTarget=n.targetDataByTarget.insert(e.targetId,e),n.targetIdByTarget.set(t,e.targetId)),e})}function pY(e,t,n){let r=rI(e),i=r.targetIdByTarget.get(n);return void 0!==i?iu.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(t,n)}async function pJ(e,t,n){let r=rI(e),i=r.targetDataByTarget.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(iy(e))r_(px,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}r.targetDataByTarget=r.targetDataByTarget.remove(t),r.targetIdByTarget.delete(i.target)}function pX(e,t,n){let r=rI(e),i=rH.min(),s=lS();return r.persistence.runTransaction("Execute query","readonly",e=>pY(r,e,a1(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(e,t,n?i:rH.min(),n?s:lS())).next(e=>(p6(r,ls(t),e),{documents:e,remoteKeys:s})))}function pZ(e,t,n,r){let i=n.batch,s=i.keys(),o=iu.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);rE(null!==s),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function p0(e,t){let n=rI(e),r=rI(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>r.lookupMutationKeys(e,t).next(t=>t?n.localDocuments.getDocuments(e,t):iu.resolve(null)))}function p1(e,t){rI(rI(e,pP).mutationQueue).removeCachedMutationKeys(t)}function p2(e){return rI(rI(e,pP).persistence).getActiveClients()}function p3(e,t){let n=rI(e),r=rI(n.targetCache),i=n.targetDataByTarget.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function p4(e,t){let n=rI(e),r=n.collectionGroupReadTime.get(t)||rH.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.remoteDocuments.getAllFromCollectionGroup(e,t,it(r,r0),Number.MAX_SAFE_INTEGER)).then(e=>(p6(n,t,e),e))}function p6(e,t,n){let r=e.collectionGroupReadTime.get(t)||rH.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.collectionGroupReadTime.set(t,r)}function p9(e){return a1(aG(rY.fromString(`__bundle__/docs/${e}`)))}async function p5(e,t,n,r){let i=rI(e),s=lS(),o=lc();for(let e of n){let n=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(n));let r=t.toMutableDocument(e);r.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),o=o.insert(n,r)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await pQ(i,p9(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>pW(e,a,o).next(t=>(a.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function p7(e,t){let n=rI(e),r=uV(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(r)>=0)}function p8(e,t){let n=rI(e);return n.persistence.runTransaction("Save bundle","readwrite",e=>n.bundleCache.saveBundleMetadata(e,t))}function fe(e,t){let n=rI(e);return n.persistence.runTransaction("Get named query","readonly",e=>n.bundleCache.getNamedQuery(e,t))}async function ft(e,t,n=lS()){let r=await pQ(e,a1(c6(t.bundledQuery))),i=rI(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=uV(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let o=r.withResumeToken(s0.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(o.targetId,o),i.targetCache.updateTargetData(e,o).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,r.targetId)).next(()=>i.targetCache.addMatchingKeys(e,n,r.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(){this.initialized=!1}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,n,r){return this.performQueryUsingIndex(e,t).next(i=>i||this.performQueryUsingRemoteKeys(e,t,r,n)).next(n=>n||this.executeFullCollectionScan(e,t))}performQueryUsingIndex(e,t){if(aK(t))return iu.resolve(null);let n=a1(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=a1(t=a4(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=lS(...r);return this.localDocumentsView.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.applyQuery(t,r);return this.needsRefill(t,s,i,n.readTime)?this.performQueryUsingIndex(e,a4(t,null,"F")):this.appendRemainingResults(e,s,t,n)}))})))}performQueryUsingRemoteKeys(e,t,n,r){return aK(t)||r.isEqual(rH.min())?this.executeFullCollectionScan(e,t):this.localDocumentsView.getDocuments(e,n).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,n,r)?this.executeFullCollectionScan(e,t):(ry()<=c.in.DEBUG&&r_("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),a8(t)),this.appendRemainingResults(e,s,t,it(r,r0)))})}applyQuery(e,t){let n=new sG(lo(e));return t.forEach((t,r)=>{le(e,r)&&(n=n.add(r))}),n}needsRefill(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}executeFullCollectionScan(e,t){return ry()<=c.in.DEBUG&&r_("QueryEngine","Using full collection scan to execute query:",a8(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,ii.min())}appendRemainingResults(e,t,n,r){return this.localDocumentsView.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fr="firestore_clients";function fi(e,t){return`${fr}_${e}_${t}`}let fs="firestore_mutations";function fo(e,t,n){let r=`${fs}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let fa="firestore_targets";function fl(e,t){return`${fa}_${e}_${t}`}let fu="firestore_online_state";function fc(e){return`${fu}_${e}`}let fh="firestore_bundle_loaded_v2";function fd(e){return`${fh}_${e}`}let fp="firestore_sequence_number";function ff(e){return`${fp}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fg="SharedClientState";class fm{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static fromWebStorageEntry(e,t,n){let r;let i=JSON.parse(n),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new rR(i.error.code,i.error.message)),s)?new fm(e,t,i.state,r):(rb(fg,`Failed to parse mutation state for ID '${t}': ${n}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class fy{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static fromWebStorageEntry(e,t){let n;let r=JSON.parse(t),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return(i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new rR(r.error.code,r.error.message)),i)?new fy(e,r.state,n):(rb(fg,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class fv{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=lT();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=od(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new fv(e,i):(rb(fg,`Failed to parse client data for instance '${e}': ${t}`),null)}}class f_{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new f_(t.clientId,t.onlineState):(rb(fg,`Failed to parse online state: ${e}`),null)}}class fb{constructor(){this.activeTargetIds=lT()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class fS{constructor(e,t,n,r,i){this.window=e,this.queue=t,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new sV(rq),this.started=!1,this.earlyEvents=[];let s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=fi(this.persistenceKey,this.localClientId),this.sequenceNumberKey=ff(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new fb),this.clientStateKeyRe=RegExp(`^${fr}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${fs}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${fa}_${s}_(\\d+)$`),this.onlineStateKey=fc(this.persistenceKey),this.bundleLoadedKey=fd(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(fi(this.persistenceKey,e));if(t){let n=fv.fromWebStorageEntry(e,t);n&&(this.activeClients=this.activeClients.insert(n.clientId,n))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,n){this.persistMutationState(e,t,n),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(fl(this.persistenceKey,e));if(n){let r=fy.fromWebStorageEntry(e,n);r&&(t=r.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(fl(this.persistenceKey,e))}updateQueryState(e,t,n){this.persistQueryTargetState(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return r_(fg,"READ",e,t),t}setItem(e,t){r_(fg,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){r_(fg,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(r_(fg,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){rb("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(async()=>{if(!this.started){this.earlyEvents.push(t);return}if(null!==t.key){if(this.clientStateKeyRe.test(t.key)){if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=fw(t.newValue);e!==iR.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,n){let r=new fm(this.currentUser,e,t,n),i=fo(this.persistenceKey,this.currentUser,e);this.setItem(i,r.toWebStorageJSON())}removeMutationState(e){let t=fo(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,n){let r=fl(this.persistenceKey,e),i=new fy(e,t,n);this.setItem(r,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let n=this.fromWebStorageClientStateKey(e);return fv.fromWebStorageEntry(n,t)}fromWebStorageMutationMetadata(e,t){let n=this.mutationBatchKeyRe.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return fm.fromWebStorageEntry(new rd(i),r,t)}fromWebStorageQueryTargetMetadata(e,t){let n=Number(this.queryTargetKeyRe.exec(e)[1]);return fy.fromWebStorageEntry(n,t)}fromWebStorageOnlineState(e){return f_.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){if(e.user.uid!==this.currentUser.uid){r_(fg,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let n=t?this.activeClients.insert(e,t):this.activeClients.remove(e),r=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.applyActiveTargetsChange(s,o).then(()=>{this.activeClients=n})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=lT();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}function fw(e){let t=iR.INVALID;if(null!=e)try{let n=JSON.parse(e);rE("number"==typeof n),t=n}catch(e){rb(fg,"Failed to read sequence number from WebStorage",e)}return t}class fT{constructor(){this.localState=new fb,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,n){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new fb,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fE{addCallback(e){}shutdown(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fI=null;function fk(){return 268435456+Math.round(2147483648*Math.random())}function fR(){return null===fI?fI=fk():fI++,"0x"+fI.toString(16)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fO(e){return new Promise((t,n)=>{e((e,r)=>{e?n(e):t(r)})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fN="1.7.3",fA="GrpcConnection",fx=`gl-node/${process.versions.node} fire/${rp} grpc/${fN}`;function fD(e,t,n,r){rE(null===t||"OAuth"===t.type);let i=new rl.SF;return t&&t.headers.forEach((e,t)=>i.set(t,e)),n&&n.headers.forEach((e,t)=>i.set(t,e)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",fx),i.set("Google-Cloud-Resource-Prefix",e),i.set("x-goog-request-params",e),i}class fP{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){r_(fA,"Creating Firestore stub.");let e=this.databaseInfo.ssl?rl.K9.createSsl():rl.K9.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,n,r,i){let s=fR(),o=this.ensureActiveStub(),a=fD(this.databasePath,r,i,this.databaseInfo.appId),l=Object.assign({database:this.databasePath},n);return fO(t=>(r_(fA,`RPC '${e}' ${s} invoked with request:`,n),o[e](l,a,(n,r)=>{n?(r_(fA,`RPC '${e}' ${s} failed with error:`,n),t(new rR(ul(n.code),n.message))):(r_(fA,`RPC '${e}' ${s} completed with response:`,r),t(void 0,r))})))}invokeStreamingRPC(e,t,n,r,i,s){let o=fR(),a=[],l=new rO;r_(fA,`RPC '${e}' ${o} invoked (streaming) with request:`,n);let u=this.ensureActiveStub(),c=fD(this.databasePath,r,i,this.databaseInfo.appId),h=Object.assign(Object.assign({},n),{database:this.databasePath}),d=u[e](h,c),p=!1;return d.on("data",t=>{r_(fA,`RPC ${e} ${o} received result:`,t),a.push(t),void 0!==s&&a.length===s&&(p=!0,l.resolve(a))}),d.on("end",()=>{r_(fA,`RPC '${e}' ${o} completed.`),p||(p=!0,l.resolve(a))}),d.on("error",t=>{r_(fA,`RPC '${e}' ${o} failed with error:`,t);let n=ul(t.code);l.reject(new rR(n,t.message))}),l.promise}openStream(e,t,n){let r=fR(),i=this.ensureActiveStub(),s=fD(this.databasePath,t,n,this.databaseInfo.appId),o=i[e](s),a=!1,l=e=>{a||(a=!0,u.callOnClose(e),o.end())},u=new fC({sendFn:t=>{if(a)r_(fA,`RPC '${e}' stream ${r} not sending because gRPC stream is closed:`,t);else{r_(fA,`RPC '${e}' stream ${r} sending:`,t);try{o.write(t)}catch(e){throw rb("Failure sending:",t),rb("Error:",e),e}}},closeFn:()=>{r_(fA,`RPC '${e}' stream ${r} closed locally via close().`),l()}});return o.on("data",t=>{a||(r_(fA,`RPC '${e}' stream ${r} received:`,t),u.callOnMessage(t))}),o.on("end",()=>{r_(fA,`RPC '${e}' stream ${r} ended.`),l()}),o.on("error",t=>{a||(rS(fA,`RPC '${e}' stream ${r} error. Code:`,t.code,"Message:",t.message),l(new rR(ul(t.code),t.message)))}),r_(fA,`Opening RPC '${e}' stream ${r} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}}let fM={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var fL={nested:fM},fF=Object.freeze({__proto__:null,nested:fM,default:fL});/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fB={longs:String,enums:String,defaults:!0,oneofs:!1};function fj(){let e=ru.im(fF,fB);return rl.Rz(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fU(e){return new fP(fj(),e)}function fq(){return new fE}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fV(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function fz(){return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fW(e){return new uD(e,!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let f$="ExponentialBackoff",fG=1e3,fH=1.5,fK=6e4;class fQ{constructor(e,t,n=fG,r=fH,i=fK){this.queue=e,this.timerId=t,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),n=Math.max(0,Date.now()-this.lastAttemptTime),r=Math.max(0,t-n);r>0&&r_(f$,`Backing off for ${r} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,r,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fY="PersistentStream",fJ=6e4,fX=1e4;class fZ{constructor(e,t,n,r,i,s,o,a){this.queue=e,this.idleTimerId=n,this.healthTimerId=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new fQ(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(4===this.state){this.performBackoff();return}this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,fJ,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===rk.RESOURCE_EXHAUSTED?(rb(t.toString()),rb("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===rk.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.closeCount===t&&this.startStream(e,n)},t=>{e(()=>{let e=new rR(rk.UNKNOWN,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onOpen(()=>{n(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,fX,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{n(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return r_(fY,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(r_(fY,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class f0 extends fZ{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=u4(this.serializer,e),n=u9(e);return this.listener.onWatchChange(t,n)}watch(e){let t={};t.database=uQ(this.serializer),t.addTarget=cp(this.serializer,e);let n=ch(this.serializer,e);n&&(t.labels=n),this.sendRequest(t)}unwatch(e){let t={};t.database=uQ(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class f1 extends fZ{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(rE(!!e.streamToken),this.lastStreamToken=e.streamToken,!this.handshakeComplete_)return rE(!e.writeResults||0===e.writeResults.length),this.handshakeComplete_=!0,this.listener.onHandshakeComplete();{this.backoff.reset();let t=cn(e.writeResults,e.commitTime),n=uV(e.commitTime);return this.listener.onMutationResult(n,t)}}writeHandshake(){let e={};e.database=uQ(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>u5(this.serializer,e))};this.sendRequest(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f2{}class f3 extends f2{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new rR(rk.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.invokeRPC(e,t,n,r,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===rk.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rR(rk.UNKNOWN,e.toString())})}invokeStreamingRPC(e,t,n,r){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeStreamingRPC(e,t,n,i,s,r)).catch(e=>{if("FirebaseError"===e.name)throw e.code===rk.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rR(rk.UNKNOWN,e.toString())})}terminate(){this.terminated=!0}}function f4(e,t,n,r){return new f3(e,t,n,r)}async function f6(e,t){let n=rI(e),r=uQ(n.serializer)+"/documents",i={writes:t.map(e=>u5(n.serializer,e))};await n.invokeRPC("Commit",r,i)}async function f9(e,t){let n=rI(e),r=uQ(n.serializer)+"/documents",i={documents:t.map(e=>u$(n.serializer,e))},s=await n.invokeStreamingRPC("BatchGetDocuments",r,i,t.length),o=new Map;s.forEach(e=>{let t=u3(n.serializer,e);o.set(t.key.toString(),t)});let a=[];return t.forEach(e=>{let t=o.get(e.toString());rE(!!t),a.push(t)}),a}async function f5(e,t,n){var r;let i=rI(e),{request:s,aliasMap:o}=cl(i.serializer,a1(t),n),a=s.parent;i.connection.shouldResourcePathBeIncludedInRequest||delete s.parent;let l=(await i.invokeStreamingRPC("RunAggregationQuery",a,s,1)).filter(e=>!!e.result);rE(1===l.length);let u=null===(r=l[0].result)||void 0===r?void 0:r.aggregateFields;return Object.keys(u).reduce((e,t)=>(e[o[t]]=u[t],e),{})}function f7(e,t,n){let r=rI(e);return r.verifyInitialized(),new f1(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}function f8(e,t,n){let r=rI(e);return r.verifyInitialized(),new f0(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ge="OnlineStateTracker",gt=1,gn=1e4;class gr{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",gn,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${gn/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=gt&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${gt} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(rb(t),this.shouldWarnClientIsOffline=!1):r_(ge,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gi="RemoteStore",gs=10;class go{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{n.enqueueAndForget(async()=>{g_(this)&&(r_(gi,"Restarting streams for network reachability change."),await gB(this))})}),this.onlineStateTracker=new gr(n,r)}}function ga(e,t,n,r,i){return new go(e,t,n,r,i)}function gl(e){let t=rI(e);return t.offlineCauses.delete(0),gu(t)}async function gu(e){if(g_(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function gc(e){let t=rI(e);t.offlineCauses.add(0),await gh(t),t.onlineStateTracker.set("Offline")}async function gh(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function gd(e){let t=rI(e);r_(gi,"RemoteStore shutting down."),t.offlineCauses.add(5),await gh(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function gp(e,t){let n=rI(e);!n.listenTargets.has(t.targetId)&&(n.listenTargets.set(t.targetId,t),gv(n)?gy(n):gq(n).isOpen()&&gg(n,t))}function gf(e,t){let n=rI(e),r=gq(n);n.listenTargets.delete(t),r.isOpen()&&gm(n,t),0===n.listenTargets.size&&(r.isOpen()?r.markIdle():g_(n)&&n.onlineStateTracker.set("Unknown"))}function gg(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(rH.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}gq(e).watch(t)}function gm(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),gq(e).unwatch(t)}function gy(e){e.watchChangeAggregator=new uI({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),gq(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function gv(e){return g_(e)&&!gq(e).isStarted()&&e.listenTargets.size>0}function g_(e){return 0===rI(e).offlineCauses.size}function gb(e){e.watchChangeAggregator=void 0}async function gS(e){e.listenTargets.forEach((t,n)=>{gg(e,t)})}async function gw(e,t){gb(e),gv(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),gy(e)):e.onlineStateTracker.set("Unknown")}async function gT(e,t,n){if(e.onlineStateTracker.set("Online"),t instanceof uT&&2===t.state&&t.cause){try{await gk(e,t)}catch(n){r_(gi,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await gE(e,n)}return}if(t instanceof uS?e.watchChangeAggregator.handleDocumentChange(t):t instanceof uw?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!n.isEqual(rH.min()))try{let t=await pV(e.localStore);n.compareTo(t)>=0&&await gI(e,n)}catch(t){r_(gi,"Failed to raise snapshot:",t),await gE(e,t)}}async function gE(e,t,n){if(iy(t))e.offlineCauses.add(1),await gh(e),e.onlineStateTracker.set("Offline"),n||(n=()=>pV(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{r_(gi,"Retrying IndexedDB access"),await n(),e.offlineCauses.delete(1),await gu(e)});else throw t}function gC(e,t){return t().catch(n=>gE(e,n,t))}function gI(e,t){let n=e.watchChangeAggregator.createRemoteEvent(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(r);i&&e.listenTargets.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.listenTargets.get(t);r&&(e.listenTargets.set(t,r.withResumeToken(s0.EMPTY_BYTE_STRING,r.snapshotVersion)),gm(e,t),gg(e,new cV(r.target,t,n,r.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(n)}async function gk(e,t){let n=t.cause;for(let r of t.targetIds)e.listenTargets.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.listenTargets.delete(r),e.watchChangeAggregator.removeTarget(r))}async function gR(e){let t=rI(e),n=gV(t),r=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:ou;for(;gO(t);)try{let e=await pH(t.localStore,r);if(null===e){0===t.writePipeline.length&&n.markIdle();break}r=e.batchId,gN(t,e)}catch(e){await gE(t,e)}gA(t)&&gx(t)}function gO(e){return g_(e)&&e.writePipeline.length<gs}function gN(e,t){e.writePipeline.push(t);let n=gV(e);n.isOpen()&&n.handshakeComplete&&n.writeMutations(t.mutations)}function gA(e){return g_(e)&&!gV(e).isStarted()&&e.writePipeline.length>0}function gx(e){gV(e).start()}async function gD(e){gV(e).writeHandshake()}async function gP(e){let t=gV(e);for(let n of e.writePipeline)t.writeMutations(n.mutations)}async function gM(e,t,n){let r=e.writePipeline.shift(),i=ur.from(r,t,n);await gC(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await gR(e)}async function gL(e,t){t&&gV(e).handshakeComplete&&await gF(e,t),gA(e)&&gx(e)}async function gF(e,t){if(ua(t.code)){let n=e.writePipeline.shift();gV(e).inhibitBackoff(),await gC(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await gR(e)}}async function gB(e){let t=rI(e);t.offlineCauses.add(4),await gh(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await gu(t)}async function gj(e,t){let n=rI(e);n.asyncQueue.verifyOperationInProgress(),r_(gi,"RemoteStore received new credentials");let r=g_(n);n.offlineCauses.add(3),await gh(n),r&&n.onlineStateTracker.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.offlineCauses.delete(3),await gu(n)}async function gU(e,t){let n=rI(e);t?(n.offlineCauses.delete(2),await gu(n)):t||(n.offlineCauses.add(2),await gh(n),n.onlineStateTracker.set("Unknown"))}function gq(e){return e.watchStream||(e.watchStream=f8(e.datastore,e.asyncQueue,{onOpen:gS.bind(null,e),onClose:gw.bind(null,e),onWatchChange:gT.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),gv(e)?gy(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),gb(e))})),e.watchStream}function gV(e){return e.writeStream||(e.writeStream=f7(e.datastore,e.asyncQueue,{onOpen:gD.bind(null,e),onClose:gL.bind(null,e),onHandshakeComplete:gP.bind(null,e),onMutationResult:gM.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await gR(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(r_(gi,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gz="AsyncQueue";class gW{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new rO,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){let s=new gW(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rR(rk.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function g$(e,t){if(rb(gz,`${t}: ${e}`),iy(e))return new rR(rk.UNAVAILABLE,`${t}: ${e}`);throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gG{constructor(e){e?this.comparator=(t,n)=>e(t,n)||rZ.comparator(t.key,n.key):this.comparator=(e,t)=>rZ.comparator(e.key,t.key),this.keyedMap=ld(),this.sortedSet=new sV(this.comparator)}static emptySet(e){return new gG(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gG)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new gG;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gH{constructor(){this.changeMap=new sV(rZ.comparator)}track(e){let t=e.doc.key,n=this.changeMap.get(t);if(!n){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===n.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==n.type?this.changeMap=this.changeMap.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):rT()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,n)=>{e.push(n)}),e}}class gK{constructor(e,t,n,r,i,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new gK(e,t,gG.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!a5(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gQ{constructor(){this.viewSnap=void 0,this.listeners=[]}}function gY(){return new gJ}class gJ{constructor(){this.queries=new ll(e=>a7(e),a5),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}}async function gX(e,t){let n=rI(e),r=t.query,i=!1,s=n.queries.get(r);if(s||(i=!0,s=new gQ),i)try{s.viewSnap=await n.onListen(r)}catch(n){let e=g$(n,`Initialization of query '${a8(t.query)}' failed`);t.onError(e);return}n.queries.set(r,s),s.listeners.push(t),t.applyOnlineStateChange(n.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&g6(n)}async function gZ(e,t){let n=rI(e),r=t.query,i=!1,s=n.queries.get(r);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function g0(e,t){let n=rI(e),r=!1;for(let e of t){let t=e.query,i=n.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(r=!0);i.viewSnap=e}}r&&g6(n)}function g1(e,t,n){let r=rI(e),i=r.queries.get(t);if(i)for(let e of i.listeners)e.onError(n);r.queries.delete(t)}function g2(e,t){let n=rI(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(let e of n.listeners)e.applyOnlineStateChange(t)&&(r=!0)}),r&&g6(n)}function g3(e,t){rI(e).snapshotsInSyncListeners.add(t),t.next()}function g4(e,t){rI(e).snapshotsInSyncListeners.delete(t)}function g6(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}class g9{constructor(e,t,n){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=n||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new gK(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache)return!0;let n="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=gK.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g5{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.addedKeys=n,this.removedKeys=r}static fromSnapshot(e,t){let n=lS(),r=lS();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new g5(e,t.fromCache,n,r)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g7{constructor(e){this.serializer=e}toDocumentKey(e){return uG(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?u0(this.serializer,e.document,!1):o6.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return uV(e)}}class g8{constructor(e,t,n){this.bundleMetadata=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=me(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let n=rY.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,n=new g7(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.toDocumentKey(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||lS()).add(e);t.set(n,r)}}return t}async complete(){let e=await p5(this.localStore,new g7(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let e of this.queries)await ft(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}}}function me(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function mt(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e){this.key=e}}class mr{constructor(e){this.key=e}}class mi{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=lS(),this.mutatedKeys=lS(),this.docComparator=lo(e),this.documentSet=new gG(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let n=t?t.changeSet:new gH,r=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1,a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),c=le(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),p=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(n.track({type:3,doc:c}),p=!0):!this.shouldWaitForSyncedDocument(u,c)&&(n.track({type:2,doc:c}),p=!0,(a&&this.docComparator(c,a)>0||l&&0>this.docComparator(c,l))&&(o=!0)):!u&&c?(n.track({type:0,doc:c}),p=!0):u&&!c&&(n.track({type:1,doc:u}),p=!0,(a||l)&&(o=!0)),p&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{documentSet:s,changeSet:n,needsRefill:o,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){let r=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let i=e.changeSet.getChanges();i.sort((e,t)=>ms(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(n);let s=t?this.updateLimboDocuments():[],o=0===this.limboDocuments.size&&this.current?1:0,a=o!==this.syncState;return(this.syncState=o,0!==i.length||a)?{snapshot:new gK(this.query,e.documentSet,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),limboChanges:s}:{limboChanges:s}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new gH,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=lS(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new mr(e))}),this.limboDocuments.forEach(n=>{e.has(n)||t.push(new mn(n))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=lS();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return gK.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function ms(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rT()}};return n(e)-n(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mo="SyncEngine";class ma{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ml{constructor(e){this.key=e,this.receivedDocument=!1}}class mu{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new ll(e=>a7(e),a5),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new sV(rZ.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new dJ,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=df.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function mc(e,t,n,r,i,s,o){let a=new mu(e,t,n,r,i,s);return o&&(a._isPrimaryClient=!0),a}async function mh(e,t){let n,r;let i=mW(e),s=i.queryViewsByQuery.get(t);if(s)n=s.targetId,i.sharedClientState.addLocalQueryTarget(n),r=s.view.computeInitialSnapshot();else{let e=await pQ(i.localStore,a1(t)),s=i.sharedClientState.addLocalQueryTarget(e.targetId);n=e.targetId,r=await md(i,t,n,"current"===s,e.resumeToken),i.isPrimaryClient&&gp(i.remoteStore,e)}return r}async function md(e,t,n,r,i){e.applyDocChanges=(t,n,r)=>mA(e,t,n,r);let s=await pX(e.localStore,t,!0),o=new mi(t,s.remoteKeys),a=o.computeDocChanges(s.documents),l=ub.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,l);mk(e,n,u.limboChanges);let c=new ma(t,n,o);return e.queryViewsByQuery.set(t,c),e.queriesByTarget.has(n)?e.queriesByTarget.get(n).push(t):e.queriesByTarget.set(n,[t]),u.snapshot}async function mp(e,t){let n=rI(e),r=n.queryViewsByQuery.get(t),i=n.queriesByTarget.get(r.targetId);if(i.length>1){n.queriesByTarget.set(r.targetId,i.filter(e=>!a5(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await pJ(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),gf(n.remoteStore,r.targetId),mC(n,r.targetId)}).catch(il)):(mC(n,r.targetId),await pJ(n.localStore,r.targetId,!0))}async function mf(e,t,n){let r=m$(e);try{let e=await pF(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),mT(r,e.batchId,n),await mN(r,e.changes),await gR(r.remoteStore)}catch(t){let e=g$(t,"Failed to persist write");n.reject(e)}}async function mg(e,t){let n=rI(e);try{let e=await pz(n.localStore,t);t.targetChanges.forEach((e,t)=>{let r=n.activeLimboResolutionsByTarget.get(t);r&&(rE(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.receivedDocument=!0:e.modifiedDocuments.size>0?rE(r.receivedDocument):e.removedDocuments.size>0&&(rE(r.receivedDocument),r.receivedDocument=!1))}),await mN(n,e,t)}catch(e){await il(e)}}function mm(e,t,n){let r=rI(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){let e=[];r.queryViewsByQuery.forEach((n,r)=>{let i=r.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),g2(r.eventManager,t),e.length&&r.syncEngineListener.onWatchChange(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function my(e,t,n){let r=rI(e);r.sharedClientState.updateQueryState(t,"rejected",n);let i=r.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new sV(rZ.comparator);e=e.insert(s,o6.newNoDocument(s,rH.min()));let n=lS().add(s),i=new u_(rH.min(),new Map,new sV(rq),e,n);await mg(r,i),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(t),mO(r)}else await pJ(r.localStore,t,!1).then(()=>mC(r,t,n)).catch(il)}async function mv(e,t){let n=rI(e),r=t.batch.batchId;try{let e=await pB(n.localStore,t);mE(n,r,null),mS(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await mN(n,e)}catch(e){await il(e)}}async function m_(e,t,n){let r=rI(e);try{let e=await pU(r.localStore,t);mE(r,t,n),mS(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await mN(r,e)}catch(e){await il(e)}}async function mb(e,t){let n=rI(e);g_(n.remoteStore)||r_(mo,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let e=await pq(n.localStore);if(e===ou){t.resolve();return}let r=n.pendingWritesCallbacks.get(e)||[];r.push(t),n.pendingWritesCallbacks.set(e,r)}catch(n){let e=g$(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function mS(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function mw(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new rR(rk.CANCELLED,t))})}),e.pendingWritesCallbacks.clear()}function mT(e,t,n){let r=e.mutationUserCallbacks[e.currentUser.toKey()];r||(r=new sV(rq)),r=r.insert(t,n),e.mutationUserCallbacks[e.currentUser.toKey()]=r}function mE(e,t,n){let r=rI(e),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function mC(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(r),n&&e.syncEngineListener.onWatchError(r,n);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||mI(e,t)})}function mI(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let n=e.activeLimboTargetsByKey.get(t);null!==n&&(gf(e.remoteStore,n),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(n),mO(e))}function mk(e,t,n){for(let r of n)r instanceof mn?(e.limboDocumentRefs.addReference(r.key,t),mR(e,r)):r instanceof mr?(r_(mo,"Document no longer in limbo: "+r.key),e.limboDocumentRefs.removeReference(r.key,t),e.limboDocumentRefs.containsKey(r.key)||mI(e,r.key)):rT()}function mR(e,t){let n=t.key,r=n.path.canonicalString();e.activeLimboTargetsByKey.get(n)||e.enqueuedLimboResolutions.has(r)||(r_(mo,"New document in limbo: "+n),e.enqueuedLimboResolutions.add(r),mO(e))}function mO(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let n=new rZ(rY.fromString(t)),r=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(r,new ml(n)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(n,r),gp(e.remoteStore,new cV(a1(aG(n.path)),r,"TargetPurposeLimboResolution",iR.INVALID))}}async function mN(e,t,n){let r=rI(e),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((e,a)=>{o.push(r.applyDocChanges(a,t,n).then(e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);let t=g5.fromSnapshot(a.targetId,e);s.push(t)}}))}),await Promise.all(o),r.syncEngineListener.onWatchChange(i),await pG(r.localStore,s))}async function mA(e,t,n,r){let i=t.view.computeDocChanges(n);i.needsRefill&&(i=await pX(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return mk(e,t.targetId,o.limboChanges),o.snapshot}async function mx(e,t){let n=rI(e);if(!n.currentUser.isEqual(t)){r_(mo,"User change. New user:",t.toKey());let e=await pL(n.localStore,t);n.currentUser=t,mw(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await mN(n,e.affectedDocuments)}}function mD(e,t){let n=rI(e),r=n.activeLimboResolutionsByTarget.get(t);if(r&&r.receivedDocument)return lS().add(r.key);{let e=lS(),r=n.queriesByTarget.get(t);if(!r)return e;for(let t of r){let r=n.queryViewsByQuery.get(t);e=e.unionWith(r.view.syncedDocuments)}return e}}async function mP(e,t){let n=rI(e),r=await pX(n.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(r);return n.isPrimaryClient&&mk(n,t.targetId,i.limboChanges),i}async function mM(e,t){let n=rI(e);return p4(n.localStore,t).then(e=>mN(n,e))}async function mL(e,t,n,r){let i=rI(e),s=await p0(i.localStore,t);if(null===s){r_(mo,"Cannot apply mutation batch with id: "+t);return}"pending"===n?await gR(i.remoteStore):"acknowledged"===n||"rejected"===n?(mE(i,t,r||null),mS(i,t),p1(i.localStore,t)):rT(),await mN(i,s)}async function mF(e,t){let n=rI(e);if(mW(n),m$(n),!0===t&&!0!==n._isPrimaryClient){let e=n.sharedClientState.getAllActiveQueryTargets(),t=await mj(n,e.toArray());for(let e of(n._isPrimaryClient=!0,await gU(n.remoteStore,!0),t))gp(n.remoteStore,e)}else if(!1===t&&!1!==n._isPrimaryClient){let e=[],t=Promise.resolve();n.queriesByTarget.forEach((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(mC(n,i),pJ(n.localStore,i,!0))),gf(n.remoteStore,i)}),await t,await mj(n,e),mB(n),n._isPrimaryClient=!1,await gU(n.remoteStore,!1)}}function mB(e){let t=rI(e);t.activeLimboResolutionsByTarget.forEach((e,n)=>{gf(t.remoteStore,n)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new sV(rZ.comparator)}async function mj(e,t,n){let r=rI(e),i=[],s=[];for(let e of t){let t;let n=r.queriesByTarget.get(e);if(n&&0!==n.length)for(let e of(t=await pQ(r.localStore,a1(n[0])),n)){let t=r.queryViewsByQuery.get(e),n=await mP(r,t);n.snapshot&&s.push(n.snapshot)}else{let n=await p3(r.localStore,e);t=await pQ(r.localStore,n),await md(r,mU(n),e,!1,t.resumeToken)}i.push(t)}return r.syncEngineListener.onWatchChange(s),i}function mU(e){return a$(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function mq(e){return p2(rI(e).localStore)}async function mV(e,t,n,r){let i=rI(e);if(i._isPrimaryClient){r_(mo,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{let e=await p4(i.localStore,ls(s[0])),r=u_.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,s0.EMPTY_BYTE_STRING);await mN(i,e,r);break}case"rejected":await pJ(i.localStore,t,!0),mC(i,t,r);break;default:rT()}}async function mz(e,t,n){let r=mW(e);if(r._isPrimaryClient){for(let e of t){if(r.queriesByTarget.has(e)){r_(mo,"Adding an already active target "+e);continue}let t=await p3(r.localStore,e),n=await pQ(r.localStore,t);await md(r,mU(t),n.targetId,!1,n.resumeToken),gp(r.remoteStore,n)}for(let e of n)r.queriesByTarget.has(e)&&await pJ(r.localStore,e,!1).then(()=>{gf(r.remoteStore,e),mC(r,e)}).catch(il)}}function mW(e){let t=rI(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=mg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=mD.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=my.bind(null,t),t.syncEngineListener.onWatchChange=g0.bind(null,t.eventManager),t.syncEngineListener.onWatchError=g1.bind(null,t.eventManager),t}function m$(e){let t=rI(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=mv.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=m_.bind(null,t),t}function mG(e,t,n){let r=rI(e);mH(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}async function mH(e,t,n){try{let r=await t.getMetadata();if(await p7(e.localStore,r))return await t.close(),n._completeWith(mt(r)),Promise.resolve(new Set);n._updateProgress(me(r));let i=new g8(r,e.localStore,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&n._updateProgress(e),s=await t.nextElement()}let o=await i.complete();return await mN(e,o.changedDocs,void 0),await p8(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.changedCollectionGroups)}catch(e){return rS(mo,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mK{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=fW(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return pM(this.persistence,new fn,e.initialUser,this.serializer)}createPersistence(e){return new d9(d7.factory,this.serializer)}createSharedClientState(e){return new fT}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class mQ extends mK{constructor(e,t,n){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await m$(this.onlineComponentProvider.syncEngine),await gR(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return pM(this.persistence,new fn,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new dO(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new ik(t,this.persistence);return new iI(e.asyncQueue,n)}createPersistence(e){let t=pO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?dw.withCacheSize(this.cacheSizeBytes):dw.DEFAULT;return new pI(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,fV(),fz(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new fT}}class mY extends mQ{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof fS&&(this.sharedClientState.syncEngine={applyBatchState:mL.bind(null,t),applyTargetState:mV.bind(null,t),applyActiveTargetsChange:mz.bind(null,t),getActiveClients:mq.bind(null,t),synchronizeWithChangedDocuments:mM.bind(null,t)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async e=>{await mF(this.onlineComponentProvider.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=fV();if(!fS.isAvailable(t))throw new rR(rk.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=pO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new fS(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class mJ{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>mm(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=mx.bind(null,this.syncEngine),await gU(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return gY()}createDatastore(e){let t=fW(e.databaseInfo.databaseId),n=fU(e.databaseInfo);return f4(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return ga(this.localStore,this.datastore,e.asyncQueue,e=>mm(this.syncEngine,e,0),fq())}createSyncEngine(e,t){return mc(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return gd(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mX=10240;function mZ(e,t=mX){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m0(e,t,n){if(!n)throw new rR(rk.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function m1(e,t,n,r){if(!0===t&&!0===r)throw new rR(rk.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function m2(e){if(!rZ.isDocumentKey(e))throw new rR(rk.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function m3(e){if(rZ.isDocumentKey(e))throw new rR(rk.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function m4(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function m6(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{let t=m9(e);return t?`a custom ${t} object`:"an object"}}if("function"==typeof e)return"a function";return rT()}function m9(e){return e.constructor?e.constructor.name:null}function m5(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new rR(rk.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=m6(e);throw new rR(rk.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function m7(e,t){if(t<=0)throw new rR(rk.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m8(e,t){if(!(e instanceof Uint8Array))throw new rR(rk.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${m6(e)}`);return mZ(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):rb("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new rO,this.buffer=new Uint8Array,this.textDecoder=up(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),n=Number(t);return isNaN(n)&&this.raiseError(`length string (${t}) is not valid number`),new yt(JSON.parse(await this.readJsonString(n)),e.length+n)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function yr(e,t){return new yn(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yi{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new rR(rk.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");let t=await f9(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new l7(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=rZ.fromPath(t);this.mutations.push(new ut(n,this.precondition(n)))}),await f6(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=rH.min();else throw rT();let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new rR(rk.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?l$.none():t.isEqual(rH.min())?l$.exists(!1):l$.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return l$.exists(!0);if(t.isEqual(rH.min()))throw new rR(rk.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return l$.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.attemptsRemaining=n.maxAttempts,this.backoff=new fQ(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let e=new yi(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.handleTransactionError(e)}))}).catch(e=>{this.handleTransactionError(e)})})}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);if(oc(t)||!t.catch||!t.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return t}catch(e){return this.deferred.reject(e),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!uo(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yo="FirestoreClient",ya=100,yl=11,yu=20,yc=22;class yh{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=rd.UNAUTHENTICATED,this.clientId=rU.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{r_(yo,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(r_(yo,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:ya}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new rR(rk.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rO;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=g$(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function yd(e,t){e.asyncQueue.verifyOperationInProgress(),r_(yo,"Initializing OfflineComponentProvider");let n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await pL(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function yp(e,t){e.asyncQueue.verifyOperationInProgress();let n=await yg(e);r_(yo,"Initializing OnlineComponentProvider");let r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>gj(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>gj(t.remoteStore,n)),e._onlineComponents=t}function yf(e){return"FirebaseError"===e.name?e.code===rk.FAILED_PRECONDITION||e.code===rk.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||e.code===yc||e.code===yu||e.code===yl}async function yg(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){r_(yo,"Using user provided OfflineComponentProvider");try{await yd(e,e._uninitializedComponentsProvider._offline)}catch(n){let t=n;if(!yf(t))throw t;rS("Error using user provided cache. Falling back to memory cache: "+t),await yd(e,new mK)}}else r_(yo,"Using default OfflineComponentProvider"),await yd(e,new mK)}return e._offlineComponents}async function ym(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(r_(yo,"Using user provided OnlineComponentProvider"),await yp(e,e._uninitializedComponentsProvider._online)):(r_(yo,"Using default OnlineComponentProvider"),await yp(e,new mJ))),e._onlineComponents}function yy(e){return yg(e).then(e=>e.persistence)}function yv(e){return yg(e).then(e=>e.localStore)}function y_(e){return ym(e).then(e=>e.remoteStore)}function yb(e){return ym(e).then(e=>e.syncEngine)}function yS(e){return ym(e).then(e=>e.datastore)}async function yw(e){let t=await ym(e),n=t.eventManager;return n.onListen=mh.bind(null,t.syncEngine),n.onUnlisten=mp.bind(null,t.syncEngine),n}function yT(e){return e.asyncQueue.enqueue(async()=>{let t=await yy(e),n=await y_(e);return t.setNetworkEnabled(!0),gl(n)})}function yE(e){return e.asyncQueue.enqueue(async()=>{let t=await yy(e),n=await y_(e);return t.setNetworkEnabled(!1),gc(n)})}function yC(e){let t=new rO;return e.asyncQueue.enqueueAndForget(async()=>mb(await yb(e),t)),t.promise}function yI(e,t,n,r){let i=new ye(r),s=new g9(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>gX(await yw(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>gZ(await yw(e),s))}}function yk(e,t){let n=new rO;return e.asyncQueue.enqueueAndForget(async()=>yP(await yv(e),t,n)),n.promise}function yR(e,t,n={}){let r=new rO;return e.asyncQueue.enqueueAndForget(async()=>yM(await yw(e),e.asyncQueue,t,n,r)),r.promise}function yO(e,t){let n=new rO;return e.asyncQueue.enqueueAndForget(async()=>yL(await yv(e),t,n)),n.promise}function yN(e,t,n={}){let r=new rO;return e.asyncQueue.enqueueAndForget(async()=>yF(await yw(e),e.asyncQueue,t,n,r)),r.promise}function yA(e,t){let n=new rO;return e.asyncQueue.enqueueAndForget(async()=>mf(await yb(e),t,n)),n.promise}function yx(e,t){let n=new ye(t);return e.asyncQueue.enqueueAndForget(async()=>g3(await yw(e),n)),()=>{n.mute(),e.asyncQueue.enqueueAndForget(async()=>g4(await yw(e),n))}}function yD(e,t,n){let r=new rO;return e.asyncQueue.enqueueAndForget(async()=>{let i=await yS(e);new ys(e.asyncQueue,i,n,t,r).run()}),r.promise}async function yP(e,t,n){try{let r=await pK(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new rR(rk.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=g$(r,`Failed to get document '${t} from cache`);n.reject(e)}}function yM(e,t,n,r,i){let s=new ye({next:s=>{t.enqueueAndForget(()=>gZ(e,o));let a=s.docs.has(n);!a&&s.fromCache?i.reject(new rR(rk.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new rR(rk.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new g9(aG(n.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return gX(e,o)}async function yL(e,t,n){try{let r=await pX(e,t,!0),i=new mi(t,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(r){let e=g$(r,`Failed to execute query '${t} against cache`);n.reject(e)}}function yF(e,t,n,r,i){let s=new g9(n,new ye({next:n=>{t.enqueueAndForget(()=>gZ(e,s)),n.fromCache&&"server"===r.source?i.reject(new rR(rk.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return gX(e,s)}function yB(e,t,n,r){let i=yU(n,fW(t));e.asyncQueue.enqueueAndForget(async()=>{mG(await yb(e),i,r)})}function yj(e,t){return e.asyncQueue.enqueue(async()=>fe(await yv(e),t))}function yU(e,t){let n;return yr(m8(n="string"==typeof e?ud().encode(e):e),t)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yq(e,t){return e.timeoutSeconds===t.timeoutSeconds}function yV(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yz="ComponentProvider",yW=new Map;function y$(e){let t=yW.get(e);t&&(r_(yz,"Removing Datastore"),yW.delete(e),t.terminate())}function yG(e,t,n,r){return new os(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,yV(r.experimentalLongPollingOptions),r.useFetchStreams)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yH="firestore.googleapis.com",yK=!0,yQ=5,yY=30,yJ=!0;class yX{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new rR(rk.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=yH,this.ssl=yK}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:yK;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=dS;else{if(e.cacheSizeBytes!==db&&e.cacheSizeBytes<dE)throw new rR(rk.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${dE}`);this.cacheSizeBytes=e.cacheSizeBytes}m1("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=yJ:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yV(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),yZ(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&yq(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function yZ(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new rR(rk.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<yQ)throw new rR(rk.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${yQ})`);if(e.timeoutSeconds>yY)throw new rR(rk.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${yY})`)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yX({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new rR(rk.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rR(rk.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yX(e),void 0!==e.credentials&&(this._authCredentials=rB(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return y$(this),Promise.resolve()}}function y1(e,t,n,r={}){var i;let s=(e=m5(e,y0))._getSettings(),o=`${t}:${n}`;if(s.host!==yH&&s.host!==o&&rS("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=rd.MOCK_USER;else{t=(0,d.Sg)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new rR(rk.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new rd(s)}e._authCredentials=new rx(new rN(t,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y2{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new y4(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new y2(this.firestore,e,this._key)}}class y3{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new y3(this.firestore,e,this._query)}}class y4 extends y3{constructor(e,t,n){super(e,t,aG(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new y2(this.firestore,null,new rZ(e))}withConverter(e){return new y4(this.firestore,e,this._path)}}function y6(e,t,...n){if(e=(0,d.m9)(e),m0("collection","path",t),e instanceof y0){let r=rY.fromString(t,...n);return m3(r),new y4(e,null,r)}{if(!(e instanceof y2)&&!(e instanceof y4))throw new rR(rk.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(rY.fromString(t,...n));return m3(r),new y4(e.firestore,null,r)}}function y9(e,t){if(e=m5(e,y0),m0("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new rR(rk.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new y3(e,null,aJ(t))}function y5(e,t,...n){if(e=(0,d.m9)(e),1==arguments.length&&(t=rU.newId()),m0("doc","path",t),e instanceof y0){let r=rY.fromString(t,...n);return m2(r),new y2(e,null,new rZ(r))}{if(!(e instanceof y2)&&!(e instanceof y4))throw new rR(rk.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(rY.fromString(t,...n));return m2(r),new y2(e.firestore,e instanceof y4?e.converter:null,new rZ(r))}}function y7(e,t){return e=(0,d.m9)(e),t=(0,d.m9)(t),(e instanceof y2||e instanceof y4)&&(t instanceof y2||t instanceof y4)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function y8(e,t){return e=(0,d.m9)(e),t=(0,d.m9)(t),e instanceof y3&&t instanceof y3&&e.firestore===t.firestore&&a5(e._query,t._query)&&e.converter===t.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ve="AsyncQueue";class vt{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new fQ(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new rO;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(iy(e))r_(ve,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,rb("INTERNAL UNHANDLED ERROR: ",vr(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,n){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let r=gW.createAndSchedule(this,e,t,n,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(r),r}verifyNotFailed(){this.failure&&rT()}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function vn(){return new vt}function vr(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(){this._progressObserver={},this._taskCompletionResolver=new rO,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vs=db;class vo extends y0{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=vn(),this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||vu(this),this._firestoreClient.terminate()}}function va(e,t){let n="object"==typeof e?e:(0,l.getApp)(),r="string"==typeof e?e:t||oo,i=(0,l._getProvider)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let e=(0,d.P0)("firestore");e&&y1(i,...e)}return i}function vl(e){return e._firestoreClient||vu(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function vu(e){var t,n,r;let i=e._freezeSettings(),s=yG(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new yh(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}function vc(e,t){v_(e=m5(e,vo));let n=vl(e);if(n._uninitializedComponentsProvider)throw new rR(rk.FAILED_PRECONDITION,"SDK cache is already specified.");rS("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings(),i=new mJ,s=new mQ(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership);return vd(n,i,s)}function vh(e){v_(e=m5(e,vo));let t=vl(e);if(t._uninitializedComponentsProvider)throw new rR(rk.FAILED_PRECONDITION,"SDK cache is already specified.");rS("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=e._freezeSettings(),r=new mJ,i=new mY(r,n.cacheSizeBytes);return vd(t,r,i)}function vd(e,t,n){let r=new rO;return e.asyncQueue.enqueue(async()=>{try{await yd(e,n),await yp(e,t),r.resolve()}catch(t){let e=t;if(!yf(e))throw e;rS("Error enabling indexeddb cache. Falling back to memory cache: "+e),r.reject(e)}}).then(()=>r.promise)}function vp(e){if(e._initialized&&!e._terminated)throw new rR(rk.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new rO;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await pN(pO(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function vf(e){return yC(vl(e=m5(e,vo)))}function vg(e){return yT(vl(e=m5(e,vo)))}function vm(e){return yE(vl(e=m5(e,vo)))}function vy(e,t){let n=vl(e=m5(e,vo)),r=new vi;return yB(n,e._databaseId,t,r),r}function vv(e,t){return yj(vl(e=m5(e,vo)),t).then(t=>t?new y3(e,null,t.query):null)}function v_(e){if(e._initialized||e._terminated)throw new rR(rk.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vb(e,t=!0){rf(l.SDK_VERSION),(0,l._registerComponent)(new u.wA("firestore",(e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider("app").getImmediate(),s=new vo(new rD(e.getProvider("auth-internal")),new rF(e.getProvider("app-check-internal")),ol(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,l.registerVersion)(rc,rh,e),(0,l.registerVersion)(rc,rh,"esm2017")}class vS{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vw(s0.fromBase64String(e))}catch(e){throw new rR(rk.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new vw(s0.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vT{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rR(rk.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rX(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vE{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new rR(rk.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new rR(rk.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return rq(this._lat,e._lat)||rq(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vI=/^__.*__$/;class vk{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new l2(e,this.data,this.fieldMask,t,this.fieldTransforms):new lZ(e,this.data,t,this.fieldTransforms)}}class vR{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new l2(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function vO(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rT()}}class vN{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new vN(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return vZ(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(vO(this.dataSource)&&vI.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class vA{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||fW(e)}createContext(e,t,n,r=!1){return new vN({dataSource:e,methodName:t,targetDoc:n,path:rX.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vx(e){let t=e._freezeSettings(),n=fW(e._databaseId);return new vA(e._databaseId,!!t.ignoreUndefinedProperties,n)}function vD(e,t,n,r,i,s={}){let o,a;let l=e.createContext(s.merge||s.mergeFields?2:0,t,n,i);vQ("Data must be an object, but it was:",l,r);let u=vW(r,l);if(s.merge)o=new sY(l.fieldMask),a=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=vY(t,r,n);if(!l.contains(i))throw new rR(rk.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);v0(e,i)||e.push(i)}o=new sY(e),a=l.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,a=l.fieldTransforms;return new vk(new o3(u),o,a)}class vP extends vE{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof vP}}function vM(e,t,n){return new vN({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class vL extends vE{_toFieldTransform(e){return new lq(e.path,new lx)}isEqual(e){return e instanceof vL}}class vF extends vE{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=vM(this,e,!0),n=new lD(this._elements.map(e=>vz(e,t)));return new lq(e.path,n)}isEqual(e){return this===e}}class vB extends vE{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=vM(this,e,!0),n=new lM(this._elements.map(e=>vz(e,t)));return new lq(e.path,n)}isEqual(e){return this===e}}class vj extends vE{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new lF(e.serializer,lI(e.serializer,this._operand));return new lq(e.path,t)}isEqual(e){return this===e}}function vU(e,t,n,r){let i=e.createContext(1,t,n);vQ("Data must be an object, but it was:",i,r);let s=[],o=o3.empty();return sU(r,(e,r)=>{let a=vX(t,e,n);r=(0,d.m9)(r);let l=i.childContextForFieldPath(a);if(r instanceof vP)s.push(a);else{let e=vz(r,l);null!=e&&(s.push(a),o.set(a,e))}}),new vR(o,new sY(s),i.fieldTransforms)}function vq(e,t,n,r,i,s){let o=e.createContext(1,t,n),a=[vY(t,r,n)],l=[i];if(s.length%2!=0)throw new rR(rk.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(vY(t,s[e])),l.push(s[e+1]);let u=[],c=o3.empty();for(let e=a.length-1;e>=0;--e)if(!v0(u,a[e])){let t=a[e],n=l[e];n=(0,d.m9)(n);let r=o.childContextForFieldPath(t);if(n instanceof vP)u.push(t);else{let e=vz(n,r);null!=e&&(u.push(t),c.set(t,e))}}return new vR(c,new sY(u),o.fieldTransforms)}function vV(e,t,n,r=!1){return vz(n,e.createContext(r?4:3,t))}function vz(e,t){if(vK(e=(0,d.m9)(e)))return vQ("Unsupported field value:",t,e),vW(e,t);if(e instanceof vE)return vG(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return vH(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return v$(e,t)}function vW(e,t){let n={};return sq(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):sU(e,(e,r)=>{let i=vz(r,t.childContextForField(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function v$(e,t){let n=[],r=0;for(let i of e){let e=vz(i,t.childContextForArray(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}function vG(e,t){if(!vO(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}function vH(e,t){if(null===(e=(0,d.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return lI(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=rG.fromDate(e);return{timestampValue:uF(t.serializer,n)}}if(e instanceof rG){let n=new rG(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:uF(t.serializer,n)}}if(e instanceof vC)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof vw)return{bytesValue:uj(t.serializer,e._byteString)};else if(e instanceof y2){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:uz(e.firestore._databaseId||t.databaseId,e._key.path)}}else throw t.createError(`Unsupported field value: ${m6(e)}`)}function vK(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof rG)&&!(e instanceof vC)&&!(e instanceof vw)&&!(e instanceof y2)&&!(e instanceof vE)}function vQ(e,t,n){if(!vK(n)||!m4(n)){let r=m6(n);if("an object"===r)throw t.createError(e+" a custom object");throw t.createError(e+" "+r)}}function vY(e,t,n){if((t=(0,d.m9)(t))instanceof vT)return t._internalPath;if("string"==typeof t)return vX(e,t);throw vZ("Field path arguments must be of type string or ",e,!1,void 0,n)}let vJ=RegExp("[~\\*/\\[\\]]");function vX(e,t,n){if(t.search(vJ)>=0)throw vZ(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new vT(...t.split("."))._internalPath}catch(r){throw vZ(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function vZ(e,t,n,r,i){let s=r&&!r.isEmpty(),o=void 0!==i,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new rR(rk.INVALID_ARGUMENT,a+e+l)}function v0(e,t){return e.some(e=>e.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new y2(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new v2(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}get(e){if(this._document){let t=this._document.data.field(v3("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class v2 extends v1{data(){return super.data()}}function v3(e,t){return"string"==typeof t?vX(e,t):t instanceof vT?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v4(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rR(rk.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class v6{}class v9 extends v6{}function v5(e,t,...n){let r=[];for(let i of(t instanceof v6&&r.push(t),_R(r=r.concat(n)),r))e=i._apply(e);return e}class v7 extends v9{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new v7(e,t,n)}_apply(e){let t=this._parse(e);return _w(e._query,t),new y3(e.firestore,e.converter,a2(e._query,t))}_parse(e){let t=vx(e.firestore);return _g(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function v8(e,t,n){let r=t,i=v3("where",e);return v7._create(i,r,n)}class _e extends v6{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new _e(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:al.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(_T(e._query,t),new y3(e.firestore,e.converter,a2(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function _t(...e){return e.forEach(e=>_k("or",e)),_e._create("or",e)}function _n(...e){return e.forEach(e=>_k("and",e)),_e._create("and",e)}class _r extends v9{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new _r(e,t)}_apply(e){let t=_m(e._query,this._field,this._direction);return new y3(e.firestore,e.converter,a3(e._query,t))}}function _i(e,t="asc"){let n=t,r=v3("orderBy",e);return _r._create(r,n)}class _s extends v9{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new _s(e,t,n)}_apply(e){return new y3(e.firestore,e.converter,a4(e._query,this._limit,this._limitType))}}function _o(e){return m7("limit",e),_s._create("limit",e,"F")}function _a(e){return m7("limitToLast",e),_s._create("limitToLast",e,"L")}class _l extends v9{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new _l(e,t,n)}_apply(e){let t=_f(e,this.type,this._docOrFields,this._inclusive);return new y3(e.firestore,e.converter,a6(e._query,t))}}function _u(...e){return _l._create("startAt",e,!0)}function _c(...e){return _l._create("startAfter",e,!1)}class _h extends v9{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new _h(e,t,n)}_apply(e){let t=_f(e,this.type,this._docOrFields,this._inclusive);return new y3(e.firestore,e.converter,a9(e._query,t))}}function _d(...e){return _h._create("endBefore",e,!1)}function _p(...e){return _h._create("endAt",e,!0)}function _f(e,t,n,r){if(n[0]=(0,d.m9)(n[0]),n[0]instanceof v1)return _y(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=vx(e.firestore);return _v(e._query,e.firestore._databaseId,i,t,n,r)}}function _g(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new rR(rk.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){_b(o,s);let t=[];for(let n of o)t.push(__(r,e,n));a={arrayValue:{values:t}}}else a=__(r,e,o)}else("in"===s||"not-in"===s||"array-contains-any"===s)&&_b(o,s),a=vV(n,t,o,"in"===s||"not-in"===s);return aa.create(i,s,a)}function _m(e,t,n){if(null!==e.startAt)throw new rR(rk.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new rR(rk.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");let r=new an(t,n);return _C(e,r),r}function _y(e,t,n,r,i){if(!r)throw new rR(rk.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of a0(e))if(n.field.isKeyField())s.push(oz(t,r.key));else{let e=r.data.field(n.field);if(ot(e))throw new rR(rk.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=n.field.canonicalString();throw new rR(rk.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new o5(s,i)}function _v(e,t,n,r,i,s){let o=e.explicitOrderBy;if(i.length>o.length)throw new rR(rk.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let s=0;s<i.length;s++){let l=i[s];if(o[s].field.isKeyField()){if("string"!=typeof l)throw new rR(rk.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!aZ(e)&&-1!==l.indexOf("/"))throw new rR(rk.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(rY.fromString(l));if(!rZ.isDocumentKey(n))throw new rR(rk.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new rZ(n);a.push(oz(t,i))}else{let e=vV(n,r,l);a.push(e)}}return new o5(a,s)}function __(e,t,n){if("string"==typeof(n=(0,d.m9)(n))){if(""===n)throw new rR(rk.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aZ(t)&&-1!==n.indexOf("/"))throw new rR(rk.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(rY.fromString(n));if(!rZ.isDocumentKey(r))throw new rR(rk.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return oz(e,new rZ(r))}if(n instanceof y2)return oz(e,n._key);throw new rR(rk.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${m6(n)}.`)}function _b(e,t){if(!Array.isArray(e)||0===e.length)throw new rR(rk.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function _S(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function _w(e,t){if(t.isInequality()){let n=aY(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new rR(rk.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);let i=aQ(e);null!==i&&_I(e,r,i)}let n=_E(e.filters,_S(t.op));if(null!==n){if(n===t.op)throw new rR(rk.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);throw new rR(rk.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}}function _T(e,t){let n=e;for(let e of t.getFlattenedFilters())_w(n,e),n=a2(n,e)}function _E(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}function _C(e,t){if(null===aQ(e)){let n=aY(e);null!==n&&_I(e,n,t.field)}}function _I(e,t,n){if(!n.isEqual(t))throw new rR(rk.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function _k(e,t){if(!(t instanceof v7)&&!(t instanceof _e))throw new rR(rk.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function _R(e){let t=e.filter(e=>e instanceof _e).length,n=e.filter(e=>e instanceof v7).length;if(t>1||t>0&&n>0)throw new rR(rk.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _O{convertValue(e,t="none"){switch(om(e)){case 0:return null;case 1:return e.booleanValue;case 2:return s6(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(s9(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw rT()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return sU(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new vC(s6(e.latitude),s6(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=or(e);if(null==n)return null;return this.convertValue(n,t);case"estimate":return this.convertTimestamp(oi(e));default:return null}}convertTimestamp(e){let t=s4(e);return new rG(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=rY.fromString(e);rE(cq(n));let r=new oa(n.get(1),n.get(3)),i=new rZ(n.popFirst(5));return r.isEqual(t)||rb(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _N(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class _A extends _O{constructor(e){super(),this.firestore=e}convertBytes(e){return new vw(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new y2(this.firestore,null,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _x(e){return _D(e,["next","error","complete"])}function _D(e,t){if("object"!=typeof e||null===e)return!1;let n=e;for(let e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _P{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _M extends v1{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new _L(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let n=this._document.data.field(v3("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class _L extends _M{data(e={}){return super.data(e)}}class _F{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new _P(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new _L(this._firestore,this._userDataWriter,n.key,n,new _P(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rR(rk.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=_B(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function _B(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new _L(e._firestore,e._userDataWriter,n.doc.key,n.doc,new _P(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new _L(e._firestore,e._userDataWriter,t.doc.key,t.doc,new _P(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:_j(t.type),doc:r,oldIndex:i,newIndex:s}})}}function _j(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rT()}}function _U(e,t){return e instanceof _M&&t instanceof _M?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof _F&&t instanceof _F&&e._firestore===t._firestore&&y8(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _q(e){e=m5(e,y2);let t=m5(e.firestore,vo);return yR(vl(t),e._key).then(n=>_1(t,e,n))}class _V extends _O{constructor(e){super(),this.firestore=e}convertBytes(e){return new vw(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new y2(this.firestore,null,t)}}function _z(e){e=m5(e,y2);let t=m5(e.firestore,vo),n=vl(t),r=new _V(t);return yk(n,e._key).then(n=>new _M(t,r,e._key,n,new _P(null!==n&&n.hasLocalMutations,!0),e.converter))}function _W(e){e=m5(e,y2);let t=m5(e.firestore,vo);return yR(vl(t),e._key,{source:"server"}).then(n=>_1(t,e,n))}function _$(e){e=m5(e,y3);let t=m5(e.firestore,vo),n=vl(t),r=new _V(t);return v4(e._query),yN(n,e._query).then(n=>new _F(t,r,e,n))}function _G(e){e=m5(e,y3);let t=m5(e.firestore,vo),n=vl(t),r=new _V(t);return yO(n,e._query).then(n=>new _F(t,r,e,n))}function _H(e){e=m5(e,y3);let t=m5(e.firestore,vo),n=vl(t),r=new _V(t);return yN(n,e._query,{source:"server"}).then(n=>new _F(t,r,e,n))}function _K(e,t,n){e=m5(e,y2);let r=m5(e.firestore,vo),i=_N(e.converter,t,n),s=vD(vx(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,l$.none());return _0(r,[s])}function _Q(e,t,n,...r){let i;e=m5(e,y2);let s=m5(e.firestore,vo),o=vx(s);return _0(s,[(i="string"==typeof(t=(0,d.m9)(t))||t instanceof vT?vq(o,"updateDoc",e._key,t,n,r):vU(o,"updateDoc",e._key,t)).toMutation(e._key,l$.exists(!0))])}function _Y(e){return _0(m5(e.firestore,vo),[new l7(e._key,l$.none())])}function _J(e,t){let n=m5(e.firestore,vo),r=y5(e),i=_N(e.converter,t);return _0(n,[vD(vx(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,l$.exists(!1))]).then(()=>r)}function _X(e,...t){var n,r,i;let s,o,a;e=(0,d.m9)(e);let l={includeMetadataChanges:!1},u=0;"object"==typeof t[0]&&!_x(t[u])&&(l=t[u],u++);let c={includeMetadataChanges:l.includeMetadataChanges};if(_x(t[u])){let e=t[u];t[u]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[u+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[u+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}if(e instanceof y2)o=m5(e.firestore,vo),a=aG(e._key.path),s={next:n=>{t[u]&&t[u](_1(o,e,n))},error:t[u+1],complete:t[u+2]};else{let n=m5(e,y3);o=m5(n.firestore,vo),a=n._query;let r=new _V(o);s={next:e=>{t[u]&&t[u](new _F(o,r,n,e))},error:t[u+1],complete:t[u+2]},v4(e._query)}return yI(vl(o),a,c,s)}function _Z(e,t){return yx(vl(e=m5(e,vo)),_x(t)?t:{next:t})}function _0(e,t){return yA(vl(e),t)}function _1(e,t,n){let r=n.docs.get(t._key),i=new _V(e);return new _M(e,i,t._key,r,new _P(n.hasPendingWrites,n.fromCache),t.converter)}class _2{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=new mJ,this._offlineComponentProvider=new mQ(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _3={maxAttempts:5};function _4(e){if(e.maxAttempts<1)throw new rR(rk.INVALID_ARGUMENT,"Max attempts must be at least 1")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _6{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=vx(e)}set(e,t,n){this._verifyNotCommitted();let r=_9(e,this._firestore),i=_N(r.converter,t,n),s=vD(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,l$.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=_9(e,this._firestore);return i="string"==typeof(t=(0,d.m9)(t))||t instanceof vT?vq(this._dataReader,"WriteBatch.update",s._key,t,n,r):vU(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,l$.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=_9(e,this._firestore);return this._mutations=this._mutations.concat(new l7(t._key,l$.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new rR(rk.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function _9(e,t){if((e=(0,d.m9)(e)).firestore===t)return e;throw new rR(rk.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=vx(e)}get(e){let t=_9(e,this._firestore),n=new _A(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return rT();let r=e[0];if(r.isFoundDocument())return new v1(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new v1(this._firestore,n,t._key,null,t.converter);throw rT()})}set(e,t,n){let r=_9(e,this._firestore),i=_N(r.converter,t,n),s=vD(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i;let s=_9(e,this._firestore);return i="string"==typeof(t=(0,d.m9)(t))||t instanceof vT?vq(this._dataReader,"Transaction.update",s._key,t,n,r):vU(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=_9(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _7 extends _5{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=_9(e,this._firestore),n=new _V(this._firestore);return super.get(e).then(e=>new _M(this._firestore,n,t._key,e._document,new _P(!1,!1),t.converter))}}function _8(e,t,n){e=m5(e,vo);let r=Object.assign(Object.assign({},_3),n);return _4(r),yD(vl(e),n=>t(new _7(e,n)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function be(){return new vP("deleteField")}function bt(){return new vL("serverTimestamp")}function bn(...e){return new vF("arrayUnion",e)}function br(...e){return new vB("arrayRemove",e)}function bi(e){return new vj("increment",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bs(e){return vl(e=m5(e,vo)),new _6(e,t=>_0(e,t))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */vb("node")},36209:(e,t,n)=>{"use strict";n.d(t,{z9:()=>ev,yu:()=>eS});var r=n(33497),i=n(77752),s=n(2377),o=n(65036);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let a=new Map,l={activated:!1,tokenObservers:[]},u={initialized:!1,enabled:!1};function c(e){return a.get(e)||Object.assign({},l)}function h(e,t){return a.set(e,t),a.get(e)}function d(){return u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let p="https://content-firebaseappcheck.googleapis.com/v1",f="exchangeRecaptchaV3Token",g="exchangeDebugToken",m={RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4},y=864e5;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new s.BH,await _(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new s.BH,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}function _(e){return new Promise(t=>{setTimeout(t,e)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let b={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},S=new s.LL("appCheck","AppCheck",b);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w(e=!1){var t;return e?null===(t=self.grecaptcha)||void 0===t?void 0:t.enterprise:self.grecaptcha}function T(e){if(!c(e).activated)throw S.create("use-before-activation",{appName:e.name})}function E(e){let t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor((t-86400*n)/3600),i=Math.floor((t-86400*n-3600*r)/60),s=t-86400*n-3600*r-60*i,o="";return n&&(o+=C(n)+"d:"),r&&(o+=C(r)+"h:"),o+=C(i)+"m:"+C(s)+"s"}function C(e){return 0===e?"00":e>=10?e.toString():"0"+e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I({url:e,body:t},n){let r,i;let s={"Content-Type":"application/json"},o=n.getImmediate({optional:!0});if(o){let e=await o.getHeartbeatsHeader();e&&(s["X-Firebase-Client"]=e)}let a={method:"POST",body:JSON.stringify(t),headers:s};try{r=await fetch(e,a)}catch(e){throw S.create("fetch-network-error",{originalErrorMessage:null==e?void 0:e.message})}if(200!==r.status)throw S.create("fetch-status-error",{httpStatus:r.status});try{i=await r.json()}catch(e){throw S.create("fetch-parse-error",{originalErrorMessage:null==e?void 0:e.message})}let l=i.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw S.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${i.ttl}`});let u=1e3*Number(l[1]),c=Date.now();return{token:i.token,expireTimeMillis:c+u,issuedAtTimeMillis:c}}function k(e,t){let{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${p}/projects/${n}/apps/${r}:${f}?key=${i}`,body:{recaptcha_v3_token:t}}}function R(e,t){let{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${p}/projects/${n}/apps/${r}:${g}?key=${i}`,body:{debug_token:t}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let O="firebase-app-check-database",N=1,A="firebase-app-check-store",x="debug-token",D=null;function P(){return D||(D=new Promise((e,t)=>{try{let n=indexedDB.open(O,N);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(S.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{let t=e.target.result;0===e.oldVersion&&t.createObjectStore(A,{keyPath:"compositeKey"})}}catch(e){t(S.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}}))}function M(e){return U(q(e))}function L(e,t){return j(q(e),t)}function F(e){return j(x,e)}function B(){return U(x)}async function j(e,t){let n=(await P()).transaction(A,"readwrite"),r=n.objectStore(A).put({compositeKey:e,value:t});return new Promise((e,t)=>{r.onsuccess=t=>{e()},n.onerror=e=>{var n;t(S.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}})}async function U(e){let t=(await P()).transaction(A,"readonly"),n=t.objectStore(A).get(e);return new Promise((e,r)=>{n.onsuccess=t=>{let n=t.target.result;n?e(n.value):e(void 0)},t.onerror=e=>{var t;r(S.create("storage-get",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}function q(e){return`${e.options.appId}-${e.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let V=new o.Yd("@firebase/app-check");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z(e){if((0,s.hl)()){let t;try{t=await M(e)}catch(e){V.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return t}}function W(e,t){return(0,s.hl)()?L(e,t).catch(e=>{V.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function $(){let e;try{e=await B()}catch(e){}if(e)return e;{let e=(0,s.k$)();return F(e).catch(e=>V.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G(){return d().enabled}async function H(){let e=d();if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function K(){let e=(0,s.Rd)(),t=d();if(t.initialized=!0,"string"!=typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN&&!0!==e.FIREBASE_APPCHECK_DEBUG_TOKEN)return;t.enabled=!0;let n=new s.BH;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve($())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Q={error:"UNKNOWN_ERROR"};function Y(e){return s.US.encodeString(JSON.stringify(e),!1)}async function J(e,t=!1){let n,r;let i=e.app;T(i);let s=c(i),o=s.token;if(o&&!ei(o)&&(s.token=void 0,o=void 0),!o){let e=await s.cachedTokenPromise;e&&(ei(e)?o=e:await W(i,void 0))}if(!t&&o&&ei(o))return{token:o.token};let a=!1;if(G()){s.exchangeTokenPromise||(s.exchangeTokenPromise=I(R(i,await H()),e.heartbeatServiceProvider).finally(()=>{s.exchangeTokenPromise=void 0}),a=!0);let t=await s.exchangeTokenPromise;return await W(i,t),s.token=t,{token:t.token}}try{s.exchangeTokenPromise||(s.exchangeTokenPromise=s.provider.getToken().finally(()=>{s.exchangeTokenPromise=void 0}),a=!0),o=await c(i).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?V.warn(e.message):V.error(e),r=e}return o?r?n=ei(o)?{token:o.token,internalError:r}:es(r):(n={token:o.token},s.token=o,await W(i,o)):n=es(r),a&&er(i,n),n}async function X(e){let t=e.app;T(t);let{provider:n}=c(t);if(G()){let n=await H(),{token:r}=await I(R(t,n),e.heartbeatServiceProvider);return{token:r}}{let{token:e}=await n.getToken();return{token:e}}}function Z(e,t,n,r){let{app:i}=e,s=c(i),o={next:n,error:r,type:t};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&ei(s.token)){let t=s.token;Promise.resolve().then(()=>{n({token:t.token}),et(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>et(e))}function ee(e,t){let n=c(e),r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=r}function et(e){let{app:t}=e,n=c(t),r=n.tokenRefresher;r||(r=en(e),n.tokenRefresher=r),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function en(e){let{app:t}=e;return new v(async()=>{let n;if((n=c(t).token?await J(e,!0):await J(e)).error)throw n.error;if(n.internalError)throw n.internalError},()=>!0,()=>{let e=c(t);if(!e.token)return 0;{let t=e.token.issuedAtTimeMillis+(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)*.5+3e5;return Math.max(0,(t=Math.min(t,e.token.expireTimeMillis-3e5))-Date.now())}},m.RETRIAL_MIN_WAIT,m.RETRIAL_MAX_WAIT)}function er(e,t){for(let n of c(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function ei(e){return e.expireTimeMillis-Date.now()>0}function es(e){return{token:Y(Q),error:e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=c(this.app);for(let t of e)ee(this.app,t.next);return Promise.resolve()}}function ea(e,t){return new eo(e,t)}function el(e){return{getToken:t=>J(e,t),getLimitedUseToken:()=>X(e),addTokenListener:t=>Z(e,"INTERNAL",t),removeTokenListener:t=>ee(e.app,t)}}let eu="@firebase/app-check",ec="0.8.0",eh="https://www.google.com/recaptcha/api.js";function ed(e,t){let n=new s.BH;c(e).reCAPTCHAState={initialized:n};let r=ef(e),i=w(!1);return i?ep(e,t,i,r,n):ey(()=>{let i=w(!1);if(!i)throw Error("no recaptcha");ep(e,t,i,r,n)}),n.promise}function ep(e,t,n,r,i){n.ready(()=>{em(e,t,n,r),i.resolve(n)})}function ef(e){let t=`fire_app_check_${e.name}`,n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}async function eg(e){T(e);let t=c(e).reCAPTCHAState,n=await t.initialized.promise;return new Promise((t,r)=>{let i=c(e).reCAPTCHAState;n.ready(()=>{t(n.execute(i.widgetId,{action:"fire_app_check"}))})})}function em(e,t,n,r){let i=n.render(r,{sitekey:t,size:"invisible",callback:()=>{c(e).reCAPTCHAState.succeeded=!0},"error-callback":()=>{c(e).reCAPTCHAState.succeeded=!1}}),s=c(e);s.reCAPTCHAState=Object.assign(Object.assign({},s.reCAPTCHAState),{widgetId:i})}function ey(e){let t=document.createElement("script");t.src=eh,t.onload=e,document.head.appendChild(t)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e,t,n;let r;eb(this._throttleData);let i=await eg(this._app).catch(e=>{throw S.create("recaptcha-error")});if(!(null===(e=c(this._app).reCAPTCHAState)||void 0===e?void 0:e.succeeded))throw S.create("recaptcha-error");try{r=await I(k(this._app,i),this._heartbeatServiceProvider)}catch(e){if(null===(t=e.code)||void 0===t?void 0:t.includes("fetch-status-error"))throw this._throttleData=e_(Number(null===(n=e.customData)||void 0===n?void 0:n.httpStatus),this._throttleData),S.create("throttled",{time:E(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus});throw e}return this._throttleData=null,r}initialize(e){this._app=e,this._heartbeatServiceProvider=(0,r._getProvider)(e,"heartbeat"),ed(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof ev&&this._siteKey===e._siteKey}}function e_(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+y,httpStatus:e};{let n=t?t.backoffCount:0,r=(0,s.$s)(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+r,httpStatus:e}}}function eb(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw S.create("throttled",{time:E(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eS(e=(0,r.getApp)(),t){e=(0,s.m9)(e);let n=(0,r._getProvider)(e,"app-check");if(d().initialized||K(),G()&&H().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){let r=n.getImmediate(),i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw S.create("already-initialized",{appName:e.name})}let i=n.initialize({options:t});return ew(e,t.provider,t.isTokenAutoRefreshEnabled),c(e).isTokenAutoRefreshEnabled&&Z(i,"INTERNAL",()=>{}),i}function ew(e,t,n){let r=h(e,Object.assign({},l));r.activated=!0,r.provider=t,r.cachedTokenPromise=z(e).then(t=>(t&&ei(t)&&(r.token=t,er(e,{token:t.token})),t)),r.isTokenAutoRefreshEnabled=void 0===n?e.automaticDataCollectionEnabled:n,r.provider.initialize(e)}let eT="app-check",eE="app-check-internal";(function(){(0,r._registerComponent)(new i.wA(eT,e=>ea(e.getProvider("app").getImmediate(),e.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(eE).initialize()})),(0,r._registerComponent)(new i.wA(eE,e=>el(e.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,r.registerVersion)(eu,ec)})()},42585:(e,t,n)=>{"use strict";n.d(t,{ZF:()=>r.initializeApp});var r=n(33497),i="firebase",s="9.23.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(0,r.registerVersion)(i,s,"app")},85931:(e,t,n)=>{"use strict";var r=n(48876),i=n(20057),s=n(2377),o=n(33497),a=n(77752),l=n(32490);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c(e,t){return t?(0,i.as)(t):((0,i.at)(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}n(65036);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h extends i.J{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return(0,i.ax)(e,this._buildIdpRequest())}_linkToIdToken(e,t){return(0,i.ax)(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return(0,i.ax)(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function d(e){return(0,i.au)(e.auth,new h(e),e.bypassAuthState)}function p(e){let{auth:t,user:n}=e;return(0,i.at)(n,t,"internal-error"),(0,i.av)(n,new h(e),e.bypassAuthState)}async function f(e){let{auth:t,user:n}=e;return(0,i.at)(n,t,"internal-error"),(0,i.aw)(n,new h(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s){this.reject(s);return}let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return d;case"linkViaPopup":case"linkViaRedirect":return f;case"reauthViaPopup":case"reauthViaRedirect":return p;default:(0,i.ay)(this.auth,"internal-error")}}resolve(e){(0,i.az)(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){(0,i.az)(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m="pendingRedirect",y=new Map;class v extends g{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=y.get(this.auth._key());if(!e){try{let t=await _(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}y.set(this.auth._key(),e)}return this.bypassAuthState||y.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type){this.resolve(null);return}if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _(e,t){let n=T(t),r=w(e);if(!await r._isAvailable())return!1;let i=await r._get(n)==="true";return await r._remove(n),i}function b(){y.clear()}function S(e,t){y.set(e._key(),t)}function w(e){return(0,i.as)(e._redirectPersistence)}function T(e){return(0,i.aA)(m,e.config.apiKey,e.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E(e,t,n=!1){let r=(0,i.aB)(e),s=c(r,t),o=new v(r,s,n),a=await o.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}let C="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(C,"1"),this.storage.removeItem(C),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k extends I{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}k.type="SESSION";let R=k,O="__/auth/handler",N="emulator/auth/handler",A=encodeURIComponent("fac");async function x(e,t,n,r,a,l){(0,i.at)(e.config.authDomain,e,"auth-domain-config-required"),(0,i.at)(e.config.apiKey,e,"invalid-api-key");let u={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:o.SDK_VERSION,eventId:a};if(t instanceof i.aC)for(let[n,r]of(t.setDefaultLanguage(e.languageCode),u.providerId=t.providerId||"",(0,s.xb)(t.getCustomParameters())||(u.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(l||{})))u[n]=r;if(t instanceof i.aD){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(u.scopes=e.join(","))}e.tenantId&&(u.tid=e.tenantId);let c=u;for(let e of Object.keys(c))void 0===c[e]&&delete c[e];let h=await e._getAppCheckToken(),d=h?`#${A}=${encodeURIComponent(h)}`:"";return`${D(e)}?${(0,s.xO)(c).slice(1)}${d}`}function D({config:e}){return e.emulator?(0,i.aE)(e,N):`https://${e.authDomain}/${O}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P(){return window}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M(e,t={}){return(0,i.aF)(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let L=2e3;async function F(e,t,n){var r;let{BuildInfo:s}=P();(0,i.az)(t.sessionId,"AuthEvent did not contain a session ID");let o=await V(t.sessionId),a={};return(0,i.aG)()?a.ibi=s.packageName:(0,i.aH)()?a.apn=s.packageName:(0,i.ay)(e,"operation-not-supported-in-this-environment"),s.displayName&&(a.appDisplayName=s.displayName),a.sessionId=o,x(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,a)}async function B(e){let{BuildInfo:t}=P(),n={};(0,i.aG)()?n.iosBundleId=t.packageName:(0,i.aH)()?n.androidPackageName=t.packageName:(0,i.ay)(e,"operation-not-supported-in-this-environment"),await M(e,n)}function j(e){let{cordova:t}=P();return new Promise(n=>{t.plugins.browsertab.isAvailable(r=>{let s=null;r?t.plugins.browsertab.openUrl(e):s=t.InAppBrowser.open(e,(0,i.aI)()?"_blank":"_system","location=yes"),n(s)})})}async function U(e,t,n){let{cordova:r}=P(),s=()=>{};try{await new Promise((o,a)=>{let l=null;function u(){var e;o();let t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function c(){l||(l=window.setTimeout(()=>{a((0,i.aJ)(e,"redirect-cancelled-by-user"))},L))}function h(){(null==document?void 0:document.visibilityState)==="visible"&&c()}t.addPassiveListener(u),document.addEventListener("resume",c,!1),(0,i.aH)()&&document.addEventListener("visibilitychange",h,!1),s=()=>{t.removePassiveListener(u),document.removeEventListener("resume",c,!1),document.removeEventListener("visibilitychange",h,!1),l&&window.clearTimeout(l)}})}finally{s()}}function q(e){var t,n,r,s,o,a,l,u,c,h;let d=P();(0,i.at)("function"==typeof(null===(t=null==d?void 0:d.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,i.at)(void 0!==(null===(n=null==d?void 0:d.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,i.at)("function"==typeof(null===(o=null===(s=null===(r=null==d?void 0:d.cordova)||void 0===r?void 0:r.plugins)||void 0===s?void 0:s.browsertab)||void 0===o?void 0:o.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,i.at)("function"==typeof(null===(u=null===(l=null===(a=null==d?void 0:d.cordova)||void 0===a?void 0:a.plugins)||void 0===l?void 0:l.browsertab)||void 0===u?void 0:u.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,i.at)("function"==typeof(null===(h=null===(c=null==d?void 0:d.cordova)||void 0===c?void 0:c.InAppBrowser)||void 0===h?void 0:h.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function V(e){let t=z(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function z(e){if((0,i.az)(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return new TextEncoder().encode(e);let t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let W=6e5;class ${constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!K(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!H(e)){let r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError((0,i.aJ)(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=W&&this.cachedEventUids.clear(),this.cachedEventUids.has(G(e))}saveEventToCache(e){this.cachedEventUids.add(G(e)),this.lastProcessedEventTime=Date.now()}}function G(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function H({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}function K(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return H(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q(){let e=(0,s.z$)();return(0,i.aN)(e)||(0,i.aG)(e)}let Y=1e3,J=10;class X extends I{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=Q()&&(0,i.aK)(),this.fallbackToPolling=(0,i.aL)(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});return}let n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){let r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}let r=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,i.aM)()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,J):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},Y)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}X.type="LOCAL";let Z=X,ee=20;class et extends ${constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function en(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:eo(),postBody:null,tenantId:e.tenantId,error:(0,i.aJ)(e,"no-auth-event")}}function er(e,t){return ea()._set(el(e),t)}async function ei(e){let t=await ea()._get(el(e));return t&&await ea()._remove(el(e)),t}function es(e,t){var n,r;let s=ec(t);if(s.includes("/__/auth/callback")){let t=eh(s),o=t.firebaseError?eu(decodeURIComponent(t.firebaseError)):null,a=null===(r=null===(n=null==o?void 0:o.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],l=a?(0,i.aJ)(a):null;return l?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:l,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function eo(){let e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<ee;n++){let n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function ea(){return(0,i.as)(Z)}function el(e){return(0,i.aA)("authEvent",e.config.apiKey,e.name)}function eu(e){try{return JSON.parse(e)}catch(e){return null}}function ec(e){let t=eh(e),n=t.link?decodeURIComponent(t.link):void 0,r=eh(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return eh(i).link||i||r||n||e}function eh(e){if(!(null==e?void 0:e.includes("?")))return{};let[t,...n]=e.split("?");return(0,s.zd)(n.join("?"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ed=500;class ep{constructor(){this._redirectPersistence=R,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=E,this._overrideRedirectResult=S}async _initialize(e){let t=e._key(),n=this.eventManagers.get(t);return n||(n=new et(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){(0,i.ay)(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){q(e);let i=await this._initialize(e);await i.initialized(),i.resetRedirect(),b(),await this._originValidation(e);let s=en(e,n,r);await er(e,s);let o=await F(e,s,t);return U(e,i,await j(o))}_isIframeWebStorageSupported(e,t){throw Error("Method not implemented.")}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=B(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){let{universalLinks:n,handleOpenURL:r,BuildInfo:i}=P(),s=setTimeout(async()=>{await ei(e),t.onEvent(eg())},ed),o=async n=>{clearTimeout(s);let r=await ei(e),i=null;r&&(null==n?void 0:n.url)&&(i=es(r,n.url)),t.onEvent(i||eg())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);let a=r,l=`${i.packageName.toLowerCase()}://`;P().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(l)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}}let ef=ep;function eg(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,i.aJ)("no-auth-event")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function em(e,t){(0,i.aB)(e)._logFramework(t)}var ey="@firebase/auth-compat",ev="0.4.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e_=1e3;function eb(){var e;return(null===(e=null==self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function eS(){return"http:"===eb()||"https:"===eb()}function ew(e=(0,s.z$)()){return!!(("file:"===eb()||"ionic:"===eb()||"capacitor:"===eb())&&e.toLowerCase().match(/iphone|ipad|ipod|android/))}function eT(){return(0,s.b$)()||(0,s.UG)()}function eE(){return(0,s.w1)()&&(null==document?void 0:document.documentMode)===11}function eC(e=(0,s.z$)()){return/Edge\/\d+/.test(e)}function eI(e=(0,s.z$)()){return eE()||eC(e)}function ek(){try{let e=self.localStorage,t=u();if(e){if(e.setItem(t,"1"),e.removeItem(t),eI())return(0,s.hl)();return!0}}catch(e){return eR()&&(0,s.hl)()}return!1}function eR(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function eO(){return(eS()||(0,s.ru)()||ew())&&!eT()&&ek()&&!eR()}function eN(){return ew()&&"undefined"!=typeof document}async function eA(){return!!eN()&&new Promise(e=>{let t=setTimeout(()=>{e(!1)},e_);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})}function ex(){return"undefined"!=typeof window?window:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eD={LOCAL:"local",NONE:"none",SESSION:"session"},eP=i.at,eM="persistence";function eL(e,t){if(eP(Object.values(eD).includes(t),e,"invalid-persistence-type"),(0,s.b$)()){eP(t!==eD.SESSION,e,"unsupported-persistence-type");return}if((0,s.UG)()){eP(t===eD.NONE,e,"unsupported-persistence-type");return}if(eR()){eP(t===eD.NONE||t===eD.LOCAL&&(0,s.hl)(),e,"unsupported-persistence-type");return}eP(t===eD.NONE||ek(),e,"unsupported-persistence-type")}async function eF(e){await e._initializationPromise;let t=ej(),n=i.aA(eM,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function eB(e,t){let n=ej();if(!n)return[];let r=i.aA(eM,e,t);switch(n.getItem(r)){case eD.NONE:return[i.N];case eD.LOCAL:return[i.i,i.a];case eD.SESSION:return[i.a];default:return[]}}function ej(){var e;try{return(null===(e=ex())||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eU=i.at;class eq{constructor(){this.browserResolver=i.as(i.k),this.cordovaResolver=i.as(ef),this.underlyingResolver=null,this._redirectPersistence=i.a,this._completeRedirectFn=E,this._overrideRedirectResult=S}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return eN()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return eU(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;let e=await eA();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eV(e){return e.unwrap()}function ez(e){return e.wrapped()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eW(e){return eG(e)}function e$(e,t){var n;let r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if((null==t?void 0:t.code)==="auth/multi-factor-auth-required")t.resolver=new eQ(e,i.aq(e,t));else if(r){let e=eG(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}function eG(e){let t;let{_tokenResponse:n}=e instanceof s.ZR?e.customData:e;if(!n)return null;if(!(e instanceof s.ZR)&&"temporaryProof"in n&&"phoneNumber"in n)return i.P.credentialFromResult(e);let r=n.providerId;if(!r||r===i.p.PASSWORD)return null;switch(r){case i.p.GOOGLE:t=i.V;break;case i.p.FACEBOOK:t=i.U;break;case i.p.GITHUB:t=i.W;break;case i.p.TWITTER:t=i.Z;break;default:let{oauthIdToken:o,oauthAccessToken:a,oauthTokenSecret:l,pendingToken:u,nonce:c}=n;if(!a&&!l&&!o&&!u)return null;if(u){if(r.startsWith("saml."))return i.aS._create(r,u);return i.L._fromParams({providerId:r,signInMethod:r,pendingToken:u,idToken:o,accessToken:a})}return new i.X(r).credential({idToken:o,accessToken:a,rawNonce:c})}return e instanceof s.ZR?t.credentialFromError(e):t.credentialFromResult(e)}function eH(e,t){return t.catch(t=>{throw t instanceof s.ZR&&e$(e,t),t}).then(e=>{let t=e.operationType,n=e.user;return{operationType:t,credential:eW(e),additionalUserInfo:i.ao(e),user:eY.getOrCreate(n)}})}async function eK(e,t){let n=await t;return{verificationId:n.verificationId,confirm:t=>eH(e,n.confirm(t))}}class eQ{constructor(e,t){this.resolver=t,this.auth=ez(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return eH(eV(this.auth),this.resolver.resolveSignIn(e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eY{constructor(e){this._delegate=e,this.multiFactor=i.ar(e)}static getOrCreate(e){return eY.USER_MAP.has(e)||eY.USER_MAP.set(e,new eY(e)),eY.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return eH(this.auth,i.a0(this._delegate,e))}async linkWithPhoneNumber(e,t){return eK(this.auth,i.l(this._delegate,e,t))}async linkWithPopup(e){return eH(this.auth,i.d(this._delegate,e,eq))}async linkWithRedirect(e){return await eF(i.aB(this.auth)),i.g(this._delegate,e,eq)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return eH(this.auth,i.a1(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return eK(this.auth,i.r(this._delegate,e,t))}reauthenticateWithPopup(e){return eH(this.auth,i.e(this._delegate,e,eq))}async reauthenticateWithRedirect(e){return await eF(i.aB(this.auth)),i.h(this._delegate,e,eq)}sendEmailVerification(e){return i.ae(this._delegate,e)}async unlink(e){return await i.an(this._delegate,e),this}updateEmail(e){return i.aj(this._delegate,e)}updatePassword(e){return i.ak(this._delegate,e)}updatePhoneNumber(e){return i.u(this._delegate,e)}updateProfile(e){return i.ai(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return i.af(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}eY.USER_MAP=new WeakMap;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eJ=i.at;class eX{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}let{apiKey:n}=e.options;eJ(n,"invalid-api-key",{appName:e.name}),eJ(n,"invalid-api-key",{appName:e.name});let r="undefined"!=typeof window?eq:void 0;this._delegate=t.initialize({options:{persistence:e0(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(i.D),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?eY.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){i.I(this._delegate,e,t)}applyActionCode(e){return i.a5(this._delegate,e)}checkActionCode(e){return i.a6(this._delegate,e)}confirmPasswordReset(e,t){return i.a4(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return eH(this._delegate,i.a8(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return i.ad(this._delegate,e)}isSignInWithEmailLink(e){return i.ab(this._delegate,e)}async getRedirectResult(){eJ(eO(),this._delegate,"operation-not-supported-in-this-environment");let e=await i.j(this._delegate,eq);return e?eH(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){em(this._delegate,e)}onAuthStateChanged(e,t,n){let{next:r,error:i,complete:s}=eZ(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){let{next:r,error:i,complete:s}=eZ(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return i.aa(this._delegate,e,t)}sendPasswordResetEmail(e,t){return i.a3(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(eL(this._delegate,e),e){case eD.SESSION:t=i.a;break;case eD.LOCAL:t=await i.as(i.i)._isAvailable()?i.i:i.b;break;case eD.NONE:t=i.N;break;default:return i.ay("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return eH(this._delegate,i._(this._delegate))}signInWithCredential(e){return eH(this._delegate,i.$(this._delegate,e))}signInWithCustomToken(e){return eH(this._delegate,i.a2(this._delegate,e))}signInWithEmailAndPassword(e,t){return eH(this._delegate,i.a9(this._delegate,e,t))}signInWithEmailLink(e,t){return eH(this._delegate,i.ac(this._delegate,e,t))}signInWithPhoneNumber(e,t){return eK(this._delegate,i.s(this._delegate,e,t))}async signInWithPopup(e){return eJ(eO(),this._delegate,"operation-not-supported-in-this-environment"),eH(this._delegate,i.c(this._delegate,e,eq))}async signInWithRedirect(e){return eJ(eO(),this._delegate,"operation-not-supported-in-this-environment"),await eF(this._delegate),i.f(this._delegate,e,eq)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return i.a7(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function eZ(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);let i=r;return{next:e=>i(e&&eY.getOrCreate(e)),error:t,complete:n}}function e0(e,t){let n=eB(e,t);if("undefined"==typeof self||n.includes(i.i)||n.push(i.i),"undefined"!=typeof window)for(let e of[i.b,i.a])n.includes(e)||n.push(e);return n.includes(i.N)||n.push(i.N),n}eX.Persistence=eD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(){this.providerId="phone",this._delegate=new i.P(eV(r.Z.auth()))}static credential(e,t){return i.P.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}e1.PHONE_SIGN_IN_METHOD=i.P.PHONE_SIGN_IN_METHOD,e1.PROVIDER_ID=i.P.PROVIDER_ID;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e2=i.at;class e3{constructor(e,t,n=r.Z.app()){var s;e2(null===(s=n.options)||void 0===s?void 0:s.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new i.R(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e4="auth-compat";(function(e){e.INTERNAL.registerComponent(new a.wA(e4,e=>new eX(e.getProvider("app-compat").getImmediate(),e.getProvider("auth")),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:i.A.EMAIL_SIGNIN,PASSWORD_RESET:i.A.PASSWORD_RESET,RECOVER_EMAIL:i.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:i.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:i.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:i.A.VERIFY_EMAIL}},EmailAuthProvider:i.Q,FacebookAuthProvider:i.U,GithubAuthProvider:i.W,GoogleAuthProvider:i.V,OAuthProvider:i.X,SAMLAuthProvider:i.Y,PhoneAuthProvider:e1,PhoneMultiFactorGenerator:i.m,RecaptchaVerifier:e3,TwitterAuthProvider:i.Z,Auth:eX,AuthCredential:i.J,Error:s.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),e.registerVersion(ey,ev)})(r.Z),/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */i.aR.initialize(l.ZP,l.PM,l.HM)},30905:(e,t,n)=>{"use strict";var r=n(48876),i=n(93219),s=n(2377),o=n(77752);let a="@firebase/firestore-compat",l="0.3.12";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new i.WA("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c(){if("undefined"==typeof Uint8Array)throw new i.WA("unimplemented","Uint8Arrays are not available in this environment.")}function h(){if(!(0,i.Me)())throw new i.WA("unimplemented","Blobs are unavailable in Firestore in this environment.")}class d{constructor(e){this._delegate=e}static fromBase64String(e){return h(),new d(i.Jj.fromBase64String(e))}static fromUint8Array(e){return c(),new d(i.Jj.fromUint8Array(e))}toBase64(){return h(),this._delegate.toBase64()}toUint8Array(){return c(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p(e){return f(e,["next","error","complete"])}function f(e,t){if("object"!=typeof e||null===e)return!1;let n=e;for(let e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g{enableIndexedDbPersistence(e,t){return(0,i.ST)(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return(0,i.fH)(e._delegate)}clearIndexedDbPersistence(e){return(0,i.Fc)(e._delegate)}}class m{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof i.l7||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();e.merge||t.host===e.host||(0,i.yq)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){(0,i.at)(this._delegate,e,t,n)}enableNetwork(){return(0,i.Ix)(this._delegate)}disableNetwork(){return(0,i.TF)(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,(0,i.Wi)("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return(0,i.Mx)(this._delegate)}onSnapshotsInSync(e){return(0,i.sc)(this._delegate,e)}get app(){if(!this._appCompat)throw new i.WA("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new A(this,(0,i.hJ)(this._delegate,e))}catch(e){throw T(e,"collection()","Firestore.collection()")}}doc(e){try{return new w(this,(0,i.JU)(this._delegate,e))}catch(e){throw T(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new R(this,(0,i.B$)(this._delegate,e))}catch(e){throw T(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return(0,i.i3)(this._delegate,t=>e(new _(this,t)))}batch(){return(0,i.qY)(this._delegate),new b(new i.PU(this._delegate,e=>(0,i.GL)(this._delegate,e)))}loadBundle(e){return(0,i.Pb)(this._delegate,e)}namedQuery(e){return(0,i.L$)(this._delegate,e).then(e=>e?new R(this,e):null)}}class y extends i.u7{constructor(e){super(),this.firestore=e}convertBytes(e){return new d(new i.Jj(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return w.forKey(t,this.firestore,null)}}function v(e){(0,i.Ub)(e)}class _{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new y(e)}get(e){let t=x(e);return this._delegate.get(t).then(e=>new I(this._firestore,new i.xU(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){let r=x(e);return n?(u("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){let i=x(e);return 2==arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){let t=x(e);return this._delegate.delete(t),this}}class b{constructor(e){this._delegate=e}set(e,t,n){let r=x(e);return n?(u("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){let i=x(e);return 2==arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){let t=x(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class S{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new i.$q(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new k(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=S.INSTANCES,r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new S(e,new y(e),t),r.set(t,i)),i}}S.INSTANCES=new WeakMap;class w{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new y(e)}static forPath(e,t,n){if(e.length%2!=0)throw new i.WA("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new w(t,new i.my(t._delegate,n,new i.Ky(e)))}static forKey(e,t,n){return new w(t,new i.my(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new A(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new A(this.firestore,(0,i.hJ)(this._delegate,e))}catch(e){throw T(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,s.m9)(e))instanceof i.my&&(0,i.Eo)(this._delegate,e)}set(e,t){t=u("DocumentReference.set",t);try{if(t)return(0,i.pl)(this._delegate,e,t);return(0,i.pl)(this._delegate,e)}catch(e){throw T(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{if(1==arguments.length)return(0,i.r7)(this._delegate,e);return(0,i.r7)(this._delegate,e,t,...n)}catch(e){throw T(e,"updateDoc()","DocumentReference.update()")}}delete(){return(0,i.oe)(this._delegate)}onSnapshot(...e){let t=E(e),n=C(e,e=>new I(this.firestore,new i.xU(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return(0,i.cf)(this._delegate,t,n)}get(e){let t;return(t=(null==e?void 0:e.source)==="cache"?(0,i.kl)(this._delegate):(null==e?void 0:e.source)==="server"?(0,i.Xk)(this._delegate):(0,i.QT)(this._delegate)).then(e=>new I(this.firestore,new i.xU(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new w(this.firestore,e?this._delegate.withConverter(S.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function T(e,t,n){return e.message=e.message.replace(t,n),e}function E(e){for(let t of e)if("object"==typeof t&&!p(t))return t;return{}}function C(e,t){var n,r;let i;return{next:e=>{i.next&&i.next(t(e))},error:null===(n=(i=p(e[0])?e[0]:p(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class I{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new w(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return(0,i.qK)(this._delegate,e._delegate)}}class k extends I{data(e){let t=this._delegate.data(e);return(0,i.K9)(void 0!==t,"Document in a QueryDocumentSnapshot should exist"),t}}class R{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new y(e)}where(e,t,n){try{return new R(this.firestore,(0,i.IO)(this._delegate,(0,i.ar)(e,t,n)))}catch(e){throw T(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new R(this.firestore,(0,i.IO)(this._delegate,(0,i.Xo)(e,t)))}catch(e){throw T(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new R(this.firestore,(0,i.IO)(this._delegate,(0,i.b9)(e)))}catch(e){throw T(e,"limit()","Query.limit()")}}limitToLast(e){try{return new R(this.firestore,(0,i.IO)(this._delegate,(0,i.vh)(e)))}catch(e){throw T(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new R(this.firestore,(0,i.IO)(this._delegate,(0,i.e0)(...e)))}catch(e){throw T(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new R(this.firestore,(0,i.IO)(this._delegate,(0,i.TQ)(...e)))}catch(e){throw T(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new R(this.firestore,(0,i.IO)(this._delegate,(0,i.Lx)(...e)))}catch(e){throw T(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new R(this.firestore,(0,i.IO)(this._delegate,(0,i.Wu)(...e)))}catch(e){throw T(e,"endAt()","Query.endAt()")}}isEqual(e){return(0,i.iE)(this._delegate,e._delegate)}get(e){let t;return(t=(null==e?void 0:e.source)==="cache"?(0,i.UQ)(this._delegate):(null==e?void 0:e.source)==="server"?(0,i.zN)(this._delegate):(0,i.PL)(this._delegate)).then(e=>new N(this.firestore,new i.W(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){let t=E(e),n=C(e,e=>new N(this.firestore,new i.W(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return(0,i.cf)(this._delegate,t,n)}withConverter(e){return new R(this.firestore,e?this._delegate.withConverter(S.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class O{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new k(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class N{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new R(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new k(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new O(this._firestore,e))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new k(this._firestore,n))})}isEqual(e){return(0,i.qK)(this._delegate,e._delegate)}}class A extends R{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new w(this.firestore,e):null}doc(e){try{if(void 0===e)return new w(this.firestore,(0,i.JU)(this._delegate));return new w(this.firestore,(0,i.JU)(this._delegate,e))}catch(e){throw T(e,"doc()","CollectionReference.doc()")}}add(e){return(0,i.ET)(this._delegate,e).then(e=>new w(this.firestore,e))}isEqual(e){return(0,i.Eo)(this._delegate,e._delegate)}withConverter(e){return new A(this.firestore,e?this._delegate.withConverter(S.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function x(e){return(0,i.Cf)(e,i.my)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D{constructor(...e){this._delegate=new i.Lz(...e)}static documentId(){return new D(i.Xb.keyField().canonicalString())}isEqual(e){return(e=(0,s.m9)(e))instanceof i.Lz&&this._delegate._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P{constructor(e){this._delegate=e}static serverTimestamp(){let e=(0,i.Bt)();return e._methodName="FieldValue.serverTimestamp",new P(e)}static delete(){let e=(0,i.AK)();return e._methodName="FieldValue.delete",new P(e)}static arrayUnion(...e){let t=(0,i.vr)(...e);return t._methodName="FieldValue.arrayUnion",new P(t)}static arrayRemove(...e){let t=(0,i.Ab)(...e);return t._methodName="FieldValue.arrayRemove",new P(t)}static increment(e){let t=(0,i.nP)(e);return t._methodName="FieldValue.increment",new P(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let M={Firestore:m,GeoPoint:i.F8,Timestamp:i.EK,Blob:d,Transaction:_,WriteBatch:b,DocumentReference:w,DocumentSnapshot:I,Query:R,QueryDocumentSnapshot:k,QuerySnapshot:N,CollectionReference:A,FieldPath:D,FieldValue:P,setLogLevel:v,CACHE_SIZE_UNLIMITED:i.IX};function L(e,t){e.INTERNAL.registerComponent(new o.wA("firestore-compat",e=>t(e.getProvider("app-compat").getImmediate(),e.getProvider("firestore").getImmediate()),"PUBLIC").setServiceProps(Object.assign({},M)))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(e){L(e,(e,t)=>new m(e,t,new g)),e.registerVersion(a,l,"node")})(r.Z)},18558:(e,t,n)=>{"use strict";let r,i,s,o,a,l,u,c,h,d;n.d(t,{U2:()=>s5,N8:()=>of,yv:()=>on,Jr:()=>or,MQ:()=>oi,jM:()=>ot,VF:()=>s4,iH:()=>s2,Od:()=>s6,t8:()=>s9});var p,f=n(83968),g=n(2377),m=n(65036),y=n(33497),v=n(77752);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _="5",b="v",S="s",w="r",T="f",E=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,C="ls",I="p",k="ac",R="websocket",O="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,g.Wl)(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,g.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,g.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let x=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new N(t)}}catch(e){}return new A},D=x("localStorage"),P=x("sessionStorage"),M=new m.Yd("@firebase/database"),L=function(){let e=1;return function(){return e++}}(),F=function(e){let t=(0,g.dS)(e),n=new g.gQ;n.update(t);let r=n.digest();return g.US.encodeByteArray(r)},B=function(...e){let t="";for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=B.apply(null,r):"object"==typeof r?t+=(0,g.Wl)(r):t+=r,t+=" "}return t},j=null,U=!0,q=function(e,t){(0,g.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(M.logLevel=m.in.VERBOSE,j=M.log.bind(M),t&&P.set("logging_enabled",!0)):"function"==typeof e?j=e:(j=null,P.remove("logging_enabled"))},V=function(...e){if(!0===U&&(U=!1,null===j&&!0===P.get("logging_enabled")&&q(!0)),j){let t=B.apply(null,e);j(t)}},z=function(e){return function(...t){V(e,...t)}},W=function(...e){let t="FIREBASE INTERNAL ERROR: "+B(...e);M.error(t)},$=function(...e){let t=`FIREBASE FATAL ERROR: ${B(...e)}`;throw M.error(t),Error(t)},G=function(...e){let t="FIREBASE WARNING: "+B(...e);M.warn(t)},H=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&G("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},K=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Q=function(e){if((0,g.Yr)()||"complete"===document.readyState)e();else{let t=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},Y="[MIN_NAME]",J="[MAX_NAME]",X=function(e,t){if(e===t)return 0;if(e===Y||t===J)return -1;if(t===Y||e===J)return 1;{let n=eh(e),r=eh(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},Z=function(e,t){return e===t?0:e<t?-1:1},ee=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+(0,g.Wl)(t))},et=function(e){if("object"!=typeof e||null===e)return(0,g.Wl)(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=(0,g.Wl)(t[r])+":"+et(e[t[r]]);return n+"}"},en=function(e,t){let n=e.length;if(n<=t)return[e];let r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function er(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let ei=function(e){let t,n,r,i,s;(0,g.hu)(!K(e),"Invalid JSON number");let o=11,a=52,l=1023;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,1-l)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),l))+l,r=Math.round(e*Math.pow(2,a-i)-Math.pow(2,a))):(n=0,r=Math.round(e/Math.pow(2,1-l-a))));let u=[];for(s=a;s;s-=1)u.push(r%2?1:0),r=Math.floor(r/2);for(s=o;s;s-=1)u.push(n%2?1:0),n=Math.floor(n/2);u.push(t?1:0),u.reverse();let c=u.join(""),h="";for(s=0;s<64;s+=8){let e=parseInt(c.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),h+=e}return h.toLowerCase()},es=function(){return!!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},eo=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI};function ea(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");let r=Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}let el=RegExp("^-?(0*)\\d{1,10}$"),eu=-2147483648,ec=2147483647,eh=function(e){if(el.test(e)){let t=Number(e);if(t>=eu&&t<=ec)return t}return null},ed=function(e){try{e()}catch(e){setTimeout(()=>{throw G("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},ep=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ef=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=D.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&D.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function em(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function ey(e,t,n){let r;if((0,g.hu)("string"==typeof t,"typeof type must == string"),(0,g.hu)("object"==typeof n,"typeof params must == object"),t===R)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===O)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);em(e)&&(n.ns=e.namespace);let i=[];return er(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,g.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,g.p$)(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e_={},eb={};function eS(e){let t=e.toString();return e_[t]||(e_[t]=new ev),e_[t]}function ew(e,t){let n=e.toString();return eb[n]||(eb[n]=t()),eb[n]}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eT="";function eE(e){eT=e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eC=16384,eI=45e3,ek=null;function eR(e){ek=e}"undefined"!=typeof MozWebSocket?ek=MozWebSocket:"undefined"!=typeof WebSocket&&(ek=WebSocket);class eO{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=z(this.connId),this.stats_=eS(t),this.connURL=eO.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){let s={};return s[b]=_,!(0,g.Yr)()&&"undefined"!=typeof location&&location.hostname&&E.test(location.hostname)&&(s[w]=T),t&&(s[S]=t),n&&(s[C]=n),r&&(s[k]=r),i&&(s[I]=i),ey(e,R,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,D.set("previous_websocket_failure",!0);try{let e;if((0,g.Yr)()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/${_}/${eT}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=process.env,r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new ek(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){eO.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&4.4>parseFloat(n[1])&&(e=!0)}return!e&&null!==ek&&!eO.forceDisallow_}static previouslyFailed(){return D.isInMemoryStorage||!0===D.get("previous_websocket_failure")}markConnectionHealthy(){D.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=(0,g.cI)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,g.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=(0,g.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=en(t,eC);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(eI))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}eO.responsesRequiredToBeHealthy=2,eO.healthyTimeout=3e4;let eN="@firebase/database",eA="0.14.4";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ex{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){G(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eD{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(V("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',G(e)}}class eP{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}eP.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eM{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&ed(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eL="start",eF="close",eB="pLPCommand",ej="pRTLPCB",eU="id",eq="pw",eV="ser",ez="cb",eW="seg",e$="ts",eG="d",eH="dframe",eK=1870,eQ=30,eY=1840,eJ=25e3,eX=3e4;class eZ{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=z(e),this.stats_=eS(t),this.urlFn=e=>(this.appCheckToken&&(e[k]=this.appCheckToken),ey(t,O,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new eM(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(eX)),Q(()=>{if(this.isClosed_)return;this.scriptTagHolder=new e0((...e)=>{let[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder){if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===eL)this.id=n,this.password=r;else if(t===eF)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)}},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[eL]="t",e[eV]=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e[ez]=this.scriptTagHolder.uniqueCallbackIdentifier),e[b]=_,this.transportSessionId&&(e[S]=this.transportSessionId),this.lastSessionId&&(e[C]=this.lastSessionId),this.applicationId&&(e[I]=this.applicationId),this.appCheckToken&&(e[k]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&E.test(location.hostname)&&(e[w]=T);let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){eZ.forceAllow_=!0}static forceDisallow(){eZ.forceDisallow_=!0}static isAvailable(){return!(0,g.Yr)()&&(!!eZ.forceAllow_||!eZ.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!es()&&!eo())}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=(0,g.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=en((0,g.h$)(t),eY);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,g.Yr)())return;this.myDisconnFrame=document.createElement("iframe");let n={};n[eH]="t",n[eU]=e,n[eq]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=(0,g.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class e0{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,g.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=L(),window[eB+this.uniqueCallbackIdentifier]=e,window[ej+this.uniqueCallbackIdentifier]=t,this.myIFrame=e0.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');let r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){V("frame writing exception"),e.stack&&V(e.stack),V(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||V("No IE domain setting required")}catch(n){let t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e[eU]=this.myID,e[eq]=this.myPW,e[eV]=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+eQ+n.length<=eK){let e=this.pendingSegs.shift();n=n+"&"+eW+r+"="+e.seg+"&"+e$+r+"="+e.ts+"&"+eG+r+"="+e.d,r++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(eJ)),i=()=>{clearTimeout(r),n()};this.addTag(e,i)}addTag(e,t){(0,g.Yr)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{V("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[eZ,eO]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){let t=eO&&eO.isAvailable(),n=t&&!eO.previouslyFailed();if(e.webSocketOnly&&(t||G("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[eO];else{let e=this.transports_=[];for(let t of e1.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);e1.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}e1.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e2=6e4,e3=5e3,e4=10240,e6=102400,e9="t",e5="d",e7="s",e8="r",te="e",tt="o",tn="a",tr="n",ti="p",ts="h";class to{constructor(e,t,n,r,i,s,o,a,l,u){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=z("c:"+this.id+":"),this.transportManager_=new e1(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=ef(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>e6?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>e4?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(e9 in e){let t=e[e9];t===tn?this.upgradeIfSecondaryHealthy_():t===e8?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===tt&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=ee("t",e),n=ee("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:ti,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:tn,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:tr,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=ee("t",e),n=ee("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=ee(e9,e);if(e5 in e){let n=e[e5];if(t===ts){let e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if(t===tr){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===e7?this.onConnectionShutdown_(n):t===e8?this.onReset_(n):t===te?W("Server Error: "+n):t===tt?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):W("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),_!==n&&G("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),ef(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(e2))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ef(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:ti,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(D.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,g.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context)){r.splice(e,1);return}}validateEventType_(e){(0,g.hu)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu extends tl{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,g.uI)()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new tu}getInitialEvent(e){return(0,g.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tc=32,th=768;class td{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function tp(){return new td("")}function tf(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function tg(e){return e.pieces_.length-e.pieceNum_}function tm(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new td(e.pieces_,t)}function ty(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function tv(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}function t_(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function tb(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new td(t,0)}function tS(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof td)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new td(n,0)}function tw(e){return e.pieceNum_>=e.pieces_.length}function tT(e,t){let n=tf(e),r=tf(t);if(null===n)return t;if(n===r)return tT(tm(e),tm(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function tE(e,t){let n=t_(e,0),r=t_(t,0);for(let e=0;e<n.length&&e<r.length;e++){let t=X(n[e],r[e]);if(0!==t)return t}return n.length===r.length?0:n.length<r.length?-1:1}function tC(e,t){if(tg(e)!==tg(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function tI(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(tg(e)>tg(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class tk{constructor(e,t){this.errorPrefix_=t,this.parts_=t_(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=(0,g.ug)(this.parts_[e]);tN(this)}}function tR(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=(0,g.ug)(t),tN(e)}function tO(e){let t=e.parts_.pop();e.byteLength_-=(0,g.ug)(t),e.parts_.length>0&&(e.byteLength_-=1)}function tN(e){if(e.byteLength_>th)throw Error(e.errorPrefix_+"has a key path longer than "+th+" bytes ("+e.byteLength_+").");if(e.parts_.length>tc)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+tc+") or object contains a cycle "+tA(e))}function tA(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tx extends tl{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new tx}getInitialEvent(e){return(0,g.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tD=1e3,tP=3e5,tM=3e4,tL=1.3,tF=3e4,tB="server_kill",tj=3;class tU extends ta{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=tU.nextPersistentConnectionId_++,this.log_=z("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=tD,this.maxReconnectDelay_=tP,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!(0,g.Yr)())throw Error("Auth override specified in options, but not supported on non Node.js platforms");tx.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&tu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_((0,g.Wl)(i)),(0,g.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();let t=new g.BH,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();let i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),(0,g.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,g.hu)(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");let o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);let i={p:n},s="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(s,i,i=>{let s=i.d,o=i.s;tU.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&(0,g.r3)(e,"w")){let n=(0,g.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();G(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,g.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=tM)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=(0,g.w9)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),(0,g.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);let i={p:e},s="n";r&&(i.q=n,i.t=r),this.sendRequest(s,i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){let i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();let s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,g.Wl)(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):W("Unrecognized action received from server: "+(0,g.Wl)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,g.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){!e||this.visible_||this.reconnectDelay_!==this.maxReconnectDelay_||(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=tD,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=tD,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>tF&&(this.reconnectDelay_=tD),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=new Date().getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*tL)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+tU.nextConnectionId_++,i=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())},l=function(e){(0,g.hu)(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)};this.realtime_={close:a,sendRequest:l};let u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,l]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);s?V("getToken() completed but was canceled"):(V("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=l&&l.token,o=new to(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{G(e+" ("+this.repoInfo_.toString()+")"),this.interrupt(tB)},i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&G(e),a())}}}interrupt(e){V("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){V("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,g.xb)(this.interruptReasons_)&&(this.reconnectDelay_=tD,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>et(e)).join("$"):"default";let r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){let n;let r=new td(e).toString();if(this.listens.has(r)){let e=this.listens.get(r);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(r)}else n=void 0;return n}onAuthRevoked_(e,t){V("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=tj&&(this.reconnectDelay_=tM,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){V("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=tj&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";(0,g.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+eT.replace(/\./g,"-")]=1,(0,g.uI)()?e["framework.cordova"]=1:(0,g.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=tu.getInstance().currentlyOnline();return(0,g.xb)(this.interruptReasons_)&&e}}tU.nextPersistentConnectionId_=0,tU.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tq{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new tq(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tV{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new tq(Y,e),r=new tq(Y,t);return 0!==this.compare(n,r)}minPost(){return tq.MIN}}class tz extends tV{static get __EMPTY_NODE(){return r}static set __EMPTY_NODE(e){r=e}compare(e,t){return X(e.name,t.name)}isDefinedOn(e){throw(0,g.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return tq.MIN}maxPost(){return new tq(J,r)}makePost(e,t){return(0,g.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new tq(e,r)}toString(){return".key"}}let tW=new tz;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t${constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class tG{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:tG.RED,this.left=null!=r?r:tK.EMPTY_NODE,this.right=null!=i?i:tK.EMPTY_NODE}copy(e,t,n,r,i){return new tG(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return tK.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,r;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return tK.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,tG.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,tG.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+(this.isRed_()?0:1);throw Error("Black depths differ")}}tG.RED=!0,tG.BLACK=!1;class tH{copy(e,t,n,r,i){return this}insert(e,t,n){return new tG(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class tK{constructor(e,t=tK.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new tK(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,tG.BLACK,null,null))}remove(e){return new tK(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,tG.BLACK,null,null))}get(e){let t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty()){if(r)return r.key;return null}for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new t$(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new t$(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new t$(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new t$(this.root_,null,this.comparator_,!0,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tQ(e,t){return X(e.name,t.name)}function tY(e,t){return X(e,t)}function tJ(e){i=e}tK.EMPTY_NODE=new tH;let tX=function(e){return"number"==typeof e?"number:"+ei(e):"string:"+e},tZ=function(e){if(e.isLeafNode()){let t=e.val();(0,g.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,g.r3)(t,".sv"),"Priority must be a string or number.")}else(0,g.hu)(e===i||e.isEmpty(),"priority of unexpected type.");(0,g.hu)(e===i||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class t0{constructor(e,t=t0.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,(0,g.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),tZ(this.priorityNode_)}static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new t0(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:t0.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return tw(e)?this:".priority"===tf(e)?this.priorityNode_:t0.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:t0.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=tf(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:((0,g.hu)(".priority"!==n||1===tg(e),".priority must be the last token in a path"),this.updateImmediateChild(n,t0.__childrenNodeConstructor.EMPTY_NODE.updateChild(tm(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+tX(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=ei(this.value_):e+=this.value_,this.lazyHash_=F(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===t0.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t0.__childrenNodeConstructor?-1:((0,g.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,r=t0.VALUE_TYPE_ORDER.indexOf(t),i=t0.VALUE_TYPE_ORDER.indexOf(n);return((0,g.hu)(r>=0,"Unknown leaf type: "+t),(0,g.hu)(i>=0,"Unknown leaf type: "+n),r!==i)?i-r:"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(!e.isLeafNode())return!1;{let t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}}}function t1(e){o=e}function t2(e){a=e}t0.VALUE_TYPE_ORDER=["object","boolean","number","string"];class t3 extends tV{compare(e,t){let n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?X(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return tq.MIN}maxPost(){return new tq(J,new t0("[PRIORITY-POST]",a))}makePost(e,t){return new tq(t,new t0("[PRIORITY-POST]",o(e)))}toString(){return".priority"}}let t4=new t3,t6=Math.log(2);class t9{constructor(e){let t=e=>parseInt(Math.log(e)/t6,10),n=e=>parseInt(Array(e+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=n(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let t5=function(e,t,n,r){e.sort(t);let i=function(t,r){let s,o;let a=r-t;if(0===a)return null;if(1===a)return s=e[t],new tG(o=n?n(s):s,s.node,tG.BLACK,null,null);{let l=parseInt(a/2,10)+t,u=i(t,l),c=i(l+1,r);return s=e[l],new tG(o=n?n(s):s,s.node,tG.BLACK,u,c)}};return new tK(r||t,function(t){let r=null,s=null,o=e.length,a=function(t,r){let s=o-t,a=o;o-=t;let u=i(s+1,a),c=e[s];l(new tG(n?n(c):c,c.node,r,null,u))},l=function(e){r?r.left=e:s=e,r=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,tG.BLACK):(a(r,tG.BLACK),a(r,tG.RED))}return s}(new t9(e.length)))},t7={};class t8{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,g.hu)(t7&&t4,"ChildrenNode.ts has not been loaded"),l=l||new t8({".priority":t7},{".priority":t4})}get(e){let t=(0,g.DV)(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof tK?t:null}hasIndex(e){return(0,g.r3)(this.indexSet_,e.toString())}addIndex(e,t){let n;(0,g.hu)(e!==tW,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(tq.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();n=i?t5(r,e.getCompare()):t7;let a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;let u=Object.assign({},this.indexes_);return u[a]=n,new t8(u,l)}addToIndexes(e,t){return new t8((0,g.UI)(this.indexes_,(n,r)=>{let i=(0,g.DV)(this.indexSet_,r);if((0,g.hu)(i,"Missing index implementation for "+r),n===t7){if(!i.isDefinedOn(e.node))return t7;{let n=[],r=t.getIterator(tq.Wrap),s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),t5(n,i.getCompare())}}{let r=t.get(e.name),i=n;return r&&(i=i.remove(new tq(e.name,r))),i.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new t8((0,g.UI)(this.indexes_,n=>{if(n===t7)return n;{let r=t.get(e.name);return r?n.remove(new tq(e.name,r)):n}}),this.indexSet_)}}class ne{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&tZ(this.priorityNode_),this.children_.isEmpty()&&(0,g.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return u||(u=new ne(new tK(tY),null,t8.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||u}updatePriority(e){return this.children_.isEmpty()?this:new ne(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?u:t}}getChild(e){let t=tf(e);return null===t?this:this.getImmediateChild(t).getChild(tm(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if((0,g.hu)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,r;let i=new tq(e,t);t.isEmpty()?(n=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(n=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));let s=n.isEmpty()?u:this.priorityNode_;return new ne(n,s,r)}}updateChild(e,t){let n=tf(e);if(null===n)return t;{(0,g.hu)(".priority"!==tf(e)||1===tg(e),".priority must be the last token in a path");let r=this.getImmediateChild(n).updateChild(tm(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,r=0,i=!0;if(this.forEachChild(t4,(s,o)=>{t[s]=o.val(e),n++,i&&ne.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),e||!i||!(r<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+tX(this.getPriority().val())+":"),this.forEachChild(t4,(t,n)=>{let r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":F(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let r=this.resolveIndex_(n);if(!r)return this.children_.getPredecessorKey(e);{let n=r.getPredecessorKey(new tq(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new tq(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new tq(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,tq.Wrap),r=n.peek();for(;null!=r&&0>t.compare(r,e);)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,tq.Wrap),r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===nn?-1:0}withIndex(e){if(e===tW||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new ne(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===tW||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{let t=e;if(!this.getPriority().equals(t.getPriority())||this.children_.count()!==t.children_.count())return!1;{let e=this.getIterator(t4),n=t.getIterator(t4),r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}}}resolveIndex_(e){return e===tW?null:this.indexMap_.get(e.toString())}}ne.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class nt extends ne{constructor(){super(new tK(tY),ne.EMPTY_NODE,t8.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ne.EMPTY_NODE}isEmpty(){return!1}}let nn=new nt;Object.defineProperties(tq,{MIN:{value:new tq(Y,ne.EMPTY_NODE)},MAX:{value:new tq(J,nn)}}),tz.__EMPTY_NODE=ne.EMPTY_NODE,t0.__childrenNodeConstructor=ne,tJ(nn),t2(nn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nr=!0;function ni(e,t=null){if(null===e)return ne.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,g.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new t0(e,ni(t));if(e instanceof Array||!nr){let n=ne.EMPTY_NODE;return er(e,(t,r)=>{if((0,g.r3)(e,t)&&"."!==t.substring(0,1)){let e=ni(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(ni(t))}{let n=[],r=!1;if(er(e,(e,t)=>{if("."!==e.substring(0,1)){let i=ni(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new tq(e,i)))}}),0===n.length)return ne.EMPTY_NODE;let i=t5(n,tQ,e=>e.name,tY);if(!r)return new ne(i,ni(t),t8.Default);{let e=t5(n,t4.getCompare());return new ne(i,ni(t),new t8({".priority":e},{".priority":t4}))}}}t1(ni);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ns extends tV{constructor(e){super(),this.indexPath_=e,(0,g.hu)(!tw(e)&&".priority"!==tf(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?X(e.name,t.name):i}makePost(e,t){let n=ni(e);return new tq(t,ne.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new tq(J,ne.EMPTY_NODE.updateChild(this.indexPath_,nn))}toString(){return t_(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no extends tV{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?X(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return tq.MIN}maxPost(){return tq.MAX}makePost(e,t){return new tq(t,ni(e))}toString(){return".value"}}let na=new no;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nl(e){return{type:"value",snapshotNode:e}}function nu(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function nc(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function nh(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}function nd(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class np{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){(0,g.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(nc(t,o)):(0,g.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(nu(t,n)):s.trackChildChange(nh(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null==n||(e.isLeafNode()||e.forEachChild(t4,(e,r)=>{t.hasChild(e)||n.trackChildChange(nc(e,r))}),t.isLeafNode()||t.forEachChild(t4,(t,r)=>{if(e.hasChild(t)){let i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(nh(t,r,i))}else n.trackChildChange(nu(t,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ne.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e){this.indexedFilter_=new np(e.getIndex()),this.index_=e.getIndex(),this.startPost_=nf.getStartPost_(e),this.endPost_=nf.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new tq(t,n))||(n=ne.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=ne.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(ne.EMPTY_NODE);let i=this;return t.forEachChild(t4,(e,t)=>{i.matches(new tq(e,t))||(r=r.updateImmediateChild(e,ne.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new nf(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return(this.rangedFilter_.matches(new tq(t,n))||(n=ne.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=ne.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=ne.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t)){if(this.withinDirectionalEnd(t))r=r.updateImmediateChild(t.name,t.node),n++;else break}}}else{let e;r=(r=t.withIndex(this.index_)).updatePriority(ne.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,ne.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();let o=e;(0,g.hu)(o.numChildren()===this.limit_,"");let a=new tq(t,n),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),u=this.rangedFilter_.matches(a);if(o.hasChild(t)){let e=o.getImmediateChild(t),c=r.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=c&&(c.name===t||o.hasChild(c.name));)c=r.getChildAfterChild(this.index_,c,this.reverse_);let h=null==c?1:s(c,a);if(u&&!n.isEmpty()&&h>=0)return null!=i&&i.trackChildChange(nh(t,n,e)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(nc(t,e));let n=o.updateImmediateChild(t,ne.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=i&&i.trackChildChange(nu(c.name,c.node)),n.updateImmediateChild(c.name,c.node)):n}}return n.isEmpty()?e:u&&s(l,a)>=0?(null!=i&&(i.trackChildChange(nc(l.name,l.node)),i.trackChildChange(nu(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(l.name,ne.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=t4}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,g.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return((0,g.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:Y}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,g.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return((0,g.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:J}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,g.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===t4}copy(){let e=new nm;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ny(e){return e.loadsAllData()?new np(e.getIndex()):e.hasLimit()?new ng(e):new nf(e)}function nv(e,t,n){let r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function n_(e,t,n){let r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function nb(e){let t;let n={};if(e.isDefault())return n;if(e.index_===t4?t="$priority":e.index_===na?t="$value":e.index_===tW?t="$key":((0,g.hu)(e.index_ instanceof ns,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,g.Wl)(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=(0,g.Wl)(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+(0,g.Wl)(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=(0,g.Wl)(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+(0,g.Wl)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function nS(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==t4&&(t.i=e.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw extends ta{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=z("p:rest:"),this.listens_={}}reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,g.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let s=nw.getListenId_(e,n),o={};this.listens_[s]=o;let a=nb(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),(0,g.DV)(this.listens_,s)===o){let t;r(t=e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}})}unlisten(e,t){let n=nw.getListenId_(e,t);delete this.listens_[n]}get(e){let t=nb(e._queryParams),n=e._path.toString(),r=new g.BH;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,g.xO)(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=(0,g.cI)(o.responseText)}catch(e){G("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&G("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nT{constructor(){this.rootNode_=ne.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nE(){return{value:null,children:new Map}}function nC(e,t,n){if(tw(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{let r=tf(t);e.children.has(r)||e.children.set(r,nE()),nC(e.children.get(r),t=tm(t),n)}}function nI(e,t){if(tw(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{let n=e.value;return e.value=null,n.forEachChild(t4,(t,n)=>{nC(e,new td(t),n)}),nI(e,t)}}if(!(e.children.size>0))return!0;{let n=tf(t);return t=tm(t),e.children.has(n)&&nI(e.children.get(n),t)&&e.children.delete(n),0===e.children.size}}function nk(e,t,n){null!==e.value?n(t,e.value):nR(e,(e,r)=>{nk(r,new td(t.toString()+"/"+e),n)})}function nR(e,t){e.children.forEach((e,n)=>{t(n,e)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nO{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&er(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nN=1e4,nA=3e4,nx=3e5;class nD{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new nO(e);let n=nN+(nA-nN)*Math.random();ef(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;er(e,(e,r)=>{r>0&&(0,g.r3)(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),ef(this.reportStats_.bind(this),Math.floor(2*Math.random()*nx))}}function nP(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function nM(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function nL(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(p||(p={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nF{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=p.ACK_USER_WRITE,this.source=nP()}operationForChild(e){if(!tw(this.path))return(0,g.hu)(tf(this.path)===e,"operationForChild called for unrelated child."),new nF(tm(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return(0,g.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new td(e));return new nF(tp(),t,this.revert)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nB{constructor(e,t){this.source=e,this.path=t,this.type=p.LISTEN_COMPLETE}operationForChild(e){return tw(this.path)?new nB(this.source,tp()):new nB(this.source,tm(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nj{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=p.OVERWRITE}operationForChild(e){return tw(this.path)?new nj(this.source,tp(),this.snap.getImmediateChild(e)):new nj(this.source,tm(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nU{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=p.MERGE}operationForChild(e){if(!tw(this.path))return(0,g.hu)(tf(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new nU(this.source,tm(this.path),this.children);{let t=this.children.subtree(new td(e));return t.isEmpty()?null:t.value?new nj(this.source,tp(),t.value):new nU(this.source,tp(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nq{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(tw(e))return this.isFullyInitialized()&&!this.filtered_;let t=tf(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nV{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function nz(e,t,n,r){let i=[],s=[];return t.forEach(t=>{"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(nd(t.childName,t.snapshotNode))}),nW(e,i,"child_removed",t,r,n),nW(e,i,"child_added",t,r,n),nW(e,i,"child_moved",s,r,n),nW(e,i,"child_changed",t,r,n),nW(e,i,"value",t,r,n),i}function nW(e,t,n,r,i,s){let o=r.filter(e=>e.type===n);o.sort((t,n)=>nG(e,t,n)),o.forEach(n=>{let r=n$(e,n,s);i.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function n$(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}function nG(e,t,n){if(null==t.childName||null==n.childName)throw(0,g.g5)("Should only compare child_ events.");let r=new tq(t.childName,t.snapshotNode),i=new tq(n.childName,n.snapshotNode);return e.index_.compare(r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nH(e,t){return{eventCache:e,serverCache:t}}function nK(e,t,n,r){return nH(new nq(t,n,r),e.serverCache)}function nQ(e,t,n,r){return nH(e.eventCache,new nq(t,n,r))}function nY(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function nJ(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let nX=()=>(c||(c=new tK(Z)),c);class nZ{constructor(e,t=nX()){this.value=e,this.children=t}static fromObject(e){let t=new nZ(null);return er(e,(e,n)=>{t=t.set(new td(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:tp(),value:this.value};if(tw(e))return null;{let n=tf(e),r=this.children.get(n);if(null===r)return null;{let i=r.findRootMostMatchingPathAndValue(tm(e),t);return null!=i?{path:tS(new td(n),i.path),value:i.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(tw(e))return this;{let t=tf(e),n=this.children.get(t);return null!==n?n.subtree(tm(e)):new nZ(null)}}set(e,t){if(tw(e))return new nZ(t,this.children);{let n=tf(e),r=(this.children.get(n)||new nZ(null)).set(tm(e),t),i=this.children.insert(n,r);return new nZ(this.value,i)}}remove(e){if(tw(e))return this.children.isEmpty()?new nZ(null):new nZ(null,this.children);{let t=tf(e),n=this.children.get(t);if(!n)return this;{let r;let i=n.remove(tm(e));return(r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty())?new nZ(null):new nZ(this.value,r)}}}get(e){if(tw(e))return this.value;{let t=tf(e),n=this.children.get(t);return n?n.get(tm(e)):null}}setTree(e,t){if(tw(e))return t;{let n;let r=tf(e),i=(this.children.get(r)||new nZ(null)).setTree(tm(e),t);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new nZ(this.value,n)}}fold(e){return this.fold_(tp(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(tS(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,tp(),t)}findOnPath_(e,t,n){let r=!!this.value&&n(t,this.value);if(r)return r;if(tw(e))return null;{let r=tf(e),i=this.children.get(r);return i?i.findOnPath_(tm(e),tS(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,tp(),t)}foreachOnPath_(e,t,n){if(tw(e))return this;{this.value&&n(t,this.value);let r=tf(e),i=this.children.get(r);return i?i.foreachOnPath_(tm(e),tS(t,r),n):new nZ(null)}}foreach(e){this.foreach_(tp(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(tS(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(e){this.writeTree_=e}static empty(){return new n0(new nZ(null))}}function n1(e,t,n){if(tw(t))return new n0(new nZ(n));{let r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){let i=r.path,s=r.value,o=tT(i,t);return s=s.updateChild(o,n),new n0(e.writeTree_.set(i,s))}{let r=new nZ(n);return new n0(e.writeTree_.setTree(t,r))}}}function n2(e,t,n){let r=e;return er(n,(e,n)=>{r=n1(r,tS(t,e),n)}),r}function n3(e,t){return tw(t)?n0.empty():new n0(e.writeTree_.setTree(t,new nZ(null)))}function n4(e,t){return null!=n6(e,t)}function n6(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(tT(n.path,t)):null}function n9(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(t4,(e,n)=>{t.push(new tq(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new tq(e,n.value))}),t}function n5(e,t){if(tw(t))return e;{let n=n6(e,t);return new n0(null!=n?new nZ(n):e.writeTree_.subtree(t))}}function n7(e){return e.writeTree_.isEmpty()}function n8(e,t){return re(tp(),e.writeTree_,t)}function re(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?((0,g.hu)(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=re(tS(e,t),i,n)}),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(tS(e,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rt(e,t){return rE(t,e)}function rn(e,t,n,r,i){(0,g.hu)(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=n1(e.visibleWrites,t,n)),e.lastWriteId=r}function rr(e,t,n,r){assert(r>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:n,writeId:r,visible:!0}),e.visibleWrites=n2(e.visibleWrites,t,n),e.lastWriteId=r}function ri(e,t){for(let n=0;n<e.allWrites.length;n++){let r=e.allWrites[n];if(r.writeId===t)return r}return null}function rs(e,t){let n=e.allWrites.findIndex(e=>e.writeId===t);(0,g.hu)(n>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){let t=e.allWrites[o];t.visible&&(o>=n&&ro(t,r.path)?i=!1:tI(r.path,t.path)&&(s=!0)),o--}return!!i&&(s?ra(e):r.snap?e.visibleWrites=n3(e.visibleWrites,r.path):er(r.children,t=>{e.visibleWrites=n3(e.visibleWrites,tS(r.path,t))}),!0)}function ro(e,t){if(e.snap)return tI(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&tI(tS(e.path,n),t))return!0;return!1}function ra(e){e.visibleWrites=ru(e.allWrites,rl,tp()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function rl(e){return e.visible}function ru(e,t,n){let r=n0.empty();for(let i=0;i<e.length;++i){let s=e[i];if(t(s)){let e;let t=s.path;if(s.snap)tI(n,t)?r=n1(r,e=tT(n,t),s.snap):tI(t,n)&&(e=tT(t,n),r=n1(r,tp(),s.snap.getChild(e)));else if(s.children){if(tI(n,t))r=n2(r,e=tT(n,t),s.children);else if(tI(t,n)){if(tw(e=tT(t,n)))r=n2(r,tp(),s.children);else{let t=(0,g.DV)(s.children,tf(e));if(t){let n=t.getChild(tm(e));r=n1(r,tp(),n)}}}}else throw(0,g.g5)("WriteRecord should have .snap or .children")}}return r}function rc(e,t,n,r,i){if(r||i){let s=n5(e.visibleWrites,t);if(!i&&n7(s))return n;if(!i&&null==n&&!n4(s,tp()))return null;{let s=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(tI(e.path,t)||tI(t,e.path))};return n8(ru(e.allWrites,s,t),n||ne.EMPTY_NODE)}}{let r=n6(e.visibleWrites,t);if(null!=r)return r;{let r=n5(e.visibleWrites,t);return n7(r)?n:null!=n||n4(r,tp())?n8(r,n||ne.EMPTY_NODE):null}}}function rh(e,t,n){let r=ne.EMPTY_NODE,i=n6(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(t4,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(!n)return n9(n5(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r;{let i=n5(e.visibleWrites,t);return n.forEachChild(t4,(e,t)=>{let n=n8(n5(i,new td(e)),t);r=r.updateImmediateChild(e,n)}),n9(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}}function rd(e,t,n,r,i){(0,g.hu)(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=tS(t,n);if(n4(e.visibleWrites,s))return null;{let t=n5(e.visibleWrites,s);return n7(t)?i.getChild(n):n8(t,i.getChild(n))}}function rp(e,t,n,r){let i=tS(t,n),s=n6(e.visibleWrites,i);return null!=s?s:r.isCompleteForChild(n)?n8(n5(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}function rf(e,t){return n6(e.visibleWrites,t)}function rg(e,t,n,r,i,s,o){let a;let l=n5(e.visibleWrites,t),u=n6(l,tp());if(null!=u)a=u;else{if(null==n)return[];a=n8(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),l=n.getNext();for(;l&&e.length<i;)0!==t(l,r)&&e.push(l),l=n.getNext();return e}}function rm(){return{visibleWrites:n0.empty(),allWrites:[],lastWriteId:-1}}function ry(e,t,n,r){return rc(e.writeTree,e.treePath,t,n,r)}function rv(e,t){return rh(e.writeTree,e.treePath,t)}function r_(e,t,n,r){return rd(e.writeTree,e.treePath,t,n,r)}function rb(e,t){return rf(e.writeTree,tS(e.treePath,t))}function rS(e,t,n,r,i,s){return rg(e.writeTree,e.treePath,t,n,r,i,s)}function rw(e,t,n){return rp(e.writeTree,e.treePath,t,n)}function rT(e,t){return rE(tS(e.treePath,t),e.writeTree)}function rE(e,t){return{treePath:e,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rC{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;(0,g.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,g.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");let r=this.changeMap.get(n);if(r){let i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,nh(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,nc(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,nu(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(n,nh(n,e.snapshotNode,r.oldSnap));else throw(0,g.g5)("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}let rk=new rI;class rR{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new nq(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return rw(this.writes_,e,t)}}getChildAfterChild(e,t,n){let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:nJ(this.viewCache_),i=rS(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rO(e){return{filter:e}}function rN(e,t){(0,g.hu)(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),(0,g.hu)(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function rA(e,t,n,r,i){let s,o;let a=new rC;if(n.type===p.OVERWRITE){let l=n;l.source.fromUser?s=rM(e,t,l.path,l.snap,r,i,a):((0,g.hu)(l.source.fromServer,"Unknown source."),o=l.source.tagged||t.serverCache.isFiltered()&&!tw(l.path),s=rP(e,t,l.path,l.snap,r,i,o,a))}else if(n.type===p.MERGE){let l=n;l.source.fromUser?s=rF(e,t,l.path,l.children,r,i,a):((0,g.hu)(l.source.fromServer,"Unknown source."),o=l.source.tagged||t.serverCache.isFiltered(),s=rj(e,t,l.path,l.children,r,i,o,a))}else if(n.type===p.ACK_USER_WRITE){let o=n;s=o.revert?rV(e,t,o.path,r,i,a):rU(e,t,o.path,o.affectedTree,r,i,a)}else if(n.type===p.LISTEN_COMPLETE)s=rq(e,t,n.path,r,a);else throw(0,g.g5)("Unknown operation type: "+n.type);let l=a.getChanges();return rx(t,s,l),{viewCache:s,changes:l}}function rx(e,t,n){let r=t.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=nY(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!i||r.getNode().equals(s))&&r.getNode().getPriority().equals(s.getPriority())||n.push(nl(nY(t)))}}function rD(e,t,n,r,i,s){let o=t.eventCache;if(null!=rb(r,n))return t;{let a,l;if(tw(n)){if((0,g.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=nJ(t),i=rv(r,n instanceof ne?n:ne.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{let n=ry(r,nJ(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}}else{let u=tf(n);if(".priority"===u){(0,g.hu)(1===tg(n),"Can't have a priority with additional path components");let i=o.getNode(),s=r_(r,n,i,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{let c;let h=tm(n);if(o.isCompleteForChild(u)){l=t.serverCache.getNode();let e=r_(r,n,o.getNode(),l);c=null!=e?o.getNode().getImmediateChild(u).updateChild(h,e):o.getNode().getImmediateChild(u)}else c=rw(r,u,t.serverCache);a=null!=c?e.filter.updateChild(o.getNode(),u,c,h,i,s):o.getNode()}}return nK(t,a,o.isFullyInitialized()||tw(n),e.filter.filtersNodes())}}function rP(e,t,n,r,i,s,o,a){let l;let u=t.serverCache,c=o?e.filter:e.filter.getIndexedFilter();if(tw(n))l=c.updateFullNode(u.getNode(),r,null);else if(c.filtersNodes()&&!u.isFiltered()){let e=u.getNode().updateChild(n,r);l=c.updateFullNode(u.getNode(),e,null)}else{let e=tf(n);if(!u.isCompleteForPath(n)&&tg(n)>1)return t;let i=tm(n),s=u.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?c.updatePriority(u.getNode(),s):c.updateChild(u.getNode(),e,s,i,rk,null)}let h=nQ(t,l,u.isFullyInitialized()||tw(n),c.filtersNodes()),d=new rR(i,h,s);return rD(e,h,n,i,d,a)}function rM(e,t,n,r,i,s,o){let a,l;let u=t.eventCache,c=new rR(i,t,s);if(tw(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),a=nK(t,l,!0,e.filter.filtersNodes());else{let i=tf(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),a=nK(t,l,u.isFullyInitialized(),u.isFiltered());else{let s;let l=tm(n),h=u.getNode().getImmediateChild(i);if(tw(l))s=r;else{let e=c.getCompleteChild(i);s=null!=e?".priority"===ty(l)&&e.getChild(tb(l)).isEmpty()?e:e.updateChild(l,r):ne.EMPTY_NODE}a=h.equals(s)?t:nK(t,e.filter.updateChild(u.getNode(),i,s,l,c,o),u.isFullyInitialized(),e.filter.filtersNodes())}}return a}function rL(e,t){return e.eventCache.isCompleteForChild(t)}function rF(e,t,n,r,i,s,o){let a=t;return r.foreach((r,l)=>{let u=tS(n,r);rL(t,tf(u))&&(a=rM(e,a,u,l,i,s,o))}),r.foreach((r,l)=>{let u=tS(n,r);rL(t,tf(u))||(a=rM(e,a,u,l,i,s,o))}),a}function rB(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function rj(e,t,n,r,i,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let u=t;l=tw(n)?r:new nZ(null).setTree(n,r);let c=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(c.hasChild(n)){let l=rB(e,t.serverCache.getNode().getImmediateChild(n),r);u=rP(e,u,new td(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!c.hasChild(n)&&!l){let l=rB(e,t.serverCache.getNode().getImmediateChild(n),r);u=rP(e,u,new td(n),l,i,s,o,a)}}),u}function rU(e,t,n,r,i,s,o){if(null!=rb(i,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value){if(tw(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return rP(e,t,n,l.getNode().getChild(n),i,s,a,o);if(!tw(n))return t;{let r=new nZ(null);return l.getNode().forEachChild(tW,(e,t)=>{r=r.set(new td(e),t)}),rj(e,t,n,r,i,s,a,o)}}{let u=new nZ(null);return r.foreach((e,t)=>{let r=tS(n,e);l.isCompleteForPath(r)&&(u=u.set(e,l.getNode().getChild(r)))}),rj(e,t,n,u,i,s,a,o)}}function rq(e,t,n,r,i){let s=t.serverCache;return rD(e,nQ(t,s.getNode(),s.isFullyInitialized()||tw(n),s.isFiltered()),n,r,rk,i)}function rV(e,t,n,r,i,s){let o;if(null!=rb(r,n))return t;{let a;let l=new rR(r,t,i),u=t.eventCache.getNode();if(tw(n)||".priority"===tf(n)){let n;if(t.serverCache.isFullyInitialized())n=ry(r,nJ(t));else{let e=t.serverCache.getNode();(0,g.hu)(e instanceof ne,"serverChildren would be complete if leaf node"),n=rv(r,e)}a=e.filter.updateFullNode(u,n,s)}else{let i=tf(n),c=rw(r,i,t.serverCache);null==c&&t.serverCache.isCompleteForChild(i)&&(c=u.getImmediateChild(i)),(a=null!=c?e.filter.updateChild(u,i,c,tm(n),l,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(u,i,ne.EMPTY_NODE,tm(n),l,s):u).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=ry(r,nJ(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=rb(r,tp()),nK(t,a,o,e.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rz{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,r=new np(n.getIndex()),i=ny(n);this.processor_=rO(i);let s=t.serverCache,o=t.eventCache,a=r.updateFullNode(ne.EMPTY_NODE,s.getNode(),null),l=i.updateFullNode(ne.EMPTY_NODE,o.getNode(),null),u=new nq(a,s.isFullyInitialized(),r.filtersNodes()),c=new nq(l,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=nH(c,u),this.eventGenerator_=new nV(this.query_)}get query(){return this.query_}}function rW(e){return e.viewCache_.serverCache.getNode()}function r$(e){return nY(e.viewCache_)}function rG(e,t){let n=nJ(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!tw(t)&&!n.getImmediateChild(tf(t)).isEmpty())?n.getChild(t):null}function rH(e){return 0===e.eventRegistrations_.length}function rK(e,t){e.eventRegistrations_.push(t)}function rQ(e,t,n){let r=[];if(n){(0,g.hu)(null==t,"A cancel should cancel all event registrations.");let i=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){let i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function rY(e,t,n,r){t.type===p.MERGE&&null!==t.source.queryId&&((0,g.hu)(nJ(e.viewCache_),"We should always have a full cache before handling merges"),(0,g.hu)(nY(e.viewCache_),"Missing event cache, even though we have a server cache"));let i=e.viewCache_,s=rA(e.processor_,i,t,n,r);return rN(e.processor_,s.viewCache),(0,g.hu)(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,rX(e,s.changes,s.viewCache.eventCache.getNode(),null)}function rJ(e,t){let n=e.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(t4,(e,t)=>{r.push(nu(e,t))}),n.isFullyInitialized()&&r.push(nl(n.getNode())),rX(e,r,n.getNode(),t)}function rX(e,t,n,r){let i=r?[r]:e.eventRegistrations_;return nz(e.eventGenerator_,t,n,i)}class rZ{constructor(){this.views=new Map}}function r0(e){(0,g.hu)(!h,"__referenceConstructor has already been defined"),h=e}function r1(){return(0,g.hu)(h,"Reference.ts has not been loaded"),h}function r2(e){return 0===e.views.size}function r3(e,t,n,r){let i=t.source.queryId;if(null!==i){let s=e.views.get(i);return(0,g.hu)(null!=s,"SyncTree gave us an op for an invalid query."),rY(s,t,n,r)}{let i=[];for(let s of e.views.values())i=i.concat(rY(s,t,n,r));return i}}function r4(e,t,n,r,i){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=ry(n,i?r:null),s=!1;return e?s=!0:(e=r instanceof ne?rv(n,r):ne.EMPTY_NODE,s=!1),new rz(t,nH(new nq(e,s,!1),new nq(r,i,!1)))}return o}function r6(e,t,n,r,i,s){let o=r4(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),rK(o,n),rJ(o,n)}function r9(e,t,n,r){let i=t._queryIdentifier,s=[],o=[],a=it(e);if("default"===i)for(let[t,i]of e.views.entries())o=o.concat(rQ(i,n,r)),rH(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||s.push(i.query));else{let t=e.views.get(i);t&&(o=o.concat(rQ(t,n,r)),rH(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!it(e)&&s.push(new(r1())(t._repo,t._path)),{removed:s,events:o}}function r5(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function r7(e,t){let n=null;for(let r of e.views.values())n=n||rG(r,t);return n}function r8(e,t){if(t._queryParams.loadsAllData())return ir(e);{let n=t._queryIdentifier;return e.views.get(n)}}function ie(e,t){return null!=r8(e,t)}function it(e){return null!=ir(e)}function ir(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}function ii(e){(0,g.hu)(!d,"__referenceConstructor has already been defined"),d=e}function is(){return(0,g.hu)(d,"Reference.ts has not been loaded"),d}let io=1;class ia{constructor(e){this.listenProvider_=e,this.syncPointTree_=new nZ(null),this.pendingWriteTree_=rm(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function il(e,t,n,r,i){return(rn(e.pendingWriteTree_,t,n,r,i),i)?iS(e,new nj(nP(),t,n)):[]}function iu(e,t,n=!1){let r=ri(e.pendingWriteTree_,t);if(!rs(e.pendingWriteTree_,t))return[];{let t=new nZ(null);return null!=r.snap?t=t.set(tp(),!0):er(r.children,e=>{t=t.set(new td(e),!0)}),iS(e,new nF(r.path,t,n))}}function ic(e,t,n){return iS(e,new nj(nM(),t,n))}function ih(e,t,n){let r=nZ.fromObject(n);return iS(e,new nU(nM(),t,r))}function id(e,t){return iS(e,new nB(nM(),t))}function ip(e,t,n){let r=ik(e,n);if(!r)return[];{let n=iR(r),i=n.path,s=n.queryId,o=tT(i,t);return iO(e,i,new nB(nL(s),o))}}function ig(e,t,n,r,i=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||ie(o,t))){let l=r9(o,t,n,r);r2(o)&&(e.syncPointTree_=e.syncPointTree_.remove(s));let u=l.removed;if(a=l.events,!i){let n=-1!==u.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>it(t));if(n&&!i){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=iN(t);for(let t=0;t<n.length;++t){let r=n[t],i=r.query,s=iE(e,r);e.listenProvider_.startListening(iA(i),iC(e,i),s.hashFn,s.onComplete)}}}if(!i&&u.length>0&&!r){if(n){let n=null;e.listenProvider_.stopListening(iA(t),n)}else u.forEach(t=>{let n=e.queryToTagMap.get(iI(t));e.listenProvider_.stopListening(iA(t),n)})}}ix(e,u)}return a}function im(e,t,n,r){let i=ik(e,r);if(null==i)return[];{let r=iR(i),s=r.path,o=r.queryId,a=tT(s,t);return iO(e,s,new nj(nL(o),a,n))}}function iy(e,t,n,r){let i=ik(e,r);if(!i)return[];{let r=iR(i),s=r.path,o=r.queryId,a=tT(s,t),l=nZ.fromObject(n);return iO(e,s,new nU(nL(o),a,l))}}function iv(e,t,n,r=!1){let i;let s=t._path,o=null,a=!1;e.syncPointTree_.foreachOnPath(s,(e,t)=>{let n=tT(e,s);o=o||r7(t,n),a=a||it(t)});let l=e.syncPointTree_.get(s);l?(a=a||it(l),o=o||r7(l,tp())):(l=new rZ,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=o?i=!0:(i=!1,o=ne.EMPTY_NODE,e.syncPointTree_.subtree(s).foreachChild((e,t)=>{let n=r7(t,tp());n&&(o=o.updateImmediateChild(e,n))}));let u=ie(l,t);if(!u&&!t._queryParams.loadsAllData()){let n=iI(t);(0,g.hu)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let r=iD();e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let c=r6(l,t,n,rt(e.pendingWriteTree_,s),o,i);if(!u&&!a&&!r){let n=r8(l,t);c=c.concat(iP(e,t,n))}return c}function i_(e,t,n){let r=!0,i=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,(e,n)=>{let r=r7(n,tT(e,t));if(r)return r});return rc(i,t,s,n,r)}function ib(e,t){let n=t._path,r=null;e.syncPointTree_.foreachOnPath(n,(e,t)=>{let i=tT(e,n);r=r||r7(t,i)});let i=e.syncPointTree_.get(n);i?r=r||r7(i,tp()):(i=new rZ,e.syncPointTree_=e.syncPointTree_.set(n,i));let s=null!=r,o=s?new nq(r,!0,!1):null,a=rt(e.pendingWriteTree_,t._path);return r$(r4(i,t,a,s?o.getNode():ne.EMPTY_NODE,s))}function iS(e,t){return iw(t,e.syncPointTree_,null,rt(e.pendingWriteTree_,tp()))}function iw(e,t,n,r){if(tw(e.path))return iT(e,t,n,r);{let i=t.get(tp());null==n&&null!=i&&(n=r7(i,tp()));let s=[],o=tf(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){let e=n?n.getImmediateChild(o):null,t=rT(r,o);s=s.concat(iw(a,l,e,t))}return i&&(s=s.concat(r3(i,e,r,n))),s}}function iT(e,t,n,r){let i=t.get(tp());null==n&&null!=i&&(n=r7(i,tp()));let s=[];return t.children.inorderTraversal((t,i)=>{let o=n?n.getImmediateChild(t):null,a=rT(r,t),l=e.operationForChild(t);l&&(s=s.concat(iT(l,i,o,a)))}),i&&(s=s.concat(r3(i,e,r,n))),s}function iE(e,t){let n=t.query,r=iC(e,n);return{hashFn:()=>(rW(t)||ne.EMPTY_NODE).hash(),onComplete:t=>{if("ok"===t)return r?ip(e,n._path,r):id(e,n._path);{let r=ea(t,n);return ig(e,n,null,r)}}}}function iC(e,t){let n=iI(t);return e.queryToTagMap.get(n)}function iI(e){return e._path.toString()+"$"+e._queryIdentifier}function ik(e,t){return e.tagToQueryMap.get(t)}function iR(e){let t=e.indexOf("$");return(0,g.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new td(e.substr(0,t))}}function iO(e,t,n){let r=e.syncPointTree_.get(t);return(0,g.hu)(r,"Missing sync point for query tag that we're tracking"),r3(r,n,rt(e.pendingWriteTree_,t),null)}function iN(e){return e.fold((e,t,n)=>{if(t&&it(t))return[ir(t)];{let e=[];return t&&(e=r5(t)),er(n,(t,n)=>{e=e.concat(n)}),e}})}function iA(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(is())(e._repo,e._path):e}function ix(e,t){for(let n=0;n<t.length;++n){let r=t[n];if(!r._queryParams.loadsAllData()){let t=iI(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}function iD(){return io++}function iP(e,t,n){let r=t._path,i=iC(e,t),s=iE(e,n),o=e.listenProvider_.startListening(iA(t),i,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(r);if(i)(0,g.hu)(!it(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!tw(e)&&t&&it(t))return[ir(t).query];{let e=[];return t&&(e=e.concat(r5(t).map(e=>e.query))),er(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let r=t[n];e.listenProvider_.stopListening(iA(r),iC(e,r))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iM{constructor(e){this.node_=e}getImmediateChild(e){return new iM(this.node_.getImmediateChild(e))}node(){return this.node_}}class iL{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=tS(this.path_,e);return new iL(this.syncTree_,t)}node(){return i_(this.syncTree_,this.path_)}}let iF=function(e){return(e=e||{}).timestamp=e.timestamp||new Date().getTime(),e},iB=function(e,t,n){return e&&"object"==typeof e?((0,g.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?ij(e[".sv"],t,n):"object"==typeof e[".sv"]?iU(e[".sv"],t):void(0,g.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},ij=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,g.hu)(!1,"Unexpected server value: "+e)},iU=function(e,t,n){e.hasOwnProperty("increment")||(0,g.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let r=e.increment;"number"!=typeof r&&(0,g.hu)(!1,"Unexpected increment value: "+r);let i=t.node();if((0,g.hu)(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let s=i.getValue();return"number"!=typeof s?r:s+r},iq=function(e,t,n,r){return iz(t,new iL(n,e),r)},iV=function(e,t,n){return iz(e,new iM(t),n)};function iz(e,t,n){let r;let i=iB(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(e.isLeafNode()){let r=e,s=iB(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new t0(s,ni(i)):e}{let s=e;return r=s,i!==s.getPriority().val()&&(r=r.updatePriority(new t0(i))),s.forEachChild(t4,(e,i)=>{let s=iz(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iW{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function i$(e,t){let n=t instanceof td?t:new td(t),r=e,i=tf(n);for(;null!==i;){let e=(0,g.DV)(r.node.children,i)||{children:{},childCount:0};r=new iW(i,r,e),i=tf(n=tm(n))}return r}function iG(e){return e.node.value}function iH(e,t){e.node.value=t,i0(e)}function iK(e){return e.node.childCount>0}function iQ(e){return void 0===iG(e)&&!iK(e)}function iY(e,t){er(e.node.children,(n,r)=>{t(new iW(n,e,r))})}function iJ(e,t,n,r){n&&!r&&t(e),iY(e,e=>{iJ(e,t,!0,r)}),n&&r&&t(e)}function iX(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}return!1}function iZ(e){return new td(null===e.parent?e.name:iZ(e.parent)+"/"+e.name)}function i0(e){null!==e.parent&&i1(e.parent,e.name,e)}function i1(e,t,n){let r=iQ(n),i=(0,g.r3)(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,i0(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,i0(e))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let i2=/[\[\].#$\/\u0000-\u001F\u007F]/,i3=/[\[\].#$\u0000-\u001F\u007F]/,i4=10485760,i6=function(e){return"string"==typeof e&&0!==e.length&&!i2.test(e)},i9=function(e){return"string"==typeof e&&0!==e.length&&!i3.test(e)},i5=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),i9(e)},i7=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!K(e)||e&&"object"==typeof e&&(0,g.r3)(e,".sv")},i8=function(e,t,n,r){r&&void 0===t||se((0,g.gK)(e,"value"),t,n)},se=function(e,t,n){let r=n instanceof td?new tk(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+tA(r));if("function"==typeof t)throw Error(e+"contains a function "+tA(r)+" with contents = "+t.toString());if(K(t))throw Error(e+"contains "+t.toString()+" "+tA(r));if("string"==typeof t&&t.length>i4/3&&(0,g.ug)(t)>i4)throw Error(e+"contains a string greater than "+i4+" utf8 bytes "+tA(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(er(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!i6(t)))throw Error(e+" contains an invalid key ("+t+") "+tA(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');tR(r,t),se(e,s,r),tO(r)}),n&&i)throw Error(e+' contains ".value" child '+tA(r)+" in addition to actual children.")}},st=function(e,t){let n,r;for(n=0;n<t.length;n++){let i=t_(r=t[n]);for(let t=0;t<i.length;t++)if(".priority"===i[t]&&t===i.length-1);else if(!i6(i[t]))throw Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(tE);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&tI(i,r))throw Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},sn=function(e,t,n,r){if((!r||void 0!==n)&&!i9(n))throw Error((0,g.gK)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},sr=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),sn(e,t,n,r)},si=function(e,t){if(".info"===tf(t))throw Error(e+" failed = Can't modify data under /.info/")},ss=function(e,t){let n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!i6(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!i5(n))throw Error((0,g.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function sa(e,t){let n=null;for(let r=0;r<t.length;r++){let i=t[r],s=i.getPath();null===n||tC(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function sl(e,t,n){sa(e,n),sc(e,e=>tC(e,t))}function su(e,t,n){sa(e,n),sc(e,e=>tI(e,t)||tI(t,e))}function sc(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){let i=e.eventLists_[r];i&&(t(i.path)?(sh(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}function sh(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let r=n.getEventRunner();j&&V("event: "+n.toString()),ed(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sd="repo_interrupt",sp=25;class sf{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new so,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=nE(),this.transactionQueueTree_=new iW,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function sg(e,t,n){if(e.stats_=eS(e.repoInfo_),e.forceRestClient_||ep())e.server_=new nw(e.repoInfo_,(t,n,r,i)=>{sv(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>s_(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,g.Wl)(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new tU(e.repoInfo_,t,(t,n,r,i)=>{sv(e,t,n,r,i)},t=>{s_(e,t)},t=>{sb(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=ew(e.repoInfo_,()=>new nD(e.stats_,e.server_)),e.infoData_=new nT,e.infoSyncTree_=new ia({startListening:(t,n,r,i)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=ic(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),sS(e,"connected",!1),e.serverSyncTree_=new ia({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{let s=i(n,r);su(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function sm(e){let t=e.infoData_.getNode(new td(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function sy(e){return iF({timestamp:sm(e)})}function sv(e,t,n,r,i){e.dataUpdateCount++;let s=new td(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i){if(r){let t=(0,g.UI)(n,e=>ni(e));o=iy(e.serverSyncTree_,s,t,i)}else{let t=ni(n);o=im(e.serverSyncTree_,s,t,i)}}else if(r){let t=(0,g.UI)(n,e=>ni(e));o=ih(e.serverSyncTree_,s,t)}else{let t=ni(n);o=ic(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=sP(e,s)),su(e.eventQueue_,a,o)}function s_(e,t){sS(e,"connected",t),!1===t&&sC(e)}function sb(e,t){er(t,(t,n)=>{sS(e,t,n)})}function sS(e,t,n){let r=new td("/.info/"+t),i=ni(n);e.infoData_.updateSnapshot(r,i);let s=ic(e.infoSyncTree_,r,i);su(e.eventQueue_,r,s)}function sw(e){return e.nextWriteId_++}function sT(e,t,n){let r=ib(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then(r=>{let i;let s=ni(r).withIndex(t._queryParams.getIndex());if(iv(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())i=ic(e.serverSyncTree_,t._path,s);else{let n=iC(e.serverSyncTree_,t);i=im(e.serverSyncTree_,t._path,s,n)}return su(e.eventQueue_,t._path,i),ig(e.serverSyncTree_,t,n,null,!0),s},n=>(sO(e,"get for query "+(0,g.Wl)(t)+" failed: "+n),Promise.reject(Error(n))))}function sE(e,t,n,r,i){sO(e,"set",{path:t.toString(),value:n,priority:r});let s=sy(e),o=ni(n,r),a=iV(o,i_(e.serverSyncTree_,t),s),l=sw(e),u=il(e.serverSyncTree_,t,a,l,!0);sa(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),(n,r)=>{let s="ok"===n;s||G("set at "+t+" failed: "+n);let o=iu(e.serverSyncTree_,l,!s);su(e.eventQueue_,t,o),sN(e,i,n,r)});let c=sU(e,t);sP(e,c),su(e.eventQueue_,c,[])}function sC(e){sO(e,"onDisconnectEvents");let t=sy(e),n=nE();nk(e.onDisconnect_,tp(),(r,i)=>{let s=iq(r,i,e.serverSyncTree_,t);nC(n,r,s)});let r=[];nk(n,tp(),(t,n)=>{r=r.concat(ic(e.serverSyncTree_,t,n));let i=sU(e,t);sP(e,i)}),e.onDisconnect_=nE(),su(e.eventQueue_,tp(),r)}function sI(e,t,n){let r;r=".info"===tf(t._path)?iv(e.infoSyncTree_,t,n):iv(e.serverSyncTree_,t,n),sl(e.eventQueue_,t._path,r)}function sk(e,t,n){let r;r=".info"===tf(t._path)?ig(e.infoSyncTree_,t,n):ig(e.serverSyncTree_,t,n),sl(e.eventQueue_,t._path,r)}function sR(e){e.persistentConnection_&&e.persistentConnection_.interrupt(sd)}function sO(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),V(n,...t)}function sN(e,t,n,r){t&&ed(()=>{if("ok"===n)t(null);else{let e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);let s=Error(i);s.code=e,t(s)}})}function sA(e,t,n){return i_(e.serverSyncTree_,t,n)||ne.EMPTY_NODE}function sx(e,t=e.transactionQueueTree_){if(t||sj(e,t),iG(t)){let n=sF(e,t);(0,g.hu)(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&sD(e,iZ(t),n)}else iK(t)&&iY(t,t=>{sx(e,t)})}function sD(e,t,n){let r=sA(e,t,n.map(e=>e.currentWriteId)),i=r,s=r.hash();for(let e=0;e<n.length;e++){let r=n[e];(0,g.hu)(0===r.status,"tryToSendTransactionQueue_: items in queue should all be run."),r.status=1,r.retryCount++;let s=tT(t,r.path);i=i.updateChild(s,r.currentOutputSnapshotRaw)}let o=i.val(!0),a=t;e.server_.put(a.toString(),o,r=>{sO(e,"transaction put response",{path:a.toString(),status:r});let i=[];if("ok"===r){let r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(iu(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();sj(e,i$(e.transactionQueueTree_,t)),sx(e,e.transactionQueueTree_),su(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)ed(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{G("transaction at "+a.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}sP(e,t)}},s)}function sP(e,t){let n=sL(e,t),r=iZ(n),i=sF(e,n);return sM(e,i,r),r}function sM(e,t,n){if(0===t.length)return;let r=[],i=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=tT(n,a.path),u=!1,c;if((0,g.hu)(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)u=!0,c=a.abortReason,i=i.concat(iu(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status){if(a.retryCount>=sp)u=!0,c="maxretry",i=i.concat(iu(e.serverSyncTree_,a.currentWriteId,!0));else{let n=sA(e,a.path,s);a.currentInputSnapshot=n;let r=t[o].update(n.val());if(void 0!==r){se("transaction failed: Data returned ",r,a.path);let t=ni(r);"object"==typeof r&&null!=r&&(0,g.r3)(r,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=iV(t,n,sy(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=sw(e),s.splice(s.indexOf(o),1),i=(i=i.concat(il(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally))).concat(iu(e.serverSyncTree_,o,!0))}else u=!0,c="nodata",i=i.concat(iu(e.serverSyncTree_,a.currentWriteId,!0))}}su(e.eventQueue_,n,i),i=[],u&&(t[o].status=2,function(e){setTimeout(e,Math.floor(0))}(t[o].unwatcher),t[o].onComplete&&("nodata"===c?r.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):r.push(()=>t[o].onComplete(Error(c),!1,null))))}sj(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)ed(r[e]);sx(e,e.transactionQueueTree_)}function sL(e,t){let n;let r=e.transactionQueueTree_;for(n=tf(t);null!==n&&void 0===iG(r);)r=i$(r,n),n=tf(t=tm(t));return r}function sF(e,t){let n=[];return sB(e,t,n),n.sort((e,t)=>e.order-t.order),n}function sB(e,t,n){let r=iG(t);if(r)for(let e=0;e<r.length;e++)n.push(r[e]);iY(t,t=>{sB(e,t,n)})}function sj(e,t){let n=iG(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,iH(t,n.length>0?n:void 0)}iY(t,t=>{sj(e,t)})}function sU(e,t){let n=iZ(sL(e,t)),r=i$(e.transactionQueueTree_,t);return iX(r,t=>{sq(e,t)}),sq(e,r),iJ(r,t=>{sq(e,t)}),n}function sq(e,t){let n=iG(t);if(n){let r=[],i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?((0,g.hu)(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):((0,g.hu)(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(iu(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?iH(t,void 0):n.length=s+1,su(e.eventQueue_,iZ(t),i);for(let e=0;e<r.length;e++)ed(r[e])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sV(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}function sz(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):G(`Invalid query segment '${n}' in query '${e}'`)}return t}let sW=function(e,t){let n=s$(e),r=n.namespace;"firebase.com"===n.domain&&$(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||$("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||H();let i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new eg(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new td(n.pathString)}},s$=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let u=e.indexOf("//");u>=0&&(a=e.substring(0,u-1),e=e.substring(u+2));let c=e.indexOf("/");-1===c&&(c=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(c,h)),c<h&&(i=sV(e.substring(c,h)));let d=sz(e.substring(Math.min(e.length,h)));(u=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(u+1),10)):u=t.length;let p=t.slice(0,u);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{let e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}},sG="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",sH=function(){let e=0,t=[];return function(n){let r;let i=n===e;e=n;let s=Array(8);for(r=7;r>=0;r--)s[r]=sG.charAt(n%64),n=Math.floor(n/64);(0,g.hu)(0===n,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&63===t[r];r--)t[r]=0;t[r]++}else for(r=0;r<12;r++)t[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)o+=sG.charAt(t[r]);return(0,g.hu)(20===o.length,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sK{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,g.Wl)(this.snapshot.exportVal())}}class sQ{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sY{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,g.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sJ{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return tw(this._path)?null:ty(this._path)}get ref(){return new s0(this._repo,this._path)}get _queryIdentifier(){let e=et(nS(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return nS(this._queryParams)}isEqual(e){if(!((e=(0,g.m9)(e))instanceof sJ))return!1;let t=this._repo===e._repo,n=tC(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+tv(this._path)}}function sX(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===tW){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==Y)throw Error(r);if("string"!=typeof t)throw Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==J)throw Error(r);if("string"!=typeof n)throw Error(i)}}else if(e.getIndex()===t4){if(null!=t&&!i7(t)||null!=n&&!i7(n))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,g.hu)(e.getIndex() instanceof ns||e.getIndex()===na,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function sZ(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class s0 extends sJ{constructor(e,t){super(e,t,new nm,!1)}get parent(){let e=tb(this._path);return null===e?null:new s0(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class s1{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new td(e),n=s3(this.ref,e);return new s1(this._node.getChild(t),n,t4)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new s1(n,s3(this.ref,t),t4)))}hasChild(e){let t=new td(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function s2(e,t){return(e=(0,g.m9)(e))._checkNotDeleted("ref"),void 0!==t?s3(e._root,t):e._root}function s3(e,t){return null===tf((e=(0,g.m9)(e))._path)?sr("child","path",t,!1):sn("child","path",t,!1),new s0(e._repo,tS(e._path,t))}function s4(e,t){let n;si("push",(e=(0,g.m9)(e))._path),i8("push",t,e._path,!0);let r=sH(sm(e._repo)),i=s3(e,r),s=s3(e,r);return n=null!=t?s9(s,t).then(()=>s):Promise.resolve(s),i.then=n.then.bind(n),i.catch=n.then.bind(n,void 0),i}function s6(e){return si("remove",e._path),s9(e,null)}function s9(e,t){si("set",(e=(0,g.m9)(e))._path),i8("set",t,e._path,!1);let n=new g.BH;return sE(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function s5(e){e=(0,g.m9)(e);let t=new s7(new sY(()=>{}));return sT(e._repo,e,t).then(t=>new s1(t,new s0(e._repo,e._path),e._queryParams.getIndex()))}class s7{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new sK("value",this,new s1(e.snapshotNode,new s0(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new sQ(this,e,t):null}matches(e){return e instanceof s7&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class s8{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new sQ(this,e,t):null}createEvent(e,t){(0,g.hu)(null!=e.childName,"Child events should have a childName.");let n=s3(new s0(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new sK(e.type,this,new s1(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof s8&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function oe(e,t,n,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){let t=n,r=(n,r)=>{sk(e._repo,e,a),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}let o=new sY(n,s||void 0),a="value"===t?new s7(o):new s8(t,o);return sI(e._repo,e,a),()=>sk(e._repo,e,a)}function ot(e,t,n,r){return oe(e,"value",t,n,r)}function on(e,t,n,r){return oe(e,"child_added",t,n,r)}function or(e,t,n,r){return oe(e,"child_changed",t,n,r)}function oi(e,t,n,r){return oe(e,"child_removed",t,n,r)}class os{}r0(s0),ii(s0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oo="FIREBASE_DATABASE_EMULATOR_HOST",oa={},ol=!1;function ou(e,t,n,r){e.repoInfo_=new eg(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),r&&(e.authTokenProvider_=r)}function oc(e,t,n,r,i){let s,o,a=r||e.options.databaseURL;void 0===a&&(e.options.projectId||$("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),V("Using default host for project ",e.options.projectId),a=`${e.options.projectId}-default-rtdb.firebaseio.com`);let l=sW(a,i),u=l.repoInfo;"undefined"!=typeof process&&process.env&&(s=process.env[oo]),s?(o=!0,u=(l=sW(a=`http://${s}?ns=${u.namespace}`,i)).repoInfo):o=!l.repoInfo.secure;let c=i&&o?new eP(eP.OWNER):new eD(e.name,e.options,t);return ss("Invalid Firebase Database URL",l),tw(l.path)||$("Database URL must point to the root of a Firebase Database (not including a child path)."),new op(od(u,e,c,new ex(e.name,n)),e)}function oh(e,t){let n=oa[t];n&&n[e.key]===e||$(`Database ${t}(${e.repoInfo_}) has already been deleted.`),sR(e),delete n[e.key]}function od(e,t,n,r){let i=oa[t.name];i||(i={},oa[t.name]=i);let s=i[e.toURLString()];return s&&$("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new sf(e,ol,n,r),i[e.toURLString()]=s,s}class op{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(sg(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new s0(this._repo,tp())),this._rootInternal}_delete(){return null!==this._rootInternal&&(oh(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&$("Cannot call "+e+" on a deleted database.")}}function of(e=(0,y.getApp)(),t){let n=(0,y._getProvider)(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){let e=(0,g.P0)("database");e&&og(n,...e)}return n}function og(e,t,n,r={}){let i;(e=(0,g.m9)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&$("Cannot call useEmulator() after instance has already been initialized.");let s=e._repoInternal;s.repoInfo_.nodeAdmin?(r.mockUserToken&&$('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new eP(eP.OWNER)):r.mockUserToken&&(i=new eP("string"==typeof r.mockUserToken?r.mockUserToken:(0,g.Sg)(r.mockUserToken,e.app.options.projectId))),ou(s,t,n,i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function om(e){eE(y.SDK_VERSION),(0,y._registerComponent)(new v.wA("database",(e,{instanceIdentifier:t})=>oc(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,y.registerVersion)(eN,eA,e),(0,y.registerVersion)(eN,eA,"esm2017")}tU.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},tU.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */eR(f.Client),om("node")},98495:(e,t,n)=>{"use strict";n.d(t,{ET:()=>r.ET,IO:()=>r.IO,JU:()=>r.JU,PL:()=>r.PL,QT:()=>r.QT,Xo:()=>r.Xo,ad:()=>r.ad,ar:()=>r.ar,b9:()=>r.b9,e0:()=>r.e0,hJ:()=>r.hJ,oe:()=>r.oe,or:()=>r.or,pl:()=>r.pl,qs:()=>r.qs,r7:()=>r.r7,xD:()=>r.xD});var r=n(93219)},38883:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},53242:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"FileDescriptorSet":{"fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}}},"FileDescriptorProto":{"fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10,"options":{"packed":false}},"weakDependency":{"rule":"repeated","type":"int32","id":11,"options":{"packed":false}},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12}}},"DescriptorProto":{"fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"FieldDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REQUIRED":2,"LABEL_REPEATED":3}}}},"OneofDescriptorProto":{"fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3}}},"EnumValueDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[38,38]],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[8,8]]},"FieldOptions":{"fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}}}},"OneofOptions":{"fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumValueOptions":{"fields":{"deprecated":{"type":"bool","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"UninterpretedOption":{"fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"SourceCodeInfo":{"fields":{"location":{"rule":"repeated","type":"Location","id":1}},"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"span":{"rule":"repeated","type":"int32","id":2},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4}}}}}}}}}}}')},88681:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},58702:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},81513:e=>{"use strict";e.exports={i8:"1.7.3"}},56541:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},89987:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"FileDescriptorSet":{"fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}}},"FileDescriptorProto":{"fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10,"options":{"packed":false}},"weakDependency":{"rule":"repeated","type":"int32","id":11,"options":{"packed":false}},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12}}},"DescriptorProto":{"fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"FieldDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REQUIRED":2,"LABEL_REPEATED":3}}}},"OneofDescriptorProto":{"fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3}}},"EnumValueDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[38,38]],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[8,8]]},"FieldOptions":{"fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}}}},"OneofOptions":{"fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumValueOptions":{"fields":{"deprecated":{"type":"bool","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"UninterpretedOption":{"fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"SourceCodeInfo":{"fields":{"location":{"rule":"repeated","type":"Location","id":1}},"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"span":{"rule":"repeated","type":"int32","id":2},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4}}}}}}}}}}}')},57674:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},73795:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')}};